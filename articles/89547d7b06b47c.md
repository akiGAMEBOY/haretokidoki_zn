---
title: "æŒ‡å®šã•ã‚ŒãŸZIPå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£å‡ã™ã‚‹Function"
emoji: "ðŸ¡"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: false
---
æŒ‡å®šã—ãŸZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£å‡ã€‚

```powershell:
function Extract-ZipFile {
    param(
        [System.String]$ZipPath,
        [System.String]$DestPath = ''
    )

    # ZIPãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
    if (-Not(Test-Path -Path $ZipPath)) {
        $multiLine = "æŒ‡å®šã•ã‚ŒãŸZIPãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚`n" + `
                    "ZIPãƒ•ã‚¡ã‚¤ãƒ«[$ZipPath]`n"
        Write-Error $multiLine
        return
    }

    # å±•é–‹å…ˆãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆ
    if ($DestPath -eq '') {
        $DestPath = "$((Get-Item $ZipPath).DirectoryName)\$((Get-Item $ZipPath).BaseName)"
    }

    # å±•é–‹å…ˆã®æœ€å¾Œã«ã€Œ\ã€ãŒã‚ã‚‹å ´åˆã«é™¤åŽ»
    $DestPath = $DestPath.TrimEnd('\')

    # å±•é–‹å…ˆã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆã¯ä¸­æ–­
    $destItems = (Get-ChildItem -Path $DestPath -Recurse -File)
    if ($destItems.Count -gt 0) {
        $multiLine = "å±•é–‹å…ˆã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼é…ä¸‹ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ãŸã‚ã€å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚`n" + `
                      "å±•é–‹å…ˆ [$Destpath]`n"
        Write-Warning $multiLine
        return
    }

    # å±•é–‹å…ˆã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆ
    if (-Not(Test-Path -Path $DestPath)) {
        try {
            (New-Item -Path $DestPath -ItemType Directory) > $null
        }
        catch {
            $multiLien = "å±•é–‹å…ˆã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ä½œæˆæ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ`n" + `
                         "å±•é–‹å…ˆ [$Destpath]`n"
            Write-Error $multiLine
            return
        }
    }

    # å±•é–‹å…ˆã«ZIPå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
    $copyToZip = "$Destpath\$((Get-Item $ZipPath).BaseName).zip"
    try {
        Copy-Item $ZipPath $copyToZip
    }
    catch {
        $multiLine = "å±•é–‹å…ˆã¸ã®ã‚³ãƒ”ãƒ¼å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚`n" + `
                     "ZIPãƒ•ã‚¡ã‚¤ãƒ« [$ZipPath], å±•é–‹å…ˆ[$Destpath]`n"
        Write-Error $multiLine
    }

    # ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’å±•é–‹
    try {ã€€
        Expand-Archive -Path $copyToZip -DestinationPath $DestPath
    }
    catch {
        $multiLine = "ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’å±•é–‹æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚`n" + `
                     "ZIPãƒ•ã‚¡ã‚¤ãƒ« [$copyToZip], å±•é–‹å…ˆ [$Destpath]`n"
        Write-Error $multiLine
        return
    }

    $multiLine = "ZIPãƒ•ã‚¡ã‚¤ãƒ«ãŒå±•é–‹ã•ã‚Œã¾ã—ãŸã€‚`n" + `
                 "ZIPãƒ•ã‚¡ã‚¤ãƒ« [$ZipPath] -> å±•é–‹å…ˆ [$DestPath]`n"
    Write-Output $multiLine 
}
```

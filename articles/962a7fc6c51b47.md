---
title: "æ–‡å­—ã‚³ãƒ¼ãƒ‰ ãŠã‚ˆã³ BOMä»˜ã ã‚’åˆ¤å®šã™ã‚‹è‡ªä½œFunction"
emoji: "ğŸ’¬"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: false
---
```powershell
# æ–‡å­—ã‚³ãƒ¼ãƒ‰ã®åˆ¤å®š
Function Get-Encoding {
	param (
		[System.String]$target_file
	)
	$stream_reader = [System.IO.StreamReader] $target_file
	$profile_encoding = $stream_reader.CurrentEncoding
	$stream_reader.Close()

	Write-Host "EncodingName: [$($profile_encoding.EncodingName)]"
}

# BOMã®åˆ¤å®š
Function Check-BOMStatus {
	param (
		[System.String]$target_file
	)

    if (-Not (Test-Path $target_file)) {
        Write-Host 'å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚' -ForegroundColor Red
        return
    }

	# BOMã®ãƒã‚¤ãƒˆã‚·ãƒ¼ã‚±ãƒ³ã‚¹
    $UTF7_BOM1 = [System.Byte[]](0x2B,0x2F,0x76,0x38)
    $UTF7_BOM2 = [System.Byte[]](0x2B,0x2F,0x76,0x39)
    $UTF7_BOM3 = [System.Byte[]](0x2B,0x2F,0x76,0x2B)
    $UTF7_BOM4 = [System.Byte[]](0x2B,0x2F,0x76,0x2F)
	$UTF8_BOM = [System.Byte[]](0xEF,0xBB,0xBF)
	$UTF16BE_BOM = [System.Byte[]](0xFE,0xFF)
    $UTF16LE_BOM = [System.Byte[]](0xFF,0xFE)
	$UTF32BE_BOM = [System.Byte[]](0x00,0x00,0xFE,0xFF)
    $UTF32LE_BOM = [System.Byte[]](0xFF,0xFE,0x00,0x00)

	# å…ˆé ­è¡Œã‚’ãƒã‚¤ãƒˆã§èª­ã¿è¾¼ã¿å…ˆé ­ã‹ã‚‰3ãƒã‚¤ãƒˆåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
	[System.Byte[]]$first_4bytes = (Get-Content -Path $target_file -Encoding Byte -TotalCount 4)

	# å…ˆé ­ãƒã‚¤ãƒˆã§BOMä»˜ãã‹åˆ¤å®š
    # UTF-7
    if (($null -eq (Compare-Object $first_4bytes $UTF7_BOM1)) -Or
        ($null -eq (Compare-Object $first_4bytes $UTF7_BOM2)) -Or
        ($null -eq (Compare-Object $first_4bytes $UTF7_BOM3)) -Or
        ($null -eq (Compare-Object $first_4bytes $UTF7_BOM4))) {
        Write-Host "[$($target_file)] is UTF-7 BOM."
    }
	# UTF-8
	elseif ($null -eq (Compare-Object $first_4bytes[0..2] $UTF8_BOM)) {
	    Write-Host "[$($target_file)] is UTF-8 BOM."
    # UTF-16 BE
	} elseif ($null -eq (Compare-Object $first_4bytes[0..1] $UTF16BE_BOM)) {
	    Write-Host "[$($target_file)] is UTF-16 BE BOM."
    # UTF-16 LE
	} elseif ($null -eq (Compare-Object $first_4bytes[0..1] $UTF16LE_BOM)) {
	    Write-Host "[$($target_file)] is UTF-16 LE BOM."
	# UTF-32 BE
	} elseif ($null -eq (Compare-Object $first_4bytes $UTF32BE_BOM)) {
	    Write-Host "[$($target_file)] is UTF-32 BE BOM."
    # UTF-32 LE
	} elseif ($null -eq (Compare-Object $first_4bytes $UTF32LE_BOM)) {
	    Write-Host "[$($target_file)] is UTF-32 LE BOM."
	} else {
        Write-Host "[$($target_file)] isn't BOM."
    }
}
```

https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.utility/compare-object
https://chaipa.hateblo.jp/entry/20081124/1227514306
https://ja.wikipedia.org/wiki/ãƒã‚¤ãƒˆé †ãƒãƒ¼ã‚¯

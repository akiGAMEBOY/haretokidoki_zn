---
title: "VS Codeを使ってソースコードを比較する方法"
emoji: "🗂"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["vscode", "compare", "diff"]
published: false
---
## 概要
コードやファイルを比較する際は、今まで[WinMerge（ウィンマージ）](https://winmerge.org/?lang=ja)を使用していましたが、
Visual Studio Code（以下、VS Code）でも比較するコマンド、「 `compare` 」がありました。

簡易なファイル比較したい場合には、おすすめです。

## この記事のターゲット
- VS Codeユーザーの方
- VS Codeで簡単にファイルを比較したい方

## 環境
### VS Code バージョン
```powershell
PS C:\XXXX> code -v
1.82.0
8b617bd08fd9e3fc94d14adb8d358b56e3f72314
x64
PS C:\XXXX> 
```
- 参考情報
    https://www.curict.com/item/00/007bbb1.html

### VS Code 拡張機能
```powershell
PS C:\XXXX> code --list-extensions --show-versions
ms-azuretools.vscode-docker@1.26.0
MS-CEINTL.vscode-language-pack-ja@1.82.2023090609  
ms-kubernetes-tools.vscode-kubernetes-tools@1.3.13 
ms-vscode-remote.remote-containers@0.309.0
ms-vscode-remote.remote-ssh@0.106.1
ms-vscode-remote.remote-ssh-edit@0.86.0
ms-vscode-remote.remote-wsl@0.81.2
ms-vscode-remote.vscode-remote-extensionpack@0.24.0
ms-vscode.hexeditor@1.9.12
ms-vscode.powershell@2023.6.0
ms-vscode.remote-explorer@0.4.1
ms-vscode.remote-server@1.4.3
redhat.vscode-yaml@1.14.0
serkonda7.vscode-vba@0.9.1
spences10.vba-snippets@1.0.1
PS C:\XXXX>
```

## 対応方法
### 主にキーボード操作で比較する方法
コマンドパレット（ `Ctrl + Shift + P` or `F1` ）でVS Codeの比較機能を呼び出して使用します。
下記が詳細な手順です。

1. VS Codeでショートカットキーを入力しコマンドパレットを表示する
    コマンドパレットを表示するショートカットキー：`Ctrl + Shift + P` or `F1`
    ![](https://storage.googleapis.com/zenn-user-upload/4016979ba7b2-20230907.png)
    *画像：VS Codeでコマンドパレットを表示している状態*

1. コマンドパレットの入力欄で「 `compare` or `比較` 」を入力する
    - `compare`と入力した場合
        ![](https://storage.googleapis.com/zenn-user-upload/4bcd529d2477-20230907.png)
        *画像：コマンドパレットで「 `compare` 」を入力した状態*

    - `比較`と入力した場合
        ![](https://storage.googleapis.com/zenn-user-upload/e0e5c1bba7e0-20230907.png)
        *画像：コマンドパレットで「 `比較` 」を入力した状態*

1. 目的に合わせて比較するモードを選択する
    | No. | 比較モード | 用途 |
    | ---- | ---- | ---- |
    | 1 | ファイル: アクティブ ファイルを比較しています...<br>File: Compare Active File With... | 現在のアクティブファイル と 指定したファイル を比較する。 |
    | 2 | ファイル: クリップボードとアクティブ ファイルを比較<br>File: Compare Active File with Clipboard | `Ctrl + C`でクリップボードに保存された文字列 と 現在のアクティブファイル を比較する。 |
    | 3 | ファイル: 新しい無題のテキスト ファイルの比較<br>File: Compare New Untitled Text Files | 比較モードで新規テキストファイルを2つ開いた状態となる。 |
    | 4 | ファイル: 保存済みファイルと作業中のファイルを比較<br>File: Compare Active File with Saved | 未編集状態のアクティブファイル と 前回保存したアクティブファイル を比較する。 |
    | 5 | マージの場合: 現在の競合を比較<br>Merge Conflict: Compare Current Conflict | Git環境でブランチをマージした時にコンリクト（競合）が発生していないか比較する。 |
    
    今回は「 1番目 の アクティブファイル と 指定したファイル」で比較してみます。

1. 比較モードの一覧から「 ファイル: アクティブ ファイルを比較しています... 」を選択しEnter
1. 最近開いたもの一覧から“比較したいファイル”を選択
1. 比較モードが起動

### 補足事項：比較モード中に便利なショートカットキー
| ショートカットキー | 動作するアクション |
| ---- | ---- |
| “比較”モード中に `Alt + F5` | 次の差異 |
| “比較”モード中に `Shift + Alt + F5` | 前の差異 |
| “比較”モード中に `Ctrl + M` | “タブによるフォーカス移動”モードがオン<br>もう一度、入力するとモード解除。 |
| “比較”＋“タブによるフォーカス移動”モード中に `Tab` | 次のコントロールにフォーカスが移動する<br>比較元のテキスト と 比較先のテキスト の間を移動する際に便利。 |
| “比較”＋“タブによるフォーカス移動”モード中に `Shift + Tab` | 前のコントロールにフォーカスが移動する<br>比較元のテキスト と 比較先のテキスト の間を移動する際に便利。 |

- 参考情報
    https://qiita.com/ktrarai/items/8bbc7566c82a3fc6d063

### 補足事項：通常モードで便利なショートカットキー
| ショートカットキー | 動作するアクション |
| ---- | ---- |
| `Ctrl + \` | 左右分割を開始 |
| `Ctrl + K` → `Ctrl + \` | 上下分割を開始 |
| `Ctrl + K` → `Shift + Ctrl + \` | グループ内分割を開始<br>もう一度、入力すると解除。 |

### 主にマウス操作で比較する方法
#### 1つひとつ選択する場合
1. アクティビティ バーのエクスプローラーを表示
1. 比較元となるファイルを1つ選択し右クリック
1. 「比較対象の選択」をクリック
1. 比較先となるファイルを1つ選択し右クリック
1. 「選択項目と比較」をクリック

#### 一度に2つ選択する場合
1. アクティビティ バーのエクスプローラーを表示
1. 比較元と比較先となるファイルを2つ選択し右クリック
    選択方法は範囲選択（`Shiftキー長押し+クリック`）でも部分選択（`Ctrlキー長押し+クリック`）どちらでもOK
1. 「選択項目の比較」をクリック

## VS Codeの比較機能でできること・できないこと
### できること
- 単純なファイル2つの差分を確認できる
- 比較元と比較先を横並びで確認できる（初期状態）
- 比較元と比較先をインライン表示でも確認できる
- 比較元、または比較先を直接編集できる

### できないこと
- バイナリデータの比較
- フォルダー単位の比較
- 比較対象を3以上に設定すること
- レポート出力
    VS Codeの機能には無い。
    ただし、Git環境の場合は`git diff`コマンドで比較結果を出力できる。

#### 出来ない事を実現するには
一方、[WinMerge](https://winmerge.org/?lang=ja)などの従来の比較ツールもしっかりと証跡（エビデンス）を残したい場合にレポートを出力できる為、
WinMergeだとHTML出力可能で表形式にする際に便利。

[こちら](https://qiita.com/Kosen-amai/items/d97a16fa6f5e880b1432)の記事で紹介されているPowerShellを使う方法で、
比較結果をアウトプットする事ができそう。
https://qiita.com/Kosen-amai/items/d97a16fa6f5e880b1432

## まとめ
- VS Codeで比較する方法
    - キーボード操作で比較
        コマンドパレット（ `Ctrl + Shift + P` or `F1` ）で「 `compare` or `比較` 」を入力し比較
    - マウス操作で比較
        アクティビティ バーのエクスプローラーで比較対象を右クリックで選択し比較

## 関連記事
https://haretokidoki-blog.com/pasocon_powershell-startup/
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960

---
title: "[Outlook VBA]複数アカウントでも可👌 自動で自分のメールアドレスをBCCに追加する方法"
emoji: "📧"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["windows", "office", "outlook", "vba"]
published: false
---
## 概要
私は全てのメールを受信トレイで確認できるようにする為、メールの新規作成／返信／全返信／転送など自身からリアクションする場合は、
必ず自身のメールアドレスをBCCに追加してメールを送信しています。
Outlook内、1アカウント分のメールアドレスをBCCに追加したい場合、Outlook標準機能の[クイック操作により自動化が可能](https://zenn.dev/haretokidoki/articles/54c4cf61b865e3#%5Boutlook%5D-メールを新規作成／返信／転送する際に毎回、bccに自身のアドレスを追加したい場合)ですが、
クイック操作のメールアドレスの設定は、固定値で設定する必要がある為、複数アカウントの場合に自動で判断できません。
その為、Outlookに複数アカウントを登録している環境では、手作業でBCCに追加してメールを送信する必要があり不便でした。

今回、「 **Outlook VBA** × **クイック アクセス ツール バー** 」を組合せて運用する事により、
複数アカウントでも自動でBCCに自分のメールアドレスを追加できたので、設定方法を紹介します。

## この記事のターゲット
- Windowsユーザー ＆ Outlookユーザー の方
  Macユーザーの方は、Outlookのオプションに`メッセージの送信時、自動的にBCCに自分を追加`という[設定があり簡単に自動化が可能](https://www.wanichan.com/office365/mac/outlook/2016/3/35.html)。
- Outlookに複数アカウントを登録している方
  アカウントが一つのみであれば、Outlook標準機能の[クイック操作により自動化が可能](https://zenn.dev/haretokidoki/articles/54c4cf61b865e3#%5Boutlook%5D-メールを新規作成／返信／転送する際に毎回、bccに自身のアドレスを追加したい場合)
- メールの新規作成時、自動敵に自分のメールアドレスをBCCに追加したい方
- キーボード操作（ショートカットキー）でも操作したい方
## 環境
### Officeのバージョン
Officeのバージョンは「Microsoft Office Standard 2019」
```powershell:コマンドでバージョン確認した結果
PS C:\WINDOWS\system32> Get-ChildItem -Path('HKLM:SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall',
>> 'HKCU:SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall') |
>> % { Get-ItemProperty $_.PsPath | Select-Object DisplayName, DisplayVersion, Publisher } |
>> ? { $_.DisplayName -like '*Office Standard*' }

DisplayName                            DisplayVersion   Publisher
-----------                            --------------   ---------
Microsoft Office Standard 2019 - ja-jp 16.0.10399.20000 Microsoft Corporation


PS C:\WINDOWS\system32>
```
:::details 参考情報：PowerShellのCLIでOfficeのバージョンを確認する方法
- Microsoft Officeのバージョンを確認するコマンド
    インストール済みのソフトウェア一覧より、「 Office 」を含むソフトウェアのみ表示するコマンド。
    フィルタ条件を変更する場合は`? { $_.DisplayName -like '*Office*' }`にある「 '\***Office**\*' 」を任意の値に変更。
  ```powershell:コマンドのみを抜粋
  Get-ChildItem -Path('HKLM:SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall',
  'HKCU:SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall') |
  % { Get-ItemProperty $_.PsPath | Select-Object DisplayName, DisplayVersion, Publisher } |
  ? { $_.DisplayName -like '*Office*' }
  ```
- 参考情報
  https://win.just4fun.biz/?PowerShell/インストール済アプリケーション一覧を取得する
  https://win2012r2.com/2022/01/21/powershell-where-object/
  https://newpops.hatenadiary.org/entry/20060505/p1
  https://papanda925.com/?p=1746
:::
## 設定方法
:::message
**注意事項**

この設定では、Outlookの設定で**マクロを有効**とします。
これは悪意のある危険なコードを受け取った際、Outlook経由で実行される可能性がある為、
**Microsoftからは推奨されない設定**となります。

一般的な企業においても禁止されている設定項目となる為、取り扱いには十分ご注意ください。
（マクロが禁止となっている企業では、そもそもマクロの有効化が設定できない環境だと思います。）
:::
大まかな設定の流れとしては、最初にOutlook VBAで新規モジュールを作成し自動化のプログラム（Subプロシージャ）をコーディングします。
その後、作成したSubプロシージャをクイック アクセス ツール バー に登録する事で、
マウスやキーボードで簡単に操作が可能となります。

- Outlook VBA で自動化プログラム（Subプロシージャ）を作成
  1. 開発環境の準備
      - (任意)Outlookのリボンに開発を追加
        :::message
        **キーボード操作でVBAエディターを起動する場合は不要**

        キーボードのショートカットキー（`Alt` + `F11`）でVBAエディター[^1]を起動する場合は不要な作業。
        [^1]: VBAエディター = [Microsoft Visual Basic for Applications](https://ja.wikipedia.org/wiki/Visual_Basic_for_Applications)
        :::
        OutlookでVBAを使用する準備としてリボンに`開発`を追加
        1. ファイル → オプション により、Outlook のオプションを表示
        1. リボンのユーザー設定 → ウィンドウ右側の`リボンのユーザー設定(B):`枠内にある `開発`のチェックボックスをオンに変更
        1. OKボタン
  1. 標準モジュールを新規作成とSubプロシージャの作成
      - 標準モジュールの新規作成
          1. VBAエディター[^1]を起動
              - マウス操作の場合　　：リボン`開発` → `Visual Basic` をクリックし起動

              または
              - キーボード操作の場合：`Alt` + `F11` により起動
          1. 標準モジュールを新規作成
              1. 左側ツリー状のルートにある `Project1 (VbaProject.OTM)` を右クリック
              1. `挿入(N)` を選択
              1. `標準モジュール(M)` を選択
              1. （任意）モジュール名の変更
                  プログラムの動作に直接関係しない処理の為、対応しなくても問題ない。
                  ここで名前を変更しない場合は、以降に登場する`mdlCommon` は `Module1` に読み換えて対応。
                  - モジュール名を `Module1` から `mdlCommon` に変更
                    1. `Project1 (VbaProject.OTM)` → `標準モジュール` → `Module1` を選択
                    1. VBAエディターの左下にあるプロパティよりオブジェクト名を `mdlCommon` に変更
      - Subプロシージャの作成
        1. `mdlCommon`内に自動化プログラムをコーディング
            ```vbnet:mdlCommonに追加するコード
            Option Explicit

            '********************************************************************************
            '* 処理名　｜CreateNewemailWithAddedToBCC
            '* 機能　　｜メール新規作成 + BCCに追加（アクティブアカウントのアドレス）
            '*-------------------------------------------------------------------------------
            '* 戻り値　｜-
            '* 引数　　｜-
            '********************************************************************************
            Public Sub CreateNewemailWithAddedToBCC()
                ' Outlookメール作成用
                Dim OutlookApp As New Outlook.Application
                Dim OutlookMailitem As Outlook.MailItem
                Set OutlookMailitem = OutlookApp.CreateItem(olMailItem)
                
                ' アクティブアカウントの情報
                Dim OutlookFolder As Outlook.Folder
                Set OutlookFolder = ActiveExplorer.CurrentFolder
                
                Dim strSenderaddress As String
                strSenderaddress = AcquisitionSenderaddress(OutlookFolder)
                
                With OutlookMailitem
                    .BCC = strSenderaddress
                    .Display
                End With
            End Sub
            '********************************************************************************
            '* 処理名　｜ReplyEmailWithAddedToBCC
            '* 機能　　｜メールを返信 + BCCに追加（アクティブアカウントのアドレス）
            '*-------------------------------------------------------------------------------
            '* 戻り値　｜-
            '* 引数　　｜-
            '********************************************************************************
            Public Sub ReplyEmailWithAddedToBCC()
                ' Outlookメール作成用
                Dim OutlookMailitem As Outlook.MailItem

                ' 個別ウィンドウで開いているメールに対しリアクション
                ' （個別ウィンドウを開いていない場合は処理が`On Error GoTo 0`までスキップされ、
                ' 　OutlookMailitem の中身は Nothing となる）
                On Error Resume Next
                Set OutlookMailitem = ActiveInspector.CurrentItem.Reply
                On Error GoTo 0

                If OutlookMailitem Is Nothing Then
                    ' Outlookで選択中のメールに対しリアクション
                    Set OutlookMailitem = ActiveExplorer.Selection.Item(1).Reply
                End If
                
                ' アクティブアカウントの情報
                Dim OutlookFolder As Object
                Set OutlookFolder = ActiveExplorer.CurrentFolder
                
                Dim strSenderaddress As String
                strSenderaddress = AcquisitionSenderaddress(OutlookFolder)
                
                With OutlookMailitem
                    .Display
                    .BCC = strSenderaddress
                End With
            End Sub
            '********************************************************************************
            '* 処理名　｜ReplyAllemailWithAddedToBCC
            '* 機能　　｜メールを全員に返信 + BCCに追加（アクティブアカウントのアドレス）
            '*-------------------------------------------------------------------------------
            '* 戻り値　｜-
            '* 引数　　｜-
            '********************************************************************************
            Public Sub ReplyAllemailWithAddedToBCC()
                ' Outlookメール作成用
                Dim OutlookMailitem As Outlook.MailItem

                ' 個別ウィンドウで開いているメールに対しリアクション
                ' （個別ウィンドウを開いていない場合は処理が`On Error GoTo 0`までスキップされ、
                ' 　OutlookMailitem の中身は Nothing となる）
                On Error Resume Next
                Set OutlookMailitem = ActiveInspector.CurrentItem.ReplyAll
                On Error GoTo 0

                If OutlookMailitem Is Nothing Then
                    ' Outlookで選択中のメールに対しリアクション
                    Set OutlookMailitem = ActiveExplorer.Selection.Item(1).ReplyAll
                End If
                
                ' アクティブアカウントの情報
                Dim OutlookFolder As Object
                Set OutlookFolder = ActiveExplorer.CurrentFolder
                
                Dim strSenderaddress As String
                strSenderaddress = AcquisitionSenderaddress(OutlookFolder)
                
                With OutlookMailitem
                    .Display
                    .BCC = strSenderaddress
                End With
            End Sub
            '********************************************************************************
            '* 処理名　｜ForwardEmailWithAddedToBCC
            '* 機能　　｜メールを転送 + BCCに追加（アクティブアカウントのアドレス）
            '*-------------------------------------------------------------------------------
            '* 戻り値　｜-
            '* 引数　　｜-
            '********************************************************************************
            Public Sub ForwardEmailWithAddedToBCC()
                ' Outlookメール作成用
                Dim OutlookMailitem As Outlook.MailItem

                ' 個別ウィンドウで開いているメールに対しリアクション
                ' （個別ウィンドウを開いていない場合は処理が`On Error GoTo 0`までスキップされ、
                ' 　OutlookMailitem の中身は Nothing となる）
                On Error Resume Next
                Set OutlookMailitem = ActiveInspector.CurrentItem.Forward
                On Error GoTo 0
                
                If OutlookMailitem Is Nothing Then
                    ' Outlookで選択中のメールに対しリアクション
                    Set OutlookMailitem = ActiveExplorer.Selection.Item(1).Forward
                End If
                
                ' アクティブアカウントの情報
                Dim OutlookFolder As Object
                Set OutlookFolder = ActiveExplorer.CurrentFolder
                
                Dim strSenderaddress As String
                strSenderaddress = AcquisitionSenderaddress(OutlookFolder)
                
                With OutlookMailitem
                    .Display
                    .BCC = strSenderaddress
                End With
            End Sub
            '********************************************************************************
            '* 処理名　｜AcquisitionSenderaddress
            '* 機能　　｜アクティブアカウントのメールアドレスを取得
            '*-------------------------------------------------------------------------------
            '* 戻り値　｜String: アクティブアカウントのメールアドレス
            '* 引数　　｜Outlook.Folder: アクティブのアカウント情報
            '********************************************************************************
            Private Function AcquisitionSenderaddress(OutlookFolder As Outlook.Folder) As String
                Dim strSenderaddress As String
                strSenderaddress = ""
                
                ' すべてのアカウント情報を取得
                Dim objAccounts As Object
                Set objAccounts = Application.Session.Accounts
                
                Dim objItem As Object
                For Each objItem In objAccounts
                    ' アクティブアカウントの表示名と個々のアカウント情報を照合
                    If OutlookFolder.Store.DisplayName = objItem.DeliveryStore.DisplayName Then
                        ' 表示名がヒットした場合、アカウント情報からメールアドレスを取得
                        strSenderaddress = objItem.CurrentUser.AddressEntry.Address
                        Exit For
                    End If
                Next
                
                AcquisitionSenderaddress = strSenderaddress
            End Function
            ```
        1. `Ctrl` + `S` で上書き保存
  1. クイック アクセス ツール バー の登録
      メイン画面のデフォルトでは、すべてのフォルダーを送受信と元に戻すの2つが登録され、
      メールを個別に開いたウィンドウでは、上書き保存と元に戻す、やり直し、前のアイテム、次のアイテムの5つが登録されています。
      各々に対し追加でボタンを割り当てる事が可能。
      　
      また、このボタン群はショートカットキーが自動で割り当てられる為、作業の効率化が図れます。
      　
      下記は設定後に自動で割り当てられるショートカットキーです。
      ::::details 参考情報：ショートカット一覧
      :::message
      **注意事項**

      ボタンの並び順により割り当てられるショートカットキーが変化します。
      :::
      | ボタンの位置 | 入力方法 | 初期設定<br>（メイン画面） | 初期設定<br>（個別ウィンドウ） |
      | ---- | ---- | ---- | ---- |
      | 1個目 | Alt -> 1 | すべてのフォルダーを送受信 | すべてのフォルダーを送受信 |
      | 2個目 | Alt -> 2 | 元に戻す | 元に戻す |
      | 3個目 | Alt -> 3 | （未設定） | やり直し |
      | 4個目 | Alt -> 4 | （未設定） | 前のアイテム |
      | 5個目 | Alt -> 5 | （未設定） | 次のアイテム |
      | 6個目 | Alt -> 6 | （未設定） | （未設定） |
      | 7個目 | Alt -> 7 | （未設定） | （未設定） |
      | 8個目 | Alt -> 8 | （未設定） | （未設定） |
      | 9個目 | Alt -> 9 | （未設定） | （未設定） |
      | 10個目 | Alt -> 0 -> 9 | （未設定） | （未設定） |
      | 11個目 | Alt -> 0 -> 8 | （未設定） | （未設定） |
      | 12個目 | Alt -> 0 -> 7 | （未設定） | （未設定） |
      | 13個目 | Alt -> 0 -> 6 | （未設定） | （未設定） |
      | 14個目 | Alt -> 0 -> 5 | （未設定） | （未設定） |
      | 15個目 | Alt -> 0 -> 4 | （未設定） | （未設定） |
      | 16個目 | Alt -> 0 -> 3 | （未設定） | （未設定） |
      | 17個目 | Alt -> 0 -> 2 | （未設定） | （未設定） |
      | 18個目 | Alt -> 0 -> 1 | （未設定） | （未設定） |
      | 19個目 | Alt -> 0 -> A  | （未設定） | （未設定） |
      | 以降は省略 | - | - | - |
      ::::

    1. ファイル → オプション → Outlook のオプション → クイック アクセス ツール バー を開く
    1. コマンドの選択(C) を 基本的なコマンド から マクロ を選択
    1. 作成したSubプロシージャを 追加(A)
        - メール新規作成用Subプロシージャ: Project1.CreateNewemailWithAddedToBCC
        - メール個別返信用Subプロシージャ: Project1.ReplyEmailWithAddedToBCC
        - メール全返信用Subプロシージャ　: Project1.ReplyAllemailWithAddedToBCC
        - メール転送用Subプロシージャ　　: Project1.ForwardEmailWithAddedToBCC
        -----
        - 登録後のイメージ
          | ボタンの位置 | 入力方法 | 追加後の設定<br>（メイン画面） | 追加後の設定<br>（個別ウィンドウ） |
          | ---- | ---- | ---- | ---- |
          | 1個目 | Alt -> 1 | すべてのフォルダーを送受信 | すべてのフォルダーを送受信 |
          | 2個目 | Alt -> 2 | 元に戻す | 元に戻す |
          | 3個目 | Alt -> 3 | マクロ:メール新規作成<br> 👆 今回、追加 | やり直し |
          | 4個目 | Alt -> 4 | マクロ:メール個別返信<br> 👆 今回、追加 | 前のアイテム |
          | 5個目 | Alt -> 5 | マクロ:メール全返信<br> 👆 今回、追加 | 次のアイテム |
          | 6個目 | Alt -> 6 | マクロ:メール転送<br> 👆 今回、追加 | マクロ:メール新規作成<br> 👆 今回、追加 |
          | 7個目 | Alt -> 7 | （未設定） | マクロ:メール個別返信<br> 👆 今回、追加 |
          | 8個目 | Alt -> 8 | （未設定） | マクロ:メール全返信<br> 👆 今回、追加 |
          | 9個目 | Alt -> 9 | （未設定） | マクロ:メール転送<br> 👆 今回、追加 |

          ![](https://storage.googleapis.com/zenn-user-upload/7fc2fb1c634a-20230718.png)
          *画像：メイン画面 - 登録後のイメージ*
          ![](https://storage.googleapis.com/zenn-user-upload/0008a92f6fc5-20230718.png)
          *画像：個別ウィンドウ - 登録後のイメージ*
  1. Outlookでマクロを有効化
## 設定
2種類あるが、前者のクイック アクセス ツール バー の方法が作業効率が良い。
- マクロ（Subプロシージャ）をクイック アクセス ツール バー に登録
  ![](https://storage.googleapis.com/zenn-user-upload/ee0e5d947b96-20230714.png)
  *画像：リボンに追加*
  ![](https://storage.googleapis.com/zenn-user-upload/e3e4d4c96c30-20230714.png)
  *画像：クイック アクセス ツール バー に追加*
- マクロ一覧から実行
  マクロ一覧を「 `Alt` + `F8` 」で呼び出し、対象のマクロが選択された状態で`Enter`キー

### 実行時に動かない & VBAエディターでデバッグ時に警告
```:Microsoft Visual Basic for Applicactions
このプロジェクトのマクロは無効に設定されています。マクロを有効にする方法についてはオンライン ヘルプまたはホスト アプリケーションのドキュメントを参照してください。
```
https://extan.jp/?p=9290
https://afroglass.com/office_macro_error-1/

#### 設定変更
![](https://storage.googleapis.com/zenn-user-upload/3a5c2e97ae4c-20230718.png)
![](https://storage.googleapis.com/zenn-user-upload/ddd4e9c698c1-20230718.png)
![](https://storage.googleapis.com/zenn-user-upload/e44aa94149b6-20230718.png)
Outlookのオプションを閉じる（OKでもキャンセルでも上記の設定は反映される）
Outlookの再起動

## 参考情報
https://access-skill.com/vba-create-outlook-mail/
https://www.fulogabc.net/entry/excelvba-outlook-username
https://detail.chiebukuro.yahoo.co.jp/qa/question_detail/q14231305039

### 差出人の取得
https://www.fulogabc.net/entry/outlook-address
→できない
  https://learn.microsoft.com/ja-jp/office/vba/api/outlook.exchangeuser
  →できない
  　https://learn.microsoft.com/ja-jp/office/vba/outlook/concepts/accounts/create-a-sendable-item-for-a-specific-account-based-on-the-current-folder-outloo
    →できそう。できた。
    個別に開いてリアクションする際の参考
    https://extan.jp/?p=4832
    選択中のアイテムに対して対応する
    https://officevba.info/outlookreply/

## まとめ

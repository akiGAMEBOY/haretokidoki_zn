---
title: "PowerShell„ÅßÊåáÂÆö„Åó„Åü„Ç∑„Éº„ÉàÂêç„ÅåExcel„Éï„Ç°„Ç§„É´ÂÜÖ„Å´Â≠òÂú®„Åô„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ„Åô„ÇãFunction"
emoji: "üëå"
type: "tech" # tech: ÊäÄË°ìË®ò‰∫ã / idea: „Ç¢„Ç§„Éá„Ç¢
topics: ["powershell", "excel"]
published: false
---
## Ê¶ÇË¶Å

```powershell:
# ExcelCOM„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅÆÁµÇ‰∫Ü„Çí„Çπ„ÇØ„É™„Éó„Éà„Éñ„É≠„ÉÉ„ÇØ„ÅßÂÆöÁæ©
$ExitExcelObjects = {
    param (
        [Microsoft.Office.Interop.Excel.ApplicationClass]$Excel,
        [System.__ComObject]$Workbooks,
        [System.__ComObject]$Workbook,
        [System.__ComObject]$WorkSheets,
        [System.__ComObject]$WorkSheet,
        [System.__ComObject]$Cells,
        [System.__ComObject]$Cell
    )

    $WorkBook.Close($false)

    # „Çª„É´„Åã„Çâ„Éñ„ÉÉ„ÇØ„Åæ„ÅßËß£Êîæ
    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($Cell) > $null
    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($Cells) > $null
    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($WorkSheet) > $null
    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($WorkSheets) > $null
    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($WorkBook) > $null
    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($WorkBooks) > $null

    $Cell = $null
    Remove-Variable Cell -ErrorAction SilentlyContinue
    $Cells = $null
    Remove-Variable Cells -ErrorAction SilentlyContinue
    $WorkSheet = $null
    Remove-Variable WorkSheet -ErrorAction SilentlyContinue
    $WorkSheets = $null
    Remove-Variable WorkSheets -ErrorAction SilentlyContinue
    $WorkBook = $null
    Remove-Variable WorkBook -ErrorAction SilentlyContinue
    $WorkBooks = $null
    Remove-Variable WorkBooks -ErrorAction SilentlyContinue

    [System.GC]::Collect()
    [System.GC]::WaitForPendingFinalizers()
    [System.GC]::Collect()

    $Excel.Quit()
    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($Excel) > $null
    $Excel = $null
    Remove-Variable Excel -ErrorAction SilentlyContinue

    [System.GC]::Collect()
    [System.GC]::WaitForPendingFinalizers()
    [System.GC]::Collect()
}

# „Ç∑„Éº„Éà„ÅÆÂ≠òÂú®„ÉÅ„Çß„ÉÉ„ÇØ
Function Test-ExcelSheetExists {
    param(
        [System.String]$Path,
        [System.String]$CheckSheet
    )
    $excel = New-Object -ComObject Excel.Application
    $excel.Visible = $false
    $workbook = $excel.Workbooks.Open($Path)

    $sheetExists = $false
    foreach ($worksheet in $workbook.Sheets) {
        if ($worksheet.Name -eq $CheckSheet) {
            $sheetExists = $true
            break
        }
    }

    $workbook.Close($false)
    $excel.Quit()
    Invoke-Command -ScriptBlock $ExitExcelObjects -ArgumentList $excel $workbook

    return $sheetExists
}
```

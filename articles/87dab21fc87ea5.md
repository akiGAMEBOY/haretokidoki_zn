---
title: "PowerShellã§æŒ‡å®šã—ãŸã‚·ãƒ¼ãƒˆåãŒExcelãƒ•ã‚¡ã‚¤ãƒ«å†…ã«å­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹Function"
emoji: "ðŸ‘Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell", "excel"]
published: false
---
## æ¦‚è¦

```powershell:
# ã‚·ãƒ¼ãƒˆã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
Function Test-ExcelSheetExists {
    param(
        [System.String]$Path,
        [System.String]$CheckSheet
    )

    $excelApp = $null
    $workBooks = $null
    $workBook = $null
    $workSheets = $null
    $workSheet = $null

    $sheetExists = $false
    try {
        $excelApp = New-Object -ComObject Excel.Application
        $excelApp.Visible = $false
        $excelApp.DisplayAlerts = $false
        $workBooks = $excelApp.Workbooks
        $workBook = $workBooks.Open($Path)
        $workSheets = $workBook.Sheets

        foreach ($workSheet in $workSheets) {
            if ($workSheet.Name -eq $CheckSheet) {
                $sheetExists = $true
                break
            }
        }
    }
    catch {
        Write-Error 'Excelæ“ä½œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'
    }
    finally {
        # ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯ã¾ã§è§£æ”¾
        if ($null -ne $workSheet) {
            [System.Runtime.Interopservices.Marshal]::ReleaseComObject($workSheet) > $null
            $workSheet = $null
            Remove-Variable workSheet -ErrorAction SilentlyContinue
        }
        if ($null -ne $workSheets) {
            [System.Runtime.Interopservices.Marshal]::ReleaseComObject($workSheets) > $null
            $workSheets = $null
            Remove-Variable workSheets -ErrorAction SilentlyContinue
        }
        if ($null -ne $workBook) {
            # ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯ã®ä¿å­˜ã—ãªã„ã§çµ‚äº†
            $workBook.Close($false)

            [System.Runtime.Interopservices.Marshal]::ReleaseComObject($workBook) > $null
            $workBook = $null
            Remove-Variable workBook -ErrorAction SilentlyContinue
        }
        if ($null -ne $workBooks) {
            [System.Runtime.Interopservices.Marshal]::ReleaseComObject($workBooks) > $null
            $workBooks = $null
            Remove-Variable workBooks -ErrorAction SilentlyContinue
        }

        # Excelã‚¢ãƒ—ãƒªçµ‚äº†
        if ($null -ne $excelApp) {
            [System.GC]::Collect()
            [System.GC]::WaitForPendingFinalizers()
            [System.GC]::Collect()

            $excelApp.Quit()
            [System.Runtime.Interopservices.Marshal]::ReleaseComObject($excelApp) > $null
            $excelApp = $null
            Remove-Variable excelApp -ErrorAction SilentlyContinue

            [System.GC]::Collect()
            [System.GC]::WaitForPendingFinalizers()
            [System.GC]::Collect()
        }
    }

    return $sheetExists
}
```

---
title: "Expand-Archiveï¼ˆã‚‚ã—ãã¯ExtractToDirectoryï¼‰ã®è§£å‡ã§æ–‡å­—åŒ–ã‘ã—ã¦ã—ã¾ã†å ´åˆ"
emoji: "ğŸ§Š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell", "zip"]
published: false
---

å…ˆæ—¥ã€ZIPãƒ•ã‚¡ã‚¤ãƒ«ã®è§£å‡å‡¦ç†ã‚’ãµãã‚€PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã€ãƒ†ã‚¹ãƒˆã—ã¦ã„ãŸæ™‚ã«ã‚¿ã‚¤ãƒˆãƒ«é€šã‚Šæ–‡å­—åŒ–ã‘ã—ã¦ã—ã¾ã†äº‹ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚
Windows OSã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹ãŸã‚ã«ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚’ã‚¤ã‚¸ã‚‹ã“ã¨ã‚‚è€ƒãˆã¾ã—ãŸãŒã€å½±éŸ¿ç¯„å›²ãŒåºƒãã†ãªã®ã§é¿ã‘ã€**ä»–ã®å¯¾å‡¦æ–¹æ³•**ã‚’èª¿ã¹ã¦ã¿ã¾ã—ãŸã€‚

## ã“ã®è¨˜äº‹ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

- PowerShellãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–¹
- æ—¥æœ¬èªãªã©ãƒãƒ«ãƒãƒã‚¤ãƒˆã®åå‰ã‚’å«ã‚€ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ­£å¸¸ã«è§£å‡ã—ãŸã„æ–¹
- å±é™ºãŒä¼´ã†ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã®å¤‰æ›´ã¯é¿ã‘ãŸä»–ã®å¯¾å¿œæ–¹æ³•ã‚’çŸ¥ã‚ŠãŸã„æ–¹

## ãªãœã€PowerShellã®è§£å‡ã§æ–‡å­—åŒ–ã‘ã—ã¦ã—ã¾ã†ã®ã‹

PowerShellã§æ¨™æº–æ­è¼‰ã•ã‚Œã¦ã„ã‚‹æ©Ÿèƒ½ã¯ä¸‹è¨˜ã®2ç‚¹ã§ã™ã€‚

- **Expand-Archive**: PowerShell 5.0ä»¥é™ã§ä½¿ç”¨ã§ãã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆ
  
- **ExtractToDirectory**: PowerShell 7.0ä»¥é™ã§ä½¿ç”¨ã§ãã‚‹\.NETã®ãƒ¡ã‚½ãƒƒãƒ‰

```powershell
$zipPath = "è§£å‡ã™ã‚‹ZIPãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹"
$outputPath = "è§£å‡å¾Œã®å‡ºåŠ›å…ˆã®ãƒ‘ã‚¹"

# PowerShell 5.0 ä»¥é™ã§å‹•ä½œ
Expand-Archive -Path $zipPath -DestinationPath $outputPath

# PowerShell 7.0 ä»¥é™ã§å‹•ä½œ
([System.IO.Compression.ZipFile]::ExtractToDirectory($zipPath, $outputPath))
```

ã“ã‚Œã‚‰æ©Ÿèƒ½ã¯ã€PowerShellã«æ¨™æº–æ­è¼‰ã•ã‚Œã¦ã„ã¦å†…éƒ¨å‡¦ç†ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¯ã€ŒUTF-8ã€ãŒæ¡ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚
ä¸€æ–¹ã€Windows æ—¥æœ¬èªOSã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã§æ—¥æœ¬èªã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã¨æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¯ã€ŒShift JISã€ã€‚

ã“ã®ã‚ˆã†ã«ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ã®æ©Ÿèƒ½ ã¨ ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ãŒã§ãƒã‚°ãƒã‚°ãªé–¢ä¿‚æ€§ã¨ãªã£ã¦ãŠã‚Šã€
ã“ã‚ŒãŒ **æ–‡å­—åŒ–ã‘ã—ã¦ã„ã‚‹è¦å› ** ã§ã™ã€‚

ã¤ãã‹ã‚‰è§£æ±ºã™ã‚‹ãŸã‚ã«æ¤œè¨¼ã—ãŸã“ã¨ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## æ¤œè¨¼ã—ãŸã“ã¨

ä¸‹è¨˜ã®ã‚ˆã†ã«æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ™‚çš„ã«å¤‰ãˆã¦ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆãƒ»é–¢æ•°ã‚’å®Ÿè¡Œã—ã¾ã—ãŸãŒã€
å¤‰ã‚ã‚‰ãšæ–‡å­—åŒ–ã‘ã—ãŸã€‚

- ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã®ä¿®æ­£ã§Windows OSã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹æ–¹æ³•
    â€» æ—¥æœ¬èªOSã§å¤§å‰æã—ã¦ã„ã‚‹æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹å ´åˆã¯å±é™ºã¨åˆ¤æ–­ã—ã¦ã€ã“ã®æ–¹æ³•ã¯é¿ã‘ã¾ã—ãŸã€‚

- ä¸€æ™‚çš„ã«PowerShellã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹æ–¹æ³•
    ä¸‹è¨˜ã®ã‚ˆã†ã«æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã€å®Ÿè¡Œã—ã¾ã—ãŸãŒå¤‰ã‚ã‚‰ãšæ–‡å­—åŒ–ã‘ã—ã¦ã—ã¾ã†ã€‚

    ```powershell
    chcp 932  # Shift_JISã«å¤‰æ›´
    $OutputEncoding = [System.Text.Encoding]::GetEncoding("shift_jis")

    chcp 65001  # UTF-8ã«å¤‰æ›´
    $OutputEncoding = [System.Text.Encoding]::UTF8
    ```

- 

```powershell
# 7Zip4Powershellãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
PS C:\Users\XXXX> Install-Module -Name 7Zip4Powershell

Untrusted repository
You are installing the modules from an untrusted repository. If you trust this repository, change its
InstallationPolicy value by running the Set-PSRepository cmdlet. Are you sure you want to install the modules from
'PSGallery'?
[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is "N"): a
PS C:\Users\Administrator>

# å¯¾è±¡ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸã“ã¨
PS C:\Users\Administrator> Get-InstalledModule

Version              Name                                Repository           Description
-------              ----                                ----------           -----------
2.7.0                7Zip4Powershell                     PSGallery            Powershell module for creating and extraâ€¦

PS C:\Users\XXXX>

PS C:\Users\XXXX> Get-Package -name 7Zip4Powershell

Name                           Version          Source                           ProviderName
----                           -------          ------                           ------------
7Zip4Powershell                2.7.0            https://www.powershellgallery.câ€¦ PowerShellGet

PS C:\Users\XXXX>

Expand-7Zip -ArchiveFileName $zipPath -TargetPath $outputPath
```

```powershell
PS D:\Desktop\Test_7Zip4Powershell> tree /F .\CompressedFile-Containing-MultibyteCharacters
ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ ãƒ‘ã‚¹ã®ä¸€è¦§:  ãƒœãƒªãƒ¥ãƒ¼ãƒ  ãƒœãƒªãƒ¥ãƒ¼ãƒ 
ãƒœãƒªãƒ¥ãƒ¼ãƒ  ã‚·ãƒªã‚¢ãƒ«ç•ªå·ã¯ 000000A7 1298:06B4 ã§ã™
D:\DESKTOP\TEST_7ZIP4POWERSHELL\COMPRESSEDFILE-CONTAINING-MULTIBYTECHARACTERS
    Only-Alphabet.txt
    ãƒãƒ«ãƒãƒã‚¤ãƒˆï¼ˆæ—¥æœ¬èªï¼‰ã‚’å«ã‚€.txt

ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã¯å­˜åœ¨ã—ã¾ã›ã‚“

PS D:\Desktop\Test_7Zip4Powershell>
```

```powershell
PS D:\Desktop\Test_7Zip4Powershell> $zipPath = ".\CompressedFile-Containing-MultibyteCharacters.zip"
PS D:\Desktop\Test_7Zip4Powershell> $outputPath = ".\"
PS D:\Desktop\Test_7Zip4Powershell>
PS D:\Desktop\Test_7Zip4Powershell> Expand-Archive -Path $zipPath -DestinationPath $outputPath
PS D:\Desktop\Test_7Zip4Powershell>
PS D:\Desktop\Test_7Zip4Powershell> tree /F .\CompressedFile-Containing-MultibyteCharacters
ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ ãƒ‘ã‚¹ã®ä¸€è¦§:  ãƒœãƒªãƒ¥ãƒ¼ãƒ  ãƒœãƒªãƒ¥ãƒ¼ãƒ 
ãƒœãƒªãƒ¥ãƒ¼ãƒ  ã‚·ãƒªã‚¢ãƒ«ç•ªå·ã¯ 000000B7 1298:06B4 ã§ã™
D:\DESKTOP\TEST_7ZIP4POWERSHELL\COMPRESSEDFILE-CONTAINING-MULTIBYTECHARACTERS
    Only-Alphabet.txt
    ï¿½}ï¿½ï¿½ï¿½`ï¿½oï¿½Cï¿½gï¿½iï¿½ï¿½ï¿½{ï¿½ï¿½jï¿½ï¿½ï¿½Ü‚ï¿½.txt

ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã¯å­˜åœ¨ã—ã¾ã›ã‚“

PS D:\Desktop\Test_7Zip4Powershell>Powershell>
```

```powershell
PS D:\Desktop\Test_7Zip4Powershell> [System.IO.Compression.ZipFile]::ExtractToDirectory($zipPath, $outputPath)
PS D:\Desktop\Test_7Zip4Powershell>
PS D:\Desktop\Test_7Zip4Powershell> tree /F .\CompressedFile-Containing-MultibyteCharacters
ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ ãƒ‘ã‚¹ã®ä¸€è¦§:  ãƒœãƒªãƒ¥ãƒ¼ãƒ  ãƒœãƒªãƒ¥ãƒ¼ãƒ 
ãƒœãƒªãƒ¥ãƒ¼ãƒ  ã‚·ãƒªã‚¢ãƒ«ç•ªå·ã¯ 0000000B 1298:06B4 ã§ã™
D:\DESKTOP\TEST_7ZIP4POWERSHELL\COMPRESSEDFILE-CONTAINING-MULTIBYTECHARACTERS
    Only-Alphabet.txt
    ï¿½}ï¿½ï¿½ï¿½`ï¿½oï¿½Cï¿½gï¿½iï¿½ï¿½ï¿½{ï¿½ï¿½jï¿½ï¿½ï¿½Ü‚ï¿½.txt

ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã¯å­˜åœ¨ã—ã¾ã›ã‚“

PS D:\Desktop\Test_7Zip4Powershell>
PS D:\Desktop\Test_7Zip4Powershell>
```

```powershell
PS D:\Desktop\Test_7Zip4Powershell> Expand-7Zip -ArchiveFileName $zipPath -TargetPath $outputPath
PS D:\Desktop\Test_7Zip4Powershell> 
PS D:\Desktop\Test_7Zip4Powershell> tree /F .\CompressedFile-Containing-MultibyteCharacters
ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ ãƒ‘ã‚¹ã®ä¸€è¦§:  ãƒœãƒªãƒ¥ãƒ¼ãƒ  ãƒœãƒªãƒ¥ãƒ¼ãƒ 
ãƒœãƒªãƒ¥ãƒ¼ãƒ  ã‚·ãƒªã‚¢ãƒ«ç•ªå·ã¯ 00000034 1298:06B4 ã§ã™
D:\DESKTOP\TEST_7ZIP4POWERSHELL\COMPRESSEDFILE-CONTAINING-MULTIBYTECHARACTERS
    Only-Alphabet.txt
    ãƒãƒ«ãƒãƒã‚¤ãƒˆï¼ˆæ—¥æœ¬èªï¼‰ã‚’å«ã‚€.txt

ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã¯å­˜åœ¨ã—ã¾ã›ã‚“

PS D:\Desktop\Test_7Zip4Powershell>
```

## å‚è€ƒæ–‡çŒ®

https://github.com/thoemmi/7Zip4Powershell

https://qiita.com/LightSilver7/items/a2532cc6e33757bb9edb
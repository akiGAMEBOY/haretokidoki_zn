---
title: "PowerShellã§æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ï¼ˆæ–‡å­—åˆ—æŠ½å‡ºã™ã‚‹Functionã‚‚ç´¹ä»‹ï¼‰"
emoji: "ğŸšª"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: true
---
## æ¦‚è¦

[Ruby bytesize](https://docs.ruby-lang.org/ja/latest/method/String/i/bytesize.html) ã‚„ [VBA LenB](https://learn.microsoft.com/ja-jp/office/vba/language/reference/user-interface-help/len-function) ã€[Excel LENBé–¢æ•°](https://support.microsoft.com/ja-jp/office/len-é–¢æ•°-lenb-é–¢æ•°-29236f94-cedc-429d-affd-b5e33d2c67cb) ã®ã‚ˆã†ã«PowerShellã§ã‚‚æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’å–å¾—ã—ãŸã„ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã€
å–å¾—æ–¹æ³•ã‚„PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆãªã©ã«çµ„ã¿è¾¼ã‚ã‚‹Functionã‚‚è‡ªä½œã—ã¾ã—ãŸã€‚

## ç’°å¢ƒ

### Windows OS

Windows 10 Proç’°å¢ƒ

```powershell:Get-WmiObjectã‚³ãƒãƒ³ãƒ‰
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> Get-CimInstance CIM_OperatingSystem

SystemDirectory     Organization BuildNumber RegisteredUser SerialNumber            Version
---------------     ------------ ----------- -------------- ------------            -------
C:\WINDOWS\system32              19045       XXXXX          00000-00000-00000-AAAAA 10.0.19045
                                             ^^^^^          ^^^^^ ^^^^^ ^^^^^ ^^^^^
                                             â†‘ãƒã‚¹ã‚¯       â†‘ãƒã‚¹ã‚¯

PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
```

### PowerShell

```powershell:PowerShellã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> $PSVersionTable

Name                           Value
----                           -----
PSVersion                      5.1.19041.4291
PSEdition                      Desktop
PSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}
BuildVersion                   10.0.19041.4291
CLRVersion                     4.0.30319.42000
WSManStackVersion              3.0
PSRemotingProtocolVersion      2.3
SerializationVersion           1.1.0.1


PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
```

## ãƒã‚¤ãƒˆæ•°ã‚’å–å¾—ã™ã‚‹ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç§ã®å ´åˆï¼‰

PowerShellã«ãŠã‘ã‚‹ã‚³ãƒãƒ³ãƒ‰çµæœã®ãƒ‡ãƒ¼ã‚¿å‹ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‹ï¼ˆ`System.Object`ï¼‰ã§ã¯ãªã„å ´åˆã¯ã€é …ç›®åã‚’æŒ‡å®šã—ãŸåŠ å·¥ãŒé¢å€’ã«ãªã‚Šã¾ã™ã€‚

ã¾ãŸã€ãã®ã‚³ãƒãƒ³ãƒ‰çµæœã«æ—¥æœ¬èªã‚’å§‹ã‚ã¨ã™ã‚‹ãƒãƒ«ãƒãƒã‚¤ãƒˆã®æ–‡å­—åˆ—ãŒå«ã¾ã‚Œã‚‹ã‚±ãƒ¼ã‚¹ã§ã¯ã€å˜ç´”ãªæ–‡å­—æ•°ã ã‘ã§ã¯åˆ¶å¾¡ã§ããšã€
ãƒã‚¤ãƒˆæ•°ã®å–å¾—ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚

ä»¥é™ã‹ã‚‰å…·ä½“çš„ãªä¾‹ã‚’ã‚ã’ã¾ã™ã€‚

æ–‡å­—æ•°ã ã‘ã§å›ºå®šé•·ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šæ‰±ã†å ´åˆã€ã™ã¹ã¦è‹±æ•°å­—ã®ã¿ã®æ–‡å­—åˆ—ã‚’åˆ¶å¾¡ã™ã‚‹ã®ã§ã‚ã‚Œã°ã€å®Ÿç¾å¯èƒ½ã§ã™ã€‚
ä¸‹è¨˜ã®ã‚ˆã†ã«Lengthãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã„æ–‡å­—æ•°ã§åˆ¶å¾¡ã€‚

```powershell:è‹±æ•°å­—ã ã‘ã®æ–‡å­—åˆ—ã®çµæœ
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> [System.String]$target_str = 'abcdefg'
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> $target_str.Length
7
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
```

ä¸€æ–¹ã€è‹±æ•°å­—ã ã‘ã§ãªãæ—¥æœ¬èªã‚’å«ã‚€æ–‡å­—åˆ—ãŒå¯¾è±¡ã ã£ãŸå ´åˆã€æ–‡å­—æ•°ã§ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹ã¨ä¸‹è¨˜ã®é€šã‚Šã¨ãªã‚Šã¾ã™ã€‚

```powershell:æ—¥æœ¬èªï¼ˆãƒãƒ«ãƒãƒã‚¤ãƒˆï¼‰ã‚’å«ã‚€æ–‡å­—åˆ—ã®çµæœ
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> [System.String]$target_str = 'ã‚ã„ã†abcd'
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> $target_str.Length
7
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
```

ã“ã®ã‚ˆã†ãªæ–‡å­—åˆ—ãŒè¤‡æ•°ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’å›ºå®šé•·ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦åˆ¶å¾¡ã—ãŸã„å ´åˆã§ã€ã‹ã¤å„æ–‡å­—åˆ—ã«ãŠã‘ã‚‹ãƒãƒ«ãƒãƒã‚¤ãƒˆæ–‡å­—ã®æŒ¿å…¥ä½ç½®ãŒãƒãƒ©ãƒãƒ©ã ã£ãŸå ´åˆã€
æ–‡å­—æ•°ã ã‘ã§ã¯åˆ¶å¾¡ã§ãã¾ã›ã‚“ã€‚

ãã“ã§ä»Šå›ã®ãƒ†ãƒ¼ãƒã€Œ **æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’å–å¾—ã™ã‚‹æ–¹æ³•** ã€ãŒå¿…è¦ã¨ãªã‚Šã¾ã—ãŸã€‚

:::details â€œæ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’å–å¾—â€ã®ã‚ˆã‚Šå…·ä½“çš„ãªä¾‹

ä¸Šè¨˜å†…å®¹ã§ã¯ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒã§ããªã‹ã£ãŸæ–¹ã«å‘ã‘ã€ã‚ˆã‚Šå…·ä½“çš„ãªä¾‹ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

ã¾ãšã€æœ€åˆã«è‹±æ•°å­—ã ã‘ã®ã‚³ãƒãƒ³ãƒ‰çµæœã‚’æ–‡å­—æ•°ã§é…åˆ—ã«ç½®ãæ›ãˆãŸã„å ´åˆã€

```:è‹±æ•°å­—ã ã‘ã®ã‚³ãƒãƒ³ãƒ‰çµæœã®ä¾‹
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> Write-Alphanumericï¼ˆâ† æ¶ç©ºã®ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆï¼‰
column01  column02  column03  
------------------------------
123456789012345678901234567890

PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
```

ã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰çµæœãŒã‚ã£ãŸå ´åˆã€æ–‡å­—æ•°ã§ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

| æ–‡å­—æ•°â†’ | 01 | 02 | 03 | 04 | 05 | 06 | 07 | 08 | 09 | 10 | 11 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| è‹±æ•°å­—ã®ã¿ - é …ç›®å | `c` | `o` | `l` | `u` | `m` | `n` | `0` | `1` | ` ` | ` ` | `c` |
| è‹±æ•°å­—ã®ã¿ - å€¤ | `1` | `2` | `3` | `4` | `5` | `6` | `7` | `8` | `9` | `0` | `1` |

ã“ã®çµæœã‹ã‚‰ã‚‚1æ–‡å­—ç›® ï½ 10æ–‡å­—ç›®ã¾ã§ãŒ é …ç›®å`column01`ã®ãƒ‡ãƒ¼ã‚¿ã€11æ–‡å­—ç›® ï½ 20æ–‡å­—ç›®ã¾ã§ãŒ é …ç›®å`column02`ã®ãƒ‡ãƒ¼ã‚¿ã¨ã„ã†ã‚ˆã†ã«ã€
å›ºå®šé•·ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦åˆ¶å¾¡ãƒ»åŠ å·¥ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚

ã¾ãŸã€ã“ã‚Œã‚’è¡¨ã«ç½®ãæ›ãˆã‚‹ã¨ä¸‹è¨˜ã®ã¨ãŠã‚Šã«ã€‚

| `[column01]` | `[column02]` | `[column03]` |
| --- | --- | --- |
| `[1234567890]` | `[1234567890]` | `[1234567890]` |

ã“ã“ã¾ã§ã®é€šã‚Šè‹±æ•°å­—ã ã‘ã®æ–‡å­—åˆ—ã¯ã€æ–‡å­—æ•°ï¼ˆLengthãƒ¡ã‚½ãƒƒãƒ‰ï¼‰ã§åˆ¶å¾¡å¯èƒ½ã§ã™ã€‚

----

ä¸€æ–¹ã€ãƒãƒ«ãƒãƒã‚¤ãƒˆæ–‡å­—ï¼ˆæ—¥æœ¬èªï¼‰ã‚’å«ã‚€ã‚³ãƒãƒ³ãƒ‰çµæœã®å ´åˆã¯ã€æ–‡å­—æ•°ã ã‘ã§ã¯åˆ¶å¾¡ã§ãã¾ã›ã‚“ã€‚
å…·ä½“çš„ãªä¾‹ã‚’ã‚ã’ã‚‹ã¨ã€

```:æ—¥æœ¬èªã‚’å«ã‚€ã‚³ãƒãƒ³ãƒ‰çµæœã®ä¾‹
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> Write-Multibyteï¼ˆâ† æ¶ç©ºã®ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆï¼‰
é …ç›®0001  é …ç›®0002  é …ç›®0003  
------------------------------
ã‚12345678ã‚12345678ã‚12345678

PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> 
```

ä¸Šè¨˜ã®ã‚ˆã†ã«ãƒãƒ«ãƒãƒã‚¤ãƒˆã‚’å«ã‚“ã ã‚³ãƒãƒ³ãƒ‰çµæœã®å ´åˆã€æ–‡å­—æ•°ã ã‘ã§ã‚«ã‚¦ãƒ³ãƒˆã—ã¦ã—ã¾ã†ã¨ã€

| æ–‡å­—æ•°â†’ | 01 | 02 | 03 | 04 | 05 | 06 | 07 | 08 | 09 | 10 | 11 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| æ—¥æœ¬èªå«ã‚€ - é …ç›®å | `é …` | `ç›®` | `0` | `0` | `0` | `1` | ` ` | ` ` | `é …` | `ç›®` | `0` |
| æ—¥æœ¬èªå«ã‚€ - å€¤ | `ã‚` | `1` | `2` | `3` | `4` | `5` | `6` | `7` | `8` | `ã‚` | `1` |

ã¨ã„ã†ã‚ˆã†ã«ã€é …ç›®åã‚„å€¤ãã‚Œãã‚Œã§ã‚ºãƒ¬ãŒç™ºç”Ÿã—ã¦ã—ã¾ã„ã¾ã™ã€‚

10æ–‡å­—ãšã¤ã§è¡¨ã«ç½®ãæ›ãˆã‚‹ã¨ä¸‹è¨˜ã®ã¨ãŠã‚Šã€‚

| `[é …ç›®0001  é …ç›®]` | `[0002  é …ç›®00]` | `[03â£â£]`<br>â€» 4æ–‡å­—ã®ã¿ |
| --- | --- | --- |
| `[ã‚12345678ã‚]` | `[12345678ã‚1]` | `[2345678]`<br>â€» 7æ–‡å­—ã®ã¿ |

ä»¥ä¸ŠãŒ è‹±æ•°å­—ã ã‘ã®æ–‡å­—åˆ— ã¨ ãƒãƒ«ãƒãƒã‚¤ãƒˆã‚’å«ã‚€æ–‡å­—åˆ— ã‚’å›ºå®šé•·ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦åˆ¶å¾¡ã™ã‚‹å ´åˆã®å…·ä½“ä¾‹ã§ã—ãŸã€‚

ã“ã‚Œã‚‰çµæœã‹ã‚‰ã‚‚ã€ãƒãƒ«ãƒãƒã‚¤ãƒˆã‚’å«ã‚€æ–‡å­—åˆ—ã‚’å›ºå®šé•·ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦å–ã‚Šæ‰±ã†å ´åˆã€ãƒã‚¤ãƒˆæ•°ã®å–å¾—ãŒå¿…é ˆã¨ãªã‚‹äº‹ã‚’ã”ç†è§£ã„ãŸã ã‘ãŸã‹ã¨æ€ã„ã¾ã™ã€‚

:::

## å¯¾å¿œæ–¹æ³•

æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã¨ã—ã¦ä¸‹è¨˜ã®3ã¤ã‚’ç´¹ä»‹ã€‚

- [ã‚³ãƒãƒ³ãƒ‰ã§æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•](#ã‚³ãƒãƒ³ãƒ‰ã§æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•)
- [è‡ªä½œã—ãŸFunctionã§æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•](#è‡ªä½œã—ãŸFunctionã§æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•)
- [ãƒã‚¤ãƒˆæ•°ã‚’æŒ‡å®šã—æ–‡å­—åˆ—ã‚’æŠ½å‡ºã™ã‚‹è‡ªä½œFunction](#ãƒã‚¤ãƒˆæ•°ã‚’æŒ‡å®šã—æ–‡å­—åˆ—ã‚’æŠ½å‡ºã™ã‚‹è‡ªä½œFunction)

æœ¬è¨˜äº‹ã®å¯¾å¿œæ–¹æ³•ã¯ã™ã¹ã¦æ–‡å­—ã‚³ãƒ¼ãƒ‰ã€Œ`Shift JIS`ã€ã§ãƒã‚¤ãƒˆæ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ã¦ãŠã‚Šã€Shift JISã®ãƒãƒ«ãƒãƒã‚¤ãƒˆã¯ã€Œ2ãƒã‚¤ãƒˆã€ã¨ã—ã¦å‡¦ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚

å¿…è¦ãªå ´åˆã¯ã€`UTF-8` ãªã©ä»–ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã«ç½®ãæ›ãˆã¦ã”å¯¾å¿œãã ã•ã„ã€‚
ãªãŠã€ãƒãƒ«ãƒãƒã‚¤ãƒˆã®ãƒã‚¤ãƒˆæ•°ã¯ã€æ–‡å­—ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚Šå¤‰åŒ–ã—ã¾ã™ã€‚
ï¼ˆ`UTF-8` ã§ã‚ã‚Œã°ã€Œ3ãƒã‚¤ãƒˆã€ã€‚ï¼‰

### ã‚³ãƒãƒ³ãƒ‰ã§æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•

```powershell:ã‚³ãƒ”ãƒ¼ç”¨
[System.String]$target_str = "å¯¾è±¡ã®æ–‡å­—åˆ—"
$target_str.Length
$encoding = [System.Text.Encoding]::GetEncoding("Shift_JIS")
$encoding.GetByteCount($target_str)
```

```powershell:å®Ÿéš›ã«ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸçµæœ
# å¯¾è±¡ã®æ–‡å­—åˆ—ã‚’æŒ‡å®š
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> [System.String]$target_str = 'ã‚12345678'
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
# æ–‡å­—ã®é•·ã•ï¼ˆæ–‡å­—æ•°ï¼‰ã ã¨9æ–‡å­—
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> $target_str.Length
9
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
# æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’SJISã§è¨­å®š
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> $encoding = [System.Text.Encoding]::GetEncoding("Shift_JIS")
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
# SJISã®ãƒã‚¤ãƒˆæ•°ï¼ˆSystem.Int32ï¼‰ã‚’å–å¾—
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> $encoding.GetByteCount($target_str)
10
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
```

### è‡ªä½œã—ãŸFunctionã§æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•

ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã—ãŸå†…å®¹ã‚’Functionã«ã™ã‚‹ã¨ä¸‹è¨˜ã®ã¨ãŠã‚Šã€‚

```powershell:æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’å–å¾—ã™ã‚‹Function
#################################################################################
# å‡¦ç†åã€€ | GetSjisCount
# æ©Ÿèƒ½ã€€ã€€ | æ–‡å­—åˆ—å…¨ä½“ã®ãƒã‚¤ãƒˆæ•°ã‚’Shift JISã§å–å¾—
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Int32ï¼ˆæ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ï¼‰
# å¼•æ•°ã€€ã€€ | target_str: å¯¾è±¡æ–‡å­—åˆ—
#################################################################################
Function GetSjisCount {
    Param (
        [System.String]$target_str
    )

    # æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’SJISã§è¨­å®š
    $encoding = [System.Text.Encoding]::GetEncoding("Shift_JIS")

    # æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’è¿”ã™
    return $encoding.GetByteCount($target_str)
}
```

```powershell:å®Ÿéš›ã«å®Ÿè¡Œã—ãŸçµæœ
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> GetSjisCount 'é …ç›®0001  '
10
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
```

### ãƒã‚¤ãƒˆæ•°ã‚’æŒ‡å®šã—æ–‡å­—åˆ—ã‚’æŠ½å‡ºã™ã‚‹è‡ªä½œFunction

æŒ‡å®šã®æ–‡å­—æ•°ã§æŠ½å‡ºå¯èƒ½ãª[Substringãƒ¡ã‚½ãƒƒãƒ‰](https://learn.microsoft.com/ja-jp/dotnet/api/system.string.substring)ã®ãƒã‚¤ãƒˆæ•°ç‰ˆã¨ã—ã¦Functionã‚’è‡ªä½œã—ã¦ã¿ã¾ã—ãŸã€‚

å¼•æ•°ã¯ã€ä¸‹è¨˜3ã¤ã®æŒ‡å®šã§æŠ½å‡ºå¯èƒ½ã«ã€‚

- `$target_str` ãŒæŠ½å‡ºå¯¾è±¡ã®æ–‡å­—åˆ—
- `$start` ãŒå…ˆé ­ä½ç½®ã‹ã‚‰ãƒã‚¤ãƒˆæ•°ã§æ•°ãˆãŸä½ç½®ã‚’æŠ½å‡ºé–‹å§‹ä½ç½®
- `$length` ãŒæŠ½å‡ºé–‹å§‹ä½ç½®ï¼ˆ`$start`ï¼‰ã‹ã‚‰æ•°ãˆæŠ½å‡ºã™ã‚‹ãƒã‚¤ãƒˆæ•°

```powershell:ãƒã‚¤ãƒˆæ•°ã§æ–‡å­—åˆ—æŠ½å‡ºã™ã‚‹Function
#################################################################################
# å‡¦ç†åã€€ | ExtractByteSubstring
# æ©Ÿèƒ½ã€€ã€€ | ãƒã‚¤ãƒˆæ•°ã§æ–‡å­—åˆ—ã‚’æŠ½å‡º
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Stringï¼ˆæŠ½å‡ºã—ãŸæ–‡å­—åˆ—ï¼‰
# å¼•æ•°ã€€ã€€ | target_str: å¯¾è±¡æ–‡å­—åˆ—
# ã€€ã€€ã€€ã€€ | start     : æŠ½å‡ºé–‹å§‹ã™ã‚‹ãƒã‚¤ãƒˆä½ç½®
# ã€€ã€€ã€€ã€€ | length    : æŒ‡å®šãƒã‚¤ãƒˆæ•°
#################################################################################
Function ExtractByteSubstring {
    Param (
        [System.String]$target_str,
        [System.Int32]$start,
        [System.Int32]$length
    )

    $encoding = [System.Text.Encoding]::GetEncoding("Shift_JIS")

    # æ–‡å­—åˆ—ã‚’ãƒã‚¤ãƒˆé…åˆ—ã«å¤‰æ›
    [System.Byte[]]$all_bytes = $encoding.GetBytes($target_str)

    # æŠ½å‡ºã™ã‚‹ãƒã‚¤ãƒˆé…åˆ—ã‚’åˆæœŸåŒ–
    $extracted_bytes = New-Object Byte[] $length

    # æŒ‡å®šã•ã‚ŒãŸãƒã‚¤ãƒˆä½ç½®ã‹ã‚‰ãƒã‚¤ãƒˆé…åˆ—ã‚’æŠ½å‡º
    [System.Array]::Copy($all_bytes, $start, $extracted_bytes, 0, $length)

    # æŠ½å‡ºã—ãŸãƒã‚¤ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æ–‡å­—åˆ—ã¨ã—ã¦è¿”ã™
    return $encoding.GetString($extracted_bytes)
}
```

```powershell:å®Ÿéš›ã«å®Ÿè¡Œã—ãŸçµæœ
# 4ãƒã‚¤ãƒˆç›®ã¨5ãƒã‚¤ãƒˆç›®ã®é–“ï¼ˆ$start = 4ï¼‰ã‚’é–‹å§‹ä½ç½®ã¨ã—ã¦4ãƒã‚¤ãƒˆåˆ†ï¼ˆ$length = 4ï¼‰ã®æ–‡å­—åˆ—ã‚’æŠ½å‡º
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> ExtractByteSubstring '1234ã‚ã‹' 4 4
ã‚ã‹
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
```

ä¸Šè¨˜ã®ã¨ãŠã‚Šã€Substringãƒ¡ã‚½ãƒƒãƒ‰ã¨åŒæ§˜ã€å…ˆé ­ã‚’0ã‹ã‚‰æ•°ãˆãŸä½ç½®ã‚’é–‹å§‹ä½ç½®ã¨ã—ã¦æŠ½å‡ºã€‚

[Array.Copy ãƒ¡ã‚½ãƒƒãƒ‰ - Microsoft Learn](https://learn.microsoft.com/ja-jp/dotnet/api/system.array.copy#system-array-copy(system-array-system-int32-system-array-system-int32-system-int32))

## å‚è€ƒæƒ…å ±

https://support.microsoft.com/ja-jp/office/len-é–¢æ•°-lenb-é–¢æ•°-29236f94-cedc-429d-affd-b5e33d2c67cb
https://learn.microsoft.com/ja-jp/office/vba/language/reference/user-interface-help/len-function
https://learn.microsoft.com/ja-jp/dotnet/api/system.string.substring
https://learn.microsoft.com/ja-jp/dotnet/api/system.array.copy#system-array-copy(system-array-system-int32-system-array-system-int32-system-int32)

## ã¾ã¨ã‚

- ãƒãƒ«ãƒãƒã‚¤ãƒˆæ–‡å­—ã‚’å«ã‚€æ–‡å­—åˆ—ã‚’å›ºå®šé•·ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦åˆ¶å¾¡ã™ã‚‹å ´åˆã«ãƒã‚¤ãƒˆæ•°ã®å–å¾—ãŒå¿…è¦ã«
- Shift JIS ã§ãƒãƒ«ãƒãƒã‚¤ãƒˆæ–‡å­—ã¯ã€Œ2ãƒã‚¤ãƒˆã€ã§ã‚«ã‚¦ãƒ³ãƒˆ
- `System.Text.Encoding`ã‚¯ãƒ©ã‚¹ã§æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’SJISï¼ˆShift JISï¼‰ã§è¨­å®šã—`GetByteCount`ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒã‚¤ãƒˆæ•°ã®å–å¾—ãŒå¯èƒ½

## é–¢é€£è¨˜äº‹

https://haretokidoki-blog.com/pasocon_powershell-startup/
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960

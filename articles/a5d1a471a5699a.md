---
title: "Windows OSで一括アップデートする方法（Win Update・MS Defender・アプリ）"
emoji: "🗂"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["windows", "powershell", "update"]
published: false
---
## 概要

あらゆる自動更新機能をオフにしているWindows OS 環境でアップデートする場合、個々の管理画面に移動して更新する必要があり面倒に感じていました。

今回は、“設定”画面内の更新とセキュリティにある

- Windows Update 更新プログラム
- Microsoft Defender セキュリティー パターンファイルの更新
    Windowsセキュリティ - ウイルスと脅威の防止 - ウイルスと脅威の防止の更新

の2点とアップデート可能なアプリ（ソフトウェア）に条件はありますが、

- インストーラー版アプリ（ソース：winget）

の合計3点を一括でアップデートするPowerShellスクリプトを作成しました。

## この記事のターゲット

- Windows ユーザーの方
- 下記を手動契機で一括アップデートしたい方
    - 更新プログラム（Windows Update）
    - セキュリティー パターンファイル（Microsoft Defender）
    - インストーラー版アプリ（source = winget）
        ※ 新しいMSIX形式のMicrosoft Store版 アプリ（[UWP](https://ja.wikipedia.org/wiki/ユニバーサルWindowsプラットフォーム)）には非対応

## 前提条件

1. システムやアプリの手動アップデートを自動で行いたい場合に使用
    :::details システムやアプリを手動アップデートしている理由
    なぜ自動更新機能をオンにしないのか

    理由は単純で自動更新すると、いつ更新するのかがわからなくなるためです。

    いつ更新するのかわからなくなると、大きく2つのデメリットがあります。

    - 更新が起因となるトラブルが発生した際、切り分けが難しくなる
    - 予期しないタイミングでネットワーク負荷がかかってしまう

    限られたアプリ（ソフトウェア）や機能のみ使用しているようなシンプルな方法でパソコンを運用している方であれば、
    自動更新をオンにしていても、そこまで切り分けが難しくなる事 や ネットワーク負荷がかかる事はないと思います。

    ただ、私のようにたくさんのアプリを導入し、さまざまな用途に使用しているような複雑な方法でパソコンを運用している方であれば、
    勝手に更新がかかるリスクが大きいと感じます。
    :::

1. Windows Update は PowerShellのモジュール「PSWindowsUpdate」を使用
    :::details そもそもWindows Updateって何をアップデートしているのか
    [Microsoft Update](https://ja.wikipedia.org/wiki/Microsoft_Update)とは、Microsoftが提供するWindows OS の機能で Windows OS や Microsoft のアプリ（ソフトウェア）、パソコンのデバイスドライバー などのセキュリティーアップデートや不具合（バグ）対応が主に実施される。
    :::

1. Microsoft Defender は PowerShellのモジュール「ConfigDefender」を使用
    :::details Microsoft Defender を使用していない場合
    Windows OSインストール直後であればMicrosoft Defenderがインストールされている。
    追加でウイルス対策ソフトを導入している場合は、自動で無効状態になる。

    このツールでMicrosoft Defenderのアップデートを無効にしたい場合は、設定ファイル（`setup.ini`）で設定変更する必要あり。
    :::

1. インストーラー版アプリ は Windowsのパッケージ管理システム「Windows Package Manager（winget）」を使用
    :::details 対象はソースが“winget”のアプリのみ
    wingetコマンドを実行すると項目「ソース」が“winget”と“msstore”、“（空欄）”の3種類が存在する。
    
    2024年1月現在、検索するコマンド `winget search` や インストールするコマンド `winget install` については、Store版アプリも実行できるが、
    一括アップデートするコマンド [`winget upgrade`](https://learn.microsoft.com/ja-jp/windows/package-manager/winget/upgrade) では、ソースが“winget”のみが対象になっているもよう。

    今後のアップデートによりStore版アプリも一括アップデート対象になる可能性はありそう。
    :::

    :::details このツールはMicrosoft Store版アプリ（UWP）は非対応
    どうにかして[Microsoft Store](https://ja.wikipedia.org/wiki/Microsoft_Store)のアプリもアップデートできないか検証しましたが、検証した下記方法では正常に動作しませんでした。
    - モジュール「Appx」を使用した更新
    - winget 標準機能を使用した更新
    - winget 試験運用中の機能を使用した更新
        winget の settings.jsonファイルで“experimentalFeatures - experimentalMSStore”の機能を使用。
        2024年1月現在、[こちらの公式ページ](https://github.com/microsoft/winget-cli/blob/master/doc/Settings.md)を確認すると、試験運用の設定にStore関連の項目がありませんでした。
        おそらく、以前あったStoreの設定「experimentalMSStore」の試験運用は終わっている。
        その結果、設定ファイルを変更せずとも `winget search` や `winget install` などのコマンドでStore版のアプリが指定できるようになっていると思われる。
    
    - 参考情報：従来のインストーラー版アプリ「MSI」とStore版のアプリ「MSIX」の違い
        https://atmarkit.itmedia.co.jp/ait/articles/2206/14/news008.html
    :::

## 事前作業

### PowerShell Coreのインストール

- 検索キーワードの例
    Windows 10 の場合「[`windows 10` ＋ `powershell` ＋ `core` ＋ `インストール`](https://www.google.com/search?q=windows+10+powershell+core+インストール)」
    Windows 11 の場合「[`windows 11` ＋ `powershell` ＋ `core` ＋ `インストール`](https://www.google.com/search?q=windows+11+powershell+core+インストール)」

// TODO: 手順を記載する

### wingetコマンドの有効化

- 検索キーワードの例
    Windows 10 の場合「[`windows 10` ＋ `winget` ＋ `インストール`](https://www.google.com/search?q=windows+10+winget+インストール)」
    Windows 11 の場合「[`windows 11` ＋ `winget` ＋ `インストール`](https://www.google.com/search?q=windows+11+winget+インストール)」

// TODO: 手順を記載する
https://atmarkit.itmedia.co.jp/ait/articles/2106/11/news021.html

## 自動化

// TODO: 一度、プライベートリポジトリで全体のソースコードを作成してみる

### 全般：PowerShellで対象のモジュールが導入されていない場合、自動でインストールするコード

### Windows Update

#### 公開モジュール「PSWindowsUpdate」を導入する方法

https://note.com/mahalo_/n/n9df78a3a2afc
https://qiita.com/NoTASK/items/8ba63aea7f037599b4f5
https://boonx4m312s.hatenablog.com/entry/2023/02/02/180000

#### 参考情報：採用しなかったアップデート方法

- UsoClientコマンド
    正常に機能しなかったので、採用しなかった。
    実行ファイル「`C:\Windows\system32\UsoClient.exe`」
    
    PowerShellやコマンドプロンプトで実行してみたが、コマンド結果の返りがなく正常動作していないもよう。
    「UsoClient /?」などでヘルプ情報がなく「UsoClient StartScan」などで引数を指定しても何も返ってこない。
    
    https://jp.minitool.com/backup-tips/windows-update-command-line.html#コマンドラインからwindows-updateを実行する方法-553

- WindowsUpdateProviderモジュール

    廃止されたモジュールの為、採用しなかった。
    https://4thsight.xyz/3865

### Microsoft Defender セキュリティー パターンファイル



### Microsoft Store版 アプリ

GUIでもインストール済みのアプリを確認できるが、アプリ内で表示されているのは、追加でインストールしたアプリだけのよう。
Windows OS（私の場合、Win10）で標準インストールされているMicrosoft Store版のアプリは一覧表示されていない。

時間はかかるが、手っ取り早い確認方法は、スタートメニューにあるアプリを右クリックし、コンテキストメニュー内にアプリの設定という項目があるとMicrosoft Store版のアプリみたい。

StoreBrokerモジュールは、非推奨になる

Appxモジュールで実現できそう。
ただし、下記の通りモジュールのインストール時にエラーが出る為、対応が必要。
https://qiita.com/tsukamoto/items/ee1c58a1afb3cef468a6
→「Import-Module Appx -UseWindowsPowerShell」

:::details Bing AI < クリックで折りたたみが開く >

-----
> Microsoft Store のアプリをコマンドで更新する方法の提案を受ける ※ ただし、モジュール「MSOnline」は非推奨となるため、対象外とした。
> 
> Microsoft Storeのアプリをコマンドで更新する方法は、以下のようなものがあります。
> 
> - wingetを使用する方法
>     - wingetは、Microsoftが開発したパッケージマネージャーで、コマンドラインでさまざまなアプリをインストールや更新ができます¹。
>     - wingetをインストールするには、Microsoft Storeから「アプリ インストーラー」を入手するか、GitHubから最新版のインストーラーをダウンロードして実行します¹。
>     - wingetを使ってアプリの更新を行うには、コマンドプロンプトやPowerShellで以下のコマンドを実行します。
> 
>         ```powershell
>         # インストール済みのアプリの更新可能なものを一覧表示する
>         winget upgrade
>         # インストール済みのアプリの更新可能なものをすべて更新する
>         winget upgrade --all
>         # 特定のアプリを更新する（例：Microsoft Edge）
>         winget upgrade Microsoft.Edge
>         ```
> 
>     - wingetはまだ正式版ではなく、試験的な機能も多いので、注意して使用してください¹。
> - PowerShellを使用する方法
>     - PowerShellは、Windowsの管理や操作を行うためのスクリプト言語です²。
>     - PowerShellを使ってMicrosoft Storeのアプリを更新するには、以下のコマンドレットを使用できます³。
> 
>         ```powershell
>         # インストール済みのアプリのパッケージ情報を取得する
>         Get-AppxPackage
>         # 特定のアプリのパッケージ情報を取得する（例：Microsoft Edge）
>         Get-AppxPackage Microsoft.MicrosoftEdge
>         # インストール済みのアプリの更新を確認する
>         Get-AppxPackage | Where-Object {$_.SignatureKind -eq "Store" -and $_.IsDevelopmentMode -eq $false} | Select-Object Name, Version, UpdateAvailable
>         # インストール済みのアプリの更新を実行する
>         Get-AppxPackage | Where-Object {$_.SignatureKind -eq "Store" -and $_.IsDevelopmentMode -eq $false -and $_.UpdateAvailable -eq $true} | Update-AppxPackage
>         # 特定のアプリの更新を実行する（例：Microsoft Edge）
>         Get-AppxPackage Microsoft.MicrosoftEdge | Update-AppxPackage
>         ```
> 
>     - PowerShellを使用する場合は、管理者権限で実行する必要があることに注意してください³。
> 
> 以上の方法を参考にして、Microsoft Storeのアプリをコマンドで更新してみてください。😊
> 
> ¹: [アプリのインストールや更新をコマンドでサクっと実行「winget」の使い方：Windows 10 The Latest - ＠IT](^1^)
> ²: [PowerShell の概要 - PowerShell | Microsoft Docs](^2^)
> ³: [Microsoft Store アプリケーションのインストール（Powershell スクリプト）](^4^)
> 
> ソース: Bing との会話 2023/12/8
> (1) アプリのインストールや更新をコマンドでサクっと実行「winget .... https://atmarkit.itmedia.co.jp/ait/articles/2106/11/news021.html.
> (2) “Microsoft Store”のアプリもコマンドラインで導入 ～Microsoft .... https://forest.watch.impress.co.jp/docs/news/1278785.html.
> (3) Microsoft Store アプリの手動アップデートとインストール - パソブル. https://bing.com/search?q=Windows+10+Microsoft+Store+%e3%82%a2%e3%83%97%e3%83%aa+%e6%9b%b4%e6%96%b0+%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89.
> (4) アプリのインストールや更新をコマンドでサクっと実行「winget .... https://atmarkit.itmedia.co.jp/ait/articles/2106/11/news021.html.
> (5) “Microsoft Store”のアプリもコマンドラインで導入 ～Microsoft .... https://forest.watch.impress.co.jp/docs/news/1278785.html.
> (6) 「Microsoft Store」ストアアプリの更新プログラムを手動で取得 .... https://dynabook.com/assistpc/faq/pcdata3/018855.htm.
> (7) Microsoft store自体を再インストールしたい。. https://answers.microsoft.com/ja-jp/windows/forum/all/microsoft/7d0a8ba4-cf3d-45ba-a1dd-3b0a49c85d48.
> (8) upgrade コマンド | Microsoft Learn. https://learn.microsoft.com/ja-jp/windows/package-manager/winget/upgrade.
> 
> Get-AppxPackageの項目「IsDevelopmentMode」について
> 
> 「IsDevelopmentMode」とは、アプリ パッケージが開発モードでインストールされているかどうかを示すプロパティです¹。開発モードとは、開発者が自分のアプリをテストやデバッグするために使用するモードで、サイドローディングやリモートデバッグなどの機能を有効にします²。開発モードでインストールされたアプリは、通常のアプリとは異なる動作をする場合があります³。例えば、開発モードでインストールされたアプリは、アプリの更新を受け取らない場合があります⁴。
> 
> 開発モードでインストールされたアプリの一覧を表示するには、以下のコマンドを実行します。
> 
> ```powershell
> Get-AppxPackage | Where-Object IsDevelopmentMode -eq $true
> ```
> 
> 開発モードでインストールされていないアプリの一覧を表示するには、以下のコマンドを実行します。
> 
> ```powershell
> Get-AppxPackage | Where-Object IsDevelopmentMode -eq $false
> ```
> 
> 開発モードでインストールされたアプリを通常のアプリに変更するには、以下のコマンドを実行します。
> 
> ```powershell
> Get-AppxPackage | Where-Object IsDevelopmentMode -eq $true | Foreach {Add-AppxPackage -DisableDevelopmentMode -Register "$($_.InstallLocation)\AppXManifest.xml"}
> ```
> 
> 以上が、「IsDevelopmentMode」というプロパティについての説明です。参考になれば幸いです。😊
> 
> ¹: [Get-AppxPackage (Appx)](^2^)
> ²: [開発者モードを有効にする - UWP applications | Microsoft Docs](^5^)
> ³: [Windows 10のシステムアプリをPowerShellで削除する方法 ...](^1^)
> ⁴: [Microsoft Store アプリケーションのインストール（Powershell スクリプト）](^4^)
> 
> ソース: Bing との会話 2023/12/8
> (1) Windows 11のシステムアプリをPowerShellで削除する方法 .... https://www.tunesbro.jp/blog/how-to-remove-windows-11-system-apps-using-powershell.html.
> (2) DISM アプリ パッケージ (.appx または .appxbundle) サービス .... https://learn.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/dism-app-package--appx-or-appxbundle--servicing-command-line-options?view=windows-11.
> (3) 対処したこと - DevelopersIO. https://dev.classmethod.jp/articles/aws-workspaces-image-checker-error-appx/.
> (4) List AppxPackages by IsFramework = True - Stack Overflow. https://stackoverflow.com/questions/69842368/list-appxpackages-by-isframework-true.
> (5) DISM アプリ パッケージ (.appx または .appxbundle) サービス .... https://learn.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/dism-app-package--appx-or-appxbundle--servicing-command-line-options?view=windows-11.
> (6) Get-Appxpackage アクセスが拒否されました: すぐに修正する方法. https://thewindowsclub.blog/get-appxpackage-access-is-denied-how-to-quickly-fix-it/.
> (7) Windows 11のシステムアプリをPowerShellで削除する方法 .... https://www.tunesbro.jp/blog/how-to-remove-windows-11-system-apps-using-powershell.html.
> (8) List AppxPackages by IsFramework = True - Stack Overflow. https://stackoverflow.com/questions/69842368/list-appxpackages-by-isframework-true.
> 
> PowerShellのモジュール「Appx」を使用したインストール済みのアプリを更新するコード
> 
> Microsoft Storeのアプリを更新するコードを作成するのは難しいですが、できるだけ近いものを試してみます。以下のコードブロックに示すように、Appxというモジュールのコマンドレットを使用することができます。
> 
> ```powershell
> # Appxモジュールをインポートする
> Import-Module Appx
> # インストール済みのアプリのパッケージ情報を取得する
> $packages = Get-AppxPackage
> # インストール済みのアプリの更新を確認する
> foreach ($package in $packages) {
>     # アプリがMicrosoft Storeからインストールされたものであることを確認する
>     if ($package.SignatureKind -eq "Store") {
>         # アプリの名前とバージョンを表示する
>         Write-Host "$($package.Name) $($package.Version)"
>         # アプリの更新があるかどうかを確認する
>         if ($package.UpdateAvailable) {
>             # アプリの更新がある場合は、更新を実行する
>             Write-Host "Updating $($package.Name)..."
>             Update-AppxPackage -Package $package
>         }
>         else {
>             # アプリの更新がない場合は、メッセージを表示する
>             Write-Host "$($package.Name) is up to date."
>         }
>     }
> }
> ```
> 
> このコードは、インストール済みのアプリのパッケージ情報を取得し、それぞれについて更新の有無をチェックして、更新があれば実行するという処理を行います。ただし、このコードは完全にテストされていないので、実行する前に注意してください。また、このコードはあくまで参考例であり、正確性や安全性を保証するものではありません。自己責任でご利用ください。😊

:::

```powershell:モジュール「Appx」をインストール
PS C:\Users\"ユーザー名"> Import-Module Appx -UseWindowsPowerShell
WARNING: Module Appx is loaded in Windows PowerShell using WinPSCompatSession remoting session; please note that all input and output of commands from this module will be deserialized objects. If you want to load this module into PowerShell please use 'Import-Module -SkipEditionCheck' syntax.
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名">
```

```powershell:
PS C:\Users\"ユーザー名"> Get-Command -Module Appx

CommandType     Name                                               Version    Source
-----------     ----                                               -------    ------
Alias           Add-AppPackage                                     1.0        Appx
Alias           Add-AppPackageVolume                               1.0        Appx
Alias           Dismount-AppPackageVolume                          1.0        Appx
Alias           Get-AppPackage                                     1.0        Appx
Alias           Get-AppPackageLastError                            1.0        Appx
Alias           Get-AppPackageLog                                  1.0        Appx
Alias           Get-AppPackageManifest                             1.0        Appx
Alias           Get-AppPackageVolume                               1.0        Appx
Alias           Mount-AppPackageVolume                             1.0        Appx
Alias           Move-AppPackage                                    1.0        Appx
Alias           Remove-AppPackage                                  1.0        Appx
Alias           Remove-AppPackageVolume                            1.0        Appx
Alias           Set-AppPackageDefaultVolume                        1.0        Appx
Function        Add-AppxPackage                                    1.0        Appx
Function        Add-AppxVolume                                     1.0        Appx
Function        Dismount-AppxVolume                                1.0        Appx
Function        Get-AppxDefaultVolume                              1.0        Appx
Function        Get-AppxLastError                                  1.0        Appx
Function        Get-AppxLog                                        1.0        Appx
Function        Get-AppxPackage                                    1.0        Appx
Function        Get-AppxPackageManifest                            1.0        Appx
Function        Get-AppxVolume                                     1.0        Appx
Function        Invoke-CommandInDesktopPackage                     1.0        Appx
Function        Mount-AppxVolume                                   1.0        Appx
Function        Move-AppxPackage                                   1.0        Appx
Function        Remove-AppxPackage                                 1.0        Appx
Function        Remove-AppxVolume                                  1.0        Appx
Function        Set-AppxDefaultVolume                              1.0        Appx

PS C:\Users\"ユーザー名">
```

→ Update-AppxPackageコマンドレットは存在しない。かつ、Appxモジュールをインストールして検証しようとしたが、
　 正常に動作しなかった為、この対応方法は見送る。

## wingetを使ってMicrosoft Store アプリを更新する方法

:::details Bing AI
> 
> winget の対象アプリに Microsoft Store アプリ を追加する方法
-----
> 
> こんにちは、こちらは Bing です。😊
> winget は Windows のコマンドラインからアプリを管理するツールですが、Microsoft Store アプリもインストールできるようになりました。¹²
> Microsoft Store アプリをインストールするには、次の手順を実行してください。
> 
> 1. winget の設定ファイルを開きます。コマンドプロンプトに `winget settings` と入力して Enter キーを押します。
> 2. 設定ファイルの `experimentalMSStore` 項目を `true` に書き換えます。³
> 3. 設定ファイルを保存して閉じます。
> 4. Microsoft Store アプリを検索します。コマンドプロンプトに `winget search アプリ名 --source msstore` と入力して Enter キーを押します。⁴
> 5. Microsoft Store アプリをインストールします。コマンドプロンプトに `winget install "アプリ名" --source msstore` と入力して Enter キーを押します。アプリ名にスペースが含まれる場合は、ダブルクォーテーションで囲みます。
> 
> 以上で、winget を使って Microsoft Store アプリをインストールする方法をご紹介しました。winget はまだ開発中のツールなので、今後も新しい機能が追加される可能性があります。² ご質問やご意見がありましたら、お気軽にお聞かせください。😊
> 
> ソース: Bing との会話 2023/12/26
> (1) wingetでMicrosoft Storeアプリをダウンロードする - マイナビニュース. https://news.mynavi.jp/article/win11tips-16/.
> (2) winget ツールを使用したアプリケーションのインストールと管理 .... https://learn.microsoft.com/ja-jp/windows/package-manager/winget/.
> (3) “Microsoft Store”のアプリもコマンドラインで導入 ～Microsoft .... https://forest.watch.impress.co.jp/docs/news/1278785.html.
> (4) Windows Package ManagerでMicrosoft Storeをソースに指定する. https://news.mynavi.jp/article/win11tips-84/.
> (5) undefined. https://aka.ms/getwinget.
> (6) undefined. https://aka.ms/Microsoft.VCLibs.x64.14.00.Desktop.appx.
> (7) undefined. https://github.com/microsoft/microsoft-ui-xaml/releases/download/v2.7.3/Microsoft.UI.Xaml.2.7.x64.appx.
> (8) undefined. https://github.com/microsoft/winget-cli/releases.
:::

winget experimentalFeaturesの参考情報
https://github.com/microsoft/winget-cli/blob/master/doc/Settings.md

1. コマンド実行
    settings.jsonファイルが開く。jsonファイルに関連付けされているアプリケーションで開こうとするため、
    環境によっては、開かない場合がある。

    私の環境だと下記のパスにある「settings.json」が開いた。
    `C:\Users\"ユーザー名"\AppData\Local\Packages\Microsoft.DesktopAppInstaller_8wekyb3d8bbwe\LocalState`

    ```powershell:
    PS C:\Users\"ユーザー名"> winget settings
    PS C:\Users\"ユーザー名">
    ```

1. wingetの設定ファイル（settings.json）の編集

    ```diff json:winget - settings.json（Microsoft Store アプリを有効）
    {
        "$schema": "https://aka.ms/winget-settings.schema.json",

        // For documentation on these settings, see: https://aka.ms/winget-settings
        // "source": {
        //    "autoUpdateIntervalInMinutes": 5
        // },
    +    
    +"experimentalFeatures": {
    +        "experimentalMSStore": true
    +    }
    +}
    ```

1. wingetコマンドでMicrosoft Store アプリも対象となっている事を確認

    ```powershell:

    ```

### インストーラー版 アプリ（ソフトウェア）

## Windows パッケージ マネージャー - upgrade コマンド（winget）

<https://answers.microsoft.com/ja-jp/windows/forum/all/akamsにつきまし/cc2b5536-8cac-4346-ab8d-658a669b8872>

アップデート対象となるソフトウェア側で制御がない場合、サポート対象外となったデバイスに対しても
ソフトウェアの更新がかかる事がある。

:::details 互換性がないのにアップデートが実行された「Dell Display Managerアプリケーション」 < クリックで折りたたみが開く >

「Dell E2218HN」だったがアップデートが1.xから2.xになり使用できなくなった。

> ✅ 公式サイトから互換性のあるシステムを抜粋
> 
> Alienware 25 Gaming Monitor AW2521HF
> Alienware 25 Gaming Monitor AW2521HFA
> Alienware 25 Gaming Monitor AW2521HFL
> Alienware 25 Gaming Monitor AW2521HFLA
> Alienware 25 Gaming Monitor AW2523HF
> Alienware 27 Gaming Monitor AW2720HF
> Alienware 27 Gaming Monitor AW2720HFA
> Alienware 27 Gaming Monitor AW2723DF
> Alienware 27 Gaming Monitor AW2724DM
> Alienware 27 Gaming Monitor AW2724HF
> Alienware 34 Curved QD OLED Gaming Monitor AW3423DWF
> Alienware 500Hz Gaming Monitor AW2524HF
> Alienware 55 OLED Monitor AW5520QF
> Dell 24 Curved Gaming Monitor S2422HG
> Dell 24 Gaming Monitor G2422HS
> Dell 24 Video Conferencing Monitor I C2422HE
> Dell 25 Gaming Monitor G2524H
> Dell 25 Gaming Monitor S2522HG
> Dell 27 Curved Gaming Monitor S2722DGM
> Dell 27 Gaming Monitor G2722HS
> Dell 27 Gaming Monitor G2723H
> Dell 27 Gaming Monitor G2723HN
> Dell 27 Gaming Monitor G2724D
> Dell 27 Gaming Monitor S2721DGF
> Dell 27 Video Conferencing Monitor I C2722DE
> Dell 32 4K UHD Gaming Monitor G3223Q
> Dell 32 Curved Gaming Monitor S3222DGM
> Dell 32 Curved Gaming Monitor S3222HG
> Dell 32 Gaming Monitor G3223D
> Dell 34 Curved Gaming Monitor S3422DWG
> Dell 34 Video Conferencing Curved Monitor I C3422WE
> Dell C2423H
> Dell C2723H Monitor
> Dell C5519Q
> Dell C5519QA
> Dell C5522QT
> Dell C6522QT
> Dell C7520QT
> Dell C8621QT
> Dell Display and Peripheral Manager
> Dell Display Manager 2.x
> Dell E1715S
> Dell E1916HV
> Dell E1920H
> Dell E2016HV
> Dell E2020H
> Dell E2219HN
> Dell E2220H
> Dell E2221HN
> Dell E2222H
> Dell E2222HS
> Dell E2223HN
> Dell E2223HV
> Dell E2420H
> Dell E2420HS
> Dell E2421HN
> Dell E2422H
> Dell E2422HN
> Dell E2422HS
> Dell E2423H
> Dell E2423HN
> Dell E2424HS
> Dell E2720H
> Dell E2720HS
> Dell E2722H
> Dell E2722HS
> Dell E2723H
> Dell E2723HN
> Dell E2724HS
> Dell Gaming S2421HGF
> Dell Gaming S2721HGF
> Dell Gaming S2721HGFA
> Dell P1424H
> Dell P1917S
> Dell P2219H
> Dell P2219HC
> Dell P2222H
> Dell P2223HC
> Dell P2319H
> Dell P2418HT
> Dell P2419H
> Dell P2419HC
> Dell P2421
> Dell P2421D
> Dell P2421DC
> Dell P2422H
> Dell P2422HA
> Dell P2422HE
> Dell P2423
> Dell P2423D
> Dell P2423DE
> Dell P2424HEB
> Dell P2424HT
> Dell P2719H
> Dell P2719HC
> Dell P2720D
> Dell P2720DC
> Dell P2721Q
> Dell P2722H
> Dell P2722HE
> Dell P2723D
> Dell P2723DE
> Dell P2723QE
> Dell P2724DEB
> Dell P3221D
> Dell P3222QE
> Dell P3223DE
> Dell P3223QE
> Dell P3421W
> Dell P3424WE
> Dell P3424WEB
> Dell P5524Q
> Dell P5524QT
> Dell P6524QT
> Dell P7524QT
> Dell P8624QT
> Dell S2319H
> Dell S2319HN
> Dell S2319HS
> Dell S2319NX
> Dell S2419H
> Dell S2419HGF
> Dell S2419HM
> Dell S2419HN
> Dell S2419NX
> Dell S2421H
> Dell S2421HN
> Dell S2421HS
> Dell S2421HSX
> Dell S2421NX
> Dell S2422HZ
> Dell S2719DC
> Dell S2719DGF
> Dell S2719DM
> Dell S2719H
> Dell S2719HN
> Dell S2719HS
> Dell S2719NX
> Dell S2721D
> Dell S2721DGFA
> Dell S2721DS
> Dell S2721H
> Dell S2721HN
> Dell S2721HS
> Dell S2721HSX
> Dell S2721NX
> Dell S2721Q
> Dell S2721QS
> Dell S2721QSA
> Dell S2722DC
> Dell S2722DZ
> Dell S2722QC
> Dell S2723HC
> Dell S3219D
> Dell S3220DGF
> Dell S3221QS
> Dell S3221QSA
> Dell S3222HN
> Dell S3222HS
> Dell S3422DW
> Dell S3423DWC
> Dell SE2219H/SE2219HX
> Dell SE2222H
> Dell SE2222HV
> Dell SE2419H/SE2419HX
> Dell SE2419HR
> Dell SE2422H
> DELL SE2422HM
> Dell SE2422HR
> Dell SE2422HX
> Dell SE2423DS
> Dell SE2719H
> Dell SE2719HR
> Dell SE2722H
> Dell SE2722HR
> Dell SE2722HX
> Dell SE2723DS
> Dell SE3223Q
> Dell U2419H
> Dell U2419HC
> Dell U2419HS
> Dell U2421E
> Dell U2421HE
> Dell U2422H
> Dell U2422HE
> Dell U2422HX
> Dell U2424H
> Dell U2424HE
> Dell U2520D
> Dell U2520DR
> Dell U2719D
> Dell U2719DC
> Dell U2719DS
> Dell U2720Q
> Dell U2720QM
> Dell U2721DE
> Dell U2722D
> Dell U2722DE
> Dell U2722DX
> Dell U2723QE
> Dell U2723QX
> Dell U2724D
> Dell U2724DE
> Dell U3023E
> Dell U3219Q
> Dell U3223QE
> Dell U3223QZ
> Dell U3224KB
> Dell U3224KBA
> Dell U3419W
> Dell U3421WE
> Dell U3423WE
> Dell U3821DW
> Dell U3824DW
> Dell U4021QW
> Dell U4320Q
> Dell U4323QE
> Dell U4919DW
> Dell U4924DW
> Dell UP2720Q
> Dell UP2720QA
> Dell UP3218K
> Dell UP3218KA
> Dell UP3221Q
> 
> 引用元：[Dell Display Managerアプリケーション → 詳細情報 → 互換性のあるシステム](https://www.dell.com/support/home/ja-jp/drivers/driversdetails?driverid=yc3cv&oscode=wt64a&productcode=dell-display-manager-2.0)

:::

## Install-PackageProvider でインストールしたNuGetをアンインストールする方法

Get-PackgeProvider や Install-PackageProvider はあるが、 Uninstall-PackageProvider がなかったので調査。
https://stackoverflow.com/questions/32508133/powershell-packagemanagement-how-to-uninstall-a-package-provider
→ Uninstall-PackageProvider はない。Install-PackageProviderでは該当のDLLファイルが格納されるだけなので、
　 格納先を調べて削除すれば、アンインストールは完了となる。

```powershell:PowerShell 5.x にてNuGetの格納先を確認した結果
PS C:\WINDOWS\system32> (Get-PackageProvider -Name NuGet).ProviderPath
C:\Program Files\PackageManagement\ProviderAssemblies\nuget\2.8.5.208\Microsoft.PackageManagement.NuGetProvider.dll
PS C:\WINDOWS\system32>
```

```powershell:PowerShell 7.x にてNuGetの格納先を確認した結果
PS C:\Users\"ユーザー名"> (Get-PackageProvider -Name NuGet).ProviderPath
C:\program files\powershell\7\Modules\PackageManagement\coreclr\netstandard2.0\Microsoft.PackageManagement.NuGetProvider.dll
PS C:\Users\"ユーザー名">
```

## Get-UpdateWindows で モジュールを読み込めないエラーが発生した場合

```powershell:
PS C:\WINDOWS\system32>
PS C:\WINDOWS\system32> Get-WindowsUpdate
Get-WindowsUpdate : 'Get-WindowsUpdate' コマンドはモジュール 'PSWindowsUpdate' で見つかりましたが、このモジュールを読み
込むことができませんでした。詳細については、'Import-Module PSWindowsUpdate' を実行してください。
発生場所 行:1 文字:1
+ Get-WindowsUpdate
+ ~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (Get-WindowsUpdate:String) [], CommandNotFoundException
    + FullyQualifiedErrorId : CouldNotAutoloadMatchingModule

PS C:\WINDOWS\system32>
PS C:\WINDOWS\system32> Get-ExecutionPolicy
Restricted
PS C:\WINDOWS\system32>
PS C:\WINDOWS\system32> Set-ExecutionPolicy RemoteSigned

実行ポリシーの変更
実行ポリシーは、信頼されていないスクリプトからの保護に役立ちます。実行ポリシーを変更すると、about_Execution_Policies
のヘルプ トピック (https://go.microsoft.com/fwlink/?LinkID=135170)
で説明されているセキュリティ上の危険にさらされる可能性があります。実行ポリシーを変更しますか?
[Y] はい(Y)  [A] すべて続行(A)  [N] いいえ(N)  [L] すべて無視(L)  [S] 中断(S)  [?] ヘルプ (既定値は "N"): a
PS C:\WINDOWS\system32>
```

## Microsoft Defender コマンドレットで操作

各種コマンド
https://4thsight.xyz/8270

Get-MpComputerStatusをはじめとするソフト起動状態を確認するコマンド。
https://qiita.com/shiso_no_ha/items/3b10119c564a86a214bc

```powershel:無効状態の場合
PS C:\Users\"ユーザー名"> Get-MpComputerStatus

RunspaceId                      : 7eadbb29-914e-4afe-9ce2-c530c28ea9e2
AMEngineVersion                 : 0.0.0.0
AMProductVersion                : 4.18.2110.6
AMRunningMode                   : Not running
AMServiceEnabled                : False
AMServiceVersion                : 0.0.0.0
AntispywareEnabled              : False
AntispywareSignatureAge         : 4294967295
AntispywareSignatureLastUpdated :
AntispywareSignatureVersion     : 0.0.0.0
AntivirusEnabled                : False
AntivirusSignatureAge           : 4294967295
AntivirusSignatureLastUpdated   :
AntivirusSignatureVersion       : 0.0.0.0
BehaviorMonitorEnabled          : False
ComputerID                      : 5A9EE102-0E80-43D9-AFA8-29B1BDFE2448
ComputerState                   : 0
FullScanAge                     : 4294967295
FullScanEndTime                 :
FullScanStartTime               :
IoavProtectionEnabled           : False
IsTamperProtected               : False
IsVirtualMachine                : False
LastFullScanSource              : 0
LastQuickScanSource             : 0
NISEnabled                      : False
NISEngineVersion                : 0.0.0.0
NISSignatureAge                 : 4294967295
NISSignatureLastUpdated         :
NISSignatureVersion             : 0.0.0.0
OnAccessProtectionEnabled       : False
QuickScanAge                    : 4294967295
QuickScanEndTime                :
QuickScanStartTime              :
RealTimeProtectionEnabled       : False
RealTimeScanDirection           : 0
TamperProtectionSource          : Signatures
TDTMode                         : N/A
TDTStatus                       : N/A
TDTTelemetry                    : N/A


PS C:\Users\"ユーザー名">
```

```powershell:有効状態の場合
PS C:\WINDOWS\system32> Get-MpComputerStatus


AMEngineVersion                  : 1.1.23110.2
AMProductVersion                 : 4.18.23110.3
AMRunningMode                    : Normal
AMServiceEnabled                 : True
AMServiceVersion                 : 4.18.23110.3
AntispywareEnabled               : True
AntispywareSignatureAge          : 1
AntispywareSignatureLastUpdated  : 2023/12/17 10:21:52
AntispywareSignatureVersion      : 1.403.636.0
AntivirusEnabled                 : True
AntivirusSignatureAge            : 1
AntivirusSignatureLastUpdated    : 2023/12/17 10:21:51
AntivirusSignatureVersion        : 1.403.636.0
BehaviorMonitorEnabled           : True
ComputerID                       : 88F7AE83-8CD0-D5C6-16D2-3E90E19DB3E3
ComputerState                    : 0
DefenderSignaturesOutOfDate      : False
DeviceControlDefaultEnforcement  :
DeviceControlPoliciesLastUpdated : 2023/03/28 14:38:58
DeviceControlState               : Disabled
FullScanAge                      : 4294967295
FullScanEndTime                  :
FullScanOverdue                  : False
FullScanRequired                 : False
FullScanSignatureVersion         :
FullScanStartTime                :
InitializationProgress           : ServiceStartedSuccessfully
IoavProtectionEnabled            : True
IsTamperProtected                : True
IsVirtualMachine                 : False
LastFullScanSource               : 0
LastQuickScanSource              : 2
NISEnabled                       : True
NISEngineVersion                 : 1.1.23110.2
NISSignatureAge                  : 1
NISSignatureLastUpdated          : 2023/12/17 10:21:51
NISSignatureVersion              : 1.403.636.0
OnAccessProtectionEnabled        : True
ProductStatus                    : 524288
QuickScanAge                     : 2
QuickScanEndTime                 : 2023/12/15 17:14:45
QuickScanOverdue                 : False
QuickScanSignatureVersion        : 1.403.523.0
QuickScanStartTime               : 2023/12/15 17:08:29
RealTimeProtectionEnabled        : True
RealTimeScanDirection            : 0
RebootRequired                   : False
SmartAppControlExpiration        :
SmartAppControlState             : Off
TamperProtectionSource           : Signatures
TDTMode                          : N/A
TDTSiloType                      : N/A
TDTStatus                        : N/A
TDTTelemetry                     : N/A
TroubleShootingDailyMaxQuota     :
TroubleShootingDailyQuotaLeft    :
TroubleShootingEndTime           :
TroubleShootingExpirationLeft    :
TroubleShootingMode              :
TroubleShootingModeSource        :
TroubleShootingQuotaResetTime    :
TroubleShootingStartTime         :
PSComputerName                   :



PS C:\WINDOWS\system32>
```

## Import-Module Appx で発生するエラー

https://qiita.com/tsukamoto/items/ee1c58a1afb3cef468a6

PS C:\Users\"ユーザー名"> Import-Module -Name 'APPX' -UseWindowsPowerShell
WARNING: Module APPX is loaded in Windows PowerShell using WinPSCompatSession remoting session; please note that all input and output of commands from this module will be deserialized objects. If you want to load this module into PowerShell please use 'Import-Module -SkipEditionCheck' syntax.
PS C:\Users\"ユーザー名">

削除は

PS C:\Users\"ユーザー名"> Remove-Module appx
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> get-module

ModuleType Version    PreRelease Name                                ExportedCommands
---------- -------    ---------- ----                                ----------------
Script     1.0                   ConfigDefender                      {Add-MpPreference, Get-MpComputerStatus, Get-MpPe…
Manifest   7.0.0.0               Microsoft.PowerShell.Management     {Add-Content, Clear-Content, Clear-Item, Clear-It…
Manifest   7.0.0.0               Microsoft.PowerShell.Utility        {Add-Member, Add-Type, Clear-Variable, Compare-Ob…
Script     1.4.8.1               PackageManagement                   {Find-Package, Find-PackageProvider, Get-Package,…
Script     2.2.5                 PowerShellGet                       {Find-Command, Find-DscResource, Find-Module, Fin…
Script     2.2.6                 PSReadLine                          {Get-PSReadLineKeyHandler, Get-PSReadLineOption, …
Binary     2.2.1.4               PSWindowsUpdate                     {Add-WUServiceManager, Enable-WURemoting, Get-Win…

PS C:\Users\"ユーザー名">

## Install-Module と Import-Module の違い

> PowerShellのコマンドレットである「Install-Module」と「Import-Module」の違い
　
> PowerShellのコマンドレットである「Install-Module」と「Import-Module」は、それぞれ異なる目的と機能を持っています。
> 
> - **Install-Module**¹⁴: このコマンドレットは、PowerShellGetリポジトリから一つ以上のモジュールをダウンロードし、ローカルコンピューターにインストールします。指定したモジュールの最小、最大、および正確なバージョンに基づいて、インストールされているモジュールをフィルター処理できます。ただし、インストールされたモジュールは、インストール後に自動的にインポートされません。
> 
> - **Import-Module**²³⁵: このコマンドレットは、現在のセッションにモジュールを追加します。インポートは、ユーザーがPowerShellセッションでモジュールにアクセスできるよう、モジュールをアクティブなメモリに読み込むプロセスです。
> 
> つまり、`Install-Module`はモジュールをダウンロードしてインストールするためのコマンドであり、`Import-Module`は既にインストールされているモジュールを現在のセッションに読み込むためのコマンドです。これらのコマンドは一緒に使われることが多く、モジュールをダウンロードしてインストールした後、そのモジュールを使用するためには`Import-Module`で読み込む必要があります。¹²³⁴⁵
> 
> ソース: Bing との会話 2023/12/18
> (1) Install-Module (PowerShellGet) - PowerShell | Microsoft Learn. https://learn.microsoft.com/ja-jp/powershell/module/powershellget/install-module?view=powershellget-3.x.
> (2) 【 Install-Module 】コマンドレット――PowerShellで利用可能な .... https://atmarkit.itmedia.co.jp/ait/articles/2010/30/news007.html.
> (3) Import-Module (Microsoft.PowerShell.Core) - PowerShell. https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/import-module?view=powershell-7.4.
> (4) PowerShell モジュールをインポートする - PowerShell .... https://learn.microsoft.com/ja-jp/powershell/scripting/developer/module/importing-a-powershell-module?view=powershell-7.2.
> (5) Import-Module - Forsenergy. https://forsenergy.com/ja-jp/windowspowershellhelp/html/2945afb3-1497-4b5c-befb-6d5fb0d3c946.htm.

## Update-AppxPackage は使えない？

Update-AppxPackage を実行してもエラーとなる。

```powershell:
PS C:\Users\"ユーザー名"> Update-AppxPackage
Update-AppxPackage: The term 'Update-AppxPackage' is not recognized as a name of a cmdlet, function, script file, or executable program.
Check the spelling of the name, or if a path was included, verify that the path is correct and try again.
PS C:\Users\"ユーザー名">
```

https://ascii.jp/elem/000/004/124/4124450/
→ こちらの記事でRemoveしてからAddしている

```powershell:
PS C:\Users\"ユーザー名"> Remove-AppxPackage Microsoft.SkypeApp -AllUsers^C
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> $Package = Get-AppxPackage Microsoft.SkypeApp -AllUsers
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Remove-AppxPackage $Package
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Add-AppxPackage $Package
Add-AppxPackage: パス 'C:\Users\"ユーザー名"\Microsoft.SkypeApp_15.110.3218.0_x64__kzf8qxf38zg5c' が存在しないため検 出できません。
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Add-AppxPackage $Package
Add-AppxPackage: パス 'C:\Users\"ユーザー名"\Microsoft.SkypeApp_15.110.3218.0_x64__kzf8qxf38zg5c' が存在しないため検 出できません。
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Add-AppxPackage

コマンド パイプライン位置 1 のコマンドレット Add-AppxPackage
次のパラメーターに値を指定してください:
Path:
PS C:\Users\"ユーザー名"> Add-AppxPackage Microsoft.SkypeApp
Add-AppxPackage: パス 'C:\Users\"ユーザー名"\Microsoft.SkypeApp' が存在しないため検出できません。
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Add-AppxPackage Microsoft.SkypeApp
```

Add-AppxPackage で登録する方法
https://qiita.com/sengoku/items/49ee1a35b88b65936d90
→これにはRegisterオプションがあった。

https://learn.microsoft.com/ja-jp/powershell/module/appx/add-appxpackage?view=windowsserver2022-ps
→これにUpdateオプションがある事がわかった。

```powershell:appxで検証したがNG
PS C:\Users\"ユーザー名"> Remove-AppxPackage 'Microsoft.SkypeApp' -AllUsers
Remove-AppxPackage: パラメーターが間違っています。

無効な引数が渡されたため、パッケージ マネージャーは Remove 操作を中止しました: Microsoft.SkypeApp。
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Remove-AppxPackage Microsoft.SkypeApp -AllUsers
Remove-AppxPackage: パラメーターが間違っています。

無効な引数が渡されたため、パッケージ マネージャーは Remove 操作を中止しました: Microsoft.SkypeApp。
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Remove-AppxPackage Microsoft.SkypeApp -AllUsers^C
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> $Package = Get-AppxPackage Microsoft.SkypeApp -AllUsers
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Remove-AppxPackage $Package
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Add-AppxPackage $Package
Add-AppxPackage: パス 'C:\Users\"ユーザー名"\Microsoft.SkypeApp_15.110.3218.0_x64__kzf8qxf38zg5c' が存在しないため検 出できません。
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Add-AppxPackage $Package
Add-AppxPackage: パス 'C:\Users\"ユーザー名"\Microsoft.SkypeApp_15.110.3218.0_x64__kzf8qxf38zg5c' が存在しないため検 出できません。
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Add-AppxPackage

コマンド パイプライン位置 1 のコマンドレット Add-AppxPackage
次のパラメーターに値を指定してください:
Path:
PS C:\Users\"ユーザー名"> Add-AppxPackage Microsoft.SkypeApp
Add-AppxPackage: パス 'C:\Users\"ユーザー名"\Microsoft.SkypeApp' が存在しないため検出できません。
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Add-AppxPackage Microsoft.SkypeApp^C
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Get-AppxPackage Microsoft.SkypeApp
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> $?
True
PS C:\Users\"ユーザー名"> Add-AppxPackage Microsoft.SkypeApp
Add-AppxPackage: パス 'C:\Users\"ユーザー名"\Microsoft.SkypeApp' が存在しないため検出できません。
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Get-AppxPackage Microsoft.SkypeApp
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Get-AppxPackage Microsoft.SkypeApp^C
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Get-AppxPackage -?
ResourceUnavailable: Get-Help could not find Get-AppxPackage in a help file in this session. To download updated help topics type: "Update-Help". To get help online, search for the help topic in the TechNet library at https://go.microsoft.com/fwlink/?LinkID=107116.
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Get-AppxPackage -AllUsers Microsoft.SkypeApp | Remove-AppxPackage
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Get-AppxPackage -AllUsers Microsoft.SkypeApp
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Get-AppxPackage -AllUsers Microsoft.SkypeApp | ForEach-Object { Add-AppxPackage -REgister "$($_.Installlocation)\AppXManifest.xml" }
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Get-AppxPackage -AllUsers Microsoft.SkypeApp
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Get-AppxPackage -AllUsers Microsoft.SkypeApp | ForEach-Object { Add-AppxPackage -REgister "$($_.Installlocation)\AppXManifest.xml" }
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Get-AppxPackage -AllUsers Microsoft.SkypeApp
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Get-AppxPackage -AllUsers Microsoft.SkypeApp
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Update-AppxProvisionedpackage
Update-AppxProvisionedpackage: The term 'Update-AppxProvisionedpackage' is not recognized as a name of a cmdlet, function, script file, or executable program.
Check the spelling of the name, or if a path was included, verify that the path is correct and try again.
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Update-AppxProvisionedPackage
Update-AppxProvisionedPackage: The term 'Update-AppxProvisionedPackage' is not recognized as a name of a cmdlet, function, script file, or executable program.
Check the spelling of the name, or if a path was included, verify that the path is correct and try again.
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Add-AppxPackage Microsoft.SkypeApp
Add-AppxPackage: パス 'C:\Users\"ユーザー名"\Microsoft.SkypeApp' が存在しないため検出できません。
PS C:\Users\"ユーザー名"> Get-AppxPackage Microsoft.SkypeApp

RunspaceId             : 7eadbb29-914e-4afe-9ce2-c530c28ea9e2
Name                   : Microsoft.SkypeApp
Publisher              : CN=Skype Software Sarl, O=Microsoft Corporation, L=Luxembourg, S=Luxembourg, C=LU
PublisherId            : kzf8qxf38zg5c
Architecture           : X64
ResourceId             :
Version                : 15.110.3218.0
PackageFamilyName      : Microsoft.SkypeApp_kzf8qxf38zg5c
PackageFullName        : Microsoft.SkypeApp_15.110.3218.0_x64__kzf8qxf38zg5c
InstallLocation        : C:\Program Files\WindowsApps\Microsoft.SkypeApp_15.110.3218.0_x64__kzf8qxf38zg5c
IsFramework            : False
PackageUserInformation : {}
IsResourcePackage      : False
IsBundle               : False
IsDevelopmentMode      : False
NonRemovable           : False
Dependencies           : {}
IsPartiallyStaged      : False
SignatureKind          : Store
Status                 : Ok


PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Get-AppxPackage Microsoft.SkypeApp | Add-AppxPackage
Add-AppxPackage: パス 'C:\Users\"ユーザー名"\Microsoft.SkypeApp_15.110.3218.0_x64__kzf8qxf38zg5c' が存在しないため検 出できません。
PS C:\Users\"ユーザー名"> Get-AppxPackage Microsoft.SkypeApp | Add-AppxPackage
Add-AppxPackage: パス 'C:\Users\"ユーザー名"\Microsoft.SkypeApp_15.110.3218.0_x64__kzf8qxf38zg5c' が存在しないため検 出できません。
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Get-AppxPackage Microsoft.SKypeApp | ForEach { Add-AppxPackage -Update "$($_.InstallLocation)\AppXManifest.xml" }
Add-AppxPackage: 無効なパラメーターがこの関数に渡されました。この関数には AppxManifest.xml ファイルではなく、パッケージ が必要です。AppxManifest.xml ファイルに必要な唯一の Appx API は、RegisterPackage です。
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Get-AppxPackage Microsoft.SKypeApp | ForEach { Add-AppxPackage -Update "$($_.InstallLocation)\AppxManifest.xml" }
Add-AppxPackage: 無効なパラメーターがこの関数に渡されました。この関数には AppxManifest.xml ファイルではなく、パッケージ が必要です。AppxManifest.xml ファイルに必要な唯一の Appx API は、RegisterPackage です。
PS C:\Users\"ユーザー名"> ^C
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Get-AppxPackage Microsoft.SKypeApp | ForEach { Add-AppxPackage -Update "$($_.InstallLocation)\AppxManifest.xml" }^C
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> "$($_.InstallLocation)\AppxManifest.xml
>> "
\AppxManifest.xml

PS C:\Users\"ユーザー名"> Get-AppxPackage Microsoft.SKypeApp | ForEach { Add-AppxPackage -Update $_.InstallLocation }
Add-AppxPackage: 次の HRESULT で展開に失敗しました: 0x80070005, アクセスが拒否されました。

エラー 0x80070005: 場所 Microsoft.SkypeApp_15.110.3218.0_x64__kzf8qxf38zg5c からパッケージを開くことができませんでした。

注: 詳細については、イベント ログで [ActivityId] 7078413f-2f24-0002-c01b-7e70242fda01 を検索するか、コマンド ラインの Get-AppPackageLog-ActivityId 7078413f-2f24-0002-c01b-7e70242fda01 を使用してください
PS C:\Users\"ユーザー名"> ^C
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Get-AppxPackage Microsoft.SKypeApp | ForEach { Add-AppxPackage -Update $_.InstallLocation }^C
PS C:\Users\"ユーザー名"> Get-AppxPackage Microsoft.SKypeApp

RunspaceId             : 7eadbb29-914e-4afe-9ce2-c530c28ea9e2
Name                   : Microsoft.SkypeApp
Publisher              : CN=Skype Software Sarl, O=Microsoft Corporation, L=Luxembourg, S=Luxembourg, C=LU
PublisherId            : kzf8qxf38zg5c
Architecture           : X64
ResourceId             :
Version                : 15.110.3218.0
PackageFamilyName      : Microsoft.SkypeApp_kzf8qxf38zg5c
PackageFullName        : Microsoft.SkypeApp_15.110.3218.0_x64__kzf8qxf38zg5c
InstallLocation        : C:\Program Files\WindowsApps\Microsoft.SkypeApp_15.110.3218.0_x64__kzf8qxf38zg5c
IsFramework            : False
PackageUserInformation : {}
IsResourcePackage      : False
IsBundle               : False
IsDevelopmentMode      : False
NonRemovable           : False
Dependencies           : {}
IsPartiallyStaged      : False
SignatureKind          : Store
Status                 : Ok


PS C:\Users\"ユーザー名"> Get-AppxPackage Microsoft.SKypeApp | ForEach { Add-AppxPackage -Update "$($_.InstallLocation)" }
Add-AppxPackage: 次の HRESULT で展開に失敗しました: 0x80070005, アクセスが拒否されました。

エラー 0x80070005: 場所 Microsoft.SkypeApp_15.110.3218.0_x64__kzf8qxf38zg5c からパッケージを開くことができませんでした。

注: 詳細については、イベント ログで [ActivityId] 7078413f-2f24-0002-fd1b-7e70242fda01 を検索するか、コマンド ラインの Get-AppPackageLog-ActivityId 7078413f-2f24-0002-fd1b-7e70242fda01 を使用してください
PS C:\Users\"ユーザー名"> ^C
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> e^C
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> Get-AppxPackage Microsoft.SKypeApp | ForEach { Add-AppxPackage "$($_.InstallLocation)" }
Add-AppxPackage: 次の HRESULT で展開に失敗しました: 0x80070005, アクセスが拒否されました。

エラー 0x80070005: 場所 Microsoft.SkypeApp_15.110.3218.0_x64__kzf8qxf38zg5c からパッケージを開くことができませんでした。

注: 詳細については、イベント ログで [ActivityId] 7078413f-2f24-0002-8526-7e70242fda01 を検索するか、コマンド ラインの Get-AppPackageLog-ActivityId 7078413f-2f24-0002-8526-7e70242fda01 を使用してください
PS C:\Users\"ユーザー名"> ^C
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名">
```

// TODO:    Appxを使って検証したが、NGだった。Wingetを使う方法で対応。
            おそらくWingetを使用するとMicrosoft Storeだけじゃなくインストーラー版の方もwingetで対応できるもよう。

https://astherier.com/blog/2021/08/winget-usage-1/
https://astherier.com/blog/2021/08/winget-usage-2/
https://astherier.com/blog/2021/09/winget-usage-3/

> 下記の対応を実施しましたが、「winget upgrade」でMicrosoft Store アプリが表示されません。
> ・winget インストール
> ・winget settings でsettings.jsonファイルを編集しexperimentalFeaturesの「experimentalMSStore」をtrueにする

> こんにちは、これは Bing です。お役に立てると嬉しいです。😊
> 
> winget upgrade コマンドで Microsoft Store アプリを表示するには、experimentalFeatures の「experimentalRestSource」も true にする必要があります¹。settings.json ファイルを次のように編集してみてください。
> 
> ```json
> {
>   "experimentalFeatures": {
>     "experimentalMSStore": true,
>     "experimentalRestSource": true
>   }
> }
> ```
> 
> その後、winget source update コマンドを実行して、ソースを更新してください²。これで、winget upgrade コマンドで Microsoft Store アプリが表示されるはずです。
> 
> もし、まだ表示されない場合は、アプリ インストーラーを Microsoft Store から最新バージョンに更新してください³。それでも問題が解決しない場合は、winget のプレビュー バージョンをインストールしてみてください⁴。
> 
> winget の詳細については、[こちら](^2^)の記事をご覧ください。ご質問やご意見がありましたら、お気軽にお寄せください。😊
> 
> ソース: Bing との会話 2023/12/27
> (1) upgrade コマンド | Microsoft Learn. https://learn.microsoft.com/ja-jp/windows/package-manager/winget/upgrade.
> (2) winget ツールを使用したアプリケーションのインストールと管理 .... https://learn.microsoft.com/ja-jp/windows/package-manager/winget/.
> (3) WingetがWindowsで認識されない場合の修正方法 - The .... https://thewindowsclub.blog/how-to-fix-winget-is-not-recognized-on-windows/.
> (4) アプリのインストールや更新をコマンドでサクっと実行「winget .... https://atmarkit.itmedia.co.jp/ait/articles/2106/11/news021.html.
> (5) winget ツールを使用したアプリケーションのインストールと管理 .... https://learn.microsoft.com/ja-jp/windows/package-manager/winget/.
> (6) undefined. https://aka.ms/getwinget.
> (7) undefined. https://aka.ms/Microsoft.VCLibs.x64.14.00.Desktop.appx.
> (8) undefined. https://github.com/microsoft/microsoft-ui-xaml/releases/download/v2.7.3/Microsoft.UI.Xaml.2.7.x64.appx.
> (9) undefined. https://github.com/microsoft/winget-cli/releases.
　
> winget list で実行した際の項目「ソース」に表示される種類は下記3種類があります。
> ・winget
> ・msstore
> ・空欄
> 
> この中でソースが空欄のものは、どのようなアプリを指しているのでしょうか。
　
> winget list コマンドでソースが空欄になっているアプリは、winget によってインストールされたものではなく、他の方法でインストールされたものを指しています¹。これらのアプリは、winget のソース リポジトリに登録されていないか、インストール時に使用されたパッケージ ID が一致しないため、winget によって検出できません²。
> 
> winget list コマンドの詳細については、[こちら](^1^)の記事をご覧ください。winget に関するご質問やご意見がありましたら、お気軽にお寄せください。😊
> 
> ソース: Bing との会話 2023/12/27
> (1) winget source コマンド | Microsoft Learn. https://learn.microsoft.com/ja-jp/windows/package-manager/winget/source.
> (2) list コマンド | Microsoft Learn. https://learn.microsoft.com/ja-jp/windows/package-manager/winget/list.
> (3) winget source コマンド | Microsoft Learn. https://learn.microsoft.com/ja-jp/windows/package-manager/winget/source.
> (4) undefined. https://www.contoso.com/cache.
> (5) undefined. https://winget.azureedge.net/cache.
> (6) undefined. https://pkgmgr-int.azureedge.net/cache.
→ おそらく初期インストールされていたアプリはwingetのソースmsstoreで管理しているIDと別になっている為、
　 msstoreで指定しても表示されていなかった。
　 winget install でscreentogifをインスト―ルした結果、winget listのソースmsstoreとして表示されるようになったので間違いないと思われる。

上記のような状況であったため、既にインストールされているアプリをwingetで再インストールする方法がないか調べてみる。
IDは異なるため、名前が一致するアプリをインストールする必要があるが、winget search で表示されるアプリは試験段階の為か、
すべて英語となる為、まずはwinget listのコマンドを英語表記で取得する方法がないか調べる必要がある。

> winget の言語を英語で実行する方法
> 
> こんにちは、これは Bing です。お役に立てると嬉しいです。😊
> 
> winget の言語を英語で実行する方法は、次のとおりです。
> 
> - Windows の言語設定で、英語を優先言語に追加します¹。
> - winget を実行する前に、コマンド プロンプトまたは PowerShell で、次のコマンドを入力します。
> 
> ```cmd
> chcp 437
> ```
> 
> - これで、winget の出力が英語になります。元の言語に戻すには、コマンド プロンプトまたは PowerShell を再起動します。
> 
> winget の詳細については、[こちら](^1^)の記事をご覧ください。ご質問やご意見がありましたら、お気軽にお寄せください。😊
> 
> ソース: Bing との会話 2023/12/27
> (1) winget ツールを使用したアプリケーションのインストールと管理 .... https://learn.microsoft.com/ja-jp/windows/package-manager/winget/.
> (2) winget ツールを使用したアプリケーションのインストールと管理 .... https://learn.microsoft.com/ja-jp/windows/package-manager/winget/.
> (3) settings コマンド | Microsoft Learn. https://learn.microsoft.com/ja-jp/windows/package-manager/winget/settings.
> (4) Windows 用の言語パック - Microsoft サポート. https://support.microsoft.com/ja-jp/windows/windows-%E7%94%A8%E3%81%AE%E8%A8%80%E8%AA%9E%E3%83%91%E3%83%83%E3%82%AF-a5094319-a92d-18de-5b53-1cfc697cfca8.
> (5) Windowsサンドボックスの環境セットアップ - Zenn. https://zenn.dev/mebiusbox/articles/a27432ce984382.
> (6) undefined. https://aka.ms/getwinget.
> (7) undefined. https://aka.ms/Microsoft.VCLibs.x64.14.00.Desktop.appx.
> (8) undefined. https://github.com/microsoft/microsoft-ui-xaml/releases/download/v2.7.3/Microsoft.UI.Xaml.2.7.x64.appx.
> (9) undefined. https://github.com/microsoft/winget-cli/releases.
> (10) undefined. https://aka.ms/winget-settings.schema.json.
> (11) undefined. https://aka.ms/winget-settings.

PowerShellを使ってWindowsの言語設定で英語を優先言語に追加する方法。

> こんにちは、これは Bing です。お役に立てると嬉しいです。😊
> 
> Windowsの言語設定で英語を優先言語に追加する方法は、次のとおりです。
> 
> - [Windows 用の言語パック](^4^)のページにアクセスして、英語の言語パックをダウンロードします。
> - PowerShellを管理者として実行して、次のコマンドを入力します。
> 
> ```powershell
> # 英語の言語パックをインストール
> Add-WindowsPackage -Online -PackagePath "C:\Windows\SoftwareDistribution\Download\Install\lp_4af162d0fd686dbd3b6a9f9530c1a8fd.cab"
> 
> # 英語を優先言語に追加
> $UserLanguageList = New-WinUserLanguageList -Language "en-US"
> $UserLanguageList.Add("ja-JP")
> Set-WinUserLanguageList -LanguageList $UserLanguageList
> ```
> 
> - コマンドが完了したら、コンピューターを再起動します。
> 
> これで、Windowsの言語設定で英語が優先言語になります。言語設定を変更するには、[設定] > [時刻と言語] > [言語] で、希望の言語を選択できます⁴。
> 
> PowerShellに関するご質問やご意見がありましたら、お気軽にお寄せください。😊
> 
> ソース: Bing との会話 2023/12/27
> (1) Windows 用の言語パック - Microsoft サポート. https://support.microsoft.com/ja-jp/windows/windows-%E7%94%A8%E3%81%AE%E8%A8%80%E8%AA%9E%E3%83%91%E3%83%83%E3%82%AF-a5094319-a92d-18de-5b53-1cfc697cfca8.
> (2) Windows 用の言語パック - Microsoft サポート. https://support.microsoft.com/ja-jp/windows/windows-%E7%94%A8%E3%81%AE%E8%A8%80%E8%AA%9E%E3%83%91%E3%83%83%E3%82%AF-a5094319-a92d-18de-5b53-1cfc697cfca8.
> (3) 言語モードについて - PowerShell | Microsoft Learn. https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_language_modes?view=powershell-7.4.
> (4) PowerShellを使用してWindowsのGUI言語設定を変更する方法 .... https://bing.com/search?q=PowerShell%e3%82%92%e4%bd%bf%e3%81%a3%e3%81%a6Windows%e3%81%ae%e8%a8%80%e8%aa%9e%e8%a8%ad%e5%ae%9a%e3%81%a7%e8%8b%b1%e8%aa%9e%e3%82%92%e5%84%aa%e5%85%88%e8%a8%80%e8%aa%9e%e3%81%ab%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b%e6%96%b9%e6%b3%95.
> (5) Windows 10 で言語設定を PowerShell で切り替える - pslaboが .... https://pslabo.hatenablog.com/entry/2019/03/13/182254.
> (6) Windows11の日本語化設定をPowerShellで行う #Windows - Qiita. https://qiita.com/bibou6/items/0a136bca349050d42b20.

→ WindowsPackage系のコマンドを試したが、現在の状態を確認する`Get-WinUserLanguageList`で予期しないエラーが発生する。

```powershell:Get-WinUserLanguageListでエラー
PS C:\Users\"ユーザー名"> Get-WinUserLanguageList
Get-WinUserLanguageList: Cannot marshal 'parameter #2': Invalid managed/unmanaged type combination.
PS C:\Users\"ユーザー名">
```

GitHub - PowerShell のIssueで類似事象が報告されていて、解決していなさそうだがCloseになっていた。
放置されている問題化も。
https://github.com/PowerShell/PowerShell/issues/14102

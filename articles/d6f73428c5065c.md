---
title: "入力メッセージの内容と試行回数、Yes/Noでの実行する内容を引き渡すと処理してくれるFunction"
emoji: "📝"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["powershell"]
published: false
---

ベースはこれ。

```powershell:
# 入力メッセージ
    $userInput = Read-Host 'ファイルを上書きしますか？ (Yes/No)'
    $yesPatterns = '[Yy][Ee][Ss]|[Yy]'
    $noPatterns = '[Nn][Oo]|[Nn]'
    $isYes = $false
    # 試行回数: 3回
    $maxCount = 2
    for ($i = 0; $i -lt $maxCount; $i++) {
        if ($userInput -match $yesPatterns) {
            $isYes = $true    
            break
        }
        else {
            Write-Host '上書き保存をキャンセルしました。'
            return
        }
    }
    if (-Not ($isYes)) {
        Write-Warning '試行回数を超過しました。処理を中断します。'
        return
    }

    # ユーザーが「はい」を選択した場合、ファイルを上書き保存します
    try {
        $markdownTables | Out-File -FilePath $ToMarkdownPath -Encoding utf8
        Write-Host '上書き保存しました。'
    }
    catch {
        Write-Error '上書き保存でエラーが発生しました。'
    }
}
else {
    # 新規保存
    try {
        $markdownTables | Out-File -FilePath $ToMarkdownPath -Encoding utf8
        Write-Host "新規保存しました。"
    }
    catch {
        Write-Error '新規保存でエラーが発生しました。'
    }
}
```

```powershell:
function Read-YesNoResponse {
    param (
        [System.String]$PromptMessage='処理を続行しますか？（ Yes / No ）',
        [System.String]$YesMessage='',
        [System.String]$NoMessage='',
        [System.Int32]$MaxAttempts=3
    )

    # 入力パターンの設定
    [System.String]$yesPattern='[Yy][Ee][Ss]|[Yy]'
    [System.String]$noPattern='[Nn][Oo]|[Nn]'

    $isYes = $false

    for ($i = 0; $i -lt $MaxAttempts; $i++) {
        # ユーザーの入力値を取得
        $userInput = (Read-Host $PromptMessage)

        # Yesが選択された場合
        if ($userInput -match $yesPattern) {
            # メッセージが設定されている場合は出力
            if ([System.String]::IsNullOrEmpty($YesMessage)) {
                Write-Output $YesMessage
            }
            $isYes = $true
            break
        }
        # Noが選択された場合
        elseif ($userInput -match $noPattern) {
            # メッセージが設定されている場合は出力
            if ([System.String]::IsNullOrEmpty($NoMessage)) {
                Write-Output $NoMessage
            }
            return $isYes
        }
    }

    if (-not ($isYes)) {
        Write-Warning "入力の試行回数を超過しました。[試行回数: $($MaxCount)回]"
    }

    return $isYes
}
```

## 関連記事

https://haretokidoki-blog.com/pasocon_powershell-startup/
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960
https://zenn.dev/haretokidoki/articles/fb6830f9155de5

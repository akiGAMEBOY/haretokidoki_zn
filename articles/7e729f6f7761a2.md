---
title: "[PowerShell]TREEã‚³ãƒãƒ³ãƒ‰ã¨åŒã˜çµæœã‚’å‡ºåŠ›ã™ã‚‹Function"
emoji: "ğŸŒŠ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: false
---

```powershell
function Get-FolderTree {
    param (
        [string]$Path
    )

    function Show-Tree {
        param (
            [string]$CurrentPath,
            [hashtable]$Levels
        )

        $items = Get-ChildItem -Path $CurrentPath | Sort-Object { -not $_.PSIsContainer }, Name
        $count = $items.Count
        $index = 0

        foreach ($item in $items) {
            $index++
            $isLastItem = $index -eq $count
            $level = $Levels.Count
            $Levels[$level] = $isLastItem
            $indent = ""

            for ($i = 0; $i -lt $level; $i++) {
                $indent += if ($Levels[$i]) { "     " } else { "â”‚    " }
            }

            $line = if ($isLastItem) { "â””â”€ " } else { "â”œâ”€ " }

            if ($item.PSIsContainer) {
                Write-Output "$indent$line< $item >"
                Show-Tree -CurrentPath $item.FullName -Levels $Levels
            } else {
                Write-Output "$indent$line$item"
            }

            $Levels.Remove($level)
        }
    }

    if (Test-Path -Path $Path) {
        $Levels = @{}
        Show-Tree -CurrentPath $Path -Levels $Levels
    } else {
        Write-Output "æŒ‡å®šã•ã‚ŒãŸãƒ‘ã‚¹ã¯å­˜åœ¨ã—ã¾ã›ã‚“: $Path"
    }
}

# Example usage
Get-FolderTree -Path "C:\Program Files\WindowsPowerShell\Modules\ImportExcel"
```

TREEã‚³ãƒãƒ³ãƒ‰ã®å•é¡Œç‚¹ã€‚ãã®ã¾ã¾å®Ÿè¡Œã™ã‚‹ã¨ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ã¿è¡¨ç¤ºã•ã‚Œã‚‹ã€‚
ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ã²ã‚‡ã†ã˜ã™ã‚‹ãŸã‚ã«ã¯ã€ŒTREE /Fã€ãŒå¿…è¦ã€‚

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«ã®åŒºåˆ¥ãŒã¤ãã«ãã„ã€‚
ã“ã‚Œã¯ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã—ã¦ã„ã™ã‚‹ã“ã¨ã§å¤‰æ›´ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„ã€‚

ã¾ãŸã€å¯èƒ½ã§ã‚ã‚Œã°ã€ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«å‡ºåŠ›çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ãŸã„ã€‚

ã¾ãŸã€ã‹ã®ã†ã§ã‚ã‚Œã°ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰ã‚’å°å…¥ã—ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ“ä½œã«ã‚ˆã‚Šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å±•é–‹ã—ãŸã‚ŠæŠ˜ã‚ŠãŸãŸã‚“ã ã‚Šã™ã‚‹ã‚ˆã†ã«ã—ã¦ã¿ãŸã„ã€‚

ä¸‹è¨˜ã‚³ãƒ¼ãƒ‰ã€Windows Formsã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§å®Ÿç¾ã§ããŸã€‚
ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã©ã«ã‚ˆã‚Šåˆ‡ã‚Šåˆ†ã‘ãŒã§ãã‚‹ã¨ã‚ˆã„ã€‚

```powershell
Add-Type -AssemblyName System.Windows.Forms
Add-Type -AssemblyName System.Drawing

# ãƒ•ã‚©ãƒ¼ãƒ ã®ä½œæˆ
$form = New-Object Windows.Forms.Form
$form.Text = "Folder Tree"
$form.Size = New-Object Drawing.Size(600, 400)

# ãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼ã®ä½œæˆ
$treeView = New-Object Windows.Forms.TreeView
$treeView.Size = New-Object Drawing.Size(580, 350)
$treeView.Location = New-Object Drawing.Point(10, 10)

# ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ãƒ„ãƒªãƒ¼æ§‹é€ ã‚’å–å¾—ã™ã‚‹é–¢æ•°
function Get-FolderTree {
    param (
        [string]$Path,
        [Windows.Forms.TreeNode]$ParentNode
    )
    $items = Get-ChildItem -Path $Path
    foreach ($item in $items) {
        $node = New-Object Windows.Forms.TreeNode
        $node.Text = $item.Name
        $node.Tag = $item.FullName
        $ParentNode.Nodes.Add($node)
        if ($item.PSIsContainer) {
            Get-FolderTree -Path $item.FullName -ParentNode $node
        }
    }
}

# ãƒ«ãƒ¼ãƒˆãƒãƒ¼ãƒ‰ã®ä½œæˆ
$rootNode = New-Object Windows.Forms.TreeNode
$rootNode.Text = "Root"
$rootNode.Tag = "D:\Downloads"
$treeView.Nodes.Add($rootNode)

# ãƒ„ãƒªãƒ¼æ§‹é€ ã®å–å¾—
Get-FolderTree -Path $rootNode.Tag -ParentNode $rootNode

# ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼ã‚’è¿½åŠ 
$form.Controls.Add($treeView)

# ãƒ•ã‚©ãƒ¼ãƒ ã®è¡¨ç¤º
$form.Add_Shown({$form.Activate()})
[void]$form.ShowDialog()
```
---
title: "[PowerShell]ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’ãƒ„ãƒªãƒ¼æ§‹é€ ã§è¡¨ç¤ºã™ã‚‹2ã¤ã®Function"
emoji: "ğŸŒŠ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: false
---
## æ¦‚è¦

PowerShellã§ãƒ„ãƒªãƒ¼æ§‹é€ ã‚’å‡ºåŠ›ã™ã‚‹å ´åˆã€ä»¥å‰ã‚ˆã‚Šã€Œ`TREE /F "å¯¾è±¡ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼"`ã€ã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã—ãŸã€‚

ãŸã ã€TREEã‚³ãƒãƒ³ãƒ‰ã§ã¯ã€ä¸‹è¨˜ã®ã‚ˆã†ãªèª²é¡ŒãŒã‚ã‚Šã¾ã™ã€‚

- 

ã“ã‚Œã‚‰èª²é¡Œã‚’ã‚¯ãƒªã‚¢ã™ã‚‹ãŸã‚ã€ä»Šå›ã¯PowerShellã§2ã¤ã®Functionã‚’è‡ªä½œã—ã¦ã¿ã¾ã—ãŸã€‚

## ã“ã®è¨˜äº‹ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

- PowerShellãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–¹
- TREEã‚³ãƒãƒ³ãƒ‰ã«ã‚ã‚‹ä¸‹è¨˜ã®èª²é¡Œã‚’ã‚¯ãƒªã‚¢ã—ãŸã„æ–¹
    - èª²é¡Œ1ï¼šã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€Œ`/F`ã€ã‚’ã¤ã‘ãªã„ã¨ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¯¾è±¡ã«ãªã‚‰ãªã„
    - èª²é¡Œ2ï¼š

## å¯¾å¿œæ–¹æ³•

```powershell
function Write-TreeView {
    param (
        [System.String]$Path,
        [System.Boolean]$AsciiMode = $False
    )

    # ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãŒãªã„å ´åˆã¯å‡¦ç†ä¸­æ–­
    if (-not (Test-Path -Path $Path)) {
        Write-Warning "æŒ‡å®šã•ã‚ŒãŸãƒ‘ã‚¹ã¯å­˜åœ¨ã—ã¾ã›ã‚“: $Path"
        return
    }
    
    # å‡ºåŠ›å½¢å¼ã‚’è¨­å®š
    # * æ—¥æœ¬èªOSã§ã¯ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ï¼ˆï¼¼ï¼‰ãŒå††ãƒãƒ¼ã‚¯ï¼ˆï¿¥ï¼‰ã«ãªã£ã¦ã—ã¾ã†ã€‚
    if ($AsciiMode) {
        $indentPattern1 = '     '
        $indentPattern2 = '|     '
        $indentPattern3 = '\---- '
        $indentPattern4 = '+---- '
    }
    else {
        $indentPattern1 = 'ã€€ã€€ã€€'
        $indentPattern2 = 'â”‚ã€€ã€€'
        $indentPattern3 = 'â””â”€â”€ã€€'
        $indentPattern4 = 'â”œâ”€â”€ã€€'
    }

    # å†…éƒ¨é–¢æ•°ï¼šãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ãƒ„ãƒªãƒ¼æ§‹é€ ã‚’å–å¾—ã™ã‚‹é–¢æ•°
    function Write-FolderTree {
        param (
            [System.String]$CurrentPath,
            [System.Collections.Hashtable]$Levels
        )

        # ãƒ•ã‚¡ã‚¤ãƒ«ãŒå…ˆé ­ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ä¸¦ã³æ›¿ãˆ
        $items = (Get-ChildItem -Path $CurrentPath | Sort-Object { -not $_.PSIsContainer }, Name)
        $count = $items.Count
        $index = 0

        foreach ($item in $items) {
            $index++
            $isLastItem = ($index -eq $count)
            $level = $Levels.Count
            $Levels[$level] = $isLastItem
            $indent = ""

            for ($i = 0; $i -lt $level; $i++) {
                $indent += if ($Levels[$i]) { $indentPattern1 } else { $indentPattern2 }
            }

            $line = if ($isLastItem) { $indentPattern3 } else { $indentPattern4 }

            if ($item.PSIsContainer) {
                # ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®å ´åˆ
                Write-Output "$indent$line< $item >"
                Write-FolderTree -CurrentPath $item.FullName -Levels $Levels
            } else {
                # ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ
                Write-Output "$indent$line$item"
            }
            
            # ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼å†…ã§æœ€çµ‚ã‚¢ã‚¤ãƒ†ãƒ ã®å ´åˆã«æ¬¡ã®ã‚¢ã‚¤ãƒ†ãƒ ã¨é–“éš”ã‚’ç©ºã‘ã‚‹
            if ($isLastItem) {
                Write-Output "$indent"
            }

            $Levels.Remove($level)
        }
    }

    $Levels = @{}
    Write-Output "$Path"
    Write-FolderTree -CurrentPath $Path -Levels $Levels
}

# Functionã‚’å®Ÿè¡Œ
Write-TreeView -Path "C:\Program Files\WindowsPowerShell\Modules\ImportExcel"
```

TREEã‚³ãƒãƒ³ãƒ‰ã®å•é¡Œç‚¹ã€‚ãã®ã¾ã¾å®Ÿè¡Œã™ã‚‹ã¨ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ã¿è¡¨ç¤ºã•ã‚Œã‚‹ã€‚
ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ã²ã‚‡ã†ã˜ã™ã‚‹ãŸã‚ã«ã¯ã€ŒTREE /Fã€ãŒå¿…è¦ã€‚

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«ã®åŒºåˆ¥ãŒã¤ãã«ãã„ã€‚
ã“ã‚Œã¯ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã—ã¦ã„ã™ã‚‹ã“ã¨ã§å¤‰æ›´ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„ã€‚

ã¾ãŸã€å¯èƒ½ã§ã‚ã‚Œã°ã€ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«å‡ºåŠ›çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ãŸã„ã€‚

ã¾ãŸã€ã‹ã®ã†ã§ã‚ã‚Œã°ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰ã‚’å°å…¥ã—ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ“ä½œã«ã‚ˆã‚Šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å±•é–‹ã—ãŸã‚ŠæŠ˜ã‚ŠãŸãŸã‚“ã ã‚Šã™ã‚‹ã‚ˆã†ã«ã—ã¦ã¿ãŸã„ã€‚

ä¸‹è¨˜ã‚³ãƒ¼ãƒ‰ã€Windows Formsã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§å®Ÿç¾ã§ããŸã€‚
ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã©ã«ã‚ˆã‚Šåˆ‡ã‚Šåˆ†ã‘ãŒã§ãã‚‹ã¨ã‚ˆã„ã€‚

```powershell
function Out-TreeView {
    param (
        [System.String]$Path,
        [System.String[]]$WindowSize = @(600, 450),
        [System.Single]$FontSize = 9.5
    )

    # å†…éƒ¨é–¢æ•°ï¼šãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ãƒ„ãƒªãƒ¼æ§‹é€ ã‚’å–å¾—ã™ã‚‹é–¢æ•°
    function Get-FolderTree {
        param (
            [System.String]$Path,
            [Windows.Forms.TreeNode]$ParentNode
        )
        $items = (Get-ChildItem -Path $Path)
        foreach ($item in $items) {
            $node = New-Object Windows.Forms.TreeNode
            $node.Text = $item.Name
            $node.Tag = $item.FullName
            if ($item.PSIsContainer) {
                $node.BackColor = [System.Drawing.Color]::DarkBlue
                $node.ForeColor = [System.Drawing.Color]::AliceBlue
                Get-FolderTree -Path $item.FullName -ParentNode $node
            } else {
                $node.ForeColor = [System.Drawing.Color]::Black
            }
            $ParentNode.Nodes.Add($node) > $null
        }
    }

    # ãƒ•ã‚©ãƒ¼ãƒ ã®ä½œæˆ
    Add-Type -AssemblyName System.Windows.Forms
    Add-Type -AssemblyName System.Drawing

    $mainForm = New-Object Windows.Forms.Form
    $mainForm.Text = "$($Path) - $($MyInvocation.MyCommand.Name)"
    $mainForm.Size = New-Object Drawing.Size($WindowSize[0], $WindowSize[1])
    $mainForm.Icon = [System.Drawing.Icon]::ExtractAssociatedIcon("$PSHOME\powershell.exe")
    
    # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã®ä½œæˆ
    $statusBar = New-Object Windows.Forms.StatusBar
    $mainForm.Controls.Add($statusBar)

    # ãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼ã®ä½œæˆ
    $treeView = New-Object Windows.Forms.TreeView
    [System.Int32]$witdhSize = [System.Int32]$WindowSize[0] * 0.957
    [System.Int32]$heightSize = [System.Int32]$WindowSize[1] * 0.845
    $treeView.Size = New-Object Drawing.Size($witdhSize, $heightSize)
    $treeView.Location = New-Object Drawing.Point(5, 5)
    $treeView.Anchor = `
    [System.Windows.Forms.AnchorStyles]::Top -bor `
    [System.Windows.Forms.AnchorStyles]::Bottom -bor `
    [System.Windows.Forms.AnchorStyles]::Left -bor `
    [System.Windows.Forms.AnchorStyles]::Right
    $treeView.Font = New-Object System.Drawing.Font("Microsoft Sans Serif", $FontSize)

    # ãƒ«ãƒ¼ãƒˆãƒãƒ¼ãƒ‰ã®ä½œæˆ
    $root = New-Object Windows.Forms.TreeNode
    $root.Text = $Path
    $root.Tag = $Path
    $root.BackColor = [System.Drawing.Color]::DarkBlue
    $root.ForeColor = [System.Drawing.Color]::AliceBlue
    $treeView.Nodes.Add($root) > $null

    # ãƒ„ãƒªãƒ¼æ§‹é€ ã®å–å¾—
    Get-FolderTree -Path $root.Tag -ParentNode $root

    # ãƒãƒ¼ãƒ‰é¸æŠã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®š
    $treeView.add_AfterSelect({
        param ($sender, $e)
        $item = Get-Item -Path $e.Node.Tag
        $statusBar.Text = "$($item.Name) - Last Modified: $($item.LastWriteTime)"
    })

    # ãƒãƒ¼ãƒ‰ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®š
    $treeView.add_NodeMouseDoubleClick({
        param ($sender, $e)
        $item = Get-Item -Path $e.Node.Tag
        if (-not ($item.PSIsContainer)) {
            Invoke-Item -Path $item.FullName
        }
    })
    
    # ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼
    $treeView.add_KeyDown({
        param ($sender, $e)
        # Enterã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸå ´åˆ
        if ($e.KeyCode -eq [System.Windows.Forms.Keys]::Enter) {
            $selectedNode = $treeView.SelectedNode
            if ($selectedNode -ne $null) {
                $item = Get-Item -Path $selectedNode.Tag
                if ($item.PSIsContainer) {
                    Start-Process explorer.exe -ArgumentList $item.FullName
                } else {
                    Invoke-Item -Path $item.FullName
                }
            }
        }
        # Ctrl + Shift + Cï¼šãƒãƒ¼ãƒ‰åã®çµ¶å¯¾ãƒ‘ã‚¹ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
        elseif ($e.Control -and $e.Shift -and $e.KeyCode -eq [System.Windows.Forms.Keys]::C) {
            $selectedNode = $treeView.SelectedNode
            if ($selectedNode -ne $null) {
                [System.Windows.Forms.Clipboard]::SetText($selectedNode.Tag)
            }
        }
        # Ctrl + Cï¼šãƒãƒ¼ãƒ‰åã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
        elseif ($e.Control -and $e.KeyCode -eq [System.Windows.Forms.Keys]::C) {
            $selectedNode = $treeView.SelectedNode
            if ($selectedNode -ne $null) {
                [System.Windows.Forms.Clipboard]::SetText($selectedNode.Text)
            }
        }
    })

    # ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼ã‚’è¿½åŠ 
    $mainForm.Controls.Add($treeView)

    # ãƒ•ã‚©ãƒ¼ãƒ ã®è¡¨ç¤º
    $mainForm.Add_Shown({$mainForm.Activate()})
    $mainForm.ShowDialog() > $null
}

# Functionã‚’å®Ÿè¡Œ
Out-TreeView 'D:\Downloads'
```

2ã¤ã®æ–¹æ³•ã‚’è¨˜è¼‰å¾Œã€ãã‚Œãã‚Œã®æ©Ÿèƒ½ã‚’è¸è¥²ã—ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¨ã‚ã‹ã‚Šã‚„ã™ã„ã‹ã‚‚ã€‚

ã“ã®è¨˜äº‹ã‚’æ›¸ã„ã¨ã„ã¦ãªã‚“ã§ã™ãŒã€ãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼ã¯è¦–è¦šçš„ã«éš ã‚Œã¦ã—ã¾ã†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚‹ã“ã¨ã‚„
æ“ä½œã‚‚ãƒ„ãƒªãƒ¼ç‰¹æœ‰ã®æ–¹æ³•ã¨ãªã‚‹ãŸã‚ã€ã‚ãŸã—å€‹äººã¨ã—ã¦ã¯è‹¦æ‰‹ã§ã™ã€‚

ã‚‚ã—ã€ãƒ„ãƒªãƒ¼å½¢å¼ã§ãªã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã§ããã†ã ã£ãŸã‚‰ã€ãã®æ–¹æ³•ã§æ¤œè¨ã—ã¦ã„ã¾ã™ã­ã€‚

---
title: "[PowerShell]System.Booleanのデータ型を変換する場合の注意事項まとめ"
emoji: "🚩"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["powershell"]
published: false
---
## 概要

PowerShellでデータ型の変換（以降、キャスト）を行う際は `変換したいデータ型` + `変換対象の値（もしくは対象変数名）` と定義することで実現可能です。

真偽である`bool`（`Boolean`）にキャストする際も同じ手法で対応可能なのですが、
PowerShellではルールが複雑なため、実例を用いて注意事項を共有します。

## PowerShellにおけるキャストの説明

最初に `bool`（`Boolean`）のキャストから説明するとわかり難いと思うので、
まずは、わかりやすい文字列型から数値型へのキャストを題材に説明します。

下記は文字列型から数値にキャストする際のコード。

```:powershell:例）文字列から数値に変換する場合
$a = "10"                   # 文字列型で宣言
$num_a = [int]$a            # 数値型に変換（キャスト）
$num_a.GetType().FullName   # データ型を確認
# 結果「System.Int32」となり数値型に変換できた！
```

### キャストするパターンとしないパターンの実例

下記のようなコードの場合、`$a` と `$b` それぞれが文字列型となっているため、そのまま数値計算できません。

```powershell:❌ 文字列同士だと数値計算不可
# "10" という文字と "20" という文字。
[System.String]$a = "10"
[System.String]$b = "20"

# 数値を加算（期待する動作にならない）
$total = $a + $b
#	-> 数値加算したいが文字列型のため、文字列結合

# 
$total.GetType().FullName


# 双方が文字列型のため、加算すると文字結合されるので、結果は "1020" になってしまう。
Write-Host ($a + $b)
# 出力結果: 1020
```

下記のように文字列型の変数を数値型にキャストすることで数値計算が可能となります！

```powershell:✅ 数値にキャスト後は数値計算可能
# "10" という文字と "20" という文字。
[System.String]$a = "10"
[System.String]$b = "20"

# ✔ 数値型にキャスト
$num_a = [System.Int32]$a
$num_b = [System.Int32]$b

# 双方が文字列型のため、加算すると文字結合されるので、結果は "1020" になってしまう。
Write-Host ($a + $b)
# 出力結果: 1020
```

これでPowerShellにおけるキャストの概要はおさえることができました。
つぎは本記事のテーマである`bool`（`Boolean`）のルールを明記します。

## PowerShellにおけるboolのルール

基本的なルールは下記のとおり。

- boolキャスト時に `$false` として判定されるもの
    - 数値の `0`
    - `$null`
    - 空文字列 (`""` または `''`)
    - 空の配列 (`@()`)

- boolキャスト時に `$true` として判定されるもの
    - `0` 以外の数値 (マイナス値も含む)
    - 空ではない文字列 ( `"false"` という文字列も `$true` に)
    - 要素が1つ以上ある配列
        - `[bool]@("false")`    -> 結果：`True`
        - `[bool]@("0")`        -> 結果：`False` ※ `@(0)`の場合は、`0`と同義となる。
        - `[bool]@("0,0")`      -> 結果：`True`

### PowerShellの真偽（System.Boolean）のキャスト

コードが簡潔、シンプルになりやすい
設定ファイルの値をそのままプログラムで使用できる


可読性が悪い
ルールが複数あり、コードが統一しにくい
不具合（バグ）の温床になるケースが多い

### キャストルール基本


## 

```powershell
$false -eq ''
> 結果：True
>       「''」は$falseど同義。
if ("") { $true } else { $false }
> 結果：False
>       「""」は$falseど同義。
if ($null) { $true } else { $false }
> 結果：False
>       「$null」は$falseど同義。
if ([int]0) { $true } else { $false }
> 結果：False
>       「[int]0」は$falseど同義。
if ([double]0.0) { $true } else { $false }
> 結果：False
>       「[double]0.0」は$falseど同義。
```

powershell system.string -> system.boolean にキャストする際の注意
キャストする文字列は下記のいずれかである必要がある。
- $True（自動変数）
	System.Boolean $Trueになる
- $False（自動変数）
	System.Boolean $Falseになる
- 0以外（1など）（数値）
	System.Boolean $Trueになる
- 0（数値）
	System.Boolean $Falseになる

```
PS XXXX> [System.Boolean]"0"
True									# → ×：文字列だと変換できない
PS XXXX>
PS XXXX> [System.Boolean]'0'
True									# → ×：文字列だと変換できない
PS XXXX>
PS XXXX> [System.Boolean]0  
False									# → ○：数値だと正常に変換可能
PS XXXX>
PS XXXX> [System.Boolean]1
True									# → ○：数値だと正常に変換可能
PS XXXX>
PS XXXX> [System.Boolean]"$False"
True									# → ×：文字列だと変換できない
PS XXXX>
PS XXXX> [System.Boolean]'$False'
True									# → ×：文字列だと変換できない
PS XXXX>
PS XXXX> [System.Boolean]$False  
False									# → ○：自動変数だと正常に変換可能
PS XXXX>
[System.Boolean]$True 
True									# → ○：自動変数だと正常に変換可能
PS XXXX>
```


```
# チェックボックスのチェック状態を文字列の変数に代入
PS XXXX> [System.String]$str_accept = $checkbox_selected_accept.Checked		# $str_accept: False

# Booleanにキャストしたデータを変数に入れようとするとエラー
PS XXXX> [System.Boolean]$bool_accept = $str_accept

MetadataError: Cannot convert value "System.String" to type "System.Boolean". Boolean parameters accept only Boolean values and numbers, such 
as $True, $False, 1 or 0.
PS XXXX>

# 変数を使わず、そのままキャストするとTrueに変換されてしまう
#	おそらく数値の0以外だとTrueに変換されてしまう仕様だと思われる。
PS XXXX> [System.Boolean]$str_accept										# System.BooleanのTrueに誤変換
True
PS XXXX>
```

## まとめ

## 参考情報

https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_booleans

## 関連記事

https://haretokidoki-blog.com/pasocon_powershell-startup/
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960
https://zenn.dev/haretokidoki/articles/fb6830f9155de5

---
title: "[Windows]wingetコマンドでソフトウェア・アプリをインストールする方法（PowerShell x winget）"
emoji: "🔮"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["windows", "powershell"]
published: false
---

新しいWindows OSでセットアップする時にわざわざ手作業でダウンロードやインストールする作業、面倒じゃないですか？

ユーザーアカウント制御があるので、完全自動化とは言えないもののPowerShellで`winget`コマンドを使えば簡単にインストールできます。

導入する機会も多いであろうブラウザ「Google Chrome」を対象に手順を紹介します。

## シナリオ・検証環境

買いたてホヤホヤのWindows OSのパソコン。
すべてコマンドで **不要なMicrosoft Edgeをアンインストール** して **Google Chromeのインストール** をやっちゃおう！

:::details 検証環境の一覧 < ここをクリックすると折りたたみが開く >

```powershell:OSのバージョンとビルド番号
PS C:\Users\XXXX> Get-CimInstance -ClassName Win32_OperatingSystem | Select-Object Caption, Version, BuildNumber | Format-Table -AutoSize

Caption                  Version    BuildNumber
-------                  -------    -----------
Microsoft Windows 10 Pro 10.0.19045 19045


PS C:\Users\XXXX>
```

```powershell:PowerShellのバージョン
PS C:\Users\XXXX> $PSVersionTable

Name                           Value
----                           -----
PSVersion                      5.1.19041.5486
PSEdition                      Desktop
PSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}
BuildVersion                   10.0.19041.5486
CLRVersion                     4.0.30319.42000
WSManStackVersion              3.0
PSRemotingProtocolVersion      2.3
SerializationVersion           1.1.0.1


PS C:\Users\XXXX>
```

:::

## 使用するコマンドを紹介

:::::message
**注意事項：wingetコマンド結果が文字化けしないために行う設定**

`winget`コマンドの結果は、文字コード「`UTF-8`」で出力されますが、Windows PowerShell ウィンドウが初期設定の場合、
フォントと文字コードが`UTF-8`に対応していないため、文字化けします。

コマンドそのものは正常終了するので問題ないですが、トラブルシューティングする際はメッセージ必須です。

文字化けしないために事前にフォントと文字コードの設定を行いましょう。

::::details PowerShell Windows ウィンドウ のフォントを設定

1. スタートメニューから "Windows PowerShell" を選択し起動
1. Windows PowerShell ウィンドウ のタイトルバーを右クリック
1. コンテキストメニュー（またはショートカットメニュー）より「プロパティ」を選択
    ![Windows PowerShell ウィンドウのシステムメニュー](https://storage.googleapis.com/zenn-user-upload/4e8b4aa47a7c-20250317.png)
    > Windows PowerShell ウィンドウ のシステムメニュー
    > 
    > 　元のサイズに戻す(R)
    > 　移動(M)
    > 　サイズ変更(S)
    > 　最小化(N)
    > 　最大化(X)
    > 　閉じる(C)
    > 　編集(E)
    > 　規定値(D)
    > 　プロパティ(P) 👈 これを選択
1. "フォントタブ" にある `フォント(F)` で 「`ＭＳ ゴシック`」or「`BIZ UDゴシック`」を設定

1. OKボタンをクリック

:::details ここまでのGUI操作をすべてキーボード操作で行いたい場合

1. 「⊞Winキー ＋ R」で"ファイル名を指定して実行"を起動
1. "ファイル名を指定して実行"の`名前(O)`欄に「powershell」を入力しEnterキー
1. （Windows PowerShell ウィンドウ が起動したことを確認）
1. 「Alt + スペース」でWindows PowerShell のシステムメニューを開く
    （PowerToysを導入している場合は、[PowerToys Run](https://learn.microsoft.com/ja-jp/windows/powertoys/run)が起動してしまうので無効化が必要）

1. 「P」を入力しプロパティを表示

1. 「Alt ＋ F」でフォント設定をアクティブに

1. 指定のフォントを選択

1. Enterキーで設定が反映

:::

以上が「PowerShell Windows ウィンドウ のフォントを設定」でした。

::::

::::details Windows PowerShell ウィンドウ の文字コードを設定

```powershell:コピー用
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8
```

```powershell:実際に実行した結果
PS C:\Users\XXXX> [Console]::OutputEncoding = [System.Text.Encoding]::UTF8
PS C:\Users\XXXX>
```

文字コードが変わった等のメッセージは表示されません。`[Console]::OutputEncoding`を実行すると、
下記のように現在の文字コードが表示されます。

```powershell:現在の文字コードを確認
PS C:\Users\XXXX> [Console]::OutputEncoding


BodyName          : utf-8
EncodingName      : Unicode (UTF-8)
HeaderName        : utf-8
WebName           : utf-8
WindowsCodePage   : 1200
IsBrowserDisplay  : True
IsBrowserSave     : True
IsMailNewsDisplay : True
IsMailNewsSave    : True
IsSingleByte      : False
EncoderFallback   : System.Text.EncoderReplacementFallback
DecoderFallback   : System.Text.DecoderReplacementFallback
IsReadOnly        : False
CodePage          : 65001



PS C:\Users\XXXX>
```

以上が「Windows PowerShell ウィンドウ の文字コードを設定」でした。

::::

:::::

### インストールするコマンド

::::message
**コマンドの途中に“ユーザーアカウント制御”が表示**

「`インストーラーは管理者として実行するように要求するため、プロンプトが表示されます。`」というメッセージが表示された際は、
同時にユーザーアカウント制御のポップアップが表示されます。
「**はい**」を選択してインストールを続行しましょう。

:::details 補足情報：wingetコマンドで自動インストールされるソフトウェア

wingetコマンドを実行すると、指定したソフトウェア（今回の例ではChrome）以外に「**Windows Package Manager Source (winget) V2**」というソフトウェアも同時にインストールされます。
ユーザー側に通知やメッセージなどはなく自動でインストールされていると思いますが、これは**wingetコマンドを実行するために必要なソフトウェア**となるので、ご安心ください。

:::

::::

```powershell:wingetでインストールする場合
winget install --id "対象ソフトウェアのID（winget上のID）"
```

実際に“Google Chrome（ID：**Google.Chrome**）”をインストールしてみます。

```powershell:実際にwingetコマンドでインストールした結果
PS C:\Users\XXXX> winget install --id "google.chrome"
見つかりました Google Chrome [Google.Chrome] バージョン 134.0.6998.89
このアプリケーションは所有者からライセンス供与されます。
Microsoft はサードパーティのパッケージに対して責任を負わず、ライセンスも付与しません。
ダウンロード中 https://dl.google.com/dl/chrome/install/googlechromestandaloneenterprise64.msi
  ██████████████████████████████   125 MB /  125 MB
インストーラーハッシュが正常に検証されました
パッケージのインストールを開始しています...
インストーラーは管理者として実行するように要求するため、プロンプトが表示されます。
インストールが完了しました
PS C:\Users\XXXX>
```

これで無事インストール完了です。

### アンインストールするコマンド

```powershell:wingetでインストールする場合
winget uninstall --id "対象ソフトウェアのID（winget上のID）"
```

実際に“Microsoft Edge（ID：**Microsoft.Edge**）”をアンインストールしてみます。

```powershell:実際にwingetコマンドでインストールした結果
PS C:\Users\XXXX> winget install --id "microsoft.edge"
見つかりました Google Chrome [Google.Chrome] バージョン 134.0.6998.89
このアプリケーションは所有者からライセンス供与されます。
Microsoft はサードパーティのパッケージに対して責任を負わず、ライセンスも付与しません。
ダウンロード中 https://dl.google.com/dl/chrome/install/googlechromestandaloneenterprise64.msi
  ██████████████████████████████   125 MB /  125 MB
インストーラーハッシュが正常に検証されました
パッケージのインストールを開始しています...
インストーラーは管理者として実行するように要求するため、プロンプトが表示されます。
インストールが完了しました
PS C:\Users\XXXX>
```

---

★以降は古い手順

## 対応手順

1. Windows PowerShell ウィンドウを開く
    :::details 開く方法がわからない場合（Windows PowerShell ウィンドウ）
    1. “ファイル名を指定して実行”を起動する
        ショートカットキー「`⊞Winキー` + `R`」で起動する方法。
        もしくは、
        「`⊞スタートメニュー` → `Windows システム ツール` → `ファイル名を指定して実行`」でも起動可能。
    1. 名前欄(O)で「`powershell`」と入力し、Enterキーを押す
    1. Windows PowerShell ウィンドウが起動！
    :::
1. 事前に文字コードとフォントの設定



Windowsでは、標準のPowerShell 5.1よりも新しいバージョンのインストールを推奨しています。
最新版のPowerShellを実際に使ってみると、処理時間が短縮したり機能が強化されたりと、
バージョンアップのメリットを実感できます。

最新のPowerShellをインストールする方法は色々あります。一番知られているのは Microsoft Store アプリに公開されている「[PowerShellアプリ](https://apps.microsoft.com/detail/9MZ1SNWT0N5D)」経由でインストールする方法でしょう。

今回は、wingetコマンドでPowerShellをインストールする方法をまとめてみました。

## コマンドでインストールするメリット

コマンドのメリットとしては、処理時間の高速化や指定したバージョンでインストールが可能などがあります。
複数台のパソコンにセットアップが必要な場合は非常に重宝する方法だと思います。


## 対応方法

### 使用するコマンドの解説

#### 事前設定：フォントと文字コードの変更

コマンドでインストールする方法は多岐に渡りますが、今回は`winget`というコマンドを使って作業を行います。
`winget`コマンドには下記2点の注意点があります。

- `winget`コマンド結果は、文字コードが「UTF-8」で出力されること
- Windows PowerShellウィンドウのフォントは文字コードが`UTF-8`で出力されるため、文字コードとフォントの設定を変更

初期値では日本語のUTF-8に対応おらず、そのまま`winget`コマンドを実行してしまうと文字化けが発生してしまうので、
あらかじめ設定変更します。

##### フォント設定の変更

![Windows PowerShell ウィンドウのシステムメニュー](https://storage.googleapis.com/zenn-user-upload/4e8b4aa47a7c-20250317.png)

1. スタートメニューから "Windows PowerShell" を選択し起動
1. Windows PowerShell ウィンドウ のタイトルバーを右クリック
1. コンテキストメニュー（またはショートカットメニュー）より「プロパティ」を選択
   元のサイズに戻す(R)
　 移動(M)
　 サイズ変更(S)
　 最小化(N)
　 最大化(X)
　 閉じる(C)
　 編集(E)
　 規定値(D)
　 プロパティ(P) 👈 これを選択
1. "フォントタブ" にある `フォント(F)` で 「`ＭＳ ゴシック`」or「`BIZ UDゴシック`」を設定

1. OKボタンをクリック

:::details 上記のGUI操作をすべてショートカットキーで対応する方法

1. 「⊞Winキー ＋ R」で"ファイル名を指定して実行"を起動
1. "ファイル名を指定して実行"の`名前(O)`欄に「powershell」を入力しEnterキー
1. （Windows PowerShell ウィンドウ が起動したことを確認）
1. 「Alt + スペース」でWindows PowerShell のシステムメニューを開く
    （PowerToysを導入している場合は、[PowerToys Run](https://learn.microsoft.com/ja-jp/windows/powertoys/run)が起動してしまうので無効化が必要）

1. 「P」を入力しプロパティを表示

1. 「Alt ＋ F」でフォント設定をアクティブに

1. 指定のフォントを選択

1. Enterキーで設定が反映

:::

#### コマンドでインストールする方法

```powershell:wingetでインストールする場合
winget install --id "対象のID"
```

```powershell:実際に“Google Chrome（ID:Google.Chrome）”をインストールしてみる

```


wingetコマンドを実行すると、指定したソフトウェア（またはアプリ）以外に「**Windows Package Manager Source (winget) V2**」というソフトウェアも自動でインストールされます。
ユーザー側にメッセージ等で通知がないため、気付かないうちにインストールされていますが、これはwingetコマンドを実行するために必要なソフトウェアとなるのでご留意ください。

```powershell:wingetでアンインストールする場合
```

### 事前設定：フォントと文字コードの変更

コマンドでインストールする方法は多岐に渡りますが、今回は`winget`というコマンドを使って作業を行います。
`winget`コマンドには下記2点の注意点があります。

- `winget`コマンド結果は、文字コードが「UTF-8」で出力されること
- Windows PowerShellウィンドウのフォントは文字コードが`UTF-8`で出力されるため、文字コードとフォントの設定を変更

初期値では日本語のUTF-8に対応おらず、そのまま`winget`コマンドを実行してしまうと文字化けが発生してしまうので、
あらかじめ設定変更します。

#### フォント設定の変更

![Windows PowerShell ウィンドウのシステムメニュー](https://storage.googleapis.com/zenn-user-upload/4e8b4aa47a7c-20250317.png)

1. スタートメニューから "Windows PowerShell" を選択し起動
1. Windows PowerShell ウィンドウ のタイトルバーを右クリック
1. コンテキストメニュー（またはショートカットメニュー）より「プロパティ」を選択
   元のサイズに戻す(R)
　 移動(M)
　 サイズ変更(S)
　 最小化(N)
　 最大化(X)
　 閉じる(C)
　 編集(E)
　 規定値(D)
　 プロパティ(P) 👈 これを選択
1. "フォントタブ" にある `フォント(F)` で 「`ＭＳ ゴシック`」or「`BIZ UDゴシック`」を設定

1. OKボタンをクリック

:::details 上記のGUI操作をすべてショートカットキーで対応する方法

1. 「⊞Winキー ＋ R」で"ファイル名を指定して実行"を起動
1. "ファイル名を指定して実行"の`名前(O)`欄に「powershell」を入力しEnterキー
1. （Windows PowerShell ウィンドウ が起動したことを確認）
1. 「Alt + スペース」でWindows PowerShell のシステムメニューを開く
    （PowerToysを導入している場合は、[PowerToys Run](https://learn.microsoft.com/ja-jp/windows/powertoys/run)が起動してしまうので無効化が必要）

1. 「P」を入力しプロパティを表示

1. 「Alt ＋ F」でフォント設定をアクティブに

1. 指定のフォントを選択

1. Enterキーで設定が反映

:::

#### 文字コードの変更


    

Windows 

## コマンドでPowerShellをインストールする方法

### Windows PowerShellのフォントを変更

日本語でのwingetコマンドは文字コードUTF-8の日本語を出力します。
そのため、下記の作業を実施しないと出力されるメッセージが文字化けしてしまうので注意！

:::details 上記をキーボード操作で対応する方法

1. 「Winキー ＋ R」でファイル名を指定して実行を起動

1. 名前(O)欄に「powershell」と入力しEnterキー

1. （Windows PowerShell ウィンドウが起動したことを確認）

1. Alt + スペースキー でシステムメニューを開く
   （PowerToysを導入している場合は、PowerToysRunが起動してしまう。）

1. 「P」を入力しプロパティを表示

1. 「Alt ＋ F」でフォント設定をアクティブに

1. 指定のフォントを選択

1. Enterキーで設定が反映

:::


```powershell
# コンソールのエンコーディングをUTF-8に設定
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8
```

### 何も指定せずにインストール

:::message
**文字化けする場合**

前述している[フォントと文字コードの変更](#事前設定：フォントと文字コードの変更)を参照し、wingetコマンドが正常に表示できるようにしてください。
:::

```powershell
# インストールするコマンド
winget install --id Microsoft.PowerShell
```

**実際に実行した結果**

ユーザーアカウント制御が表示された場合は「はい」

```powershell
```

はじめてwingetコマンドでPowerShellをインストールした場合は、下記2点がインストール。
- Windows Package Manager Source (winget) V2
- PowerShell 7-x64

**すでにインストールされている場合**

```powershell
PS C:\Users\XXXX> winget install --id Microsoft.PowerShell
既存のパッケージが既にインストールされています。インストールされているパッケージ...をアップグレードしようとしています
利用可能なアップグレードが見つかりませんでした。
構成されたソースから入手できる新しいパッケージ バージョンはありません。
PS C:\Users\XXXX>
```

wingetを使用する為には、Microsoft Store アプリの「アプリ インストーラー」のインストールが必要。
手動でインストールしなくても自動でインストールされるはず。

### バージョンの指定してインストール

```powershell
winget install --id Microsoft.PowerShell --version "指定するバージョン"
```

:::details インストール可能なバージョンを一覧表示する方法

```powershell:バージョン一覧を取得するコマンド
winget show --id Microsoft.PowerShell --versions
```

```powershell:wingetでインストール可能なバージョンを表示（）
PS C:\Users\XXXX> winget show --id Microsoft.PowerShell --versions
ソースを更新できませんでした: winget
ソースの検索中にエラーが発生しました;結果は含まれません: msstore
見つかりました PowerShell [Microsoft.PowerShell]
バージョン
----------
7.5.0.0
7.4.7.0
7.4.6.0
7.4.5.0
7.4.4.0
7.4.3.0
7.4.2.0
7.4.1.0
7.4.0.0
7.3.11.0
7.3.10.0
7.3.9.0
7.3.8.0
7.3.7.0
7.3.6.0
7.3.5.0
7.3.4.0
7.3.3.0
7.3.2.0
7.3.1.0
7.3.0.0
7.2.24.0
7.2.23.0
7.2.22.0
7.2.21.0
7.2.18.0
7.2.17.0
7.2.16.0
7.2.14.0
7.2.13.0
7.2.12.0
7.2.10.0
7.2.9.0
7.2.8.0
7.2.7.0
7.2.6.0
7.2.5.0
7.2.4.0
7.2.3.0
7.2.2.0
7.2.1.0
7.2.0.0
7.1.5.0
7.1.4.0
7.1.3.0
7.1.2.0
7.1.1.0
7.1.0.0
7.0.13.0
7.0.8.0
7.0.6.0
7.0.5.0
7.0.4.0
7.0.3.0
7.0.2.0
7.0.1.0
7.0.0.0
6.2.6.0
6.2.5.0
6.2.4.0
6.2.3.0
6.2.2.0
6.2.1.0
6.2.0.0
6.1.6.0
6.1.5.0
6.1.4.0
6.1.3.0
6.1.2.0
6.1.1.0
6.1.0.0
6.0.5.0
6.0.4.0
6.0.3.0
6.0.2.0
6.0.1.0
6.0.0.0
PS C:\Users\XXXX>
```

:::

### Functionで実行

```powershell:Function
Function Install-WingetPackage {
    param (
        [Parameter(Mandatory = $false)]
        [string]$PackageId, # インストール対象のパッケージ ID（任意）

        [Parameter(Mandatory = $false)]
        [string]$Version # 指定があればそのバージョンをインストール
    )

    $statusCode = 0

    # コンソールのエンコーディングをUTF-8に設定
    [Console]::OutputEncoding = [System.Text.Encoding]::UTF8

    # パッケージ ID が指定されていない場合、パッケージリストを取得
    if (-Not $PackageId) {
        Write-Host "利用可能なパッケージのリストを取得中..." -ForegroundColor Cyan
        Write-Host "検索するクエリを入力してください (例: browser)"
        $query = Read-Host
        $wingetListOutput = (winget search -q $query | Out-String)

        if (-Not $wingetListOutput) {
            Write-Error "winget コマンドが実行できないか、パッケージリストを取得できませんでした。"
            $statusCode = -11
            return $statusCode
        }

        # パッケージリストを整形して表示
        $lines = ($wingetListOutput -split "`r?`n")
        $availablePackages = $lines | Where-Object { $_ -match "^\S+\s+\S+" } # 名前と ID を含む行だけ残す

        if (-Not $availablePackages) {
            Write-Error "利用可能なパッケージが見つかりませんでした。クエリを変更して再試行してください。"
            $statusCode = -12
            return $statusCode
        }

        Write-Host "以下のパッケージが利用可能です（名前、ID）:" -ForegroundColor Green
        $availablePackages | ForEach-Object { Write-Host $_ }

        # ユーザーに ID を入力させる
        Write-Host "インストールするパッケージの ID を入力してください"
        $selectedId = Read-Host
        if (-Not $selectedId) {
            Write-Error "パッケージ ID が入力されませんでした。処理を終了します。"
            $statusCode = -13
            return $statusCode
        }
    }
    else {
        $selectedId = $PackageId
    }

    # 選択されたパッケージのバージョンを確認
    Write-Host "利用可能なバージョンを確認中 ($selectedId)..." -ForegroundColor Cyan
    $wingetOutput = (winget show --id $selectedId --versions | Out-String)

    if (-Not $wingetOutput) {
        Write-Error "パッケージ '$selectedId' が見つかりませんでした。"
        $statusCode = -21
        return $statusCode
    }

    # バージョン一覧を抽出
    $lines = ($wingetOutput -split "`r?`n")
    $availableVersions = ($lines -replace "\s+", "" | Where-Object { $_ -ne "" -and $_ -match "^\d" } | Sort-Object)

    if (-Not $availableVersions) {
        Write-Error "利用可能なバージョンを取得できませんでした。"
        $statusCode = -22
        return $statusCode
    }

    Write-Host "以下のバージョンが選択可能です:" -ForegroundColor Green
    $availableVersions | ForEach-Object { Write-Host $_ }

    # ユーザーにバージョンを入力させる（空の場合は最新版を使用）
    Write-Host "インストールするバージョンを入力してください（空の場合は最新バージョンを選択）"
    $selectedVersion = Read-Host

    # バージョンが未指定の場合、最新版を選択
    if (-Not $selectedVersion) {
        $selectedVersion = $availableVersions[-1]
        Write-Host "最新版 '$selectedVersion' をインストールします。" -ForegroundColor Yellow
    } elseif (-Not ($availableVersions -contains $selectedVersion)) {
        Write-Error "指定されたバージョン '$selectedVersion' は利用可能なリストにありません。"
        $statusCode = -23
        return $statusCode
    }

    Write-Host "$selectedId のバージョン $selectedVersion をインストールします..." -ForegroundColor Cyan

    # 標準出力を破棄してインストール処理を実行
    # (winget install --id $selectedId --version $selectedVersion --silent | Out-Null)
    winget install --id $selectedId --version $selectedVersion --silent
    $wingetExitcode = $LASTEXITCODE

    if ($wingetExitcode -eq 0) {
        Write-Host "$selectedId バージョン $selectedVersion のインストールが完了しました。" -ForegroundColor Green
    } else {
        Write-Error "インストール中にエラーが発生しました。winget 終了コード: $wingetExitcode"
        $statusCode = -24
        return $statusCode
    }

    return $statusCode
}
```

```powershell
# 実行例
$statusCode = Install-WingetPackage
Write-Output "終了コード: $statusCode"
Write-Output "Enterキーで終了します。"
Read-Host > $null
```

## アンインストール

```
winget list --id Microsoft.PowerShell

```

```powershell:ある場合
PS C:\Users\XXXX> winget list --id Microsoft.PowerShell
入力条件に一致するインストール済みのパッケージが見つかりませんでした。
PS C:\Users\XXXX>
```

```powershell:ない場合
PS C:\Users\XXXX> winget list --id Microsoft.PowerShell
入力条件に一致するインストール済みのパッケージが見つかりませんでした。
PS C:\Users\XXXX>
PS C:\Users\XXXX> $LASTEXITCODE
-1978335212
PS C:\Users\XXXX>
```

```
winget uninstall --id Microsoft.PowerShell

```

## 参考文献

すべてコマンドでアップデートするやつ

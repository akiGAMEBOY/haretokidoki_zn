---
title: "[PowerShell]PSCustomObjectã§åŒã˜è¦ç´ ï¼ˆé …ç›®æ•°ãƒ»é …ç›®åï¼‰ã‹æ¯”è¼ƒã™ã‚‹Function"
emoji: "ğŸ™Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: true
---

[ã“ã¡ã‚‰ã®è¨˜äº‹](https://zenn.dev/haretokidoki/articles/c1aeace31dbf48)ã§ã¯ã€å¤šæ¬¡å…ƒé…åˆ— ã¨ ã‚¸ãƒ£ã‚°é…åˆ—ï¼ˆå¤šæ®µé…åˆ—ï¼‰ã®è¦ç´ æ•°ã‚’æ¯”è¼ƒã—ã¾ã—ãŸã€‚
PowerShellã§ã¯ã€ãã®ã»ã‹ã«PSCustomObjectã¨ã„ã†ãƒ‡ãƒ¼ã‚¿æ§‹é€ ä½“ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

æœ¬è¨˜äº‹ã§ã¯ã€ã€ŒPSCustomObjectã€åŒå£«ã®è¦ç´ ï¼ˆé …ç›®åã€é …ç›®æ•°ï¼‰ã‚’æ¯”è¼ƒã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã€‚

## è‡ªä½œã—ãŸã‚³ãƒ¼ãƒ‰

```powershell:PSCustomObjectã§è¦ç´ ã‚’æ¯”è¼ƒã™ã‚‹ã‚³ãƒ¼ãƒ‰
Function Test-IsPSCustomObject {
    param(
        [Parameter(Mandatory=$true)]
        [System.Object[]]$Argument
    )

    foreach ($arg in $Argument) {
        if (-not ($arg -is [System.Management.Automation.PSCustomObject])) {
            return $false
        }
    }
    return $true
}
Function Test-PSCustomObjectEquality {
    param (
        [Parameter(Mandatory=$true)][System.Object[]]$Object1,
        [Parameter(Mandatory=$true)][System.Object[]]$Object2
    )

    # ãƒ‡ãƒ¼ã‚¿å­˜åœ¨ãƒã‚§ãƒƒã‚¯
    if (($Object1.Count -eq 0) -or ($Object2.Count -eq 0)) {
        Write-Warning "ã„ãšã‚Œã‹å¼•æ•°ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚[å¼•æ•°1ã®ä»¶æ•°: $($Object1.Count), å¼•æ•°2ã®ä»¶æ•°: $($Object2.Count)]"
        return $false
    }

    # ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…ãŒPSCustomObjectã§ã‚ã‚‹ã‹åˆ¤å®š
    if (-not (Test-IsPSCustomObject $Object1)) {
        Write-Warning 'å¼•æ•°ã®ã€ŒObject1ã€ãŒPSCustomObjectã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚'
        return $false
    }
    elseif (-not (Test-IsPSCustomObject $Object2)) {
        Write-Warning 'å¼•æ•°ã®ã€ŒObject2ã€ãŒPSCustomObjectã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚'
        return $false
    }

    # é …ç›®åã¨é …ç›®æ•°ã‚’æ¯”è¼ƒ
    $object1ColumnData = $Object1[0].psobject.properties | ForEach-Object { $_.Name }
    $object2ColumnData = $Object2[0].psobject.properties | ForEach-Object { $_.Name }
    $compareResult = (Compare-Object $object1ColumnData $object2ColumnData -SyncWindow 0)
    if (($null -ne $compareResult) -and ($compareResult.Count -ne 0)) {
        Write-Warning "ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒå£«ã®é …ç›®ãŒä¸€è‡´ã—ã¦ã„ã¾ã›ã‚“ã€‚"
        return $false
    }

    # # ãƒ‡ãƒ¼ã‚¿ä»¶æ•°ã‚’æ¯”è¼ƒï¼ˆãƒã‚§ãƒƒã‚¯ã™ã‚‹å ´åˆã¯ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆè§£é™¤ï¼‰
    # if ($Object1.Count -ne $Object2.Count) {
    #     Write-Warning "ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…ã®ãƒ‡ãƒ¼ã‚¿ä»¶æ•°ãŒä¸€è‡´ã—ã¾ã›ã‚“ã€‚[å¼•æ•°1ã®ä»¶æ•°: $($Object1.Count), å¼•æ•°2ã®ä»¶æ•°: $($Object2.Count)]"
    #     return $false
    # }

    # æ¯”è¼ƒã—ãŸçµæœ2ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä¸€è‡´
    return $true
}
```

## ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰

```powershell:
# 4ã¤ã®PSCustomObjectã¨1ã¤ã®ã‚¸ãƒ£ã‚°é…åˆ—ã‚’ä½œæˆ
#   object1 ã¨ object2 ã¯åŒä¸€ã€‚
$object1 = @(
    [PSCustomObject]@{Name="Zennã•ã‚“"; Age=25},
    [PSCustomObject]@{Name="Devã•ã‚“"; Age=30}
)
$object2 = @(
    [PSCustomObject]@{Name="Zennã•ã‚“"; Age=25},
    [PSCustomObject]@{Name="Devã•ã‚“"; Age=30}
)
#   object1(ã¾ãŸã¯object2) ã¨ object3ã¯è¦ç´ æ•°ãŒåŒä¸€
$object3 = @(
    [PSCustomObject]@{Name="Powerã•ã‚“"; Age=22},
    [PSCustomObject]@{Name="Shellã•ã‚“"; Age=40}
)
# object3 ã¯è¦ç´ æ•°ï¼ˆé …ç›®æ•°ï¼‰ãŒå°‘ãªã„
$object4 = @(
    [PSCustomObject]@{Name="Zennã•ã‚“"}
)
# object4 ã¯è¦ç´ æ•°ï¼ˆé …ç›®æ•°ï¼‰ãŒå¤šã„
$object5 = @(
    [PSCustomObject]@{Name="Zennã•ã‚“"; Age=25; City="Tokyo"},
    [PSCustomObject]@{Name="Devã•ã‚“"; Age=30; City="Kyoto"}
)
# ã‚¸ãƒ£ã‚°é…åˆ—
$array1 = @(
    @(1, 2, 3),
    @(4, 5)
)

# ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
# Functionã€ŒTest-IsPSCustomObjectã€ã®ãƒ†ã‚¹ãƒˆ
Write-Host "Testing Test-IsPSCustomObject..."
# æ­£å¸¸ç³»
if (Test-IsPSCustomObject -Argument $object1) {
	Write-Host "Object1 is a PSCustomObject array."
} else {
	Write-Host "Object1 is NOT a PSCustomObject array."
}
if (Test-IsPSCustomObject -Argument $object4) {
	Write-Host "Object4 is a PSCustomObject array."
} else {
	Write-Host "Object4 is NOT a PSCustomObject array."
}
# ç•°å¸¸ç³»
if (Test-IsPSCustomObject -Argument $array1) {
	Write-Host "array1 is a PSCustomObject array."
} else {
	Write-Host "array1 is NOT a PSCustomObject array."
}

# Functionã€ŒTest-PSCustomObjectEqualityã€ã®ãƒ†ã‚¹ãƒˆ
Write-Host "Testing Test-PSCustomObjectEquality..."
# æ­£å¸¸ç³»
if (Test-PSCustomObjectEquality -Object1 $object1 -Object2 $object2) {
	Write-Host "Object1 and Object2 are equal."
} else {
	Write-Host "Object1 and Object2 are NOT equal."
}
if (Test-PSCustomObjectEquality -Object1 $object1 -Object2 $object3) {
	Write-Host "Object1 and Object3 are equal."
} else {
	Write-Host "Object1 and Object3 are NOT equal."
}
# ç•°å¸¸ç³»
if (Test-PSCustomObjectEquality -Object1 $object1 -Object2 $object4) {
	Write-Host "Object1 and Object4 are equal."
} else {
	Write-Host "Object1 and Object4 are NOT equal."
}
if (Test-PSCustomObjectEquality -Object1 $object1 -Object2 $object5) {
	Write-Host "Object1 and Object5 are equal."
} else {
	Write-Host "Object1 and Object5 are NOT equal."
}

```

## ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œçµæœ

ã™ã¹ã¦æœŸå¾…é€šã‚Šã®çµæœã¨ãªã‚Šã¾ã—ãŸã€‚

```powershell:å®Ÿè¡Œçµæœ
Testing Test-IsPSCustomObject...
Object1 is a PSCustomObject array.
Object4 is a PSCustomObject array.
array1 is NOT a PSCustomObject array.
Testing Test-PSCustomObjectEquality...
Object1 and Object2 are equal.
Object1 and Object3 are equal.
è­¦å‘Š: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒå£«ã®é …ç›®åãŒä¸€è‡´ã—ã¦ã„ã¾ã›ã‚“ã€‚
Object1 and Object4 are NOT equal.
è­¦å‘Š: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåŒå£«ã®é …ç›®åãŒä¸€è‡´ã—ã¦ã„ã¾ã›ã‚“ã€‚
Object1 and Object5 are NOT equal.
PS XXXX>
```

## ã¾ã¨ã‚

ã—ã£ã‹ã‚Šã¨æ¤œè¨¼ã§ãã¦ã„ã¾ã›ã‚“ãŒã€ãŠãã‚‰ãã“ã®ã‚³ãƒ¼ãƒ‰ã§æ¯”è¼ƒã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

ãƒ‡ãƒ¼ã‚¿æ§‹é€ ä½“ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãªã©ã€ã‚ˆã‚Šç´°ã‹ãæ¯”è¼ƒã—ãŸã„å ´åˆã¯ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ã”åˆ©ç”¨ãã ã•ã„ï¼

## å‚è€ƒæ–‡çŒ®

https://zenn.dev/haretokidoki/articles/c1aeace31dbf48

## é–¢é€£è¨˜äº‹

https://haretokidoki-blog.com/pasocon_powershell-startup/
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960
https://zenn.dev/haretokidoki/articles/fb6830f9155de5

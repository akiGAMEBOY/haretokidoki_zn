---
title: "PowerShellå¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã®VBAã‚³ãƒ¼ãƒ‰ã‚’Excelãƒã‚¯ãƒ­æœ‰åŠ¹ãƒ–ãƒƒã‚¯ï¼ˆ*xlsmï¼‰ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹æ–¹æ³•"
emoji: "ğŸ•"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell", "excel"]
published: false
---

```powershell:
# Excelã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•
$excel = New-Object -ComObject Excel.Application
$excel.Visible = $false

# ãƒã‚¯ãƒ­æœ‰åŠ¹ãƒ–ãƒƒã‚¯ã‚’é–‹ã
$workbookPath = "C:\path\to\your\workbook.xlsm"
$workbook = $excel.Workbooks.Open($workbookPath)

# VBAã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã‚€
$vbaCodePath = "C:\path\to\your\vba_code.txt"
$vbaCode = Get-Content -Path $vbaCodePath -Raw

# VBAã‚³ãƒ¼ãƒ‰ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«è¿½åŠ 
$vbModule = $workbook.VBProject.VBComponents.Add(1) # 1ã¯æ¨™æº–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
$vbModule.CodeModule.AddFromString($vbaCode)

# ãƒ–ãƒƒã‚¯ã‚’ä¿å­˜ã—ã¦é–‰ã˜ã‚‹
$workbook.Save()
$workbook.Close()

# Excelã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’çµ‚äº†
$excel.Quit()

# COMã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è§£æ”¾
[System.Runtime.InteropServices.Marshal]::ReleaseComObject($excel) | Out-Null
[System.GC]::Collect()
[System.GC]::WaitForPendingFinalizers()
```
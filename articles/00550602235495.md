---
title: "[PowerShell]å®šæ•°ãŒå®šç¾©æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹Function"
emoji: "ğŸ‘»"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: true
---
## æ¦‚è¦

ã™ã§ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ç’°å¢ƒã§å®šæ•°ã‚’å®šç¾©ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€`Set-Variable : å¤‰æ•° "å®šæ•°å" ã¯èª­ã¿å–ã‚Šå°‚ç”¨ã¾ãŸã¯å®šæ•°ã§ã‚ã‚‹ãŸã‚ã€ä¸Šæ›¸ãã§ãã¾ã›ã‚“ã€‚`ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚

ã“ã®ã‚¨ãƒ©ãƒ¼ã¯PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å®šæ•°ã‚’ä½¿ç”¨ã—ã€ãã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ¤œè¨¼ã™ã‚‹ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãªã©ã§ç™ºç”Ÿã—ã€
ã‚¨ãƒ©ãƒ¼ãƒã‚¤ã‚ºã¨ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚

ä¸è¦ãªã‚¨ãƒ©ãƒ¼ã‚’æŠ‘æ­¢ã™ã‚‹ãŸã‚ã€ä»Šå›ã¯å®šæ•°ãŒå®šç¾©æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹Functionã‚’ä½œæˆã—ã¾ã—ãŸã€‚

## å®šç¾©æ¸ˆã¿ã®çŠ¶æ…‹ã§å®šç¾©ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼

å®Ÿéš›ã®ã‚¨ãƒ©ãƒ¼ã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã€‚

```powershell:ã‚¨ãƒ©ãƒ¼ã€ŒSet-Variable : å¤‰æ•° "å®šæ•°å" ã¯èª­ã¿å–ã‚Šå°‚ç”¨ã¾ãŸã¯å®šæ•°ã§ã‚ã‚‹ãŸã‚ã€ä¸Šæ›¸ãã§ãã¾ã›ã‚“ã€‚ã€
# å®šæ•°ãŒã™ã§ã«å®šç¾©æ¸ˆã¿
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> $STRING1
æ–‡å­—åˆ—1
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
# ã™ã§ã«å®šç¾©ã•ã‚ŒãŸçŠ¶æ…‹ã§åŒã˜å®šæ•°ã‚’å®šç¾©ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> Set-Variable -Name 'STRING1' -Value 'æ–‡å­—åˆ—1' -Option Constant
Set-Variable : å¤‰æ•° STRING1 ã¯èª­ã¿å–ã‚Šå°‚ç”¨ã¾ãŸã¯å®šæ•°ã§ã‚ã‚‹ãŸã‚ã€ä¸Šæ›¸ãã§ãã¾ã›ã‚“ã€‚
ç™ºç”Ÿå ´æ‰€ è¡Œ:1 æ–‡å­—:1
+ Set-Variable -Name 'STRING1' -Value 'æ–‡å­—åˆ—1' -Option Constant
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : WriteError: (STRING1:String) [Set-Variable], SessionStateUnauthorizedAccessException
    + FullyQualifiedErrorId : VariableNotWritable,Microsoft.PowerShell.Commands.SetVariableCommand

PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
```

## å¯¾å¿œæ–¹æ³•

### å®šæ•°ãŒå®šç¾©æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‚³ãƒ¼ãƒ‰

ä¸‹è¨˜ãŒè‡ªä½œã—ãŸFuncitonã€‚

```powershell:å®šæ•°ãŒå®šç¾©æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹Function
function Test-ConstantDefined {
    param (
        [System.String[]]$Constants
    )
    foreach ($const in $Constants) {
        [System.String]$constValue = (Get-Variable -Name $const -ErrorAction SilentlyContinue)
        # Nullã®å ´åˆã¯æœªå®šç¾©ã¨ã—ã¦åˆ¤æ–­
        # ï¼ˆç©ºæ–‡å­—ã‚„ç©ºç™½ã®ã¿ã¯å®šæ•°ã¨ã—ã¦å®šç¾©ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ãƒã‚§ãƒƒã‚¯ã—ãªã„ï¼‰
        if ($null -eq $constValue) {
            return $false
        }
    }
    return $true
}
```

### è‡ªä½œFunctionã‚’æ¤œè¨¼

æ¤œè¨¼ã™ã‚‹ãŸã‚ã®ä¸‹è¨˜ã‚³ãƒ¼ãƒ‰ã§æœŸå¾…é€šã‚Šå‹•ä½œã™ã‚‹ã‹ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

```powershell:è‡ªä½œFunctionã‚’æ¤œè¨¼ã™ã‚‹ã‚³ãƒ¼ãƒ‰
# å®šæ•°åã®é…åˆ—
$constantsArray = @('STRING1', 'STRING2', 'NUMBER1', 'NUMBER2')

# é…åˆ—å†…ã®ã™ã¹ã¦ã®å®šæ•°ãŒ$nullã®å ´åˆã€å®šæ•°ã¨ã—ã¦è¨­å®š
if (-not (Test-ConstantDefined -Constants $constantsArray)) {
    Set-Variable -Name $constantsArray[0] -Value 'æ–‡å­—åˆ—1' -Option Constant
    Set-Variable -Name $constantsArray[1] -Value 'æ–‡å­—åˆ—2' -Option Constant
    Set-Variable -Name $constantsArray[2] -Value 1 -Option Constant
    Set-Variable -Name $constantsArray[3] -Value 2 -Option Constant

    Write-Output 'å®šæ•°ã‚’ã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚'
}
else {
    Write-Warning 'ã™ã§ã«å®šæ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãŸç‚ºã€å®šæ•°ã®å®£è¨€ã‚’ã‚¹ã‚­ãƒƒãƒ—ã€‚'
}
```

å®šæ•°ãŒ**å®šç¾©ã•ã‚Œã¦ã„ãªã„**å ´åˆã¯ã€ä»¥ä¸‹ã®ã¨ãŠã‚Šã€Œ`å®šæ•°ã‚’ã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚`ã€ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚Œã€
æœŸå¾…é€šã‚Šå®šæ•°ãŒå®šç¾©ã§ããŸã“ã¨ã‚’ç¢ºèªã€‚

```powershell:å®šæ•°ãŒæœªå®šç¾©ã®å ´åˆ
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> # å®šæ•°åã®é…åˆ—
>> $constantsArray = @('STRING1', 'STRING2', 'NUMBER1', 'NUMBER2')
>>
>> # é…åˆ—å†…ã®ã™ã¹ã¦ã®å®šæ•°ãŒ$nullã®å ´åˆã€å®šæ•°ã¨ã—ã¦è¨­å®š
>> if (-not (Test-ConstantDefined -Constants $constantsArray)) {
>>     Set-Variable -Name $constantsArray[0] -Value 'æ–‡å­—åˆ—1' -Option Constant
>>     Set-Variable -Name $constantsArray[1] -Value 'æ–‡å­—åˆ—2' -Option Constant
>>     Set-Variable -Name $constantsArray[2] -Value 1 -Option Constant
>>     Set-Variable -Name $constantsArray[3] -Value 2 -Option Constant
>>
>>     Write-Output 'å®šæ•°ã‚’ã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚'
>> }
>> else {
>>     Write-Warning 'ã™ã§ã«å®šæ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãŸç‚ºã€å®šæ•°ã®å®£è¨€ã‚’ã‚¹ã‚­ãƒƒãƒ—ã€‚'
>> }
å®šæ•°ã‚’ã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
```

ä¸€æ–¹ã€å®šæ•°ãŒ**å®šç¾©æ¸ˆã¿**ã®çŠ¶æ…‹ã§ã€ã‚‚ã†ä¸€åº¦ãŠãªã˜ã‚³ãƒ¼ãƒ‰ã§å¤‰æ•°ã‚’å®šç¾©ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€
ä»¥ä¸‹ã®ã¨ãŠã‚Šã€Œ`è­¦å‘Š: ã™ã§ã«å®šæ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãŸç‚ºã€å®šæ•°ã®å®£è¨€ã‚’ã‚¹ã‚­ãƒƒãƒ—ã€‚`ã€ã¨è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã€
æœŸå¾…é€šã‚Šå®šæ•°ã®å®šç¾©ã™ã‚‹å‡¦ç†ãŒã‚¹ã‚­ãƒƒãƒ—ã§ããŸã“ã¨ã‚’ç¢ºèªã€‚

```powershell:å®šæ•°ãŒå®šç¾©æ¸ˆã¿ã®å ´åˆ
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> # å®šæ•°åã®é…åˆ—
>> $constantsArray = @('STRING1', 'STRING2', 'NUMBER1', 'NUMBER2')
>>
>> # é…åˆ—å†…ã®ã™ã¹ã¦ã®å®šæ•°ãŒ$nullã®å ´åˆã€å®šæ•°ã¨ã—ã¦è¨­å®š
>> if (-not (Test-ConstantDefined -Constants $constantsArray)) {
>>     Set-Variable -Name $constantsArray[0] -Value 'æ–‡å­—åˆ—1' -Option Constant
>>     Set-Variable -Name $constantsArray[1] -Value 'æ–‡å­—åˆ—2' -Option Constant
>>     Set-Variable -Name $constantsArray[2] -Value 1 -Option Constant
>>     Set-Variable -Name $constantsArray[3] -Value 2 -Option Constant
>>
>>     Write-Output 'å®šæ•°ã‚’ã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚'
>> }
>> else {
>>     Write-Warning 'ã™ã§ã«å®šæ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãŸç‚ºã€å®šæ•°ã®å®£è¨€ã‚’ã‚¹ã‚­ãƒƒãƒ—ã€‚'
>> }
è­¦å‘Š: ã™ã§ã«å®šæ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãŸç‚ºã€å®šæ•°ã®å®£è¨€ã‚’ã‚¹ã‚­ãƒƒãƒ—ã€‚
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
```

## ã¾ã¨ã‚

- å®šæ•°ã‚’å®šç¾©æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯ã§ãã‚‹Functionã‚’è‡ªä½œã—ãŸ
- PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å®šæ•°ã‚’å–ã‚Šæ‰±ã„æ¤œè¨¼æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒã‚¤ã‚ºã‚’æ¸›ã‚‰ã—ãŸã„å ´åˆã«æ´»ç”¨

## é–¢é€£è¨˜äº‹

https://haretokidoki-blog.com/pasocon_powershell-startup/
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960
https://zenn.dev/haretokidoki/articles/fb6830f9155de5

---
title: "PowerShellスクリプトを起動する○つの方法"
emoji: "🐥"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["powershell"]
published: false
---
以前からの名残でPowerShellスクリプトの実行方法をbatファイルから起動する方法で作っていましたが、
日本語を含むメッセージをbatファイルとPowerShellスクリプトそれぞれで表示させたい場合、
batファイルはShiftJISで保存。PowerShellスクリプトはUTF8 BOM付きで保存。というわかりにくい構成で対応していた。

もう、batファイルからの実行を脱却したいのでPowerShellスクリプトの起動方法を洗い出して、
自分なりのベストプラクティスを探したいと思い、


ダウンロードフォルダ―をまとめて日付フォルダー（PSCOPY_YYYYMMDD）に移動するスクリプトを作成。
1. ダウンロードフォルダ―に指定日付フォルダー以外のコンテンツ有無をチェック
   →ない場合は処理中断
2. ダウンロードフォルダ―に今日日付のフォルダーを作成

3. 対象コンテンツを今日日付フォルダーにコピーする

4. コピー完了後、ダウンロードフォルダ―内と今日日付フォルダーの構成を比較

5. 比較で一致した場合、ダウンロードフォルダ―内の対象コンテンツを削除

なお、このスクリプトを作成する場合にRead-Hostを使用するかしないかをパラメーター「-WaitForInput」で
制御できるようにしたい。

```
param (
	[Swith]$WaitForInput
)

# 処理

if ($WaitForInput) {
	Write-Host "スクリプトが完了しました。Enterキーを押してウィンドウを閉じてください。"
	Read-Host "" | Out-Null
}

exit $statusCode
```


```
PowerShellスクリプトを作成し、そのスクリプトをWindows OSで起動する方法をすべて上げてください。 

なお、その起動方法に対して、起動する区分（CLIかGUIか）や特徴、制限、考えうるメリット、考えうるデメリットを表形式で回答して。
```

以下は、PowerShellスクリプトをWindows OSで起動する方法について、その区分、特徴、制限、メリット、デメリットをまとめた表です。

| **起動方法**                | **区分** | **特徴**                                                                                                                                       | **制限**                                                                                                                                         | **考えうるメリット**                                                                                                            | **考えうるデメリット**                                                                                                        |
|-----------------------------|----------|------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------|
| **PowerShellコンソールから実行**  | CLI      | PowerShellコンソールで`.\script.ps1`のように直接スクリプトを実行。<br> パラメータ指定も可能。                                                  | スクリプト実行ポリシー（Execution Policy）が適切に設定されていないと、実行がブロックされることがある。                                            | シンプルで手軽。<br> スクリプトの動作をリアルタイムで確認できる。                                                              | GUIが不要なため初心者には少し取っ付きにくい可能性がある。                                                                    |
| **タスクスケジューラで設定して実行** | GUI      | Windowsのタスクスケジューラから実行。<br> 定期実行や時間指定実行が可能。                                                                     | 実行時にシステムアカウントやユーザーアカウントの指定を誤ると、実行権限に問題が出る可能性。                                                        | 定期的な実行やバックグラウンドでの処理に最適。<br> GUIで設定可能なので視覚的に分かりやすい。                                   | 設定が複雑になることがあり、初回設定に時間がかかる場合も。                                                                    |
| **ショートカットを作成して実行**  | GUI      | スクリプトへのショートカットをデスクトップなどに配置し、ダブルクリックで実行。<br> ショートカットのプロパティでパラメータを設定可能。            | 実行時に画面が一瞬表示される（ウィンドウ非表示化設定をしない場合）。                                                                          | 利便性が高く、必要なときにすぐに起動できる。                                                                                  | ウィンドウが一瞬開くのが気になる場合も。                                                                                      |
| **コマンドプロンプトから実行**      | CLI      | コマンドプロンプトで`powershell -File script.ps1`などを使用して実行。                                                                          | コマンドを覚える必要があり、初心者には少し複雑。                                                                                                | PowerShell以外のCLI環境でも柔軟にスクリプトを実行可能。                                                                        | CLIの知識がない場合は理解が難しい場合がある。                                                                                 |
| **スタートアップフォルダに配置**   | GUI      | スクリプト（またはショートカット）をスタートアップフォルダに配置することで、Windows起動時に自動的に実行。                                         | Windows起動時に必ずスクリプトが実行されるため、意図しないタイミングでの実行を防ぐ管理が必要。                                                    | PC起動と同時に自動処理を実行できる。                                                                                          | 不要な場合でも毎回起動してしまい、パフォーマンスに影響を与える可能性。                                                        |
| **PowerShell ISEで実行**        | GUI      | PowerShell ISEからスクリプトを開き、F5キーで実行可能。                                                                                       | PowerShell ISEは廃止予定となっているため、長期的な利用には向かない。                                                                             | スクリプトを簡単に編集しながら動作確認が可能。                                                                                 | 将来的なサポートが不明であり、使用を避けるべき場合も。                                                                        |
| **VS Codeで実行**        | GUI      | VS Codeからスクリプトを開き、F5キーで実行可能。                                                                                       | PowerShell ISEは廃止予定となっているため、長期的な利用には向かない。                                                                             | スクリプトを簡単に編集しながら動作確認が可能。                                                                                 | エディターは開発用。                                                                        |
| **スクリプトをEXEに変換して実行** | GUI/CLI  | Ps1ファイルをEXEに変換（ツールを使用）し、実行可能ファイルとして実行。                                                                        | 追加ツール（PS2EXEなど）が必要であり、EXE化に失敗する場合も。                                                                                    | EXE形式ならPowerShellがインストールされていない環境でも実行可能。<br> 実行ファイルとして配布しやすい。                        | 修正やデバッグが困難になる場合がある。                                                                                        |
| **他のスクリプトやアプリケーションから実行** | CLI/GUI  | 他のスクリプトやプログラムからPowerShellスクリプトを呼び出して実行。例：バッチファイル（.bat）やタスクスケジューラとの連携。                     | 呼び出し元のスクリプトやプログラムの設定や動作に依存する場合がある。                                                                             | 他のプロセスと連携することで強力なシステム構築が可能。                                                                        | デバッグが複雑化する可能性がある。                                                                                            |

これらの方法は、シナリオや目的に応じて使い分けることが重要です。例えば、頻繁な自動実行が必要な場合はタスクスケジューラやスタートアップが適切ですし、簡易なテストならPowerShellコンソールが便利です。必要に応じてカスタマイズしてください！何か他にも補足が必要ですか？

:::details 代表的な「他のスクリプトやアプリケーションから実行」について

```
以下は「他のスクリプトやアプリケーションからPowerShellスクリプトを実行」する代表的な方法を掘り下げ、それぞれの区分、特徴、制限、考えうるメリット、デメリットを整理した表です。

| **方法**                           | **区分**    | **特徴**                                                                                     | **制限**                                                                                              | **考えうるメリット**                                                                 | **考えうるデメリット**                                                              |
|-----------------------------------|-------------|----------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------|------------------------------------------------------------------------------------|
| **バッチファイル（.bat）から実行** | CLI          | バッチファイルで`powershell -File script.ps1`を呼び出し、PowerShellスクリプトを実行可能。       | バッチファイルとPowerShellスクリプトの両方を理解する必要がある。                                       | 他のWindows環境に広く対応しやすい。<br> 設定や呼び出しが簡単。                         | エラーハンドリングや出力処理が複雑になる場合がある。                                 |
| **VBSスクリプトから実行**          | CLI/GUI      | Visual Basic ScriptでPowerShellスクリプトを呼び出して実行可能。                                | VBSとPowerShellの両方にある程度の知識が必要。                                                         | より複雑な操作をGUI的に統合したり、対話型プロンプトを追加できる。                       | VBS自体の知識が求められるため、初心者には少し難しい。                                 |
| **他のPowerShellスクリプトから実行**| CLI          | 別のPowerShellスクリプトから`& .\script.ps1`のようにして呼び出せる。                          | 呼び出し先のスクリプトに問題がある場合、エラーが連鎖的に発生する可能性。                               | 簡潔で再利用性が高いコード構成を構築できる。                                          | スクリプト間の依存関係が複雑化する場合がある。                                       |
| **C#アプリケーションから実行**      | GUI          | .NET環境を利用して、C#コードからPowerShellスクリプトを呼び出せる。                             | 開発環境が必要で、コード記述に関する高度な知識が求められる。                                            | GUIを組み込んだ高度なアプリケーションの一部として活用可能。                             | 開発時間が長くなることがある。                                                       |
| **Pythonスクリプトから実行**       | CLI/GUI      | `subprocess`モジュールなどを用いてPythonコードからPowerShellスクリプトを呼び出し可能。         | PythonとPowerShellの両方のコード構文に精通する必要がある。                                             | クロスプラットフォームで連携可能な柔軟性を持つ。                                       | Python環境のセットアップが必要な場合がある。                                         |
| **ジョブ管理ソフトから呼び出し**   | GUI          | パッケージ販売されているジョブ管理ソフトからPowerShellスクリプトの実行タスクを登録し、定期的またはトリガーで実行可能。   | 権限設定に問題があると実行が失敗する場合がある。                                                       | タイミングを柔軟にコントロール可能。                                                  | GUIでの設定が複雑で、初心者には時間がかかる場合がある。                               |
| **Excelマクロ（VBA）から実行**     | GUI          | Excel内のVBAコードでShell関数を用い、PowerShellスクリプトを呼び出せる。                         | VBAコードとPowerShellの両方を理解する必要がある。                                                     | ビジネスシナリオでExcelとPowerShellを統合した自動化が可能。                             | 環境に依存した動作となる可能性が高い。                                               |
| **リモートから実行（WinRM経由）**   | CLI          | Windows Remote Management（WinRM）を使い、他のマシンからPowerShellスクリプトを実行可能。        | ネットワーク設定や権限管理の設定が正しく行われていないと失敗する。                                     | 複数のデバイスにわたる一括管理や自動化が可能。                                         | ネットワークの知識が必要で、初期セットアップが複雑。                                   |

これらの方法は、使用するシナリオや目的によって適切なものを選ぶことが重要です。例えば、ビジネスアプリケーションとの統合ではExcelマクロやC#の利用が適しているかもしれませんし、日常的な運用タスクではバッチファイルやタスクスケジューラが便利です。さらに知りたい内容があればお気軽にどうぞ！

ジョブ管理ソフト
Hinemos｜株式会社NTTデータ先端技術
A-AUTO｜株式会社ユニリタ
Systemwalker Operation Manager｜富士通株式会社
JP1 Cloud Service/Job Management｜株式会社 日立製作所


```

:::

ショートカットを使った起動方法

powershell.exe -ExecutionPolicy Bypass -File "PowerShellスクリプトの絶対パス"
pwsh.exe -ExecutionPolicy Bypass -File "PowerShellスクリプトの絶対パス"

課題
実行後、結果を見ることができない
→Read-Hostにより画面を止める


## 関連記事

PAUSEの記事

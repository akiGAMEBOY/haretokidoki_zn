---
title: "[PowerShell]å®šç¾©ã—ãŸFunctionã®å†…å®¹ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•"
emoji: "ðŸ‘€"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: false
---

### ã‚³ãƒžãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã§ç¢ºèªã™ã‚‹æ–¹æ³•

```powershell:Get-ChildItemã‚’ä½¿ã„æ–‡å­—åˆ—å½¢å¼ã§å–å¾—ã™ã‚‹æ–¹æ³•
(Get-ChildItem function:Test-FileLocked).Definition
```

```powershell:Get-ChildItemã‚’ä½¿ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã§å–å¾—ã™ã‚‹æ–¹æ³•
(Get-ChildItem function:Test-FileLocked).ScriptBlock
```

```powershell:Get-Commandã‚’ä½¿ã„æ–‡å­—åˆ—å½¢å¼ã§å–å¾—ã™ã‚‹æ–¹æ³•
(Get-Command $FunctionName).ScriptBlock.ToString()
```

```powershell:Get-Commandã‚’ä½¿ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã§å–å¾—ã™ã‚‹æ–¹æ³•
(Get-Command $FunctionName).ScriptBlock
```

```powershell:å®Ÿéš›ã«ç¢ºèªã—ãŸçµæžœ
# Get-ChildItemã‚’ä½¿ã„æ–‡å­—åˆ—å½¢å¼ã§å–å¾—ã™ã‚‹æ–¹æ³•
PS D:\Downloads> $result = (Get-ChildItem function:Test-FileLocked).Definition
PS D:\Downloads> $result.GetType().FullName
System.String
PS D:\Downloads>
# Get-ChildItemã‚’ä½¿ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã§å–å¾—ã™ã‚‹æ–¹æ³•
PS D:\Downloads> $result = (Get-ChildItem function:Test-FileLocked).ScriptBlock
PS D:\Downloads> $result.GetType().FullName
System.Management.Automation.ScriptBlock
PS D:\Downloads>
# Get-Commandã‚’ä½¿ã„æ–‡å­—åˆ—å½¢å¼ã§å–å¾—ã™ã‚‹æ–¹æ³•
PS D:\Downloads> $result = (Get-Command $FunctionName).ScriptBlock.ToString()
PS D:\Downloads> $result.GetType().FullName
System.String
PS D:\Downloads>
# Get-Commandã‚’ä½¿ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã§å–å¾—ã™ã‚‹æ–¹æ³•
PS D:\Downloads> $result = (Get-Command $FunctionName).ScriptBlock
PS D:\Downloads> $result.GetType().FullName
System.Management.Automation.ScriptBlock
PS D:\Downloads>
```

:::details è£œè¶³æƒ…å ±ï¼šæ–‡å­—åˆ—å½¢å¼ ã¨ ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ ã®é•ã„

- æ–‡å­—åˆ—å½¢å¼
    æ–‡å­—é€šã‚Šãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã™ã‚‹ç‚ºã«ä½¿ç”¨ã€‚
    ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã ã‘ã§ã¯ä½•ã‚‚å‡¦ç†ã§ããªã„ã€‚
    ä»£ç”¨çš„ãªä½¿ç”¨æ–¹æ³•ã¯å‡ºåŠ›ã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆï¼ˆ`Write-Host`ï¼‰ã¨çµ„ã¿åˆã‚ã›ã‚‹æ–¹æ³•ãŒã‚ã‚‹ã€‚

    ```powershell:æ–‡å­—åˆ—ã‚’å®£è¨€ã—ã¦ã‚³ãƒžãƒ³ãƒ‰ã§å‡ºåŠ›
    # æ–‡å­—åˆ—é…åˆ—ã‚’å®£è¨€
    $months = @(
        @("1æœˆ", "January", "ËˆjÃ¦n.ju.er.i (ã‚¸ãƒ£ãƒ‹ãƒ¥ã‚¨ãƒª)"),
        @("2æœˆ", "February", "Ëˆfeb.ruË.er.i (ãƒ•ã‚§ãƒ–ãƒ«ã‚¨ãƒª)"),
        @("3æœˆ", "March", "mÉ‘ËrtÊƒ (ãƒžãƒ¼ãƒ)"),
        @("4æœˆ", "April", "ËˆeÉª.prÉ™l (ã‚¨ã‚¤ãƒ—ãƒªãƒ«)"),
        @("5æœˆ", "May", "meÉª (ãƒ¡ã‚¤)"),
        @("6æœˆ", "June", "dÊ’uËn (ã‚¸ãƒ¥ãƒ¼ãƒ³)"),
        @("7æœˆ", "July", "dÊ’ÊŠËˆlaÉª (ã‚¸ãƒ¥ãƒ©ã‚¤)"),
        @("8æœˆ", "August", "ËˆÉ”Ë.É¡É™st (ã‚ªãƒ¼ã‚¬ã‚¹ãƒˆ)"),
        @("9æœˆ", "September", "sÉ›pËˆtÉ›mbÉ™r (ã‚»ãƒ—ãƒ†ãƒ³ãƒãƒ¼)"),
        @("10æœˆ", "October", "É’kËˆtoÊŠbÉ™r (ã‚ªã‚¯ãƒˆãƒ¼ãƒãƒ¼)"),
        @("11æœˆ", "November", "noÊŠËˆvÉ›mbÉ™r (ãƒŽãƒ¼ãƒ´ã‚§ãƒ³ãƒãƒ¼)"),
        @("12æœˆ", "December", "dÉªËˆsÉ›mbÉ™r (ãƒ‡ã‚£ã‚»ãƒ³ãƒãƒ¼)")
    )

    # æ–‡å­—åˆ—é…åˆ—ã‚’è¡Œã”ã¨ã«å‡ºåŠ›
    foreach ($row in $months) {
        Write-Host "$($row[0]),    $($row[1]),    $($row[2])"
    }
    ```

- ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å½¢å¼
    å®Ÿè¡Œå¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦å®šç¾©ã§ãã‚‹å½¢å¼ã€‚
    ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã¯ã€ä¸­æ‹¬å¼§ï¼ˆ`{}`ï¼‰ã«å›²ã¾ã‚ŒãŸã‚³ãƒžãƒ³ãƒ‰ã‚„å¼ã®é›†åˆä½“ã§ãã®ã¾ã¾å®Ÿè¡Œã§ãã‚‹ã€‚
    ã¾ãŸã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯åž‹ã¨ã—ã¦å¤‰æ•°ã«æ ¼ç´ã—ãŸã‚Šã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã‚’å¯¾å¿œã™ã‚‹ä»–ã®ã‚³ãƒžãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆï¼ˆ`Invoke-Command`ï¼‰ã«å¼•ãæ¸¡ã—å®Ÿè¡ŒãŒå¯èƒ½ã€‚

    ```powershell:ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã§å®£è¨€ã—å®Ÿè¡Œ
    # ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã§è‹±èªžå…ˆé ­3æ¡ã‹ã‚‰æ›œæ—¥ã‚’æ¤œç´¢ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’å®£è¨€
    $findDay = {
        param (
            [System.String]$Abbreviation
        )
        # ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å†…ã§æ–‡å­—åˆ—é…åˆ—ã‚’å®£è¨€
        $daysOfTheWeek = @(
            @("æ—¥æ›œ", "Sunday", "ËˆsÊŒn.deÉª (ã‚µãƒ³ãƒ‡ã‚¤)"),
            @("æœˆæ›œ", "Monday", "ËˆmÊŒn.deÉª (ãƒžãƒ³ãƒ‡ã‚¤)"),
            @("ç«æ›œ", "Tuesday", "ËˆtjuËz.deÉª (ãƒãƒ¥ãƒ¼ã‚ºãƒ‡ã‚¤)"),
            @("æ°´æ›œ", "Wednesday", "ËˆwÉ›nz.deÉª (ã‚¦ã‚§ãƒ³ã‚ºãƒ‡ã‚¤)"),
            @("æœ¨æ›œ", "Thursday", "ËˆÎ¸ÉœËrz.deÉª (ã‚µãƒ¼ã‚ºãƒ‡ã‚¤)"),
            @("é‡‘æ›œ", "Friday", "ËˆfraÉª.deÉª (ãƒ•ãƒ©ã‚¤ãƒ‡ã‚¤)"),
            @("åœŸæ›œ", "Saturday", "ËˆsÃ¦t.É™r.deÉª (ã‚µã‚¿ãƒ‡ã‚¤)")
        )
        
        # é…åˆ—ã‚’æ¤œç´¢
        $dayFound = $daysOfTheWeek | Where-Object { $_[1].Substring(0,3).ToLower() -eq $abbreviation.ToLower() }
        if ($dayFound) {
            Write-Host "ãƒ’ãƒƒãƒˆã—ã¾ã—ãŸã€‚æ—¥æœ¬èªžã®æ›œæ—¥ã€Œ$($dayFound[0])ã€"
        } else {
            Write-Host "è©²å½“ã™ã‚‹æ›œæ—¥ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚"
        }
    }

    # ä¸Šè¨˜ã§å®šç¾©ã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã‚’å®Ÿè¡Œ
    PS D:\Downloads> & $findDay -Abbreviation "Thu"
    ãƒ’ãƒƒãƒˆã—ã¾ã—ãŸã€‚æ—¥æœ¬èªžã®æ›œæ—¥ã€Œæœ¨æ›œã€
    PS D:\Downloads>

    # Invoke-Commandã«å¼•ãæ¸¡ã—ã¦å®Ÿè¡Œ
    PS D:\Downloads> Invoke-Command -ScriptBlock $findDay -ArgumentList "Sun"
    ãƒ’ãƒƒãƒˆã—ã¾ã—ãŸã€‚æ—¥æœ¬èªžã®æ›œæ—¥ã€Œæ—¥æ›œã€
    PS D:\Downloads>
    ```

æ–‡å­—åˆ—ã¯è¨€è‘‰ã®ã¨ãŠã‚Šã€æ–‡å­—ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ã§å®šç¾©ã®å†…å®¹ã‚’ç¢ºèªã§ãã‚‹ã€‚
ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã¯ã€Functionå†…ã®å®šç¾©ãã®ã‚‚ã®ã‚’å–å¾—ã—ã¦ã„ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã€
ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã‚’å¯¾å¿œã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã«æ¸¡ã™ã¨å®Ÿè¡Œã—ã¦ãã‚Œã‚‹ã€‚
Invoke-Commandã¯ãã‚Œã€‚

:::

### è‡ªä½œã—ãŸFunctionã§ç¢ºèªã™ã‚‹æ–¹æ³•

```powershell:Functionã‚’ä½¿ã£ã¦å–å¾—ã™ã‚‹æ–¹æ³•
function Get-FunctionDefinition {
    param (
        [System.String]$FunctionName,
        [System.String]$Newline="`r`n",
        [System.Boolean]$MarkdownMode=$False
    )

    # FunctionãŒå­˜åœ¨ã—ãªã„å ´åˆ
    if ($null -eq (Get-Command -Name $FunctionName -ErrorAction SilentlyContinue)) {
        Write-Warning "è©²å½“ã®FunctionãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚[æ¤œç´¢ã—ãŸFunctionå: $($FunctionName)]"
        return
    }

    # ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å†…ã®æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’ã€ŒLFã€ã§è¨­å®š
    $scriptblockNewline = "`n"
    $plainDefinition = (((Get-Command $FunctionName).ScriptBlock.ToString() -Split $scriptblockNewline | Select-Object -Skip 1) -Join $Newline)

    $functionDefinition = ''
    if ($MarkdownMode) {
        $functionDefinition = "``````powershell$($Newline)"
        $functionDefinition += "function $FunctionName {$($Newline)"
        $functionDefinition += $plainDefinition
        $functionDefinition += "}$($Newline)"
        $functionDefinition += "``````$($Newline)"
    }
    else {
        $functionDefinition = "function $FunctionName {$($Newline)"
        $functionDefinition += $plainDefinition
        $functionDefinition += "}$($Newline)"
    }

    return $functionDefinition
}
```

```powershell:
PS D:\Downloads> Get-FunctionDefinition Test-FileLocked
function Test-FileLocked {
    param (
        [Parameter(Mandatory=$true)][System.String]$Path
    )

    if (-Not(Test-Path $Path)) {
        Write-Error 'å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚' -ErrorAction Stop
    }

    # ç›¸å¯¾ãƒ‘ã‚¹ã ã¨Openãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£å¸¸å‹•ä½œã—ãªã„ç‚ºã€çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›
    $fullPath = (Resolve-Path -Path $Path -ErrorAction SilentlyContinue).Path

    $fileLocked = $false
    try {
        # èª­ã¿å–ã‚Šå°‚ç”¨ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãå‡¦ç†ã‚’å®Ÿè¡Œ
        $fileStream = [System.IO.File]::Open($fullPath, 'Open', 'ReadWrite', 'None')
    }
    catch {
        # ãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‘ãªã„å ´åˆã€ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã¨åˆ¤æ–­
        $fileLocked = $true
    }
    finally {
        if ($null -ne $fileStream) {
            $fileStream.Close()
        }
    }

    return $fileLocked
}

PS D:\Downloads>
```

```powershell:
PS D:\Downloads> Get-ChildItem function:Test-FileLocked | Get-Member
   TypeName: System.Management.Automation.FunctionInfo

Name                MemberType     Definition
----                ----------     ----------
Equals              Method         bool Equals(System.Object obj)
GetHashCode         Method         int GetHashCode()
GetType             Method         type GetType()
ResolveParameter    Method         System.Management.Automation.ParameterMetadata ResolveParameter(string name)
ToString            Method         string ToString()
PSDrive             NoteProperty   PSDriveInfo PSDrive=Function
PSIsContainer       NoteProperty   bool PSIsContainer=False
PSPath              NoteProperty   string PSPath=Microsoft.PowerShell.Core\Function::Test-FileLocked
PSProvider          NoteProperty   ProviderInfo PSProvider=Microsoft.PowerShell.Core\Function
CmdletBinding       Property       bool CmdletBinding {get;}
CommandType         Property       System.Management.Automation.CommandTypes CommandType {get;}
DefaultParameterSet Property       string DefaultParameterSet {get;}
Definition          Property       string Definition {get;}
Description         Property       string Description {get;set;}
HelpFile            Property       string HelpFile {get;}
Module              Property       psmoduleinfo Module {get;}
ModuleName          Property       string ModuleName {get;}
Name                Property       string Name {get;}
Noun                Property       string Noun {get;}
Options             Property       System.Management.Automation.ScopedItemOptions Options {get;set;}
OutputType          Property       System.Collections.ObjectModel.ReadOnlyCollection[System.Management.Automation.PS...
Parameters          Property       System.Collections.Generic.Dictionary[string,System.Management.Automation.Paramet...
ParameterSets       Property       System.Collections.ObjectModel.ReadOnlyCollection[System.Management.Automation.Co...
RemotingCapability  Property       System.Management.Automation.RemotingCapability RemotingCapability {get;}
ScriptBlock         Property       scriptblock ScriptBlock {get;}
Version             Property       version Version {get;}
Visibility          Property       System.Management.Automation.SessionStateEntryVisibility Visibility {get;set;}
HelpUri             ScriptProperty System.Object HelpUri {get=$oldProgressPreference = $ProgressPreference...


PS D:\Downloads>
PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).Definition

    param (
        [Parameter(Mandatory=$true)][System.String]$Path
    )

    if (-Not(Test-Path $Path)) {
        Write-Error 'å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚' -ErrorAction Stop
    }

    # ç›¸å¯¾ãƒ‘ã‚¹ã ã¨Openãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£å¸¸å‹•ä½œã—ãªã„ç‚ºã€çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›
    $fullPath = (Resolve-Path -Path $Path -ErrorAction SilentlyContinue).Path

    $fileLocked = $false
    try {
        # èª­ã¿å–ã‚Šå°‚ç”¨ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãå‡¦ç†ã‚’å®Ÿè¡Œ
        $fileStream = [System.IO.File]::Open($fullPath, 'Open', 'ReadWrite', 'None')
    }
    catch {
        # ãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‘ãªã„å ´åˆã€ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã¨åˆ¤æ–­
        $fileLocked = $true
    }
    finally {
        if ($null -ne $fileStream) {
            $fileStream.Close()
        }
    }

    return $fileLocked

PS D:\Downloads>
PS D:\Downloads> Get-ChildItem function:Test-FileLocked | Get-Member | Format-Table -AutoSize -Wrap


   TypeName: System.Management.Automation.FunctionInfo

Name                MemberType     Definition
----                ----------     ----------
Equals              Method         bool Equals(System.Object obj)
GetHashCode         Method         int GetHashCode()
GetType             Method         type GetType()
ResolveParameter    Method         System.Management.Automation.ParameterMetadata ResolveParameter(string name)
ToString            Method         string ToString()
PSDrive             NoteProperty   PSDriveInfo PSDrive=Function
PSIsContainer       NoteProperty   bool PSIsContainer=False
PSPath              NoteProperty   string PSPath=Microsoft.PowerShell.Core\Function::Test-FileLocked
PSProvider          NoteProperty   ProviderInfo PSProvider=Microsoft.PowerShell.Core\Function
CmdletBinding       Property       bool CmdletBinding {get;}
CommandType         Property       System.Management.Automation.CommandTypes CommandType {get;}
DefaultParameterSet Property       string DefaultParameterSet {get;}
Definition          Property       string Definition {get;}
Description         Property       string Description {get;set;}
HelpFile            Property       string HelpFile {get;}
Module              Property       psmoduleinfo Module {get;}
ModuleName          Property       string ModuleName {get;}
Name                Property       string Name {get;}
Noun                Property       string Noun {get;}
Options             Property       System.Management.Automation.ScopedItemOptions Options {get;set;}
OutputType          Property       System.Collections.ObjectModel.ReadOnlyCollection[System.Management.Automation.PSTyp
                                   eName] OutputType {get;}
Parameters          Property       System.Collections.Generic.Dictionary[string,System.Management.Automation.ParameterM
                                   etadata] Parameters {get;}
ParameterSets       Property       System.Collections.ObjectModel.ReadOnlyCollection[System.Management.Automation.Comma
                                   ndParameterSetInfo] ParameterSets {get;}
RemotingCapability  Property       System.Management.Automation.RemotingCapability RemotingCapability {get;}
ScriptBlock         Property       scriptblock ScriptBlock {get;}
Source              Property       string Source {get;}
Verb                Property       string Verb {get;}
Version             Property       version Version {get;}
Visibility          Property       System.Management.Automation.SessionStateEntryVisibility Visibility {get;set;}
HelpUri             ScriptProperty System.Object HelpUri {get=$oldProgressPreference = $ProgressPreference
                                             $ProgressPreference = 'SilentlyContinue'
                                             try
                                             {
                                             if ($psversiontable.psversion.Major -lt 3)
                                             {
                                             # ok to cast CommandTypes enum to HelpCategory because string/indentifier
                                   for
                                             # cmdlet,function,filter,alias,externalscript is identical.
                                             # it is ok to fail for other enum values (i.e. for Application)
                                             $commandName = $this.Name
                                             if ($this.ModuleName)
                                             {
                                             $commandName = "{0}\{1}" -f $this.ModuleName,$commandName
                                             }

                                             $helpObject = get-help -Name $commandName -Category ([string]($this.Comman
                                   dType)) -ErrorAction SilentlyContinue

                                             # return first non-null uri (and try not to hit any strict mode things)
                                             if ($helpObject -eq $null) { return $null }
                                             if ($helpObject.psobject.properties['relatedLinks'] -eq $null) { return $n
                                   ull }
                                             if ($helpObject.relatedLinks.psobject.properties['navigationLink'] -eq $nu
                                   ll) { return $null }
                                             $helpUri = [string]$( $helpObject.relatedLinks.navigationLink | %{ if ($_.
                                   psobject.properties['uri'] -ne $null) { $_.uri } } | ?{ $_ } | select -first 1 )
                                             return $helpUri
                                             }
                                             else
                                             {
                                             [Microsoft.PowerShell.Commands.GetHelpCodeMethods]::GetHelpUri($this)
                                             }
                                             }
                                             catch {}
                                             finally
                                             {
                                             $ProgressPreference = $oldProgressPreference
                                             };}


PS D:\Downloads>
PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).CmdletBinding
True
PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).DefaultParameterSet
PS D:\Downloads>
PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).Description
PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).HelpFile
PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).ModuleName

PS D:\Downloads>
PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).Name
Test-FileLocked
PS D:\Downloads>
PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).Noun
FileLocked
PS D:\Downloads>
PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).Options
None
PS D:\Downloads>
PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).OutputType
PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).Parameters

Key                 Value
---                 -----
Path                System.Management.Automation.ParameterMetadata
Verbose             System.Management.Automation.ParameterMetadata
Debug               System.Management.Automation.ParameterMetadata
ErrorAction         System.Management.Automation.ParameterMetadata
WarningAction       System.Management.Automation.ParameterMetadata
InformationAction   System.Management.Automation.ParameterMetadata
ErrorVariable       System.Management.Automation.ParameterMetadata
WarningVariable     System.Management.Automation.ParameterMetadata
InformationVariable System.Management.Automation.ParameterMetadata
OutVariable         System.Management.Automation.ParameterMetadata
OutBuffer           System.Management.Automation.ParameterMetadata
PipelineVariable    System.Management.Automation.ParameterMetadata


PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).ParameterSets

Parameter Set Name: __AllParameterSets
Is default parameter set: False

  Parameter Name: Path
    ParameterType = System.String
    Position = 0
    IsMandatory = True
    IsDynamic = False
    HelpMessage =
    ValueFromPipeline = False
    ValueFromPipelineByPropertyName = False
    ValueFromRemainingArguments = False
    Aliases = {}
    Attributes =



  Parameter Name: Verbose
    ParameterType = System.Management.Automation.SwitchParameter
    Position = -2147483648
    IsMandatory = False
    IsDynamic = False
    HelpMessage =
    ValueFromPipeline = False
    ValueFromPipelineByPropertyName = False
    ValueFromRemainingArguments = False
    Aliases = {vb}
    Attributes =



  Parameter Name: Debug
    ParameterType = System.Management.Automation.SwitchParameter
    Position = -2147483648
    IsMandatory = False
    IsDynamic = False
    HelpMessage =
    ValueFromPipeline = False
    ValueFromPipelineByPropertyName = False
    ValueFromRemainingArguments = False
    Aliases = {db}
    Attributes =



  Parameter Name: ErrorAction
    ParameterType = System.Management.Automation.ActionPreference
    Position = -2147483648
    IsMandatory = False
    IsDynamic = False
    HelpMessage =
    ValueFromPipeline = False
    ValueFromPipelineByPropertyName = False
    ValueFromRemainingArguments = False
    Aliases = {ea}
    Attributes =



  Parameter Name: WarningAction
    ParameterType = System.Management.Automation.ActionPreference
    Position = -2147483648
    IsMandatory = False
    IsDynamic = False
    HelpMessage =
    ValueFromPipeline = False
    ValueFromPipelineByPropertyName = False
    ValueFromRemainingArguments = False
    Aliases = {wa}
    Attributes =



  Parameter Name: InformationAction
    ParameterType = System.Management.Automation.ActionPreference
    Position = -2147483648
    IsMandatory = False
    IsDynamic = False
    HelpMessage =
    ValueFromPipeline = False
    ValueFromPipelineByPropertyName = False
    ValueFromRemainingArguments = False
    Aliases = {infa}
    Attributes =



  Parameter Name: ErrorVariable
    ParameterType = System.String
    Position = -2147483648
    IsMandatory = False
    IsDynamic = False
    HelpMessage =
    ValueFromPipeline = False
    ValueFromPipelineByPropertyName = False
    ValueFromRemainingArguments = False
    Aliases = {ev}
    Attributes =




  Parameter Name: WarningVariable
    ParameterType = System.String
    Position = -2147483648
    IsMandatory = False
    IsDynamic = False
    HelpMessage =
    ValueFromPipeline = False
    ValueFromPipelineByPropertyName = False
    ValueFromRemainingArguments = False
    Aliases = {wv}
    Attributes =




  Parameter Name: InformationVariable
    ParameterType = System.String
    Position = -2147483648
    IsMandatory = False
    IsDynamic = False
    HelpMessage =
    ValueFromPipeline = False
    ValueFromPipelineByPropertyName = False
    ValueFromRemainingArguments = False
    Aliases = {iv}
    Attributes =




  Parameter Name: OutVariable
    ParameterType = System.String
    Position = -2147483648
    IsMandatory = False
    IsDynamic = False
    HelpMessage =
    ValueFromPipeline = False
    ValueFromPipelineByPropertyName = False
    ValueFromRemainingArguments = False
    Aliases = {ov}


  Parameter Name: OutBuffer
    ParameterType = System.Int32
    Position = -2147483648
    IsMandatory = False
    IsDynamic = False
    HelpMessage =
    ValueFromPipeline = False
    ValueFromPipelineByPropertyName = False
    ValueFromRemainingArguments = False
    Aliases = {ob}
    Attributes =




  Parameter Name: PipelineVariable
    ParameterType = System.String
    Position = -2147483648
    IsMandatory = False
    IsDynamic = False
    HelpMessage =
    ValueFromPipeline = False
    ValueFromPipelineByPropertyName = False
    ValueFromRemainingArguments = False
    Aliases = {pv}
    Attributes =



PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).RemotingCapability
PowerShell
PS D:\Downloads>

    param (
    )
    if (-Not(Test-Path $Path)) {
        Write-Error 'å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚' -ErrorAction Stop
    }

    # ç›¸å¯¾ãƒ‘ã‚¹ã ã¨Openãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£å¸¸å‹•ä½œã—ãªã„ç‚ºã€çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›
    $fullPath = (Resolve-Path -Path $Path -ErrorAction SilentlyContinue).Path

    $fileLocked = $false
    try {
        # èª­ã¿å–ã‚Šå°‚ç”¨ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãå‡¦ç†ã‚’å®Ÿè¡Œ
        $fileStream = [System.IO.File]::Open($fullPath, 'Open', 'ReadWrite', 'None')
    }
    catch {
        # ãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‘ãªã„å ´åˆã€ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã¨åˆ¤æ–­
        $fileLocked = $true
    }
    finally {
        if ($null -ne $fileStream) {
            $fileStream.Close()
        }
    }

    return $fileLocked

PS D:\Downloads>
PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).Source

PS D:\Downloads>
PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).Verb
Test
PS D:\Downloads>
PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).Version
PS D:\Downloads>
PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).Visibility
Public
PS D:\Downloads> (Get-ChildItem function:Test-FileLocked).HelpUri

PS D:\Downloads>
PS D:\Downloads>
```
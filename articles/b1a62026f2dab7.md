---
title: "[PowerShell]å®šç¾©ã—ãŸFunctionã®å†…å®¹ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•"
emoji: "ğŸ§"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: false
---

## å¯¾å¿œæ–¹æ³•

ãŠãŠããã‚ã‘ã¦ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã§å–å¾—ã™ã‚‹æ–¹æ³• ã¨ è‡ªä½œã—ãŸFunctionã§å–å¾—ã™ã‚‹æ–¹æ³• ã‚’ç´¹ä»‹ã€‚

### å¯¾å¿œæ–¹æ³•1: ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã§ç¢ºèªã™ã‚‹æ–¹æ³•

```powershell:A. Get-ChildItemã‚’ä½¿ã„æ–‡å­—åˆ—å½¢å¼ã§å–å¾—ã™ã‚‹æ–¹æ³•
(Get-ChildItem function:Test-FileLocked).Definition
```

```powershell:B. Get-ChildItemã‚’ä½¿ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã§å–å¾—ã™ã‚‹æ–¹æ³•
(Get-ChildItem function:Test-FileLocked).ScriptBlock
```

```powershell:C. Get-Commandã‚’ä½¿ã„æ–‡å­—åˆ—å½¢å¼ã§å–å¾—ã™ã‚‹æ–¹æ³•
(Get-Command $FunctionName).ScriptBlock.ToString()
```

```powershell:D. Get-Commandã‚’ä½¿ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã§å–å¾—ã™ã‚‹æ–¹æ³•
(Get-Command $FunctionName).ScriptBlock
```

```powershell:å®Ÿéš›ã«ç¢ºèªã—ãŸçµæœ
# A. Get-ChildItemã‚’ä½¿ã„æ–‡å­—åˆ—å½¢å¼ã§å–å¾—ã™ã‚‹æ–¹æ³•
PS D:\Downloads> $result = (Get-ChildItem function:Test-FileLocked).Definition
PS D:\Downloads> $result.GetType().FullName
System.String
PS D:\Downloads>

# B. Get-ChildItemã‚’ä½¿ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã§å–å¾—ã™ã‚‹æ–¹æ³•
PS D:\Downloads> $result = (Get-ChildItem function:Test-FileLocked).ScriptBlock
PS D:\Downloads> $result.GetType().FullName
System.Management.Automation.ScriptBlock
PS D:\Downloads>

# C. Get-Commandã‚’ä½¿ã„æ–‡å­—åˆ—å½¢å¼ã§å–å¾—ã™ã‚‹æ–¹æ³•
PS D:\Downloads> $result = (Get-Command $FunctionName).ScriptBlock.ToString()
PS D:\Downloads> $result.GetType().FullName
System.String
PS D:\Downloads>

# D. Get-Commandã‚’ä½¿ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã§å–å¾—ã™ã‚‹æ–¹æ³•
PS D:\Downloads> $result = (Get-Command $FunctionName).ScriptBlock
PS D:\Downloads> $result.GetType().FullName
System.Management.Automation.ScriptBlock
PS D:\Downloads>
```

:::details è£œè¶³æƒ…å ±ï¼šæ–‡å­—åˆ—å½¢å¼ ã¨ ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ ã®é•ã„

- æ–‡å­—åˆ—å½¢å¼
    æ–‡å­—é€šã‚Šãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã™ã‚‹ç‚ºã«ä½¿ç”¨ã€‚
    ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã ã‘ã§ã¯ä½•ã‚‚å‡¦ç†ã§ããªã„ã€‚
    ä»£ç”¨çš„ãªä½¿ç”¨æ–¹æ³•ã¯å‡ºåŠ›ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆï¼ˆ`Write-Host`ï¼‰ã¨çµ„ã¿åˆã‚ã›ã‚‹æ–¹æ³•ãŒã‚ã‚‹ã€‚

    ```powershell:æ–‡å­—åˆ—ã‚’å®£è¨€ã—ã¦ã‚³ãƒãƒ³ãƒ‰ã§å‡ºåŠ›
    # æ–‡å­—åˆ—é…åˆ—ã‚’å®£è¨€
    $months = @(
        @("1æœˆ", "January", "ËˆjÃ¦n.ju.er.i (ã‚¸ãƒ£ãƒ‹ãƒ¥ã‚¨ãƒª)"),
        @("2æœˆ", "February", "Ëˆfeb.ruË.er.i (ãƒ•ã‚§ãƒ–ãƒ«ã‚¨ãƒª)"),
        @("3æœˆ", "March", "mÉ‘ËrtÊƒ (ãƒãƒ¼ãƒ)"),
        @("4æœˆ", "April", "ËˆeÉª.prÉ™l (ã‚¨ã‚¤ãƒ—ãƒªãƒ«)"),
        @("5æœˆ", "May", "meÉª (ãƒ¡ã‚¤)"),
        @("6æœˆ", "June", "dÊ’uËn (ã‚¸ãƒ¥ãƒ¼ãƒ³)"),
        @("7æœˆ", "July", "dÊ’ÊŠËˆlaÉª (ã‚¸ãƒ¥ãƒ©ã‚¤)"),
        @("8æœˆ", "August", "ËˆÉ”Ë.É¡É™st (ã‚ªãƒ¼ã‚¬ã‚¹ãƒˆ)"),
        @("9æœˆ", "September", "sÉ›pËˆtÉ›mbÉ™r (ã‚»ãƒ—ãƒ†ãƒ³ãƒãƒ¼)"),
        @("10æœˆ", "October", "É’kËˆtoÊŠbÉ™r (ã‚ªã‚¯ãƒˆãƒ¼ãƒãƒ¼)"),
        @("11æœˆ", "November", "noÊŠËˆvÉ›mbÉ™r (ãƒãƒ¼ãƒ´ã‚§ãƒ³ãƒãƒ¼)"),
        @("12æœˆ", "December", "dÉªËˆsÉ›mbÉ™r (ãƒ‡ã‚£ã‚»ãƒ³ãƒãƒ¼)")
    )

    # æ–‡å­—åˆ—é…åˆ—ã‚’è¡Œã”ã¨ã«å‡ºåŠ›
    foreach ($row in $months) {
        Write-Host "$($row[0]),    $($row[1]),    $($row[2])"
    }

    # å®Ÿè¡Œçµæœ
    1æœˆ,    January,    ËˆjÃ¦n.ju.er.i (ã‚¸ãƒ£ãƒ‹ãƒ¥ã‚¨ãƒª)
    2æœˆ,    February,    Ëˆfeb.ruË.er.i (ãƒ•ã‚§ãƒ–ãƒ«ã‚¨ãƒª)
    3æœˆ,    March,    mÉ‘ËrtÊƒ (ãƒãƒ¼ãƒ)
    4æœˆ,    April,    ËˆeÉª.prÉ™l (ã‚¨ã‚¤ãƒ—ãƒªãƒ«)
    5æœˆ,    May,    meÉª (ãƒ¡ã‚¤)
    6æœˆ,    June,    dÊ’uËn (ã‚¸ãƒ¥ãƒ¼ãƒ³)
    7æœˆ,    July,    dÊ’ÊŠËˆlaÉª (ã‚¸ãƒ¥ãƒ©ã‚¤)
    8æœˆ,    August,    ËˆÉ”Ë.É¡É™st (ã‚ªãƒ¼ã‚¬ã‚¹ãƒˆ)
    9æœˆ,    September,    sÉ›pËˆtÉ›mbÉ™r (ã‚»ãƒ—ãƒ†ãƒ³ãƒãƒ¼)
    10æœˆ,    October,    É’kËˆtoÊŠbÉ™r (ã‚ªã‚¯ãƒˆãƒ¼ãƒãƒ¼)
    11æœˆ,    November,    noÊŠËˆvÉ›mbÉ™r (ãƒãƒ¼ãƒ´ã‚§ãƒ³ãƒãƒ¼)
    12æœˆ,    December,    dÉªËˆsÉ›mbÉ™r (ãƒ‡ã‚£ã‚»ãƒ³ãƒãƒ¼)
    ```

- ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å½¢å¼
    å®Ÿè¡Œå¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦å®šç¾©ã§ãã‚‹å½¢å¼ã€‚
    ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã¯ã€ä¸­æ‹¬å¼§ï¼ˆ`{}`ï¼‰ã«å›²ã¾ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã‚„å¼ã®é›†åˆä½“ã§ãã®ã¾ã¾å®Ÿè¡Œã§ãã‚‹ã€‚
    ã¾ãŸã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å‹ã¨ã—ã¦å¤‰æ•°ã«æ ¼ç´ã—ãŸã‚Šã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã‚’å¯¾å¿œã™ã‚‹ä»–ã®ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆï¼ˆ`Invoke-Command`ï¼‰ã«å¼•ãæ¸¡ã—å®Ÿè¡ŒãŒå¯èƒ½ã€‚

    ```powershell:ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã§å®£è¨€ã—å®Ÿè¡Œ
    # ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã§è‹±èªå…ˆé ­3æ¡ã‹ã‚‰æ›œæ—¥ã‚’æ¤œç´¢ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’å®£è¨€
    $findDay = {
        param (
            [System.String]$Abbreviation
        )
        # ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å†…ã§æ–‡å­—åˆ—é…åˆ—ã‚’å®£è¨€
        $daysOfTheWeek = @(
            @("æ—¥æ›œ", "Sunday", "ËˆsÊŒn.deÉª (ã‚µãƒ³ãƒ‡ã‚¤)"),
            @("æœˆæ›œ", "Monday", "ËˆmÊŒn.deÉª (ãƒãƒ³ãƒ‡ã‚¤)"),
            @("ç«æ›œ", "Tuesday", "ËˆtjuËz.deÉª (ãƒãƒ¥ãƒ¼ã‚ºãƒ‡ã‚¤)"),
            @("æ°´æ›œ", "Wednesday", "ËˆwÉ›nz.deÉª (ã‚¦ã‚§ãƒ³ã‚ºãƒ‡ã‚¤)"),
            @("æœ¨æ›œ", "Thursday", "ËˆÎ¸ÉœËrz.deÉª (ã‚µãƒ¼ã‚ºãƒ‡ã‚¤)"),
            @("é‡‘æ›œ", "Friday", "ËˆfraÉª.deÉª (ãƒ•ãƒ©ã‚¤ãƒ‡ã‚¤)"),
            @("åœŸæ›œ", "Saturday", "ËˆsÃ¦t.É™r.deÉª (ã‚µã‚¿ãƒ‡ã‚¤)")
        )
        
        # é…åˆ—ã‚’æ¤œç´¢
        $dayFound = $daysOfTheWeek | Where-Object { $_[1].Substring(0,3).ToLower() -eq $abbreviation.ToLower() }
        if ($dayFound) {
            Write-Host "ãƒ’ãƒƒãƒˆã—ã¾ã—ãŸã€‚æ—¥æœ¬èªã®æ›œæ—¥ã€Œ$($dayFound[0])ã€"
        } else {
            Write-Host "è©²å½“ã™ã‚‹æ›œæ—¥ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚"
        }
    }

    # å®Ÿè¡Œçµæœ
    #   ç›´æ¥ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã‚’å®Ÿè¡Œ
    PS D:\Downloads> & $findDay -Abbreviation "Thu"
    ãƒ’ãƒƒãƒˆã—ã¾ã—ãŸã€‚æ—¥æœ¬èªã®æ›œæ—¥ã€Œæœ¨æ›œã€
    PS D:\Downloads>

    #   Invoke-Commandã«å¼•ãæ¸¡ã—ã¦å®Ÿè¡Œ
    PS D:\Downloads> Invoke-Command -ScriptBlock $findDay -ArgumentList "Sun"
    ãƒ’ãƒƒãƒˆã—ã¾ã—ãŸã€‚æ—¥æœ¬èªã®æ›œæ—¥ã€Œæ—¥æ›œã€
    PS D:\Downloads>
    ```

:::

### å¯¾å¿œæ–¹æ³•2: è‡ªä½œã—ãŸFunctionã§ç¢ºèªã™ã‚‹æ–¹æ³•

```powershell:è‡ªä½œã—ãŸFunctionã®ã‚³ãƒ¼ãƒ‰
function Get-FunctionDefinition {
    param (
        [System.String]$FunctionName,
        [System.String]$Newline="`r`n",
        [System.Boolean]$MarkdownMode=$False
    )

    # FunctionãŒå­˜åœ¨ã—ãªã„å ´åˆ
    if ($null -eq (Get-Command -Name $FunctionName -ErrorAction SilentlyContinue)) {
        Write-Warning "è©²å½“ã®FunctionãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚[æ¤œç´¢ã—ãŸFunctionå: $($FunctionName)]"
        return
    }

    # å…ˆé ­ã®ç©ºè¡Œã‚’é£›ã°ã—ã¦Functionã®å®šç¾©å†…å®¹ã‚’å–å¾—
    #   ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å†…ã®æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’ã€ŒLFã€ã§è¨­å®šï¼ˆâ€» PowerShellãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦å¤‰ã‚ã‚‹ã‹ã‚‚ï¼‰
    $scriptblockNewline = "`n"
    $plainDefinition = (((Get-Command $FunctionName).ScriptBlock.ToString() -Split $scriptblockNewline | Select-Object -Skip 1) -Join $Newline)

    $functionDefinition = ''
    if ($MarkdownMode) {
        $functionDefinition += "``````powershell$($Newline)"
        $functionDefinition += "function $FunctionName {$($Newline)"
        $functionDefinition += $plainDefinition
        $functionDefinition += "}$($Newline)"
        $functionDefinition += "``````$($Newline)"
    }
    else {
        $functionDefinition += "function $FunctionName {$($Newline)"
        $functionDefinition += $plainDefinition
        $functionDefinition += "}$($Newline)"
    }

    return $functionDefinition
}
```

```powershell:å¿…é ˆã®å¼•æ•°ã®ã¿ã§è‡ªä½œFunctionã‚’å®Ÿè¡Œ
PS D:\Downloads> Get-FunctionDefinition Test-FileLocked
function Test-FileLocked {
    param (
        [Parameter(Mandatory=$true)][System.String]$Path
    )

    if (-Not(Test-Path $Path)) {
        Write-Error 'å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚' -ErrorAction Stop
    }

    # ç›¸å¯¾ãƒ‘ã‚¹ã ã¨Openãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£å¸¸å‹•ä½œã—ãªã„ç‚ºã€çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›
    $fullPath = (Resolve-Path -Path $Path -ErrorAction SilentlyContinue).Path

    $fileLocked = $false
    try {
        # èª­ã¿å–ã‚Šå°‚ç”¨ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãå‡¦ç†ã‚’å®Ÿè¡Œ
        $fileStream = [System.IO.File]::Open($fullPath, 'Open', 'ReadWrite', 'None')
    }
    catch {
        # ãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‘ãªã„å ´åˆã€ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã¨åˆ¤æ–­
        $fileLocked = $true
    }
    finally {
        if ($null -ne $fileStream) {
            $fileStream.Close()
        }
    }

    return $fileLocked
}

PS D:\Downloads>
```

````powershell:å¼•æ•°ã§æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’LFãƒ»Markdownãƒ¢ãƒ¼ãƒ‰ã‚’ã‚ªãƒ³ã§è¨­å®šã—å‡ºåŠ›
PS D:\Downloads> Get-FunctionDefinition -FunctionName "Test-FileLocked" -Newline "`n" -MarkdownMode $True
```powershell
function Test-FileLocked {
    param (
        [Parameter(Mandatory=$true)][System.String]$Path
    )

    if (-Not(Test-Path $Path)) {
        Write-Error 'å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚' -ErrorAction Stop
    }

    # ç›¸å¯¾ãƒ‘ã‚¹ã ã¨Openãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£å¸¸å‹•ä½œã—ãªã„ç‚ºã€çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›
    $fullPath = (Resolve-Path -Path $Path -ErrorAction SilentlyContinue).Path

    $fileLocked = $false
    try {
        # èª­ã¿å–ã‚Šå°‚ç”¨ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãå‡¦ç†ã‚’å®Ÿè¡Œ
        $fileStream = [System.IO.File]::Open($fullPath, 'Open', 'ReadWrite', 'None')
    }
    catch {
        # ãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‘ãªã„å ´åˆã€ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã¨åˆ¤æ–­
        $fileLocked = $true
    }
    finally {
        if ($null -ne $fileStream) {
            $fileStream.Close()
        }
    }

    return $fileLocked
}
```

PS D:\Downloads>
````

## ã¾ã¨ã‚

- PowerShellã§ã‚ã‚‰ã‹ã˜ã‚å®šç¾©ã—ãŸFunctionã®å†…å®¹ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã‚’èª¿ã¹ãŸ
    - å¯¾å¿œæ–¹æ³•1: ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã§å–å¾—ã™ã‚‹æ–¹æ³•
        - A. Get-ChildItemã§æ–‡å­—åˆ—å½¢å¼ã‚’å–å¾—

            ```powershell:
            (Get-ChildItem function:"å¯¾è±¡ã®Functionå").Definition`
            ```

        - B. Get-ChildItemã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã‚’å–å¾—
            
            ```powershell:
            (Get-ChildItem function:"å¯¾è±¡ã®Functionå").ScriptBlock`
            ```

        - C. Get-Commandã§æ–‡å­—åˆ—å½¢å¼ã‚’å–å¾—

            ```powershell:
            (Get-Command "å¯¾è±¡ã®Functionå").ScriptBlock.ToString()`
            ```

        - D. Get-Commandã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã‚’å–å¾—
            
            ```powershell:
            (Get-Command $FunctionName).ScriptBlock`
            ```

    - å¯¾å¿œæ–¹æ³•2: Functionã§å–å¾—ã™ã‚‹æ–¹æ³•
        
        ```powershell:
        Get-FunctionDefinition -FunctionName "å¯¾è±¡ã®Functioonå" -
        ```

---
title: "[PowerShell]Excelã®COMã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹æ”¾ã™ã‚‹Function"
emoji: "ğŸ¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell", "excel"]
published: false
---
## æ¦‚è¦

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ä½¿ã£ãŸå¾Œã®è§£æ”¾å‡¦ç†ã‚’Functionã«

## å¯¾å¿œæ–¹æ³•

```powershell:
# Excelã®COMã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹æ”¾ã™ã‚‹å‡¦ç†
function Release-ExcelObjects {
    param (
        [Microsoft.Office.Interop.Excel.ApplicationClass]$ExcelObject,
        [System.__ComObject]$WorkbookObject
    )

    # ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚‹å ´åˆã¯é–‹æ”¾
    if ($null -ne $WorkbookObject) {
        # ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯ãŒé–‰ã˜ã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
        if (-not ($WorkbookObject.Saved)) {
            Write-Error 'ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯ãŒé–‹ã‹ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚'
            return
        }
        [System.Runtime.InteropServices.Marshal]::ReleaseComObject($WorkbookObject)
    }
    # ã‚¨ã‚¯ã‚»ãƒ«ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚‹å ´åˆã¯é–‹æ”¾
    if ($null -ne $ExcelObject) {
        # Excelã‚¢ãƒ—ãƒªãŒé–‰ã˜ã‚Œã‚‰ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
        if ($ExcelObject.Workbooks.Count -gt 0) {
            Write-Error 'Excelã‚¢ãƒ—ãƒªãŒé–‹ã‹ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚'
            return
        }
        [System.Runtime.InteropServices.Marshal]::ReleaseComObject($ExcelObject)
    }

    # ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’å¼·åˆ¶çš„ã«å®Ÿè¡Œ
    [System.GC]::Collect()
    [System.GC]::WaitForPendingFinalizers()
}
```


https://zenn.dev/pfirsich/articles/8eb131db9eba3d
---
title: "PowerShellã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹Functionã‚’ä½œæˆã—ã¾ã—ãŸ"
emoji: "ğŸ‰"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: false
---

## winget upgrade ã®çµæœã‚’å¤‰æ•°ã«å…¥ã‚Œã‚‹ã¨æ–‡å­—åŒ–ã‘

PowerShell 7.x ã«ãŠã‘ã‚‹æ–‡å­—ã‚³ãƒ¼ãƒ‰ã®åˆæœŸå€¤ãŒ
æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã§ãã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã®æ—¢å®šå€¤ï¼ˆ`[console]::OutputEncoding`ï¼‰ãŒ `Shift JIS` ã§ã€
PowerShellã‹ã‚‰å¤–éƒ¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«æ¸¡ã™æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®è¨­å®šï¼ˆ`$global:OutputEncoding`ï¼‰ ãŒ `UTF8` ã¨ãªã‚Šã€
å¤–éƒ¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€wingetã‚³ãƒãƒ³ãƒ‰ã§å‡ºåŠ›ã•ã‚Œã‚‹æ–‡å­—ã‚³ãƒ¼ãƒ‰ãŒã€Œ`UTF8`ã€ã€‚
ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚³ãƒ³ã‚½ãƒ¼ãƒ«è¡¨ç¤ºã§ã¯ã€`Shift JIS` ã¨ã„ã†é£Ÿã„é•ã„ãŒåˆæœŸçŠ¶æ…‹ã§ç™ºç”Ÿã—æ–‡å­—åŒ–ã‘ã¦ã„ãŸæ¨¡æ§˜ã€‚

æ¤œç´¢ã—ãŸçµæœã€åŒæ–¹ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’åˆã‚ã›ã‚‹Functionã‚’ä½œæˆã—ã¦ã„ãŸæ–¹ãŒã„ãŸã®ã§å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸã€‚
ï¼ˆPowerShellãŒCoreã®å ´åˆã€`[System.Text.Encoding]::Default`ã®çµæœãŒutf8ã¨ãªã‚‹ç‚ºã€ãã®ã¾ã¾PowerShell 7.xã§ä½¿ç”¨ã™ã‚‹äº‹ãŒã§ããªã‹ã£ãŸç‚ºã€ç´¹ä»‹ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’å…ƒã«å¾®ä¿®æ­£ã€‚ï¼‰
https://qiita.com/e4rfx/items/3772ecb58b6918ed5348

```powershell:ä½œæˆã—ãŸFunction
function SetPsOutputEncoding {
    param (
        [System.String]$charcode = 'reset_encoding'
    )

    switch ($charcode) {
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’UTF8ã«è¨­å®šã™ã‚‹
        'utf8' {
            $PSDefaultParameterValues['*:Encoding'] = 'utf8'
            $global:OutputEncoding = [System.Text.Encoding]::UTF8
            [console]::OutputEncoding = [System.Text.Encoding]::UTF8
        }
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’Shift JISï¼ˆSJISï¼‰ã«è¨­å®šã™ã‚‹
        'sjis' {
            $PSDefaultParameterValues['*:Encoding'] = 'sjis'
            $global:OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
            [console]::OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
        }
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ASCIIã«è¨­å®šã™ã‚‹
        'ascii' {
            $PSDefaultParameterValues.Remove('*:Encoding')
            $global:OutputEncoding = [System.Text.Encoding]::ASCII
            [console]::OutputEncoding = [System.Text.Encoding]::ASCII
        }
        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æŒ‡å®šã‚’è§£é™¤ã™ã‚‹
        'rm_encoding' {
            $PSDefaultParameterValues.Remove('*:Encoding')
        }
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰è¨­å®šã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
        'reset_encoding' {
            $PSDefaultParameterValues.Remove('*:Encoding')

            If ($PSVersionTable.PSEdition -eq 'Core') {
                # Core ã®å ´åˆ
                $global:OutputEncoding = [System.Text.Encoding]::UTF8
                [console]::OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
            }
            else {
                # Core ä»¥å¤–ã®å ´åˆï¼ˆPowerShell 5.Xãªã©ï¼‰
                $global:OutputEncoding = [System.Text.Encoding]::ASCII
                [console]::OutputEncoding = [System.Text.Encoding]::Default     # shift_jis
            }
            
            # ã‚¿ã‚¤ãƒˆãƒ«ã®è¡¨ç¤ºåˆ‡æ›¿Functionå‘¼ã³å‡ºã—ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆè§£é™¤ã¯ä»»æ„ï¼‰
            # (https://zenn.dev/haretokidoki/articles/67788ca9b47b27)
            # ChangeWindowTitle
        }
    }
}

# å®Ÿè¡Œãƒ†ã‚¹ãƒˆ
SetPsOutputEncoding 'utf8'
```

## Bing AI

:::details Bing AI
> 
> 
> powershell ã§æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹éš›ã®ä¸‹è¨˜é …ç›®ã«ã¤ã„ã¦ã€èª¬æ˜ã—ã¦ãã ã•ã„ã€‚
> ãƒ»$PSDefaultParameterValues['*:Encoding']
> ãƒ»$global:OutputEncoding
> ãƒ»[console]::OutputEncoding
-----
> 
> 
> ã“ã‚“ã«ã¡ã¯ã€ã“ã‚Œã¯ Bing ã§ã™ã€‚ğŸ˜Š
> 
> powershell ã§æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹éš›ã®ä¸‹è¨˜é …ç›®ã«ã¤ã„ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«èª¬æ˜ã§ãã¾ã™ã€‚
> 
> - `$PSDefaultParameterValues['*:Encoding']` ã¯ã€æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã§ãã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã®æ—¢å®šå€¤ã‚’è¨­å®šã™ã‚‹ãŸã‚ã®å¤‰æ•°ã§ã™ã€‚ä¾‹ãˆã°ã€`$PSDefaultParameterValues['Out-File:Encoding'] = 'utf8'` ã¨ã™ã‚‹ã¨ã€`Out-File` ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã® `Encoding` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®æ—¢å®šå€¤ãŒ `utf8` ã«ãªã‚Šã¾ã™Â¹ã€‚
> - `$global:OutputEncoding` ã¯ã€powershell ã‹ã‚‰å¤–éƒ¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å‡ºåŠ›ã™ã‚‹éš›ã®æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹ãŸã‚ã®å¤‰æ•°ã§ã™ã€‚ä¾‹ãˆã°ã€`$global:OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')` ã¨ã™ã‚‹ã¨ã€å¤–éƒ¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«æ¸¡ã™å‡ºåŠ›ãŒã‚·ãƒ•ãƒˆJISã«ãªã‚Šã¾ã™Â²ã€‚
> - `[console]::OutputEncoding` ã¯ã€powershell ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã™ã‚‹éš›ã®æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã™ã€‚ä¾‹ãˆã°ã€`[console]::OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')` ã¨ã™ã‚‹ã¨ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã™ã‚‹å‡ºåŠ›ãŒã‚·ãƒ•ãƒˆJISã«ãªã‚Šã¾ã™Â³ã€‚
> 
> ã“ã‚Œã‚‰ã®é …ç›®ã¯ã€ãã‚Œãã‚Œç•°ãªã‚‹ç›®çš„ã‚„ç¯„å›²ã§æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚æ–‡å­—åŒ–ã‘ã‚’é˜²ããŸã‚ã«ã¯ã€é©åˆ‡ãªæ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’é¸æŠã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚â´
> 
> å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚ğŸ˜Š
> 
> ã‚½ãƒ¼ã‚¹: Bing ã¨ã®ä¼šè©± 2024/1/15
> (1) æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã«ã¤ã„ã¦ - PowerShell | Microsoft Learn. https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_character_encoding?view=powershell-7.4.
> (2) PowerShellã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹ #Windows - Qiita. https://qiita.com/Yorcna/items/d015ebe4fae50882e3a1.
> (3) Powershellã®æ–‡å­—åŒ–ã‘ã‚’ç›´ã™æ–¹æ³• - ãŠã‚Œã•ã¾ãƒ©ãƒœ. https://bing.com/search?q=powershell+%e6%96%87%e5%ad%97%e3%82%b3%e3%83%bc%e3%83%89+%e8%a8%ad%e5%ae%9a.
> (4) Powershellã®æ–‡å­—åŒ–ã‘ã‚’ç›´ã™æ–¹æ³• - ãŠã‚Œã•ã¾ãƒ©ãƒœ. https://www.oresamalabo.net/entry/2021/09/15/003143.
:::

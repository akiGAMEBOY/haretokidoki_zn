---
title: "New-WinEventで指定するProviderを作成する"
emoji: "🦁"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

こんにちは、Copilotです。PowerShellに関する質問ありがとうございます。😊

New-WinEventで指定するProviderを作成する方法は、以下のようになります。

- Providerとは、イベントのソースとなるコンポーネントやアプリケーションのことで、イベントの種類や形式を定義したものです¹。
- Providerを作成するには、イベント マニフェストと呼ばれるXMLファイルを作成し、イベントのプロパティやテンプレートを記述します²。
- イベント マニフェストを作成したら、wevtutil.exeというツールを使って、マニフェストを登録し、イベント ログに出力できるようにします³。
- 例えば、以下のようなイベント マニフェストを作成したとします。

```xml
<?xml version="1.0" encoding="utf-8"?>
<instrumentationManifest xmlns="http://schemas.microsoft.com/win/2004/08/events">
  <instrumentation>
    <events>
      <provider name="MyProvider" guid="{11111111-1111-1111-1111-111111111111}" symbol="MY_PROVIDER">
        <events>
          <event symbol="MY_EVENT" value="1000" version="0" level="win:Informational" task="None" opcode="win:Info" channel="Application" keywords="win:None" template="MyTemplate"/>
        </events>
        <templates>
          <template tid="MyTemplate">
            <data name="Message" inType="win:UnicodeString" outType="xs:string"/>
          </template>
        </templates>
      </provider>
    </events>
  </instrumentation>
</instrumentationManifest>
```

このマニフェストでは、MyProviderというProviderを作成し、イベント ID が 1000 のイベントを定義しています。このイベントは、Application ログに出力され、メッセージというデータを持ちます。

- このマニフェストを MyProvider.man という名前で保存し、コマンドプロンプトで以下のコマンドを実行します。

```cmd
wevtutil.exe im MyProvider.man
```

このコマンドは、マニフェストを登録し、イベント ログに出力できるようにします。

- これで、New-WinEventでMyProviderを指定して、イベントを作成できます。例えば、以下のようなコマンドを実行できます。

```powershell
New-WinEvent -ProviderName MyProvider -Id 1000 -Payload @("Hello, World!")
```

このコマンドは、MyProviderのイベント 1000 を作成し、メッセージに "Hello, World!" を指定します。

以上が、New-WinEventで指定するProviderを作成する方法の説明です。ご参考になれば幸いです。😊

: [イベント プロバイダーの概要 - Windows Server | Microsoft Docs](^1^)
: [イベント マニフェストの概要 - Windows Server | Microsoft Docs](^2^)
: [Wevtutil - Windows コマンド リファレンス](^3^)

ソース: Bing との会話 2024/3/5
(1) New-WinEvent (Microsoft.PowerShell.Diagnostics) - PowerShell. https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.diagnostics/new-winevent?view=powershell-7.4.
(2) 【PowerShell】イベントログをCSVファイルとして出力する - Qiita. https://qiita.com/hara_power/items/073fa6079e633f084412.
(3) Windowsイベントをログに記録する方法について #Windows - Qiita. https://qiita.com/King_kenshi/items/7e6f421f9b3545e65420.
(4) New-WinEvent (Microsoft.PowerShell.Diagnostics) - PowerShell. https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.diagnostics/new-winevent?view=powershell-7.4.
(5) 【PowerShell】イベントログをCSVファイルとして出力する - Qiita. https://qiita.com/hara_power/items/073fa6079e633f084412.
(6) Windowsイベントをログに記録する方法について #Windows - Qiita. https://qiita.com/King_kenshi/items/7e6f421f9b3545e65420.
(7) PowerShellでイベントソースを追加・削除する #Windows - Qiita. https://qiita.com/gtom7156/items/b055f3b11785d9c9f90e.
(8) undefined. http://schemas.microsoft.com/win/2004/08/events.

---
title: "PowerShellで独自のイベントログ（イベントビューアー内）を出力するまでの方法"
emoji: "🦁"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["powershell"]
published: false
---

Write-EventlogやNew-Eventlogは使用できない。
イベント登録時、wevtutil.exeを使わない方法を

-----

PowerShell 6.0以降のコマンドレットを使って独自のイベントログを出力する方法を教えて。
バージョンが6.0以降つまり、Write-EvnetlogやNew-Eventlogは使えないという事です。

-----

こんにちは、Copilotです。😊
PowerShell 6.0以降では、Write-EventlogやNew-Eventlogは非推奨となり、代わりにGet-WinEventやWrite-Eventというコマンドレットを使う必要があります¹²。独自のイベントログを出力するには、以下の手順を参考にしてください。

★ここにプロバイダーの登録が必要。

1. イベントプロバイダーを登録する
イベントプロバイダーとは、イベントログに書き込むための識別子です。New-EventLogで作成したログ名と同じものを使うことができます。イベントプロバイダーを登録するには、New-WinEventコマンドレットの-ProviderNameパラメーターを使います。例えば、以下のコマンドは"MyLog"というイベントプロバイダーを登録します。

```powershell
New-WinEvent -ProviderName "MyLog" -Id 100
```

2. イベントログに書き込む
イベントログに書き込むには、Write-Eventコマンドレットを使います。-ProviderNameパラメーターには、登録したイベントプロバイダーの名前を指定します。-Idパラメーターには、イベントIDを指定します。-Levelパラメーターには、イベントのレベルを指定します。-Messageパラメーターには、イベントのメッセージを指定します。例えば、以下のコマンドは"MyLog"というイベントプロバイダーに対して、IDが100、レベルがInformation、メッセージが"Hello, World!"というイベントを書き込みます。

```powershell
Write-Event -ProviderName "MyLog" -Id 100 -Level Information -Message "Hello, World!"
```

3. イベントログを確認する
イベントログを確認するには、Get-WinEventコマンドレットを使います。-ProviderNameパラメーターには、登録したイベントプロバイダーの名前を指定します。-MaxEventsパラメーターには、取得するイベントの最大数を指定します。例えば、以下のコマンドは"MyLog"というイベントプロバイダーから最新の10件のイベントを取得します。

```powershell
Get-WinEvent -ProviderName "MyLog" -MaxEvents 10
```

以上が、PowerShell 6.0以降のコマンドレットを使って独自のイベントログを出力する方法です。詳細は、[こちら](^1^)や[こちら](^2^)を参照してください。ご質問がありましたら、お気軽にお尋ねください。😊

ソース: Bing との会話 2024/3/5
(1) Get-Eventlogの使い方から覚えていくPowershellの基本的な使い .... https://qiita.com/Anubis_369/items/d0566143a1356a2f8ec5.
(2) Get-EventLog (Microsoft.PowerShell.Management) - PowerShell. https://learn.microsoft.com/ja-jp/powershell/module/Microsoft.PowerShell.Management/Get-EventLog?view=powershell-5.1.
(3) Get-Eventlogの使い方から覚えていくPowershellの基本的な使い .... https://qiita.com/Anubis_369/items/d0566143a1356a2f8ec5.
(4) Get-EventLog (Microsoft.PowerShell.Management) - PowerShell. https://learn.microsoft.com/ja-jp/powershell/module/Microsoft.PowerShell.Management/Get-EventLog?view=powershell-5.1.
(5) PowerShellを使って特定のWindowsイベントログをエクスポート .... https://ittrip.xyz/soft/windows/powershell-export-specific-windows-eventlog.
(6) 【Get-EventLog】PowerShell でイベントログを取得する .... https://win2012r2.com/2024/03/03/get-eventlog/.

-----

PowerShell 6.0以降でイベントプロバイダーを新規登録する方法。
なお、コマンドレット「Register-WmiEvent」は使用できません。

-----

こんにちは、Copilotです。PowerShellに関する質問をありがとうございます。😊

PowerShell 6.0以降では、Register-WmiEventコマンドレットは廃止されています¹。代わりに、Register-CimIndicationEventコマンドレットを使用して、CIMイベントプロバイダーを登録することができます²。例えば、次のコマンドは、Win32_Processクラスのインスタンスが作成されたときに発生するイベントを登録します。

```powershell
$query = "SELECT * FROM CIM_InstModification WHERE TargetInstance ISA 'Win32_Process'"
Register-CimIndicationEvent -Query $query -SourceIdentifier ProcessCreated
```

このコマンドは、ProcessCreatedという名前のイベントサブスクリプションを作成します。イベントが発生すると、PowerShellはイベントオブジェクトを作成し、イベントキューに追加します。イベントオブジェクトには、イベントの詳細や発生したインスタンスの情報が含まれます。イベントオブジェクトを取得するには、Get-Eventコマンドレットを使用します³。

```powershell
Get-Event -SourceIdentifier ProcessCreated
```

イベントプロバイダーの登録を解除するには、Unregister-Eventコマンドレットを使用します。

```powershell
Unregister-Event -SourceIdentifier ProcessCreated
```

以上が、PowerShell 6.0以降でイベントプロバイダーを新規登録する方法です。詳細については、[こちら](^2^)のドキュメントを参照してください。もっと知りたいことがあれば、お気軽にお尋ねください。😊

ソース: Bing との会話 2024/3/5
(1) Windows PowerShell プロバイダーを作成する方法 - PowerShell. https://learn.microsoft.com/ja-jp/powershell/scripting/developer/prog-guide/how-to-create-a-windows-powershell-provider?view=powershell-7.3.
(2) Windows のログ記録について - PowerShell | Microsoft Learn. https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_logging_windows?view=powershell-7.4.
(3) PowerShellでイベントソースを追加・削除する #Windows - Qiita. https://qiita.com/gtom7156/items/b055f3b11785d9c9f90e.
(4) Windows のログ記録について - PowerShell | Microsoft Learn. https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_logging_windows?view=powershell-7.4.
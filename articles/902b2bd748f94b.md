---
title: "ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ã—ãã¯ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒé–¾å€¤ä»¥ä¸‹ã‹åˆ¤å®šã™ã‚‹Function"
emoji: "ğŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: false
---

```powershell:
function Test-FileSizeLimit {
    param(
        # ãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¾ã™
        [Parameter(Mandatory = $true)]
        [System.String]$Path,

        # åˆ¤å®šã™ã‚‹ã‚µã‚¤ã‚ºã®é–¾å€¤ï¼ˆGBå˜ä½ï¼‰â€»æŒ‡å®šãŒãªã‘ã‚Œã°20GBã§è¨­å®š
        [Parameter(Mandatory = $false)]
        [System.Int32]$MaxGB = 20
    )

    # ãƒ‘ã‚¹ã®å­˜åœ¨ç¢ºèª
    if (-not (Test-Path -Path $Path)) {
        Write-Error "æŒ‡å®šã•ã‚ŒãŸãƒ‘ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $Path"
        return $false
    }

    # æŒ‡å®šãƒ‘ã‚¹ã®æƒ…å ±ã‚’å–å¾—
    $totalSize = 0
    $item = Get-Item -LiteralPath $Path

    if ($item.PSIsContainer) {
        # ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®å ´åˆã€ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’å«ã‚ãŸåˆè¨ˆã‚µã‚¤ã‚ºã‚’ç®—å‡º
        $sumSize = (Get-ChildItem -LiteralPath $Path -Recurse -File | Measure-Object -Property Length -Sum).Sum
        # ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼å†…ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒç„¡ã„å ´åˆã¯ $null ã¨ãªã‚‹ã®ã§ã€0ã¨ã™ã‚‹
        if ($null -eq $sum) {
        	$sum = 0
        }
        $totalSize = $sumSize
        $totalSizeFormatted = $totalSize.ToString("N0")
        Write-Host "ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ '$Path' ã®åˆè¨ˆã‚µã‚¤ã‚º: $totalSizeFormatted ãƒã‚¤ãƒˆ"
    }
    else {
        # ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ
        $totalSize = $item.Length
        $totalSizeFormatted = $totalSize.ToString("N0")
        Write-Host "ãƒ•ã‚¡ã‚¤ãƒ« '$Path' ã®ã‚µã‚¤ã‚º: $totalSizeFormatted ãƒã‚¤ãƒˆ"
    }

    # ã‚µã‚¤ã‚ºæ¯”è¼ƒã®åˆ¤å®š
    $maxBytes = $MaxGB * 1024 * 1024 * 1024
    $maxBytesFormatted = $maxBytes.ToString("N0")
    
    if ($totalSize -le $maxBytes) {
        Write-Host "ã‚µã‚¤ã‚ºã¯ $totalSizeFormatted ãƒã‚¤ãƒˆã§ã€é–¾å€¤ ($MaxGB GB = $maxBytesFormatted ãƒã‚¤ãƒˆ) ä»¥ä¸‹ã§ã™ã€‚"
        return $true
    }
    else {
        Write-Host "ã‚µã‚¤ã‚ºã¯ $totalSizeFormatted ãƒã‚¤ãƒˆã§ã€é–¾å€¤ ($MaxGB GB = $maxBytesFormatted ãƒã‚¤ãƒˆ) ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚"
        return $false
    }
}
```

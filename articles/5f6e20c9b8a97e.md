---
title: "PowerShellã®ã‚¸ãƒ£ã‚°é…åˆ—ã¨å¤šæ¬¡å…ƒé…åˆ—ã§ç›¸äº’å¤‰æ›ã™ã‚‹Function"
emoji: "ğŸ”"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: false
---

PowerShellã§ã‚¸ãƒ£ã‚°é…åˆ—ã‹ã‚‰å¤šæ¬¡å…ƒé…åˆ—ã«å¤‰æ›ã™ã‚‹Functionã¨ã€ãã®é€†ã®Functionã‚’ä½œæˆã™ã‚‹ã“ã¨ã¯ã€å°‘ã—è¤‡é›‘ã§ã™ãŒã€ä»¥ä¸‹ã®ä¾‹ã‚’å‚è€ƒã«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

ã¾ãšã€ã‚¸ãƒ£ã‚°é…åˆ—ã‹ã‚‰å¤šæ¬¡å…ƒé…åˆ—ã«å¤‰æ›ã™ã‚‹Functionã§ã™ã€‚

```powershell
Function Convert-JaggedToMulti {
    <#
    .SYNOPSIS
        ã‚¸ãƒ£ã‚°é…åˆ—ï¼ˆé…åˆ—ã®é…åˆ—ï¼‰ã‚’2æ¬¡å…ƒã®å¤šæ¬¡å…ƒé…åˆ—ã«å¤‰æ›ã—ã¾ã™ã€‚
    .DESCRIPTION
        å…¥åŠ›ã•ã‚ŒãŸã‚¸ãƒ£ã‚°é…åˆ—ã‚’åˆ†æã—ã€ã™ã¹ã¦ã®ã‚µãƒ–é…åˆ—ã‚’æ ¼ç´ã§ãã‚‹æœ€å°ã®å¤šæ¬¡å…ƒé…åˆ—ã‚’ä½œæˆã—ã¾ã™ã€‚
        ã‚µãƒ–é…åˆ—ã®é•·ã•ãŒç•°ãªã‚‹å ´åˆã€ä¸è¶³ã—ã¦ã„ã‚‹è¦ç´ ã¯ $null ã§åŸ‹ã‚ã‚‰ã‚Œã¾ã™ã€‚
    .PARAMETER JaggedArray
        å¤‰æ›å¯¾è±¡ã®ã‚¸ãƒ£ã‚°é…åˆ—ã€‚
    .EXAMPLE
        PS C:\> $jagged = @(@(1, 2), @(3, 4, 5), @(6))
        PS C:\> Convert-JaggedToMulti -JaggedArray $jagged
    .OUTPUTS
        [System.Object[,]]
    #>
    [CmdletBinding()]
    param(
        [Parameter(Mandatory = $true, ValueFromPipeline = $true)]
        [array]$JaggedArray
    )

    # å…¥åŠ›ãŒç©ºã®é…åˆ—ã®å ´åˆã¯ã€0x0ã®å¤šæ¬¡å…ƒé…åˆ—ã‚’è¿”ã™
    if ($JaggedArray.Length -eq 0) {
        return (New-Object 'object[,]' 0, 0)
    }

    # ã‚µãƒ–é…åˆ—ã®æœ€å¤§ã®é•·ã•ã‚’å–å¾—
    $maxSubArrayLength = ($JaggedArray | Measure-Object -Property Length -Maximum).Maximum
    # å…¨ã¦ã®ã‚µãƒ–é…åˆ—ãŒç©ºã ã£ãŸå ´åˆã€$maxSubArrayLength ãŒ $null ã«ãªã‚‹ãŸã‚ã€0ã«è¨­å®š
    if ($null -eq $maxSubArrayLength) {
        $maxSubArrayLength = 0
    }

    # å¤šæ¬¡å…ƒé…åˆ—ã‚’åˆæœŸåŒ–
    $multiArray = New-Object 'object[,]' $JaggedArray.Length, $maxSubArrayLength

    # è¦ç´ ã‚’ã‚³ãƒ”ãƒ¼
    for ($i = 0; $i -lt $JaggedArray.Length; $i++) {
        # ã‚µãƒ–é…åˆ—ãŒ null ã§ãªã„ã“ã¨ã‚’ç¢ºèª
        if ($null -ne $JaggedArray[$i]) {
            for ($j = 0; $j -lt $JaggedArray[$i].Length; $j++) {
                $multiArray[$i, $j] = $JaggedArray[$i][$j]
            }
        }
    }

    return $multiArray
}
```

æ¬¡ã«ã€å¤šæ¬¡å…ƒé…åˆ—ã‹ã‚‰ã‚¸ãƒ£ã‚°é…åˆ—ã«å¤‰æ›ã™ã‚‹Functionã§ã™ã€‚

```powershell
Function Convert-MultiToJagged {
    <#
    .SYNOPSIS
        2æ¬¡å…ƒã®å¤šæ¬¡å…ƒé…åˆ—ã‚’ã‚¸ãƒ£ã‚°é…åˆ—ï¼ˆé…åˆ—ã®é…åˆ—ï¼‰ã«å¤‰æ›ã—ã¾ã™ã€‚
    .DESCRIPTION
        å…¥åŠ›ã•ã‚ŒãŸå¤šæ¬¡å…ƒé…åˆ—ã®å„è¡Œã‚’ã‚µãƒ–é…åˆ—ã¨ã—ã¦æŒã¤ã‚¸ãƒ£ã‚°é…åˆ—ã‚’ä½œæˆã—ã¾ã™ã€‚
        -TrimNulls ã‚¹ã‚¤ãƒƒãƒã‚’æŒ‡å®šã™ã‚‹ã¨ã€å„ã‚µãƒ–é…åˆ—ã®æœ«å°¾ã«ã‚ã‚‹é€£ç¶šã—ãŸ $null è¦ç´ ãŒé™¤å»ã•ã‚Œã¾ã™ã€‚
    .PARAMETER MultiArray
        å¤‰æ›å¯¾è±¡ã®2æ¬¡å…ƒå¤šæ¬¡å…ƒé…åˆ—ã€‚
    .PARAMETER TrimNulls
        ã“ã®ã‚¹ã‚¤ãƒƒãƒã‚’æŒ‡å®šã™ã‚‹ã¨ã€å„è¡Œã®æœ«å°¾ã«ã‚ã‚‹é€£ç¶šã—ãŸ $null å€¤ãŒå–ã‚Šé™¤ã‹ã‚Œã¾ã™ã€‚
        ã“ã‚Œã«ã‚ˆã‚Šã€Convert-JaggedToMulti ã§åŸ‹ã‚ã‚‰ã‚ŒãŸ $null ã‚’é™¤å»ã§ãã¾ã™ã€‚
    .EXAMPLE
        PS C:\> $multi = New-Object 'object[,]' 2, 3
        PS C:\> $multi[0,0] = 1; $multi[0,1] = 2
        PS C:\> $multi[1,0] = 3; $multi[1,1] = 4; $multi[1,2] = 5
        PS C:\> Convert-MultiToJagged -MultiArray $multi -TrimNulls
        
        # å‡ºåŠ›: @(@(1, 2), @(3, 4, 5))
    .OUTPUTS
        [System.Object[]]
    #>
    [CmdletBinding()]
    param(
        [Parameter(Mandatory = $true, ValueFromPipeline = $true)]
        [System.Array]$MultiArray,

        [Parameter()]
        [switch]$TrimNulls
    )

    # 2æ¬¡å…ƒé…åˆ—ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
    if ($MultiArray.Rank -ne 2) {
        throw "å…¥åŠ›ã¯2æ¬¡å…ƒé…åˆ—ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚"
    }

    $rows = $MultiArray.GetLength(0)
    $cols = $MultiArray.GetLength(1)
    $jaggedArray = New-Object "object[]" $rows

    for ($i = 0; $i -lt $rows; $i++) {
        # ä¸€æ™‚çš„ãªã‚µãƒ–é…åˆ—ã‚’ä½œæˆ
        $tempSubArray = New-Object "object[]" $cols
        for ($j = 0; $j -lt $cols; $j++) {
            $tempSubArray[$j] = $MultiArray[$i, $j]
        }

        # -TrimNulls ã‚¹ã‚¤ãƒƒãƒãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€æœ«å°¾ã® null ã‚’é™¤å»
        if ($TrimNulls) {
            $lastIndex = $tempSubArray.Length - 1
            # æœ«å°¾ã‹ã‚‰è¦‹ã¦ã„ãã€$null ã§ãªã„è¦ç´ ãŒè¦‹ã¤ã‹ã‚‹ã¾ã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ¸›ã‚‰ã™
            while ($lastIndex -ge 0 -and $null -eq $tempSubArray[$lastIndex]) {
                $lastIndex--
            }
            # $null ã§ãªã„è¦ç´ ãŒè¦‹ã¤ã‹ã£ãŸä½ç½®ã¾ã§ã®éƒ¨åˆ†é…åˆ—ã‚’æ ¼ç´
            # å…¨ã¦ãŒ $null ã®å ´åˆã¯ç©ºã®é…åˆ—ã«ãªã‚‹
            $jaggedArray[$i] = $tempSubArray[0..$lastIndex]
        }
        else {
            # [ãƒã‚°ä¿®æ­£] ã‚¹ã‚¤ãƒƒãƒãŒãªã„å ´åˆã¯ã€ãã®ã¾ã¾ã®ã‚µãƒ–é…åˆ—ã‚’æ ¼ç´
            $jaggedArray[$i] = $tempSubArray
        }
    }

    return $jaggedArray
}
```

## é–¢é€£è¨˜äº‹

https://haretokidoki-blog.com/pasocon_powershell-startup/
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960
https://zenn.dev/haretokidoki/articles/fb6830f9155de5

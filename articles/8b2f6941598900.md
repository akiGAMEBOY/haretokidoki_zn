---
title: "UNIXã®headã‚„tailã‚³ãƒãƒ³ãƒ‰ã¨åŒã˜äº‹ã‚’PowerShellã§ã‚‚å®Ÿç¾ã—ãŸã„å ´åˆ"
emoji: "ğŸ¦–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell", "cli"]
published: false
---
## æ¦‚è¦
[ã“ã¡ã‚‰](https://zenn.dev/haretokidoki/articles/1b48ced6152648)ã§ç´¹ä»‹ã—ãŸã€Œãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ä¸€è¦§ã‚’æ›´æ–°æ—¥ä»˜é †ï¼ˆé™é †ï¼‰ã«ä¸¦ã¹æ›¿ãˆã¦è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã€ã‚’èª¿ã¹ã¦ã„ãŸã‚‰ã€UNIXã®headã‚„tailã‚³ãƒãƒ³ãƒ‰ã¨åŒã˜ã‚ˆã†ã«å‰æ–¹ã‚„å¾Œæ–¹ã‹ã‚‰æŒ‡å®šè¡Œæ•°åˆ†ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã‚‚è¦‹ã¤ã‘ãŸã®ã§åˆ¥è¨˜äº‹ã¨ã—ã¦æŠ•ç¨¿ã—ã¾ã™ã€‚

ã¡ãªã¿ã«UNIXç³»ã ã¨ä¸€è¦§è¡¨ç¤ºã‚³ãƒãƒ³ãƒ‰ï¼ˆ`ls`ï¼‰ã ã‚ã†ãŒãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèªã‚³ãƒãƒ³ãƒ‰ï¼ˆ`cat`ï¼‰ã ã‚ã†ãŒã€
ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆ`|`ï¼‰ã«headã‚„tailã§å®Ÿç¾ã§ãã¾ã™ãŒã€
Windowsï¼ˆPowerShellï¼‰ã§ã¯ã€ä¸€è¦§è¡¨ç¤ºã‚³ãƒãƒ³ãƒ‰ï¼ˆ`Get-ChildItem`ï¼‰ã¨ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèªã‚³ãƒãƒ³ãƒ‰ï¼ˆ`Get-Content`ï¼‰ãã‚Œãã‚Œã§é•ã†æ–¹æ³•ã§å¯¾å¿œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚

https://zenn.dev/haretokidoki/articles/1b48ced6152648

## ç’°å¢ƒ
```powershell:ã‚³ãƒ”ãƒ¼ç”¨
$PSVersionTable
```
```powershell:PowerShellã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³
PS C:\Users\XXXX> $PSVersionTable

Name                           Value
----                           -----
PSVersion                      7.3.8
PSEdition                      Core
GitCommitId                    7.3.8
OS                             Microsoft Windows 10.0.19045
Platform                       Win32NT
PSCompatibleVersions           {1.0, 2.0, 3.0, 4.0â€¦}
PSRemotingProtocolVersion      2.3
SerializationVersion           1.1.0.1
WSManStackVersion              3.0

PS C:\Users\XXXX>
```
## ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®å‚ç…§ã§å¯¾å¿œã™ã‚‹æ–¹æ³•
### å‰æ–¹ã‚ˆã‚Šã‚«ã‚¦ãƒ³ãƒˆã—æŒ‡å®šè¡Œæ•°åˆ†ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•
```powershell:ã‚³ãƒ”ãƒ¼ç”¨
Get-ChildItem | Select-Object -First 5
```
```powershell:â€œSelect-Object -First XXXâ€ã§å¯èƒ½
PS C:\Windows\Logs> Get-ChildItem | Select-Object -First 5

    Directory: C:\Windows\Logs

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d----          2023/10/24    11:52                CBS
d----          2022/11/17    10:09                DISM
d----          2023/10/20    10:09                DPX
d---s          2023/10/18    15:35                MeasuredBoot
d----          2023/10/12     8:31                MoSetup

PS C:\Windows\Logs>
```

### å¾Œæ–¹ã‚ˆã‚Šã‚«ã‚¦ãƒ³ãƒˆã—æŒ‡å®šè¡Œæ•°åˆ†ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•
```powershell:ã‚³ãƒ”ãƒ¼ç”¨
Get-ChildItem | Select-Object -Last 5
```
```powershell:â€œSelect-Object -Last XXXâ€ã§å¯èƒ½
PS C:\Windows\Logs> Get-ChildItem | Select-Object -Last 5

    Directory: C:\Windows\Logs

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d----          2023/10/23     8:24                waasmediccapsule
d----          2022/09/21    13:30                WindowsBackup
d----          2023/10/24    11:41                WindowsUpdate
d----          2021/10/13     5:44                WinREAgent
-a---          2023/10/18    15:54         100389 StorGroupPolicy.log

PS C:\Windows\Logs>
```
## ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§å¯¾å¿œã™ã‚‹æ–¹æ³•
### å‰æ–¹ã‚ˆã‚Šã‚«ã‚¦ãƒ³ãƒˆã—æŒ‡å®šè¡Œæ•°åˆ†ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•
å…ˆé ­è¡Œã‹ã‚‰ã‚«ã‚¦ãƒ³ãƒˆã—æŒ‡å®šã®è¡Œæ•°åˆ†ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚
```powershell:ã‚³ãƒ”ãƒ¼ç”¨
Get-Content StorGroupPolicy.log -TotalCount 20
```
```powershell:ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ŒGet-Content XXX -TotalCount XXXã€
PS C:\Windows\Logs> Get-Content StorGroupPolicy.log -TotalCount 20
07/13/2022  0: 8:19.00000860:RegEnumKeyExW failed with (259)

07/13/2022  0: 8:19.00000860:GP object initialized successfully

07/13/2022  0: 8:19.00000891:Deny_All not set for all. Will query other 6 GUIDs

07/13/2022  0: 8:19.00000906:Policy for other GUID is not enabled, status:  1008

07/13/2022  0: 8:19.00000922:Policy for other GUID is not enabled, status:  1008

07/13/2022  0: 8:19.00000938:Policy for other GUID is not enabled, status:  1008

07/13/2022  0: 8:19.00000938:Policy for other GUID is not enabled, status:  1008

07/13/2022  0: 8:19.00000938:Policy for other GUID is not enabled, status:  1008

07/13/2022  0: 9:27.00000577:Deny_All not set for all. Will query other 6 GUIDs

PS C:\Windows\Logs>
```
### å¾Œæ–¹ã‚ˆã‚Šã‚«ã‚¦ãƒ³ãƒˆã—æŒ‡å®šè¡Œæ•°åˆ†ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•
#### ãƒ‘ã‚¿ãƒ¼ãƒ³1ï¼šä¸€å›ãã‚Šã®ç¢ºèªæ–¹æ³•
å®Ÿè¡Œå¾Œã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¿”ã£ã¦ãã‚‹ã€‚
```powershell:ã‚³ãƒ”ãƒ¼ç”¨
Get-Content StorGroupPolicy.log -Tail 20
```
```powershell:ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ŒGet-Content XXX -Tail XXXã€
PS C:\Windows\Logs> Get-Content StorGroupPolicy.log -Tail 20
08/16/2023 23:28:26.00000966:RegEnumKeyExW failed with (259)

08/16/2023 23:28:26.00000966:GP object initialized successfully

08/16/2023 23:28:26.00000982:Deny_All not set for all. Will query other 6 GUIDs

08/16/2023 23:28:26.00000982:Policy for other GUID is not enabled, status:  2

08/16/2023 23:28:26.00000982:Policy for other GUID is not enabled, status:  2

08/16/2023 23:28:26.00000982:Policy for other GUID is not enabled, status:  2

08/16/2023 23:28:26.00000982:Policy for other GUID is not enabled, status:  2

08/16/2023 23:28:26.00000982:Policy for other GUID is not enabled, status:  2

08/16/2023 23:28:26.00000982:Policy for other GUID is not enabled, status:  2

08/16/2023 23:30:26.00000996:Deleted GP object

PS C:\Windows\Logs>
ï¼ˆğŸ‘† ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¿”ã£ã¦ãã‚‹ï¼‰
```
#### ãƒ‘ã‚¿ãƒ¼ãƒ³2ï¼šãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
å®Ÿè¡Œå¾Œã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¿”ã‚‰ãšã«å¸¸æ™‚ç›£è¦–ã—ãŸçŠ¶æ…‹ã€‚ï¼ˆUNIXã®â€œtail -fâ€ã¨ã»ã¼åŒã˜å‹•ãï¼‰
```powershell:ã‚³ãƒ”ãƒ¼ç”¨
Get-Content .\StorGroupPolicy.log -Tail 20 -Wait
```
```powershell:ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ŒGet-Content XXX -Tail XXX -Waitã€
PS C:\Windows\Logs> Get-Content .\StorGroupPolicy.log -Tail 20 -Wait
10/18/2023  6:52: 3.00000048:RegEnumKeyExW failed with (259)

10/18/2023  6:52: 3.00000048:GP object initialized successfully

10/18/2023  6:52: 3.00000063:Deny_All not set for all. Will query other 6 GUIDs

10/18/2023  6:52: 3.00000063:Policy for other GUID is not enabled, status:  2

10/18/2023  6:52: 3.00000063:Policy for other GUID is not enabled, status:  2

10/18/2023  6:52: 3.00000063:Policy for other GUID is not enabled, status:  2

10/18/2023  6:52: 3.00000063:Policy for other GUID is not enabled, status:  2

10/18/2023  6:52: 3.00000063:Policy for other GUID is not enabled, status:  2

10/18/2023  6:52: 3.00000063:Policy for other GUID is not enabled, status:  2

10/18/2023  6:54: 3.00000068:Deleted GP object


ï¼ˆğŸ‘† ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¿”ã‚‰ãšãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã€‚"Ctrl + C"ã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«æˆ»ã‚‹ï¼‰
```
#### ãƒ‘ã‚¿ãƒ¼ãƒ³3ï¼šãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼†Grepæ¤œç´¢ã®è¡¨ç¤º
å®Ÿè¡Œå¾Œã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¿”ã‚‰ãšæ–‡å­—åˆ—ã§ãƒ•ã‚£ãƒ«ã‚¿ã—å¸¸æ™‚ç›£è¦–ã—ãŸçŠ¶æ…‹ã«ã€‚ï¼ˆUNIXã®â€œtail -f XXX | grep XXXâ€ã¨ã»ã¼åŒã˜å‹•ãï¼‰
```powershell:ã‚³ãƒ”ãƒ¼ç”¨
Get-Content .\StorGroupPolicy.log -Tail 20 -Wait | Select-String -Pattern ".*is not enabled.*"
```
```powershell:ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ŒGet-Content XXX -Tail XXX -Wait | Select-String -Pattern XXXã€
PS C:\Windows\Logs> Get-Content .\StorGroupPolicy.log -Tail 20 -Wait | Select-String -Pattern ".*is not enabled.*"

10/18/2023  6:52: 3.00000063:Policy for other GUID is not enabled, status:  2
10/18/2023  6:52: 3.00000063:Policy for other GUID is not enabled, status:  2
10/18/2023  6:52: 3.00000063:Policy for other GUID is not enabled, status:  2
10/18/2023  6:52: 3.00000063:Policy for other GUID is not enabled, status:  2
10/18/2023  6:52: 3.00000063:Policy for other GUID is not enabled, status:  2
10/18/2023  6:52: 3.00000063:Policy for other GUID is not enabled, status:  2

ï¼ˆğŸ‘† ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¿”ã‚‰ãšæ–‡å­—åˆ—ãƒ•ã‚£ãƒ«ã‚¿ + ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã€‚"Ctrl + C"ã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«æˆ»ã‚‹ï¼‰
```

## å‚è€ƒæƒ…å ±
- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®å‚ç…§
    https://www.gamingdeputy.com/jp/windows/powershell-ãƒªã‚¹ãƒˆ-ãƒ•ã‚¡ã‚¤ãƒ«ã®æ—¥ä»˜é †ã®ä¸¦ã¹æ›¿ãˆ/	  
- ãƒ†ã‚­ã‚¹ãƒˆã®ä¸­èº«ã‚’å‚ç…§
    https://tex2e.github.io/blog/powershell/Get-Content-TotalCount-Tail
- PowerShellã§ã‚‚â€œtail -fâ€ã‚„â€œgrepâ€ã™ã‚‹æ–¹æ³•
    https://qiita.com/yokra9/items/d95abda8a795d4e19e0e
- å…¬å¼ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã€ŒGet-Contentã€ã‚³ãƒãƒ³ãƒ‰
    https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.management/get-content

## ã¾ã¨ã‚
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®å‚ç…§ã§å¯¾å¿œã™ã‚‹æ–¹æ³•
    - å‰æ–¹ã‚ˆã‚Šã‚«ã‚¦ãƒ³ãƒˆã—æŒ‡å®šè¡Œæ•°åˆ†ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•
        `Get-ChildItem | Select-Object -First "æŒ‡å®šè¡Œæ•°"`
    - å¾Œæ–¹ã‚ˆã‚Šã‚«ã‚¦ãƒ³ãƒˆã—æŒ‡å®šè¡Œæ•°åˆ†ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•
        `Get-ChildItem | Select-Object -Last "æŒ‡å®šè¡Œæ•°"`
- ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§å¯¾å¿œã™ã‚‹æ–¹æ³•
    - å‰æ–¹ã‚ˆã‚Šã‚«ã‚¦ãƒ³ãƒˆã—æŒ‡å®šè¡Œæ•°åˆ†ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•
        `Get-Content "å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«" -TotalCount "æŒ‡å®šè¡Œæ•°"`
    - å¾Œæ–¹ã‚ˆã‚Šã‚«ã‚¦ãƒ³ãƒˆã—æŒ‡å®šè¡Œæ•°åˆ†ã‚’è¡¨ç¤ºã™ã‚‹æ–¹æ³•
        - ãƒ‘ã‚¿ãƒ¼ãƒ³1ï¼šä¸€å›ãã‚Šã®ç¢ºèªæ–¹æ³•
            `Get-Content "å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«" -Tail "æŒ‡å®šè¡Œæ•°"`
        - ãƒ‘ã‚¿ãƒ¼ãƒ³2ï¼šãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
            `Get-Content "å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«" -Tail "æŒ‡å®šè¡Œæ•°" -Wait`
        - ãƒ‘ã‚¿ãƒ¼ãƒ³3ï¼šãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼†Grepæ¤œç´¢ã®è¡¨ç¤º
            `Get-Content "å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«" -Tail "æŒ‡å®šè¡Œæ•°" -Wait | Select-String -Pattern "æŒ‡å®šæ–‡å­—åˆ—"`

## é–¢é€£è¨˜äº‹
https://haretokidoki-blog.com/pasocon_powershell-startup/
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960

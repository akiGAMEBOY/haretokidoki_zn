---
title: "[PowerShell]自動変数（予約語）のデータ型を調べてみた"
emoji: "🔍"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["powershell", "自動変数"]
published: false
---
## 概要
PowerShellの予約語のようなものである[自動変数](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_automatic_variables?view=powershell-7.2)を使用する際、
正しくデータ型を理解しておく必要があり、毎回PowerShellのスクリプトを作成する度にコマンドで調べていました。

いっその事、事前にすべての自動変数のデータ型を調べて一覧化してしまおうというのが趣旨となります。

## この記事のターゲット
- PowerShellユーザーの方
- 自動変数のデータ型を確認したい方

## 環境
```powershell:PowerShellのバージョン
PS C:\WINDOWS\system32> $PSVersionTable

Name                           Value
----                           -----
PSVersion                      5.1.19041.3031
PSEdition                      Desktop
PSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}
BuildVersion                   10.0.19041.3031
CLRVersion                     4.0.30319.42000
WSManStackVersion              3.0
PSRemotingProtocolVersion      2.3
SerializationVersion           1.1.0.1


PS C:\WINDOWS\system32>
```

## 調査方法
`自動変数名.GetType().FullName`によりデータ型を調べました。
実際に、`$PSVersionTable`のデータ型を調べた際のコマンドは、下記の通りです。
```powershell:$PSVersionTableのデータ型を確認
PS C:\WINDOWS\system32> $PSVersionTable.GetType().FullName
System.Collections.Hashtable
PS C:\WINDOWS\system32>
```
### 参考情報
https://learn.microsoft.com/ja-jp/dotnet/api/system.object.gettype?view=net-7.0
https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_properties?view=powershell-7.3

## 調査結果
コマンド結果で`null`によりエラーとなったものに対しては、「エラー（nullだった）」と表記。
初期値が`null`の自動変数は、値が入る条件（例えば、`$_`ではForEach内で値がセット）がある為、
PowerShellの起動直後では、`null`になっているものと思われます。

机上で理由がわかるものに関しては、その理由を注釈として記載。値が入る条件がわかった場合は、更新します。
```powershell:参考：「 $_ 」のデータ型を確認した際のエラー
PS C:\WINDOWS\system32> $_.GetType().FullName
null 値の式ではメソッドを呼び出せません。
発生場所 行:1 文字:1
+ $_.GetType().FullName
+ ~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) []、RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull

PS C:\WINDOWS\system32>
```

| 自動変数名 | データ型<br>［自動変数名.GetType().FullName］ |
| ---- | ---- |
| `$$` | System.String |
| `$?` | System.Boolean |
| `$^` | System.String |
| `$_（$PSItem）`<br>* パイプラインで渡ってくるオブジェクトにより変化 | `Get-Process | ForEach-Object -Process { Write-Host $_.GetType().FullName }`だと`System.Diagnostics.Process`<br>そのまま確認するとエラー（nullだった） |
| `$args` | System.Object[] |
| `$ConsoleFileName` | System.String |
| `$EnabledExperimentalFeatures`<br>* PowerShell Core 導入で使用可能 | System.Management.Automation.Internal.ReadOnlyBag`1[[System.String, System.Private.CoreLib, Version=7.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]<br>Windows標準のPowerShellだとエラー（nullだった） |
| `$Error` | System.Collections.ArrayList |
| `$ErrorActionPreference` | System.Management.Automation.ActionPreference |
| `$Event` | エラー（nullだった） |
| `$EventArgs` | エラー（nullだった） |
| `$EventSubscriber` | エラー（nullだった） |
| `$ExecutionContext` | System.Management.Automation.EngineIntrinsics |
| `$false` | System.Boolean |
| `$foreach` | エラー（nullだった） |
| `$HOME` | System.String |
| `$Host` | System.Management.Automation.Internal.Host.InternalHost |
| `$input` | System.Collections.ArrayList+ArrayListEnumeratorSimple |
| `$IsCoreCLR`<br>* PowerShell Core 導入で使用可能 | System.Boolean<br>Windows標準のPowerShellだとエラー（nullだった） |
| `$IsLinux`<br>* PowerShell Core 導入で使用可能 | System.Boolean<br>Windows標準のPowerShellだとエラー（nullだった） |
| `$IsMacOS`<br>* PowerShell Core 導入で使用可能 | System.Boolean<br>Windows標準のPowerShellだとエラー（nullだった） |
| `$IsWindows`<br>* PowerShell Core 導入で使用可能 | System.Boolean<br>Windows標準のPowerShellだとエラー（nullだった） |
| `$OutputEncoding` | System.Text.ASCIIEncoding |
| `$Matches` | エラー（nullだった） |
| `$MyInvocation` | System.Management.Automation.InvocationInfo |
| `$NestedPromptLevel` | System.Int32 |
| `$null` | エラー（nullのため） |
| `$PID` | System.Int32 |
| `$profile` | System.String |
| `$PSBoundParameters` | System.Management.Automation.PSBoundParametersDictionary |
| `$PSCmdlet` | エラー（nullだった） |
| `$PSCommandPath` | System.String |
| `$PSCulture` | System.String |
| `$PSDebugContext` | エラー（nullだった） |
| `$PSEdition` | System.String |
| `$PSHOME` | System.String |
| `$PSScriptRoot` | System.String |
| `$PSSenderInfo` | エラー（nullだった） |
| `$PSUICulture` | System.String |
| `$PSVersionTable` | System.Collections.Hashtable |
| `$PWD` | System.Management.Automation.PathInfo |
| `$Sender` | エラー（nullだった） |
| `$ShellId` | System.String |
| `$StackTrace` | System.String |
| `$switch` | エラー（nullだった） |
| `$this` | エラー（nullだった） |
| `$true` | System.Boolean |

## 参考情報
https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_automatic_variables?view=powershell-7.3
https://tex2e.github.io/blog/powershell/automatic-variables

## $Evnet $EventArgsについて確認中
```powershell:確認用
Add-Type -AssemblyName System.Windows.Forms
Add-Type -AssemblyName System.Drawing

[System.Windows.Forms.Form]$form = New-Object System.Windows.Forms.Form
$form.Text = "実行前の確認"
$form.Size = New-Object System.Drawing.Size(460,210)
$form.StartPosition = "CenterScreen"
$form.MaximizeBox = $false
$form.MinimizeBox = $false
# ラベル作成
[System.Windows.Forms.Label]$label = New-Object System.Windows.Forms.Label
$label.Location = New-Object System.Drawing.Point(85,30)
$label.Size = New-Object System.Drawing.Size(350,80)
$label.Text = "テストフォーム"
$font = New-Object System.Drawing.Font("ＭＳ ゴシック",12)
$label.Font = $font
# ラベルのダブルクリックイベント
$label.Add_DoubleClick({param($sender, $e)$Events.GetType()})
# OKボタンの作成
[System.Windows.Forms.Button]$btnOkay = New-Object System.Windows.Forms.Button
$btnOkay.Location = New-Object System.Drawing.Point(255,120)
$btnOkay.Size = New-Object System.Drawing.Size(75,30)
$btnOkay.Text = "OK"
$btnOkay.DialogResult = [System.Windows.Forms.DialogResult]::OK
# Cancelボタンの作成
[System.Windows.Forms.Button]$btnCancel = New-Object System.Windows.Forms.Button
$btnCancel.Location = New-Object System.Drawing.Point(345,120)
$btnCancel.Size = New-Object System.Drawing.Size(75,30)
$btnCancel.Text = "キャンセル"
$btnCancel.DialogResult = [System.Windows.Forms.DialogResult]::Cancel
# ボタンの紐づけ
$form.AcceptButton = $btnOkay
$form.CancelButton = $btnCancel
# フォームに紐づけ
$form.Controls.Add($pic)
$form.Controls.Add($label)
$form.Controls.Add($btnOkay)
$form.Controls.Add($btnCancel)
# フォーム表示
if ($form.ShowDialog() -eq [System.Windows.Forms.DialogResult]::OK)
{
    $return = $true
} else {
    $return = $false
}
```
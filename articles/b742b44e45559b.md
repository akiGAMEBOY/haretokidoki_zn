---
title: "[PowerShell]自動変数（予約語）のデータ型を調べてみた"
emoji: "🔍"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["powershell", "自動変数"]
published: true
---
## 概要
PowerShellの予約語のようなものである[自動変数](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_automatic_variables?view=powershell-7.2)を使用する際、
正しくデータ型を理解しておく必要がある。

PowerShellのスクリプトを作成し自動変数を使用する度にコマンドでデータ型を調べていました。
いっその事、事前にすべての自動変数のデータ型を調べて一覧化してしまおうというのが趣旨となります。

## この記事のターゲット
- PowerShellユーザーの方
- 自動変数のデータ型を確認したい方

## 環境
```powershell:PowerShellのバージョン
PS C:\WINDOWS\system32> $PSVersionTable

Name                           Value
----                           -----
PSVersion                      5.1.19041.3031
PSEdition                      Desktop
PSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}
BuildVersion                   10.0.19041.3031
CLRVersion                     4.0.30319.42000
WSManStackVersion              3.0
PSRemotingProtocolVersion      2.3
SerializationVersion           1.1.0.1


PS C:\WINDOWS\system32>
```

## 調査方法
`自動変数名.GetType().FullName`によりデータ型を調べました。
実際に、`$PSVersionTable`のデータ型を調べた際のコマンドは、下記の通りです。
```powershell:$PSVersionTableのデータ型を確認した時
PS C:\WINDOWS\system32> $PSVersionTable.GetType().FullName
System.Collections.Hashtable
PS C:\WINDOWS\system32>
```
### 参考情報
https://learn.microsoft.com/ja-jp/dotnet/api/system.object.gettype?view=net-7.0
https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_properties?view=powershell-7.3

## 調査結果
コマンド結果で`null`によりエラーとなったものに対しては、「エラー（nullだった）」と表記。
初期値が`null`の自動変数は、値が入る条件（例えば、`$_`ではForEach内で値がセット）がある為、
PowerShellの起動直後では、`null`になっているものと思われます。

現時点で理由がわかるものに関しては、その理由を注釈として記載しています。
随時、更新予定。
```powershell:参考：「 $_ 」のデータ型を確認した際のエラー
PS C:\WINDOWS\system32> $_.GetType().FullName
null 値の式ではメソッドを呼び出せません。
発生場所 行:1 文字:1
+ $_.GetType().FullName
+ ~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) []、RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull

PS C:\WINDOWS\system32>
```

| 自動変数名 | データ型 |
| ---- | ---- |
| `$$` | System.String |
| `$?` | System.Boolean |
| `$^` | System.String |
| `$_（$PSItem）`<br>* パイプラインで渡ってくるオブジェクトにより変化 | `Get-Process \| ForEach-Object -Process { Write-Host $_.GetType().FullName }` の場合だと `System.Diagnostics.Process`。 <br>* 初期起動時に確認するとエラー（nullだった） |
| `$args` | System.Object[] |
| `$ConsoleFileName` | System.String |
| `$EnabledExperimentalFeatures`<br>* PowerShell Core 導入で使用可能 | System.Management.Automation.Internal.ReadOnlyBag`1[[System.String, System.Private.CoreLib, Version=7.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]<br>* Windows標準のPowerShellだとエラー（nullだった） |
| `$Error` | System.Collections.ArrayList |
| `$ErrorActionPreference` | System.Management.Automation.ActionPreference |
| `$Event` | 実行環境により変化<br>* 参考:調査時のエビデンス - $Event と $Sender 、 $this のデータ型をチェックした時<br>* 初期起動時に確認するとエラー（nullだった） |
| `$EventArgs` | エラー（nullだった） |
| `$EventSubscriber` | エラー（nullだった） |
| `$ExecutionContext` | System.Management.Automation.EngineIntrinsics |
| `$false` | System.Boolean |
| `$foreach` | エラー（nullだった） |
| `$HOME` | System.String |
| `$Host` | System.Management.Automation.Internal.Host.InternalHost |
| `$input` | System.Collections.ArrayList+ArrayListEnumeratorSimple |
| `$IsCoreCLR`<br>* PowerShell Core 導入で使用可能 | System.Boolean<br>* Windows標準のPowerShellだとエラー（nullだった） |
| `$IsLinux`<br>* PowerShell Core 導入で使用可能 | System.Boolean<br>* Windows標準のPowerShellだとエラー（nullだった） |
| `$IsMacOS`<br>* PowerShell Core 導入で使用可能 | System.Boolean<br>* Windows標準のPowerShellだとエラー（nullだった） |
| `$IsWindows`<br>* PowerShell Core 導入で使用可能 | System.Boolean<br>* Windows標準のPowerShellだとエラー（nullだった） |
| `$OutputEncoding` | System.Text.ASCIIEncoding |
| `$Matches` | エラー（nullだった） |
| `$MyInvocation` | System.Management.Automation.InvocationInfo |
| `$NestedPromptLevel` | System.Int32 |
| `$null` | エラー（nullのため） |
| `$PID` | System.Int32 |
| `$profile` | System.String |
| `$PSBoundParameters` | System.Management.Automation.PSBoundParametersDictionary |
| `$PSCmdlet` | エラー（nullだった） |
| `$PSCommandPath` | System.String |
| `$PSCulture` | System.String |
| `$PSDebugContext` | エラー（nullだった） |
| `$PSEdition` | System.String |
| `$PSHOME` | System.String |
| `$PSScriptRoot` | System.String |
| `$PSSenderInfo` | エラー（nullだった） |
| `$PSUICulture` | System.String |
| `$PSVersionTable` | System.Collections.Hashtable |
| `$PWD` | System.Management.Automation.PathInfo |
| `$Sender` | 実行環境により変化<br>* 参考:調査時のエビデンス - $Event と $Sender 、 $this のデータ型をチェックした時<br>* 初期起動時に確認するとエラー（nullだった） |
| `$ShellId` | System.String |
| `$StackTrace` | System.String |
| `$switch` | エラー（nullだった） |
| `$this` | 実行環境により変化<br>* 参考:調査時のエビデンス - $Event と $Sender 、 $this のデータ型をチェックした時<br>* 初期起動時に確認するとエラー（nullだった） |
| `$true` | System.Boolean |

### 調査時のエビデンス
:::details $Event と $Sender 、 $this のデータ型をチェックした時
処理内容によって変化する。下記のサンプルコードでは、

- $Eventが
    [`System.Windows.Forms.MouseEventArgs`]
- $Senderが
    [`System.Windows.Forms.Button`]
- $thisが
    [`System.Windows.Forms.Button`]

```powershell:$this と $e のデータ型をチェックした時
[Void][Reflection.Assembly]::LoadWithPartialName("System.Windows.Forms")
$form   = New-Object Windows.Forms.Form
$button = New-Object Windows.Forms.Button
$button.Text = "テストのボタン"
$button.Dock = "Fill"
$button_click =
{
    ($Sender, $Event) = $this, $_
    
    Write-Host ' ----- '
    Write-Host 'Event : '$Event.GetType().FullName
    Write-Host 'Sender: '$Sender.GetType().FullName
    Write-Host 'this  : '$this.GetType().FullName
    Write-Host ' ----- '
}
$button.add_Click($button_click)
$form.Controls.Add($button)
$form.ShowDialog()
```
- 参考記事
    https://newpops.hatenadiary.org/entry/20070120/p1
:::

## 参考情報
https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_automatic_variables?view=powershell-7.3
https://tex2e.github.io/blog/powershell/automatic-variables

## 関連記事
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960
https://haretokidoki-blog.com/pasocon_powershell-startup/

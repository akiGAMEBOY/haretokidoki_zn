---
title: "[PowerShell]è‡ªå‹•å¤‰æ•°ï¼ˆäºˆç´„èªï¼‰ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’èª¿ã¹ã¦ã¿ãŸ"
emoji: "ğŸ”"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell", "è‡ªå‹•å¤‰æ•°"]
published: true
---
## æ¦‚è¦
PowerShellã®äºˆç´„èªã®ã‚ˆã†ãªã‚‚ã®ã§ã‚ã‚‹[è‡ªå‹•å¤‰æ•°](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_automatic_variables?view=powershell-7.2)ã‚’ä½¿ç”¨ã™ã‚‹éš›ã€
æ­£ã—ããƒ‡ãƒ¼ã‚¿å‹ã‚’ç†è§£ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ç§ã¯ã€PowerShellã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—è‡ªå‹•å¤‰æ•°ã‚’ä½¿ç”¨ã™ã‚‹åº¦ã«ã‚³ãƒãƒ³ãƒ‰ã§ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã—ãŸã€‚
ã„ã£ãã®äº‹ã€äº‹å‰ã«ã™ã¹ã¦ã®è‡ªå‹•å¤‰æ•°ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’èª¿ã¹ã¦ä¸€è¦§åŒ–ã—ã¦ã—ã¾ãŠã†ã¨ã„ã†ã®ãŒã€ã“ã®è¨˜äº‹ã®è¶£æ—¨ã¨ãªã‚Šã¾ã™ã€‚

## ã“ã®è¨˜äº‹ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
- PowerShellãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–¹
- è‡ªå‹•å¤‰æ•°ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ç¢ºèªã—ãŸã„æ–¹

## ç’°å¢ƒ
```powershell:PowerShellã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³
PS C:\WINDOWS\system32> $PSVersionTable

Name                           Value
----                           -----
PSVersion                      5.1.19041.3031
PSEdition                      Desktop
PSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}
BuildVersion                   10.0.19041.3031
CLRVersion                     4.0.30319.42000
WSManStackVersion              3.0
PSRemotingProtocolVersion      2.3
SerializationVersion           1.1.0.1


PS C:\WINDOWS\system32>
```
ãªãŠã€ä¸€éƒ¨ã®è‡ªå‹•å¤‰æ•°ã¯PowerShell Coreã‚’å°å…¥ã—ãƒã‚§ãƒƒã‚¯ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸç‚ºã€
ZIPç‰ˆã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦æ¤œè¨¼ã—ã¾ã—ãŸã€‚
å¿µã®ãŸã‚ã€PowerShell Coreã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨˜è¼‰ã—ã¦ãŠãã¾ã™ã€‚
```powershell:PowerShell Coreã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³
PS D:\Downloads\PowerShell-7.3.6-win-x64> $PSVersionTable

Name                           Value
----                           -----
PSVersion                      7.3.6
PSEdition                      Core
GitCommitId                    7.3.6
OS                             Microsoft Windows 10.0.19045
Platform                       Win32NT
PSCompatibleVersions           {1.0, 2.0, 3.0, 4.0â€¦}
PSRemotingProtocolVersion      2.3
SerializationVersion           1.1.0.1
WSManStackVersion              3.0

PS D:\Downloads\PowerShell-7.3.6-win-x64>
```

## èª¿æŸ»æ–¹æ³•
`è‡ªå‹•å¤‰æ•°å.GetType().FullName`ã«ã‚ˆã‚Šãƒ‡ãƒ¼ã‚¿å‹ã‚’èª¿ã¹ã¾ã—ãŸã€‚
å®Ÿéš›ã«ã€`$PSVersionTable`ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’èª¿ã¹ãŸéš›ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚
```powershell:$PSVersionTableã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ç¢ºèªã—ãŸæ™‚
PS C:\WINDOWS\system32> $PSVersionTable.GetType().FullName
System.Collections.Hashtable
PS C:\WINDOWS\system32>
```
:::details çŸ¥ã£ã¦ãŠãã¨ä¾¿åˆ©ãªæƒ…å ±ï¼šã€ŒGet-Memberã€ã‚³ãƒãƒ³ãƒ‰ã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’èª¿ã¹ã‚‹
ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã‚³ãƒãƒ³ãƒ‰ã‚’æ¸¡ã—ã¦`Get-Member`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€
ä½¿ç”¨ã§ãã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ä¸€è¦§ãŒè¡¨ç¤ºã§ãã‚‹ã€‚
```powershell:$PSVersionTableã§Get-Memberã‚’å®Ÿè¡Œã—ãŸå ´åˆ
PS C:\WINDOWS\system32> $PSVersionTable | Get-Member


   TypeName: System.Collections.Hashtable

Name              MemberType            Definition
----              ----------            ----------
Add               Method                void Add(System.Object key, System.Object value), void IDictionary.Add(Syste...
Clear             Method                void Clear(), void IDictionary.Clear()
Clone             Method                System.Object Clone(), System.Object ICloneable.Clone()
Contains          Method                bool Contains(System.Object key), bool IDictionary.Contains(System.Object key)
ContainsKey       Method                bool ContainsKey(System.Object key)
ContainsValue     Method                bool ContainsValue(System.Object value)
CopyTo            Method                void CopyTo(array array, int arrayIndex), void ICollection.CopyTo(array arra...
Equals            Method                bool Equals(System.Object obj)
GetEnumerator     Method                System.Collections.IDictionaryEnumerator GetEnumerator(), System.Collections...
GetHashCode       Method                int GetHashCode()
GetObjectData     Method                void GetObjectData(System.Runtime.Serialization.SerializationInfo info, Syst...
GetType           Method                type GetType()
OnDeserialization Method                void OnDeserialization(System.Object sender), void IDeserializationCallback....
Remove            Method                void Remove(System.Object key), void IDictionary.Remove(System.Object key)
ToString          Method                string ToString()
Item              ParameterizedProperty System.Object Item(System.Object key) {get;set;}
Count             Property              int Count {get;}
IsFixedSize       Property              bool IsFixedSize {get;}
IsReadOnly        Property              bool IsReadOnly {get;}
IsSynchronized    Property              bool IsSynchronized {get;}
Keys              Property              System.Collections.ICollection Keys {get;}
SyncRoot          Property              System.Object SyncRoot {get;}
Values            Property              System.Collections.ICollection Values {get;}


PS C:\WINDOWS\system32>
```
- å‚è€ƒæƒ…å ±
    [Microsoftãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ - GetMember](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.utility/get-member?view=powershell-7.3https://cheshire-wara.com/powershell/ps-cmdlets/object/get-member/)
    [GetHashCode()ã®ä½¿ç”¨ã¯é¿ã‘ãŸæ–¹ãŒè‰¯ã„](https://qiita.com/Toraja/items/912d9e7e1e89c4379889)
:::

### å‚è€ƒæƒ…å ±
https://learn.microsoft.com/ja-jp/dotnet/api/system.object.gettype?view=net-7.0
https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_properties?view=powershell-7.3

## èª¿æŸ»çµæœ
ã‚³ãƒãƒ³ãƒ‰çµæœã§`null`ã«ã‚ˆã‚Šã‚¨ãƒ©ãƒ¼ã¨ãªã£ãŸã‚‚ã®ã«å¯¾ã—ã¦ã¯ã€ã€Œã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ã€ã¨è¡¨è¨˜ã€‚
åˆæœŸå€¤ãŒ`null`ã®è‡ªå‹•å¤‰æ•°ã¯ã€å€¤ãŒå…¥ã‚‹æ¡ä»¶ï¼ˆä¾‹ãˆã°ã€`$_`ã§ã¯ForEachå†…ã§å€¤ãŒã‚»ãƒƒãƒˆï¼‰ãŒã‚ã‚‹ç‚ºã€
PowerShellã®èµ·å‹•ç›´å¾Œã§ã¯ã€`null`ã«ãªã£ã¦ã„ã‚‹ã‚‚ã®ã¨æ€ã‚ã‚Œã¾ã™ã€‚

ç¾æ™‚ç‚¹ã§ç†ç”±ãŒã‚ã‹ã‚‹ã‚‚ã®ã«é–¢ã—ã¦ã¯ã€ãã®ç†ç”±ã‚’æ³¨é‡ˆã¨ã—ã¦è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚
éšæ™‚ã€æ›´æ–°äºˆå®šã€‚
```powershell:å‚è€ƒï¼šã€Œ $_ ã€ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ç¢ºèªã—ãŸéš›ã®ã‚¨ãƒ©ãƒ¼
PS C:\WINDOWS\system32> $_.GetType().FullName
null å€¤ã®å¼ã§ã¯ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã›ã¾ã›ã‚“ã€‚
ç™ºç”Ÿå ´æ‰€ è¡Œ:1 æ–‡å­—:1
+ $_.GetType().FullName
+ ~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (:) []ã€RuntimeException
    + FullyQualifiedErrorId : InvokeMethodOnNull

PS C:\WINDOWS\system32>
```

| è‡ªå‹•å¤‰æ•°å | ãƒ‡ãƒ¼ã‚¿å‹ |
| ---- | ---- |
| `$$` | System.String |
| `$?` | System.Boolean |
| `$^` | System.String |
| `$_ï¼ˆ$PSItemï¼‰`<br>* ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§æ¸¡ã£ã¦ãã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã‚Šå¤‰åŒ– | `Get-Process \| ForEach-Object -Process { Write-Host $_.GetType().FullName }` ã®å ´åˆã ã¨ `System.Diagnostics.Process`ã€‚ <br>* åˆæœŸèµ·å‹•æ™‚ã«ç¢ºèªã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ |
| `$args` | System.Object[] |
| `$ConsoleFileName` | System.String |
| `$EnabledExperimentalFeatures`<br>* PowerShell Core å°å…¥ã§ä½¿ç”¨å¯èƒ½ | System.Management.Automation.Internal.ReadOnlyBag`1[[System.String, System.Private.CoreLib, Version=7.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]<br>* Windowsæ¨™æº–ã®PowerShellã ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ |
| `$Error` | System.Collections.ArrayList |
| `$ErrorActionPreference` | System.Management.Automation.ActionPreference |
| `$Event` | å®Ÿè¡Œç’°å¢ƒã«ã‚ˆã‚Šå¤‰åŒ–<br>* å‚è€ƒ:èª¿æŸ»æ™‚ã®ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹<br>* åˆæœŸèµ·å‹•æ™‚ã«ç¢ºèªã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ |
| `$EventArgs` | å®Ÿè¡Œç’°å¢ƒã«ã‚ˆã‚Šå¤‰åŒ–<br>* å‚è€ƒ:èª¿æŸ»æ™‚ã®ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹<br>* åˆæœŸèµ·å‹•æ™‚ã«ç¢ºèªã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ |
| `$EventSubscriber` | å®Ÿè¡Œç’°å¢ƒã«ã‚ˆã‚Šå¤‰åŒ–<br>* å‚è€ƒ:èª¿æŸ»æ™‚ã®ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹<br>* åˆæœŸèµ·å‹•æ™‚ã«ç¢ºèªã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ |
| `$ExecutionContext` | System.Management.Automation.EngineIntrinsics |
| `$false` | System.Boolean |
| `$foreach` | System.Array+SZArrayEnumerator<br>* å‚è€ƒ:èª¿æŸ»æ™‚ã®ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹<br>* åˆæœŸèµ·å‹•æ™‚ã«ç¢ºèªã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ |
| `$HOME` | System.String |
| `$Host` | System.Management.Automation.Internal.Host.InternalHost |
| `$input` | System.Collections.ArrayList+ArrayListEnumeratorSimple |
| `$IsCoreCLR`<br>* PowerShell Core å°å…¥ã§ä½¿ç”¨å¯èƒ½ | System.Boolean<br>* Windowsæ¨™æº–ã®PowerShellã ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ |
| `$IsLinux`<br>* PowerShell Core å°å…¥ã§ä½¿ç”¨å¯èƒ½ | System.Boolean<br>* Windowsæ¨™æº–ã®PowerShellã ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ |
| `$IsMacOS`<br>* PowerShell Core å°å…¥ã§ä½¿ç”¨å¯èƒ½ | System.Boolean<br>* Windowsæ¨™æº–ã®PowerShellã ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ |
| `$IsWindows`<br>* PowerShell Core å°å…¥ã§ä½¿ç”¨å¯èƒ½ | System.Boolean<br>* Windowsæ¨™æº–ã®PowerShellã ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ |
| `$OutputEncoding` | System.Text.ASCIIEncoding |
| `$Matches` | System.Collections.Hashtable<br>* å‚è€ƒ:èª¿æŸ»æ™‚ã®ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹<br>* åˆæœŸèµ·å‹•æ™‚ã«ç¢ºèªã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ |
| `$MyInvocation` | System.Management.Automation.InvocationInfo |
| `$NestedPromptLevel` | System.Int32 |
| `$null` | ã‚¨ãƒ©ãƒ¼ï¼ˆnullã®ãŸã‚ï¼‰ |
| `$PID` | System.Int32 |
| `$profile` | System.String |
| `$PSBoundParameters` | System.Management.Automation.PSBoundParametersDictionary |
| `$PSCmdlet` | System.Management.Automation.PSScriptCmdlet<br>* å‚è€ƒ:èª¿æŸ»æ™‚ã®ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹<br>* åˆæœŸèµ·å‹•æ™‚ã«ç¢ºèªã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ |
| `$PSCommandPath` | System.String |
| `$PSCulture` | System.String |
| `$PSDebugContext` | System.Management.Automation.PSDebugContext<br>* å‚è€ƒ:èª¿æŸ»æ™‚ã®ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹<br>* åˆæœŸèµ·å‹•æ™‚ã«ç¢ºèªã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ |
| `$PSEdition` | System.String |
| `$PSHOME` | System.String |
| `$PSScriptRoot` | System.String |
| `$PSSenderInfo` | System.Management.Automation.Remoting.PSSenderInfo<br>* å‚è€ƒ:èª¿æŸ»æ™‚ã®ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹<br>* åˆæœŸèµ·å‹•æ™‚ã«ç¢ºèªã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ |
| `$PSUICulture` | System.String |
| `$PSVersionTable` | System.Collections.Hashtable |
| `$PWD` | System.Management.Automation.PathInfo |
| `$Sender` | å®Ÿè¡Œç’°å¢ƒã«ã‚ˆã‚Šå¤‰åŒ–<br>* å‚è€ƒ:èª¿æŸ»æ™‚ã®ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹<br>* åˆæœŸèµ·å‹•æ™‚ã«ç¢ºèªã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ |
| `$ShellId` | System.String |
| `$StackTrace` | System.String |
| `$switch` | System.Array+SZArrayEnumerator<br>* å‚è€ƒ:èª¿æŸ»æ™‚ã®ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹<br>* åˆæœŸèµ·å‹•æ™‚ã«ç¢ºèªã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ |
| `$this` | å®Ÿè¡Œç’°å¢ƒã«ã‚ˆã‚Šå¤‰åŒ–<br>* å‚è€ƒ:èª¿æŸ»æ™‚ã®ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹<br>* åˆæœŸèµ·å‹•æ™‚ã«ç¢ºèªã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ï¼ˆnullã ã£ãŸï¼‰ |
| `$true` | System.Boolean |

### èª¿æŸ»æ™‚ã®ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹
:::details $Event ã¨ $Sender ã€ $this ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸæ™‚
å‡¦ç†å†…å®¹ã«ã‚ˆã£ã¦å¤‰åŒ–ã™ã‚‹ã€‚ä¸‹è¨˜ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã¯ã€

- $EventãŒ
    [`System.Windows.Forms.MouseEventArgs`]
- $SenderãŒ
    [`System.Windows.Forms.Button`]
- $thisãŒ
    [`System.Windows.Forms.Button`]

```powershell:$Event ã¨ $Sender ã¨ $this ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‚³ãƒ¼ãƒ‰
[Void][Reflection.Assembly]::LoadWithPartialName("System.Windows.Forms")
$form   = New-Object Windows.Forms.Form
$button = New-Object Windows.Forms.Button
$button.Text = "ãƒ†ã‚¹ãƒˆã®ãƒœã‚¿ãƒ³"
$button.Dock = "Fill"
$button_click =
{
    ($Sender, $Event) = $this, $_
    
    Write-Host ' ----- '
    Write-Host 'Event : '$Event.GetType().FullName
    Write-Host 'Sender: '$Sender.GetType().FullName
    Write-Host 'this  : '$this.GetType().FullName
    Write-Host ' ----- '
}
$button.add_Click($button_click)
$form.Controls.Add($button)
$form.ShowDialog()
```
ä¸Šè¨˜ã¯å®Ÿè¡Œå¾Œã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ãƒ‡ãƒ¼ã‚¿å‹ã‚’ç¢ºèªå¯èƒ½ã€‚

- å‚è€ƒè¨˜äº‹
    https://newpops.hatenadiary.org/entry/20070120/p1
:::

:::details $EventArgs ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸæ™‚
å‡¦ç†å†…å®¹ã«ã‚ˆã£ã¦å¤‰åŒ–ã™ã‚‹ã€‚ä¸‹è¨˜ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã¯ã€

- $EventArgsãŒ
    [`System.IO.FileSystemEventArgs`]

```powershell:$EventArgs ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã‚³ãƒ¼ãƒ‰
$watcher = New-Object System.IO.FileSystemWatcher
$watcher.Path = "C:\"
$watcher.IncludeSubdirectories = $true
$watcher.EnableRaisingEvents = $true
$watcher.Site
$arrary = @()

$watcher.Filter = ""

Register-ObjectEvent $watcher "Created" -Action {
    Write-Host $EventArgs.GetType().FullName
    exit
}
```
ä¸Šè¨˜ã‚’å®Ÿè¡Œã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿å‹ãŒãƒã‚§ãƒƒã‚¯ã§ãã‚‹ã€‚
- å‚è€ƒè¨˜äº‹
    https://stackoverflow.com/questions/38274746/powershell-get-members-of-eventargs-automatic-variable
:::

:::details $Event ã¨ $EventSubscriber ã€ $Sender ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸæ™‚
å‡¦ç†å†…å®¹ã«ã‚ˆã£ã¦å¤‰åŒ–ã™ã‚‹ã€‚ä¸‹è¨˜ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã¯ã€

- $EventãŒ
    [`System.Management.Automation.PSEventArgs`]
- $EventSubscriberãŒ
    [`System.Management.Automation.PSEventSubscriber`]
- $SenderãŒ
    [`System.IO.FileSystemWatcher`]

```powershell:ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ã®ã‚³ãƒ¼ãƒ‰
$wait= New-Object System.IO.FileSystemWatcher

$wait.NotifyFilter= [IO.NotifyFilters]::LastWrite
$wait.Path= "D:\Downloads"
$wait.Filter= "*.txtâ€

#ãƒãƒƒã‚¯ã‚°ãƒ©ãƒ³ãƒ‰ã§ç¨¼åƒ

Register-ObjectEvent -InputObject $wait -SourceIdentifier "mml_wchâ€ -EventName "Changedâ€ -Action{

    if($i -eq $null){ # åˆæœŸåŒ–

        [int]$i= 0
    }

    $t= $Event.TimeGenerated # è¦‹ã‚„ã™ãã™ã‚‹ãŸã‚
    $f= $Event.SourceEventArgs

    [string]$lated_time= $t.ToString(â€˜yy/MM/dd HH:mm:ss.fâ€™)

    if($lated_time -ne $chk_time){ # å‡ºåŠ›

        Write-Host ("`r`nâ€+ â€˜no. â€˜+ $i)
        $i++

        write-host ("change type: "+ $f.ChangeType)
        write-host ("full path: "+ $f.FullPath)
        write-host ("name: "+ $f.Name)
        write-host ("time: "+ $lated_time)
        
        write-host ("-----")
        write-host (â€˜$Event                 : â€˜+ $Event.GetType().FullName)
        write-host (â€˜$EventSubscriber       : â€˜+ $EventSubscriber.GetType().FullName)
        write-host (â€˜$Sender                : â€˜+ $Sender.GetType().FullName)
        # write-host (â€˜$SourceEventArgs       : â€˜+ $SourceEventArgs.GetType().FullName)
        # write-host (â€˜$SourceArgs            : â€˜+ $SourceArgs.GetType().FullName)
        write-host (â€˜$Event.SourceArgs      : â€˜+ $Event.SourceArgs.GetType().FullName)
        write-host (â€˜$Event.SourceEventArgs : â€˜+ $Event.SourceEventArgs.GetType().FullName)
        write-host ("-----")

        [string]$chk_time= $lated_time
    }
}
```
ä¸Šè¨˜ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ŒD:Â¥Downloadsé…ä¸‹ã€ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›£è¦–ã™ã‚‹å¸¸é§ãƒ—ãƒ­ã‚»ã‚¹ãŒèµ·å‹•ã™ã‚‹ã€‚
```powershell:å¸¸é§ãƒ—ãƒ­ã‚»ã‚¹èµ·å‹•ä¸­ã«ã€ŒD:Â¥Downloadsé…ä¸‹ã€ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ãŸéš›ã®çµæœ
PS C:\WINDOWS\system32>
no. 0
change type: Changed
full path: D:\Downloads\20230823_memo.txt
name: 20230823_memo.txt
time: 23/08/23 15:48:13.2
-----
$Event                 : System.Management.Automation.PSEventArgs
$EventSubscriber       : System.Management.Automation.PSEventSubscriber
$Sender                : System.IO.FileSystemWatcher
$Event.SourceArgs      : System.Object[]
$Event.SourceEventArgs : System.IO.FileSystemEventArgs
-----

PS C:\WINDOWS\system32>
```

```powershell:èµ·å‹•ä¸­ã®å¸¸é§ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢ã™ã‚‹æ–¹æ³•
# ç›£è¦–çµ‚äº†
Unregister-Event -SourceIdentifier "mml_wch"
```
- å‚è€ƒè¨˜äº‹
    https://eseakisakura.wordpress.com/2017/10/29/register-objectevent/
:::

:::details $foreach ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸæ™‚

- $foreachãŒ
    [`System.Array+SZArrayEnumerator`]

```powershell:$foreach ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã‚³ãƒ¼ãƒ‰
foreach($item in $array) {
	write-host "foreach: $($foreach.GetType().FullName)"
	write-host "item   : $($item.GetType().FullName)"
	break
}
```
```powershell:å®Ÿéš›ã«å®Ÿè¡Œã—ãŸçµæœ
PS C:\WINDOWS\system32> foreach($item in $array) {
>>     write-host "foreach: $($foreach.GetType().FullName)"
>>     write-host "item   : $($item.GetType().FullName)"
>>     break
>> }
foreach: System.Array+SZArrayEnumerator
item   : System.Int32
PS C:\WINDOWS\system32>
```
- å‚è€ƒæƒ…å ±
    https://microsoftou.com/ps-foreach/#toc2
:::

:::details $Matches ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸæ™‚

- $MatchesãŒ
    [`System.Collections.Hashtable`]

```powershell:$Matches ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã‚³ãƒãƒ³ãƒ‰çµæœ
# ãƒãƒƒãƒã—ãŸå ´åˆ
PS C:\WINDOWS\system32> "abc" -match "abc"
True
PS C:\WINDOWS\system32>
PS C:\WINDOWS\system32> $Matches

Name                           Value
----                           -----
0                              abc


PS C:\WINDOWS\system32>
PS C:\WINDOWS\system32> $Matches.Gettype().Fullname
System.Collections.Hashtable
PS C:\WINDOWS\system32>
# ãƒãƒƒãƒã—ãªã„å ´åˆ
PS C:\WINDOWS\system32> "abc" -match "123"
False
PS C:\WINDOWS\system32>
PS C:\WINDOWS\system32> $Matches

Name                           Value
----                           -----
0                              abc


PS C:\WINDOWS\system32>
PS C:\WINDOWS\system32> $Matches.Gettype().Fullname
System.Collections.Hashtable
PS C:\WINDOWS\system32>
```
- å‚è€ƒæƒ…å ±
    https://www.fenet.jp/infla/column/technology/powershellã§ã®matchesã®ä½¿ã„æ–¹ã‚’ç´¹ä»‹ï¼matchesã‚’æ­£ã—ãä½¿ã„ã“ãªã/
:::

:::details $PSCmdlet ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸæ™‚

- $PSCmdletãŒ
    [`System.Management.Automation.PSScriptCmdlet`]

```powershell:$PSCmdlet ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã‚³ãƒ¼ãƒ‰
function typeof-psCmdlet {
  [cmdletBinding()] param()

   echo "type of `$psCmdlet is $($psCmdlet.GetType().FullName)"
}

```
```powershell:å®Ÿéš›ã«å®Ÿè¡Œã—ãŸçµæœ
PS C:\WINDOWS\system32> function typeof-psCmdlet {
>>   [cmdletBinding()] param()
>>
>>    echo "type of `$psCmdlet is $($psCmdlet.GetType().FullName)"
>> }
>>
>> typeof-psCmdlet
type of $psCmdlet is System.Management.Automation.PSScriptCmdlet
PS C:\WINDOWS\system32>
```
- å‚è€ƒæƒ…å ±
    https://renenyffenegger.ch/notes/Windows/PowerShell/language/variable/automatic/PsCmdLet
:::

:::details $PSDebugContext ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸæ™‚

- $PSDebugContextãŒ
    []`System.Management.Automation.PSDebugContext`]

```powershell:VS Codeã‚’ä½¿ã„ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã§åœã‚ãŸçŠ¶æ…‹ã§ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸæ™‚
$PSDebugContext.GetType().FullName              # â† ã“ã®è¡Œã‚’ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã«è¨­å®šã—ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œ
Write-Host $PSDebugContext.GetType().FullName   # â† ãƒ‡ãƒãƒƒã‚°ä¸­ã«ä¸Šè¨˜ã®è¡Œã§åœæ­¢ä¸­ã«ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ç¢ºèª
                                                # ã€€ * ãƒ–ãƒ¬ãƒ¼ã‚¯å¾Œã«ç¶šè¡Œã™ã‚‹ã¨nullã‚¨ãƒ©ãƒ¼ï¼ˆnull å€¤ã®å¼ã§ã¯ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã›ã¾ã›ã‚“ã€‚ï¼‰ã¨ãªã‚‹
```

èª¿æŸ»æ™‚ã«å½“åˆã¯ä¸‹è¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ãƒ‡ãƒãƒƒã‚°ã—ã¦ã„ãªã„é€šå¸¸èµ·å‹•ã®æ™‚ã¯ã€"Is Null"ã€‚
ãƒ‡ãƒãƒƒã‚°ä¸­ã®æ™‚ã¯ã€"Is not Null" + `$PSDebugContext`ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’è¡¨ç¤ºã€‚ã¨ã„ã†æƒ³å®šã§ã„ãŸãŒã€
æœŸå¾…é€šã‚Šã«å‹•ä½œã—ãªãã€ã©ã¡ã‚‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚‚Trueç³»ã¨ãªã£ãŸã€‚
åŸå› ã¯ä¸æ˜ã ãŒã€ãŠãã‚‰ã`$PSDebugContext`ãŒãƒ‡ãƒãƒƒã‚°ã®ãƒ–ãƒ¬ãƒ¼ã‚¯ä¸­ã§ãªã„ã¨ã€ãƒ‡ãƒ¼ã‚¿ãŒå‚ç…§ã§ããªã„ã®ã ã¨æ€ã‚ã‚Œã‚‹ã€‚
```powershell:æ¤œè¨¼ã«å¤±æ•—ã—ãŸã‚³ãƒ¼ãƒ‰
if ($null -eq $PSDebugContext) {
    Write-Host "Is Null"
} else {
    Write-Host "Is not Null"
    Write-Host $PSDebugContext.GetType().FullName
}
```
:::

:::details $PSSenderInfo ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸæ™‚

- $PSSenderInfoãŒ
[`System.Management.Automation.Remoting.PSSenderInfo`]

```powershell:$PSSenderInfo ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã‚³ãƒãƒ³ãƒ‰çµæœ
PS C:\WINDOWS\system32> Enter-PSSession -ComputerName 192.168.XXX.XXX -Credential "UserName"
[192.168.XXX.XXX]: PS D:\ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ>
[192.168.XXX.XXX]: PS D:\ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ> $PSSenderInfo


UserInfo             : System.Management.Automation.Remoting.PSPrincipal
ClientTimeZone       : System.CurrentSystemTimeZone
ConnectionString     : http://192.168.XXX.XXX:5985/wsman?PSVersion=5.1.19041.3031
ApplicationArguments : {PSVersionTable}
ConfigurationName    : Microsoft.PowerShell
ConnectedUser        : ComputerName\UserName
RunAsUser            : ComputerName\UserName



[192.168.XXX.XXX]: PS D:\ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ>
[192.168.XXX.XXX]: PS D:\ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ> $PSSenderInfo.GetType().FullName
System.Management.Automation.Remoting.PSSenderInfo
[192.168.XXX.XXX]: PS D:\ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ>
[192.168.XXX.XXX]: PS D:\ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ> exit
PS C:\WINDOWS\system32>
```
:::

:::details $switch ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸæ™‚

- $foreachãŒ
    [`System.Array+SZArrayEnumerator`]

```powershell:$PSCmdlet ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã‚³ãƒ¼ãƒ‰
switch (2) {
    1 {"One."}
    2 {$switch.GetType().FullName}
    3 {"Three."}
    default {"Not matched."}
}
```
```powershell:å®Ÿéš›ã«å®Ÿè¡Œã—ãŸçµæœ
PS C:\WINDOWS\system32> switch (2) {
>>     1 {"One."}
>>     2 {$switch.GetType().FullName}
>>     3 {"Three."}
>>     default {"Not matched."}
>> }
System.Array+SZArrayEnumerator
PS C:\WINDOWS\system32>
```
- å‚è€ƒæƒ…å ±
    https://qiita.com/nimzo6689/items/26373ed44119c303e539
:::

## å‚è€ƒæƒ…å ±
https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_automatic_variables?view=powershell-7.3
https://tex2e.github.io/blog/powershell/automatic-variables

## é–¢é€£è¨˜äº‹
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960
https://haretokidoki-blog.com/pasocon_powershell-startup/

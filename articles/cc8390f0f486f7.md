---
title: "実行中のPowerShellスクリプトが格納されているディレクトリーを取得する2つの方法"
emoji: "📑"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---
## 概要

これまで下記のコードで実行中のPowerShellスクリプトが格納されている場所を取得していましたが、
より簡潔な方法で取得できました。

```powershell:$MyInvocation.ScriptName
$currentDirectoryUsingMyInvocation = (Split-Path ( & { $MyInvocation.ScriptName } ) -Parent)
```

2つの方法を紹介。

## カレントディレクトリーを取得するシチュエーション

バッチファイル経由で実行する際、バッチファイルの格納場所とPowerShellスクリプトの格納場所が異なる場合、
`.\`から始まる相対パスを使うと指定方法が面倒になります。

たとえば下記のような構成だった場合、

```:ディレクトリー（フォルダー）構成
D:\ルートディレクトリ
│
├ExecuteMain.bat
│
└source
　└powershell
　　└Main.ps1
```

ExecuteMain.batでMain.ps1を実行すると、

Main.ps1内で相対パス、たとえば `.\` を使うと「D:\ルートディレクトリ\source\powershell」とはならない。
実際にはバッチファイルの場所が実行場所となる為、Main.ps1内の`.\`は「`D:\ルートディレクトリ`」となる。

## 対応方法

### 自動変数「$MyInvocation」を使ったカレントディレクトリーの取得方法

```powershell:$MyInvocation.MyCommand.Path
$currentDirectoryUsingMyInvocation01 = (Split-Path -Path $MyInvocation.MyCommand.Path -Parent)
```

```powershell:$MyInvocation.ScriptName
$currentDirectoryUsingMyInvocation02 = (Split-Path ( & { $MyInvocation.ScriptName } ) -Parent)
```

```powershell:$myInvocation.ScriptNameを使用
[System.String]$current_dir=Split-Path ( & { $MyInvocation.ScriptName } ) -parent
Set-Location "$($current_dir)\..\.."
[System.String]$root_dir = (Convert-Path .)
```

### 自動変数「$PSScriptRoot」を使ったカレントディレクトリーの取得方法

```powershell:$PSScriptRoot
$currentDirectoryUsingPSScriptRoot = $PSScriptRoot
```

```powershell:$PSScriptRootを使用
# 現在のスクリプトが存在するディレクトリを取得
[System.String]$current_dir = $PSScriptRoot

# ルートディレクトリに移動
Set-Location "$($current_dir)\..\.."

# ルートディレクトリのパスを取得
[System.String]$root_dir = (Convert-Path .)
```

### コマンドレット「Get-Location」を使ったカレントディレクトリーの取得方法

```
$currentDirectoryUsingGetLocation = Get-Location
```

## 使用用途


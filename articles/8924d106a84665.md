---
title: "PowerShellの出力コマンドレット「Write-*」の一覧と使用用途"
emoji: "😊"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["powershell"]
published: false
---
## 概要

主に出力系で使用しているコマンドレットは、`Write-Host` と `Write-Output` です。

それぞれの違いを雰囲気でしか把握していなかったこと。
また、`Write-`ではじまる他のコマンドレットもあり使用用途をおさえたかったこと。

以上、2点を目的に調べてみました。

## この記事のターゲット

- PowerShellユーザーの方
- よく使用するWrite-Host と Write-Output の違いを理解したい方
- （Writeではじまる）他の出力系コマンドレットの違いも理解したい方

## 環境

```powershell:PowerShellのバージョン
PS C:\Users\"ユーザー名">
PS C:\Users\"ユーザー名"> $PSVersionTable

Name                           Value
----                           -----
PSVersion                      7.4.1
PSEdition                      Core
GitCommitId                    7.4.1
OS                             Microsoft Windows 10.0.19045
Platform                       Win32NT
PSCompatibleVersions           {1.0, 2.0, 3.0, 4.0…}
PSRemotingProtocolVersion      2.3
SerializationVersion           1.1.0.1
WSManStackVersion              3.0

PS C:\Users\"ユーザー名">
```

## PowerShellにおける出力系のコマンドレット13種類

`Get-Command Write-*`でWriteではじまるコマンドの一覧を取得。

```powershell:Writeではじまるコマンド一覧
PS C:\Users\"ユーザー名"> Get-Command Write-*

CommandType     Name                                               Version    Source
-----------     ----                                               -------    ------
Alias           Write-FileSystemCache                              2.0.0.0    Storage
Function        Write-DtcTransactionsTraceSession                  1.0.0.0    MsDtc
Function        Write-PrinterNfcTag                                1.1        PrintManagement
Function        Write-VolumeCache                                  2.0.0.0    Storage
Cmdlet          Write-Debug                                        7.0.0.0    Microsoft.PowerShell.Utility
Cmdlet          Write-Error                                        7.0.0.0    Microsoft.PowerShell.Utility
Cmdlet          Write-EventLog                                     3.1.0.0    Microsoft.PowerShell.Management
Cmdlet          Write-Host                                         7.0.0.0    Microsoft.PowerShell.Utility
Cmdlet          Write-Information                                  7.0.0.0    Microsoft.PowerShell.Utility
Cmdlet          Write-Output                                       7.0.0.0    Microsoft.PowerShell.Utility
Cmdlet          Write-Progress                                     7.0.0.0    Microsoft.PowerShell.Utility
Cmdlet          Write-Verbose                                      7.0.0.0    Microsoft.PowerShell.Utility
Cmdlet          Write-Warning                                      7.0.0.0    Microsoft.PowerShell.Utility

PS C:\Users\"ユーザー名">
```

## 使用用途

| コマンドレット | 説明 |
| --- | --- |
| Write-Debug | デバッグメッセージを表示する |
| Write-Error | エラーメッセージを表示する |
| Write-EventLog | イベントログにエントリを書き込む |
| Write-Host | コンソールにメッセージを表示する |
| Write-Information | 情報メッセージを表示する |
| Write-Output | パイプラインにオブジェクトを送信する |
| Write-Progress | プログレスバーを表示する |
| Write-Verbose | 詳細メッセージを表示する |
| Write-Warning | 警告メッセージを表示する |
| Write-FileSystemCache | ファイルシステムのキャッシュを書き込む |
| Write-DtcTransactionsTraceSession | DTCのトレースセッションを書き込む |
| Write-PrinterNfcTag | プリンターのNFCタグに情報を書き込む |
| Write-VolumeCache | ボリュームのキャッシュを書き込む |

## Write-Host と Write-Output の違いを解説

違いがよくわかっていなかった Write-Host と Write-Output の違いを調べました。

コマンドレットを実行し、PowerShellの内部処理からユーザーの目に触れるまで、通常は下記のような流れで表示されます。

$$

（ユーザー） \leftarrow コンソール表示 \leftarrow 標準出力 \leftarrow （PowerShellの内部処理）

$$

### Write-Output

上記の流れは、**Write-Output**も同じで標準出力しコンソール上にも表示します。
なお、標準出力 ＋ コンソール出力 の2つ出力と説明しましたが、Write-Outputコマンドレット自体にコンソール出力する機能はありません。
Write-Outputで標準出力されたことによりPowerShellウィンドウ側で自動的にコンソール表示されています。

### Write-Host

一方で、標準出力は行わずコンソール上のみに出力するコマンドレットが、**Write-Host** です。

$$

（ユーザー） \leftarrow コンソール表示 \leftarrow  （PowerShellの内部処理）

$$

上記のように Write-Host には標準出力する機能はありません。

## 各コマンドレットの解説・実際に実行してみる

ざっくり書くとPowerShellには出力する場所（Output Streams）が合計7種類あります。
今回紹介するコマンドレットの大半は、その7種類それぞれに出力するためのコマンドです。

1. Write-Debug
    デフォルトだとコンソール上に表示されないが、`$DebugPreference` を「`Continue`」にすると、
    コンソール上に出力される。

    また、コマンドレットにパラメーター `-Debug` を指定する方法でもデバッグ出力が可能。
    このパラメーターは `$DebugPreference` の設定にかかわらずデバッグ出力ができます。

    ```powershell:Write-Debug
    PS C:\Users\"ユーザー名"> $DebugPreference
    SilentlyContinue
    PS C:\Users\"ユーザー名">
    PS C:\Users\"ユーザー名"> Write-Debug 'Write Debug Message'
    PS C:\Users\"ユーザー名">
    PS C:\Users\"ユーザー名"> $DebugPreference = 'Continue'
    PS C:\Users\"ユーザー名">
    PS C:\Users\"ユーザー名"> Write-Debug 'Write Debug Message'
    DEBUG: Write Debug Message
    PS C:\Users\"ユーザー名">
    ```

    [Write-Debug - Microsoft Learn](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.utility/write-debug)

1. Write-Error
    エラー出力を行うためのコマンドレット。
    このコマンドレットを実行すると、PowerShellの自動変数 `$Error` に自動で格納される。
    最新のエラーは、一番要素が低い `$Error[0]` に格納される。要素数があがるにつれて過去のエラーを確認可能。

    ```powershell:Write-Error
    # エラー出力
    PS C:\Users\"ユーザー名"> Write-Error "Write Error Message" -ErrorId Err001 -Category InvalidResult
    Write-Error: Write Error Message
    # エラーの履歴がある自動変数「$Error」のPropertyを確認
    PS C:\Users\"ユーザー名"> $Error[0] | Get-Member -MemberType Property

    TypeName: System.Management.Automation.ErrorRecord

    Name                  MemberType Definition
    ----                  ---------- ----------
    CategoryInfo          Property   System.Management.Automation.ErrorCategoryInfo CategoryInfo {get;}
    ErrorDetails          Property   System.Management.Automation.ErrorDetails ErrorDetails {get;set;}
    Exception             Property   System.Exception Exception {get;}
    FullyQualifiedErrorId Property   string FullyQualifiedErrorId {get;}
    InvocationInfo        Property   System.Management.Automation.InvocationInfo InvocationInfo {get;}
    PipelineIterationInfo Property   System.Collections.ObjectModel.ReadOnlyCollection[int] PipelineIterationInfo {get;}
    ScriptStackTrace      Property   string ScriptStackTrace {get;}
    TargetObject          Property   System.Object TargetObject {get;}


    # エラー情報を確認
    PS C:\Users\"ユーザー名"> $Error[0].Exception

    TargetSite     :
    Message        : Write Error Message
    Data           : {}
    InnerException :
    HelpLink       :
    Source         :
    HResult        : -2146233087
    StackTrace     :

    # エラーのIDを確認
    PS C:\Users\"ユーザー名"> $Error[0].FullyQualifiedErrorId
    Err001

    # エラーのCategoryを確認
    PS C:\Users\"ユーザー名"> $Error[0].CategoryInfo

    Category   : InvalidResult
    Activity   : Write-Error
    Reason     : WriteErrorException
    TargetName :
    TargetType :

    PS C:\Users\"ユーザー名">
    ```

    [Write-Error - Microsoft Learn](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.utility/write-error)

1. Write-EventLog
    この`Write-EvnetLog`コマンドレットは、PowerShell 5.1までは実行可能です。
    6.0以降のCoreバージョンでは、実行できません。かわりに`New-WinEvnet`というコマンドレットを使用します。

    - PowerShell 5.1以前
        
        ```powershell:PowerShell 5.1までは動作する
        PS C:\Users\"ユーザー名"> Write-EventLog -LogName "Application" -Source "Windows Error Reporting" -EventID 1001 -EntryType Information -Message "Write Eventlog Message." -Category 1000
        PS C:\Users\"ユーザー名">
        ```

        ![Write-EventLog実行後にイベントビューアーを確認](https://storage.googleapis.com/zenn-user-upload/581db8e8ae3f-20240304.png)
        *画像：Write-EventLog実行後にイベントビューアーを確認*

        [Write-EventLog - Microsoft Learn](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.management/write-eventlog)

    - PowerShell 6.0以降

        ```powershell:Write-EventLogはNG
        PS C:\Users\"ユーザー名"> Write-EventLog -LogName "Application" -Source "Windows Error Reporting" -EventID 1001 -EntryType Information -Message "Write Eventlog Message." -Category 1000
        Write-EventLog: The term 'Write-EventLog' is not recognized as a name of a cmdlet, function, script file, or executable program.
        Check the spelling of the name, or if a path was included, verify that the path is correct and try again.
        PS C:\Users\"ユーザー名">
        ```

        ```powershell:New-WinEvnetはOK
        PS C:\Users\"ユーザー名"> New-WinEvent -ProviderName Microsoft-Windows-PowerShell -Id 4100 -Payload @("PowerShell Cmdlet", "New-WinEvent", "Test Message")
        PS C:\Users\"ユーザー名">
        ```
    
    ![New-WinEvent実行でイベントビューアーに登録された事を確認](https://storage.googleapis.com/zenn-user-upload/7aac7d3747bb-20240304.png)
    *画像：New-WinEvent実行でイベントビューアーに登録された事を確認*

    [New-WinEvent - Microsoft Learn](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.diagnostics/new-winevent)

    :::details 補足情報：PowerShellでイベントログを出力する方法をより深く調べた < クリックで折りたたみが開く >

    @[card](https://zenn.dev/haretokidoki/articles/0a179fe71a2cc8)
    @[card](https://zenn.dev/haretokidoki/articles/af3e404855c54b)
    @[card](https://zenn.dev/haretokidoki/articles/48de2dc693f9c0)

    :::

1. Write-Host
    前述している通り、コンソール出力するためのコマンドレット。

    ```powershell
    Write-Host 'This Message. Back Ground Color = "DarkYellow", Fore Ground Color = "White"' -BackGroundColor DarkMagenta -ForeGroundColor White
    ```

    [Write-Host - Microsoft Learn](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.utility/write-host)
1. Write-Information

    [Write-Information - Microsoft Learn](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.utility/write-information)
1. Write-Output

    [Write-Output - Microsoft Learn](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.utility/write-output)
1. Write-Progress
    [Write-Progress - Microsoft Learn](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.utility/write-progress)
1. Write-Verbose
    [Write-Verbose - Microsoft Learn](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.utility/write-verbose)
1. Write-Warning
    [Write-Warning - Microsoft Learn](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.utility/write-warning)
1. Write-FileSystemCache
    [Write-FileSystemCache - Microsoft Learn](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.utility/write-filesystemcache)
1. Write-DtcTransactionsTraceSession
    [Write-DtcTransactionsTraceSession - Microsoft Learn](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.utility/write-dtctransactionstracesession)
1. Write-PrinterNfcTag
    [Write-PrinterNfcTag - Microsoft Learn](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.utility/write-printernfctag)
1. Write-VolumeCache
    [Write-VolumeCache - Microsoft Learn](https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.utility/write-volumecache)

## 参考情報

https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_output_streams
https://blog.shibata.tech/entry/2015/06/26/001944

## 関連記事

https://zenn.dev/haretokidoki/articles/0a179fe71a2cc8
https://zenn.dev/haretokidoki/articles/af3e404855c54b
https://zenn.dev/haretokidoki/articles/48de2dc693f9c0
https://haretokidoki-blog.com/pasocon_powershell-startup/
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960

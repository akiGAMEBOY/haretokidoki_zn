---
title: "[PowerShell]変数名を文字列型で宣言しその文字列の変数を呼び出す方法"
emoji: "👏"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["powershell"]
published: false
---

コマンドレットを使用する方法

PowerShellで変数名を文字列として宣言し、その文字列を使用して変数を呼び出す方法は、`Get-Variable` コマンドレットを使用することです。以下に例を示します：

```powershell
# 文字列型の変数名を宣言
$variableName = 'stringData'

# 実際の変数を宣言し、値を代入
$stringData = @('a', 'b', 'c', 'd', 'e')

# 文字列型の変数名を使用して変数の値を取得
$variableValue = (Get-Variable -Name $variableName -ValueOnly)

# 取得した値を表示
Write-Host $variableValue
```

この例では、`$variableNameAsString` という文字列型の変数に `'variableName'` という文字列を代入しています。`$variableName` という実際の変数に `'値'` を代入し、`Get-Variable` コマンドレットを使用して `$variableNameAsString` で指定された変数の値を取得しています。`-ValueOnly` パラメーターは、変数の値のみを取得するために使用されます。

この方法を使用すると、動的に変数名を指定して、その変数の値を操作するスクリプトを作成することができます¹²³。ただし、変数が存在しない場合はエラーが発生するので、`-ErrorAction` パラメーターを使用してエラー処理を適切に行うことが重要です。🔍

ソース: Copilot との会話、 2024/6/12
(1) PowerShellでオブジェクトのプロパティを文字列の中で展開したい .... https://qiita.com/yutami/items/7f3d28c4873da9d1a359.
(2) Get-Variable (Microsoft.PowerShell.Utility) - PowerShell. https://bing.com/search?q=PowerShell+%e6%96%87%e5%ad%97%e5%88%97%e5%9e%8b%e3%81%ae%e5%a4%89%e6%95%b0%e5%90%8d%e3%81%a7%e5%a4%89%e6%95%b0%e3%82%92%e5%91%bc%e3%81%b3%e5%87%ba%e3%81%99%e6%96%b9%e6%b3%95.
(3) PowerShellの変数の様々な使い方 | 晴耕雨読. https://tex2e.github.io/blog/powershell/variables.
(4) 文字列での変数の代入について知りたかったことのすべて .... https://learn.microsoft.com/ja-jp/powershell/scripting/learn/deep-dives/everything-about-string-substitutions?view=powershell-7.4.
(5) [PowerShell][基本] 変数の使用方法 | PowerShell from Japan .... https://blog.powershell-from.jp/?p=2832.

コマンドレットを使用せずコード上で実現する方法

はい、PowerShellでコマンドレットを使用せずに変数の値を取得する方法があります。変数のスコープを利用して、変数名を文字列として保持し、その文字列を使って変数の値を取得することができます。以下に例を示します：

```powershell
# 文字列として変数名を保持
$variableName = "変数名"

# 実際の変数を宣言し、値を代入
$変数名 = "値"

# スコープを利用して変数の値を取得
$retrievedValue = $ExecutionContext.InvokeCommand.ExpandString("`$$variableName")

# 取得した値を表示
Write-Host $retrievedValue
```

```powershell:
PS D:\Downloads> $variableName = "numberData"
PS D:\Downloads>
PS D:\Downloads> $numberData = @(1, 2, 3, 4, 5)
PS D:\Downloads>
PS D:\Downloads> $variableValue = $ExecutionContext.InvokeCommand.ExpandString("`$$variableName")
PS D:\Downloads>
PS D:\Downloads> Write-Host $variableValue
1 2 3 4 5
PS D:\Downloads>
```

この例では、`$ExecutionContext.InvokeCommand.ExpandString()` メソッドを使用しています。このメソッドは、文字列内の変数を展開してその値を取得するためのものです。`"`$$variableName"` という式は、`$variableName` に格納されている文字列（この場合は `"変数名"`）を変数名として認識し、その変数の値を取得します。

この方法を使用すると、コマンドレットを使わずに動的に変数の値を取得することができます。ただし、この方法はあまり一般的ではなく、通常のスクリプト作成では `Get-Variable` のようなコマンドレットを使用する方が一般的です。また、この方法は変数のスコープに依存するため、スコープ外の変数にはアクセスできない点に注意が必要です¹²³。🔍

ソース: Copilot との会話、 2024/6/12
(1) 変数について - PowerShell | Microsoft Learn. https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powershell.core/about/about_variables?view=powershell-7.4.
(2) Powershell入門 - 04.変数 #初心者向け - Qiita. https://qiita.com/daifukusan/items/69a20b5280277f42027d.
(3) PowerShellで独自のコマンドレットを作成する #初心者 - Qiita. https://qiita.com/seiseikinkin/items/72fa637d26cb1ece96a7.
(4) [PowerShell][基本] 変数の使用方法 | PowerShell from Japan .... https://blog.powershell-from.jp/?p=2832.

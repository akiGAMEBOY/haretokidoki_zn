---
title: "PowerShellæ¨™æº–å‡ºåŠ›ã‚’ç ´æ£„ã™ã‚‹4ã¤ã®æ–¹æ³•ã§ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¯ï¼Ÿ"
emoji: "ðŸ£"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: false
---

```powershell:æ¸¬å®šã—ãŸã‚³ãƒ¼ãƒ‰
function Measure-DiscardCommandOutput {
    [CmdletBinding()]
    param (
        [int]$RepeatCount = 3,           # ç¹°ã‚Šè¿”ã—å›žæ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯10ï¼‰
        [string]$OutputUnit = "ms"        # å‡ºåŠ›å˜ä½ ("ms", "s", "min", "h", "HH:MM")
    )

    # è² è·ã®é«˜ã„ã‚³ãƒžãƒ³ãƒ‰ä¾‹ï¼ˆå¤§é‡ã®ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’å–å¾—ï¼‰
    $testCommand = {
        Get-ChildItem -Path "C:\Windows" -Recurse -ErrorAction SilentlyContinue
    }

    # å„æ–¹æ³•ã®å‡¦ç†æ™‚é–“ã‚’æ ¼ç´ã™ã‚‹é…åˆ—
    $times = @(
        @{ Method = "æ–¹æ³•1: ã‚³ãƒžãƒ³ãƒ‰ | Out-Null"; TotalTime = 0; Results = @() },
        @{ Method = "æ–¹æ³•2: [void](ã‚³ãƒžãƒ³ãƒ‰)"; TotalTime = 0; Results = @() },
        @{ Method = "æ–¹æ³•3: ã‚³ãƒžãƒ³ãƒ‰ > `$null"; TotalTime = 0; Results = @() },
        @{ Method = "æ–¹æ³•4: `$null = ã‚³ãƒžãƒ³ãƒ‰"; TotalTime = 0; Results = @() }
    )

    # ç¹°ã‚Šè¿”ã—æ¸¬å®š
    for ($i = 1; $i -le $RepeatCount; $i++) {
        # å„æ–¹æ³•ã®æ¸¬å®šã¨ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›
        $time1 = (Measure-Command { & $testCommand | Out-Null }).TotalMilliseconds
        $times[0].TotalTime += $time1
        $times[0].Results += $time1
        if ($PSCmdlet.Debug) { Write-Debug "å®Ÿè¡Œå›žæ•° $i æ–¹æ³•1 -> $time1 ms" }

        $time2 = (Measure-Command { [void](& $testCommand) }).TotalMilliseconds
        $times[1].TotalTime += $time2
        $times[1].Results += $time2
        if ($PSCmdlet.Debug) { Write-Debug "å®Ÿè¡Œå›žæ•° $i æ–¹æ³•2 -> $time2 ms" }

        $time3 = (Measure-Command { & $testCommand > $null }).TotalMilliseconds
        $times[2].TotalTime += $time3
        $times[2].Results += $time3
        if ($PSCmdlet.Debug) { Write-Debug "å®Ÿè¡Œå›žæ•° $i æ–¹æ³•3 -> $time3 ms" }

        $time4 = (Measure-Command { $null = & $testCommand }).TotalMilliseconds
        $times[3].TotalTime += $time4
        $times[3].Results += $time4
        if ($PSCmdlet.Debug) { Write-Debug "å®Ÿè¡Œå›žæ•° $i æ–¹æ³•4 -> $time4 ms" }
    }

    # å˜ä½å¤‰æ›ç”¨ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    function Convert-Time {
        param (
            [double]$Milliseconds,
            [string]$Unit
        )

        switch ($Unit) {
            "ms"    { return $Milliseconds }
            "s"     { return $Milliseconds / 1000 }
            "min"   { return $Milliseconds / 1000 / 60 }
            "h"     { return $Milliseconds / 1000 / 60 / 60 }
            "HH:MM" {
                $totalMinutes = [math]::Floor($Milliseconds / 1000 / 60)
                $hours = [math]::Floor($totalMinutes / 60)
                $minutes = $totalMinutes % 60
                return "{0:D2}:{1:D2}" -f $hours, $minutes
            }
            default { throw "ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„å˜ä½: $Unit" }
        }
    }

    # å¹³å‡æ™‚é–“ã‚’è¨ˆç®—ã—ã¦æŒ‡å®šã•ã‚ŒãŸå˜ä½ã§å‡ºåŠ›
    foreach ($time in $times) {
        $time.AverageTime = $time.TotalTime / $RepeatCount
        $convertedTime = Convert-Time -Milliseconds $time.AverageTime -Unit $OutputUnit
        Write-Output "$($time.Method) -> å¹³å‡ $convertedTime $OutputUnit"
    }
}
```

```powershell:å®Ÿè¡Œ
Measure-DiscardCommandOutput -Debug
```

```powershell:å®Ÿè¡Œçµæžœ

```

## è¨ˆæ¸¬

### 1å›žç›®

```

```

æ–¹æ³•1: 60999.9094 ãƒŸãƒªç§’
æ–¹æ³•2: 37767.5073 ãƒŸãƒªç§’
æ–¹æ³•3: 52638.8393 ãƒŸãƒªç§’
æ–¹æ³•4: 38693.2879 ãƒŸãƒªç§’

xxxxx.xxxx ms / 1000 = x s

æ–¹æ³•1: 61.00 ç§’
æ–¹æ³•2: 37.77 ç§’
æ–¹æ³•3: 52.64 ç§’
æ–¹æ³•4: 38.69 ç§’

### 2å›žç›®

```
æ–¹æ³•1: ã‚³ãƒžãƒ³ãƒ‰ | Out-Null -> 42544.3476 ms
æ–¹æ³•2: [void](ã‚³ãƒžãƒ³ãƒ‰)	-> 40000.5987 ms
æ–¹æ³•3: ã‚³ãƒžãƒ³ãƒ‰ > $null -> 59501.2323 ms
æ–¹æ³•4: $null = ã‚³ãƒžãƒ³ãƒ‰ -> 39876.9409 ms
```

xxxxx.xxxx ms / 1000 = xx.xx s

æ–¹æ³•1: 42.54 ç§’
æ–¹æ³•2: 40.00 ç§’
æ–¹æ³•3: 59.50 ç§’
æ–¹æ³•4: 39.88 ç§’


### 3å›žç›®

16:10 ï½ž 16:15

```
æ–¹æ³•1: ã‚³ãƒžãƒ³ãƒ‰ | Out-Null -> 42367.0244 ms
æ–¹æ³•2: [void](ã‚³ãƒžãƒ³ãƒ‰) -> 38848.5259 ms
æ–¹æ³•3: ã‚³ãƒžãƒ³ãƒ‰ > $null -> 55244.5738 ms
æ–¹æ³•4: $null = ã‚³ãƒžãƒ³ãƒ‰ -> 39613.8504 ms
```

xxxxx.xxxx ms / 1000 = xx.xx s

æ–¹æ³•1: 42.37 ç§’
æ–¹æ³•2: 38.85 ç§’
æ–¹æ³•3: 55.24 ç§’
æ–¹æ³•4: 39.61 ç§’

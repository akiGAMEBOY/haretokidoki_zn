---
title: "Scrap Memo"
emoji: "📝"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["memo"]
published: false
---
PowerShellで環境変数を確認／設定する方法
	https://zaki-hmkc.hatenablog.com/entry/2020/04/13/124930

Dockerで発生した問題・調べたこと
## 発生した問題
### ▼Dockerのデータファイル「ext4.vhdx」の肥大化でCドライブ枯渇
https://zenn.dev/haretokidoki/articles/49dacc3516c441
## 調べたこと
### ▼Dockerのデータファイル「ext4.vhdx」の最適化
- Win10 Pro/Enterprise
    https://www.curict.com/item/f4/f46da60.html
    https://qiita.com/sarisia/items/5c53c078ab30eb26bc3b
- Win10 Home
    https://qiita.com/siruku6/items/c91a40d460095013540d
### ▼Dockerのデータファイル「ext4.vhdx」の格納先（保存先）変更
https://qiita.com/__fu__/items/7c533911fc64006f64a0
https://zenn.dev/ijiwarunahello/articles/498acbe0d28f8b
### ▼Docker Desktop for Windowsのクリーンインストール
1. スタートメニュー -> 設定 -> アプリで、Docker Desktopを選択しアンインストール。
2. 残存しているデータを手動で削除（ただ再インストールしたい場合は不要）
    - C:\Users\XXXX\AppData\Local\Docker
        フォルダ内にデータあり。私の環境では約131MB
	- C:\Users\XXXX\AppData\Local\Temp\DockerDesktop
        フォルダ内にデータなし。空フォルダ
	- C:\ProgramData\DockerDesktop
        フォルダ内にデータあり。私の環境では約5KB
	- C:\Users\XXXX\.docker
        フォルダ内にデータあり。私の環境では約11.6MB
	- C:\Users\XXXX\AppData\Roaming\Docker
        フォルダ内にデータあり。私の環境では約11KB
	- C:\Users\XXXX\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\docker-desktop-data
        フォルダ内にデータなし。空フォルダ
3. Docker Desktop for Windowsのインストール
    - 公式：Install Docker Desktop on Windows
        https://docs.docker.com/desktop/install/windows-install/
    - 公式：ダウンロードリンク
	    https://desktop.docker.com/win/main/amd64/Docker%20Desktop%20Installer.exe
	
### ▼Docker Desktop + WSL2 メモリ使用率を制限する方法
#### 対応方法
    1. コンフィグファイルの作成
        C:\Users\`ユーザ名`の配下に`.wslconfig`を作成する。
        （ネットの記事だと`C:\Users\`ユーザ名\.wslconfig`にファイルがある前提で記載があったが、
        　私の環境では`.wslconfig`が存在しなかった為、手動で作成）
    2. コンフィグファイルに追記
        ```:`.wslconfig`ファイル
        [wsl2]
        memory=6GB # Limits VM memory in WSL 2 to 6 GB
        processors=2 # Makes the WSL 2 VM use two virtual processors
        swap=0
        ```
#### 参考記事
https://zenn.dev/takajun/articles/4f15d115548899
https://dojo.docker.jp/t/topic/52/2

OS関連のコマンド
### ▼サイズの大きいファイルを調べるコマンド
https://orebibou.com/ja/home/201501/20150113_001/
### ▼プロパティを表示のショートカット
ファイルもしくはフォルダを選択中にAlt + Enterを入力するとプロパティが表示
### ▼名前を指定して実行 で利用できるコマンド一覧
https://www.projectgroup.info/tips/Windows/comm_0006.html
### ▼回避方法：ExcelのハイパーリンクでアクセスするとCAPTCHA認証が表示される場合
とあるECサイトのリンクをExcelのセルにメモしていたが、
Excelのハイパーリンクからサイトにアクセスすると人間かの認証「CAPTCHA認証（hCaptcha）」が表示されてしまう。
認証を回避方法を見つけた。
#### Google検索ページのリンクをExcelに貼り付ける回避方法
直接、ECサイトのリンクを貼ってアクセスするとCAPTCHA認証が表示されてしまう為、
Google検索のフィルタ機能を使用しアクセスしたいページをGoogle経由のリンクで準備する。
リンクから該当ページに到達するまで、
「Excelのセルをクリック -> Google検索ページが表示 -> 該当ページをクリック -> 該当ページに到達」
というように段階を踏む必要があるが比較的、簡単な方法となる。
- Google検索ページのリンクを準備する方法
    :::message
    **注意事項**

    Amazon.comにhCaptchaが導入されている場合を想定して方法を紹介。
    実際は**Amazon.comにhCaptchaは導入されていない**。
    :::
    Googleで「`site:対象サイト △（空白） 検索キーワード（例ではAmazon商品コード ASIN）`」で検索。
    下記のURLは`site:https://www.amazon.com B07Y57ZVZX`で検索した際のURL。
    このURLをExcelに貼り付ける事でExcelから直接アクセスしないので認証を回避可能。
    https://www.google.com/search?q=site%3Ahttps%3A%2F%2Fwww.amazon.com+B07Y57ZVZX
#### VBAで独自関数を作成しサイトにアクセスする回避方法
独自関数の中身は、コマンドプロンプトのSTARTコマンドにURLの引数を渡して実行している。
- Excelでの使用方法
    ```vbnet:Excelシート上での関数を使用する方法
    =FuncJumpUrl("URLが入力されたセル位置、もしくは対象のURL")
    ```
- Excelシート上での記入例

    | ＼ | A | B | C |
    | ---- | ---- | ---- | ---- |
    | **1** |  |  |  |
    | **2** |  | https://www.amazon.com/dp/B07Y57ZVZX | =FuncJumpUrl(**B2**)<br>→成功すると"Success"が表示<br>　失敗すると"Failure"が表示<br><br>または<br>=FuncJumpUrl(`https://www.amazon.com/dp/B07Y57ZVZX`)でもOK |
    | **3** |  |  |  |
	```vbnet:独自関数の中身
	Function FuncJumpUrl(strUrl As String) As Long
        Dim lngResult As Long
        Dim strCommand As String
        Dim objWsh As Object
        
        ' 実行するコマンドを指定
        strCommand = "start " & strUrl
        
        ' コマンドプロンプトで指定コマンドを実行
        Set objWsh = CreateObject("WScript.Shell")
        lngResult = objWsh.Run(Command:="%ComSpec% /c " & strCommand, WindowStyle:=0, WaitOnReturn:=True)
        
        ' 結果
        If lngResult = 0 Then
            MsgBox "Success", vbOKOnly + vbInformation, "処理結果｜FuncJumpUrl"
            FuncJumpUrl = 0
        Else
            MsgBox "Failure", vbOKOnly + vbCritical, "処理結果｜FuncJumpUrl"
            FuncJumpUrl = -1
        End If
    End Function
	```
##### 参考記事
https://excel-vba.work/2020/10/30/【vba】windowsのコマンドを実行する/

プログラム全般
## プログラム全般で発生した問題
### ▼小数点を含む計算で誤差が発生
#### 原因
2進浮動小数点数（データ型 Double）を含んだ計算により[丸め誤差](https://e-words.jp/w/丸め誤差.html)が発生していた事が判明。
今回、誤差が発生した計算式「1.1 x 200」以外にも、「0.1 + 0.2」など他にも多くのパターンで誤差が発生する。
#### 検証
実際に誤差が発生するのかExcel VBAで検証。
- 誤差あり「1.1 x 200」
    ```vbnet:プログラム（VBA） 
    Sub SubMarume()
        Dim dblKitai As Double
        Dim dblResult As Double
        Dim dblValue As Double
        Dim lngValue As Long
        
        dblValue = 1.1
        lngValue = 200
        
        dblResult = dblValue * lngValue
        
        dblKitai = 220
        
        Debug.Print "----- 出力結果 -----"
        Debug.Print ""
        If dblKitai = dblResult Then
            Debug.Print "判定結果：同じ"
            Debug.Print "　期待値：" & dblKitai
            Debug.Print "　計算値：" & dblResult
            Debug.Print ""
            Debug.Print "　期待値 - 計算値 = " & dblKitai - dblResult
        Else
            Debug.Print "判定結果：違う"
            Debug.Print "　期待値：" & dblKitai
            Debug.Print "　計算値：" & dblResult
            Debug.Print ""
            Debug.Print "220 - 220 = " & 220 - 220
            Debug.Print "期待値 - 計算値 = " & dblKitai - dblResult
        End If
        Debug.Print ""
        Debug.Print "--------------------"
        Debug.Print ""

    End Sub
    ```
    ```vbnet:実行結果
    ----- 出力結果 -----

    判定結果：違う
    　期待値：220
    　計算値：220

    220 - 220 = 0
    期待値 - 計算値 = -2.8421709430404E-14

    --------------------
    ```
- 誤差なし「1.2 x 200」
    ```vbnet:プログラム（VBA）
    Sub SubMarume()
        Dim dblKitai As Double
        Dim dblResult As Double
        Dim dblValue As Double
        Dim lngValue As Long
        
        dblValue = 1.2
        lngValue = 200
        
        dblResult = dblValue * lngValue
        
        dblKitai = 240
        
        Debug.Print "----- 出力結果 -----"
        Debug.Print ""
        If dblKitai = dblResult Then
            Debug.Print "判定結果：同じ"
            Debug.Print "　期待値：" & dblKitai
            Debug.Print "　計算値：" & dblResult
            Debug.Print ""
            Debug.Print "　期待値 - 計算値 = " & dblKitai - dblResult
        Else
            Debug.Print "判定結果：違う"
            Debug.Print "　期待値：" & dblKitai
            Debug.Print "　計算値：" & dblResult
            Debug.Print ""
            Debug.Print "240 - 240 = " & 240 - 240
            Debug.Print "期待値 - 計算値 = " & dblKitai - dblResult
        End If
        Debug.Print ""
        Debug.Print "--------------------"
        Debug.Print ""

    End Sub
    ```
    ```vbnet:[出力結果] 1.2 x 200 は**誤差なし**
    ----- 出力結果 -----

    判定結果：同じ
    　期待値：240
    　計算値：240

    　期待値 - 計算値 = 0

    --------------------
    ```
#### 対処方法
- データ型を見直す対処
	データ型の見直し以外にも対処が必要と思われる。
	プログラムで小数点を取り扱う場合、有効とする小数点の桁数や、計算結果を判定する判定する場合は許容する誤差の範囲など、
	取り決めるべき事項がある。
	取り決め後、具体的な対応方法は指定の桁数までの値を四捨五入や切り捨て、切り上げなどが考えられる。
	- 小数4桁以内の場合、固定小数点数のデータ型（Currency）で対処
		```vbnet:プログラム（VBA）
		Sub SubCurrency()
		    Dim curKitai As Currency
		    Dim curResult As Currency
		    Dim curValue As Currency
		    Dim lngValue As Long
		    
		    curValue = 1.1
		    lngValue = 200
		    
		    curResult = curValue * lngValue
		    
		    curKitai = 220
		    
		    Debug.Print "----- 出力結果 -----"
		    Debug.Print ""
		    If curKitai = curResult Then
		        Debug.Print "判定結果：同じ"
		        Debug.Print "　期待値：" & curKitai
		        Debug.Print "　計算値：" & curResult
		        Debug.Print ""
		        Debug.Print "　期待値 - 計算値 = " & curKitai - curResult
		    Else
		        Debug.Print "判定結果：違う"
		        Debug.Print "　期待値：" & curKitai
		        Debug.Print "　計算値：" & curResult
		        Debug.Print ""
		        Debug.Print "220 - 220 = " & 220 - 220
		        Debug.Print "期待値 - 計算値 = " & curKitai - curResult
		    End If
		    Debug.Print ""
		    Debug.Print "--------------------"
		    Debug.Print ""

		End Sub
		```
		```vbnet:出力結果
		----- 出力結果 -----

		判定結果：同じ
		　期待値：220
		　計算値：220

		　期待値 - 計算値 = 0

		--------------------
		```
	- 10進数の小数点を取り扱うデータ型（Decimal）で対処
        VBAでは個別でDecimalがなく`CDec`でDecimalに変換し、Variantに代入する必要がある。
        C#ではデータ型にDecimalがある。
		```vbnet:プログラム（VBA）
		Sub SubDecimal()
		    Dim decKitai As Variant
		    Dim decResult As Variant
		    Dim decValue As Variant
		    Dim lngValue As Long
		    
		    decValue = CDec(1.1)
		    lngValue = 200
		    
		    decResult = decValue * lngValue
		    
		    decKitai = CDec(220)
		    
		    Debug.Print "----- 出力結果 -----"
		    Debug.Print ""
		    If decKitai = decResult Then
		        Debug.Print "判定結果：同じ"
		        Debug.Print "　期待値：" & decKitai
		        Debug.Print "　計算値：" & decResult
		        Debug.Print ""
		        Debug.Print "　期待値 - 計算値 = " & decKitai - decResult
		    Else
		        Debug.Print "判定結果：違う"
		        Debug.Print "　期待値：" & decKitai
		        Debug.Print "　計算値：" & decResult
		        Debug.Print ""
		        Debug.Print "220 - 220 = " & 220 - 220
		        Debug.Print "期待値 - 計算値 = " & decKitai - decResult
		    End If
		    Debug.Print ""
		    Debug.Print "--------------------"
		    Debug.Print ""

		End Sub
		```
		```vbnet:出力結果
		----- 出力結果 -----

		判定結果：同じ
		　期待値：220
		　計算値：220

		　期待値 - 計算値 = 0

		--------------------
		```
- データ型の見直し以外の対処方法
	- 計算時、一時的に整数する対応
		利用方法によって想定外の動きになる可能性があり。
		```vbnet:プログラム（VBA）
		Sub SubSeisu()
		    Dim dblKitai As Double
		    Dim dblResult As Double
		    Dim dblValue As Double
		    Dim lngValue As Long
		    
		    dblValue = 1.1
		    dblValue = dblValue * 10					' 整数にする
		    lngValue = 200
		    
		    dblResult = dblValue * lngValue
		    dblResult = dblResult / 10					' 小数点に戻す
		    
		    dblKitai = 220
		    
		    Debug.Print "----- 出力結果 -----"
		    Debug.Print ""
		    If dblKitai = dblResult Then
		        Debug.Print "判定結果：同じ"
		        Debug.Print "　期待値：" & dblKitai
		        Debug.Print "　計算値：" & dblResult
		        Debug.Print ""
		        Debug.Print "　期待値 - 計算値 = " & dblKitai - dblResult
		    Else
		        Debug.Print "判定結果：違う"
		        Debug.Print "　期待値：" & dblKitai
		        Debug.Print "　計算値：" & dblResult
		        Debug.Print ""
		        Debug.Print "220 - 220 = " & 220 - 220
		        Debug.Print "期待値 - 計算値 = " & dblKitai - dblResult
		    End If
		    Debug.Print ""
		    Debug.Print "--------------------"
		    Debug.Print ""

		End Sub
		```
		```vbnet:出力結果
		----- 出力結果 -----

		判定結果：同じ
		　期待値：220
		　計算値：220

		　期待値 - 計算値 = 0

		--------------------
		```
	- 四捨五入して対処
		```vbnet:プログラム（VBA）
		Sub SubShishagonyu()
		    Dim dblKitai As Double
		    Dim dblResult As Double
		    Dim dblValue As Double
		    Dim lngValue As Long
		    
		    dblValue = 1.1
		    lngValue = 200
		    
		    dblResult = dblValue * lngValue
		    dblResult = Round(dblResult)				' 四捨五入
		    
		    dblKitai = 220
		    
		    Debug.Print "----- 出力結果 -----"
		    Debug.Print ""
		    If dblKitai = dblResult Then
		        Debug.Print "判定結果：同じ"
		        Debug.Print "　期待値：" & dblKitai
		        Debug.Print "　計算値：" & dblResult
		        Debug.Print ""
		        Debug.Print "　期待値 - 計算値 = " & dblKitai - dblResult
		    Else
		        Debug.Print "判定結果：違う"
		        Debug.Print "　期待値：" & dblKitai
		        Debug.Print "　計算値：" & dblResult
		        Debug.Print ""
		        Debug.Print "220 - 220 = " & 220 - 220
		        Debug.Print "期待値 - 計算値 = " & dblKitai - dblResult
		    End If
		    Debug.Print ""
		    Debug.Print "--------------------"
		    Debug.Print ""

		End Sub
		```
		```vbnet:出力結果
		----- 出力結果 -----

		判定結果：同じ
		　期待値：220
		　計算値：220

		　期待値 - 計算値 = 0

		--------------------
		```
	- 判定する際の許容範囲を設定し判定
		```vbnet:プログラム（VBA）
		Sub SubKyoyou()
		    Dim dblKitai As Double
		    Dim dblResult As Double
		    Dim dblValue As Double
		    Dim lngValue As Long
            Dim dblKitei As Double                      ' 許容範囲
            Dim dblGosa As Double                       ' 誤差の値
		    
		    dblValue = 1.1
		    lngValue = 200
		    
		    dblResult = dblValue * lngValue
		    
		    dblKitai = 220

            dblKitei = 0.1                              ' 許容範囲の設定
            dblGosa = Abs(dblKitai - dblResult)         ' 差分の絶対値
		    
		    Debug.Print "----- 出力結果 -----"
		    Debug.Print ""
		    'If dblKitai = dblResult Then
            If dblKitei > dblGosa Then                  ' 許容範囲で判定
		        Debug.Print "判定結果：同じ"
		        Debug.Print "　期待値：" & dblKitai
		        Debug.Print "　計算値：" & dblResult
		        Debug.Print ""
		        Debug.Print "　期待値 - 計算値 = " & dblKitai - dblResult
		    Else
		        Debug.Print "判定結果：違う"
		        Debug.Print "　期待値：" & dblKitai
		        Debug.Print "　計算値：" & dblResult
		        Debug.Print ""
		        Debug.Print "220 - 220 = " & 220 - 220
		        Debug.Print "期待値 - 計算値 = " & dblKitai - dblResult
		    End If
		    Debug.Print ""
		    Debug.Print "--------------------"
		    Debug.Print ""

		End Sub
		```
		```vbnet:出力結果
        ----- 出力結果 -----

        判定結果：同じ
        　期待値：220
        　計算値：220

        　期待値 - 計算値 = -2.8421709430404E-14

        --------------------
		```
#### 参考記事
- 丸め誤差（わかりやすい解説）
	https://blog.apar.jp/program/8900/
- 丸め誤差（浮動小数点数型の計算が期待通りにならない）
	https://dobon.net/vb/dotnet/beginner/floatingpointerror.html
- ExcelVBA
    - データ型 Double
        https://learn.microsoft.com/ja-jp/office/vba/language/reference/user-interface-help/double-data-type
    - データ型 Currency
        https://learn.microsoft.com/ja-jp/office/vba/language/reference/user-interface-help/currency-data-type
    - データ型 Decimal
        https://learn.microsoft.com/ja-jp/office/vba/language/reference/user-interface-help/decimal-data-type
- C#
    - データ型 Double
        https://learn.microsoft.com/ja-jp/dotnet/api/system.double?view=net-7.0
    - データ型 Decimal
        https://learn.microsoft.com/ja-jp/dotnet/api/system.decimal?view=net-7.0
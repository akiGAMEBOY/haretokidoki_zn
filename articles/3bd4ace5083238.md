---
title: "Coreç’°å¢ƒã‹ãƒã‚§ãƒƒã‚¯"
emoji: "ğŸŒŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: false
---

```powershell:
# ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ enumè¨­å®š
Add-Type -TypeDefinition @"
    public enum MESSAGECODE {
        Successful = 0,
        Abend,
        Cancel,
        Error_NotCore,
        Error_NotSupportedVersion,
        Error_NotWindows
    }
"@
#################################################################################
# å‡¦ç†åã€€ | VerificationExecutionEnv
# æ©Ÿèƒ½ã€€ã€€ | PowerShellç’°å¢ƒãƒã‚§ãƒƒã‚¯
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | MESSAGECODEï¼ˆenumï¼‰
# å¼•æ•°ã€€ã€€ | ãªã—
#################################################################################
Function VerificationExecutionEnv {
    [MESSAGECODE]$messagecode = [MESSAGECODE]::Successful

    # ç’°å¢ƒæƒ…å ±ã‚’å–å¾—
    [System.Collections.Hashtable]$powershell_ver = $PSVersionTable

    # ç’°å¢ƒã®åˆ¤å®šï¼šCoreã§ã¯ãªã„å ´åˆ
    if ($powershell_ver.PSEdition -ne 'Core') {
        $messagecode = [MESSAGECODE]::Error_NotCore
        Write-Host 'Coreï¼ˆ6.0ä»¥é™ï¼‰ã®ç’°å¢ƒã§ã¯ãªã„' -ForegroundColor Red
    }
    # ç’°å¢ƒã®åˆ¤å®šï¼šãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ7ã‚ˆã‚Šå°ã•ã„å ´åˆ
    elseif ($powershell_ver.PSVersion.Major -lt 7) {
        $messagecode = [MESSAGECODE]::Error_NotSupportedVersion
        Write-Host 'Coreï¼ˆ6.0ä»¥é™ï¼‰ã®ç’°å¢ƒã ãŒã€7ä»¥ä¸Š ã®ç’°å¢ƒã§ã¯ãªã„' -ForegroundColor Red
    }
    # ç’°å¢ƒã®åˆ¤å®šï¼šWindows OSã§ã¯ãªã„å ´åˆ
    elseif (-Not($IsWindows)) {
        $messagecode = [MESSAGECODE]::Error_NotWindows
        Write-Host 'Coreï¼ˆ6.0ä»¥é™ï¼‰ã®ç’°å¢ƒã§ã€ã‹ã¤ 7ä»¥ä¸Š ã®ç’°å¢ƒã ãŒã€Windows OS ã®ç’°å¢ƒã§ã¯ãªã„' -ForegroundColor Red
    }
    else {
        Write-Host 'Coreï¼ˆ6.0ä»¥é™ï¼‰ã®ç’°å¢ƒã§ã€ã‹ã¤ 7ä»¥ä¸Š ã®ç’°å¢ƒã€Windows OS ã®ç’°å¢ƒã§ã‚ã‚‹'
    }

    return $messagecode
}
```

$IsCoreCLR: PowerShellãŒCoreCLRä¸Šã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¤ºã—ã¾ã™ã€‚
$IsLinux: ã‚·ã‚¹ãƒ†ãƒ ãŒLinuxãƒ™ãƒ¼ã‚¹ã§ã‚ã‚‹ã‹ã©ã†ã‹ã‚’ç¤ºã—ã¾ã™ã€‚
$IsMacOS: ã‚·ã‚¹ãƒ†ãƒ ãŒmacOSã§ã‚ã‚‹ã‹ã©ã†ã‹ã‚’ç¤ºã—ã¾ã™ã€‚
$IsWindows: ã‚·ã‚¹ãƒ†ãƒ ãŒWindowsãƒ™ãƒ¼ã‚¹ã§ã‚ã‚‹ã‹ã©ã†ã‹ã‚’ç¤ºã—ã¾ã™ã€‚

5.1ã§å®Ÿè¡Œã™ã‚‹ã¨ã€Nullã§è¿”ã£ã¦ãã‚‹ã€‚â—‹â—‹ã‹ã‚‰å®Ÿè£…ã•ã‚ŒãŸè‡ªå‹•å¤‰æ•°ã€‚

ä»–ã®è‡ªå‹•å¤‰æ•°ã‚’ç´¹ä»‹ã€‚

```:ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
WHERE /Q pwsh
IF %ERRORLEVEL% == 0 (
    @REM PowerShell Core ã§å®Ÿè¡Œã™ã‚‹å ´åˆ
    pwsh -NoProfile -ExecutionPolicy Unrestricted -File "%~dp0\source\powershell\Main.ps1"
    @REM pwsh -NoProfile -ExecutionPolicy RemoteSigned -File "%~dp0\source\powershell\Main.ps1"
) ELSE (
    @REM PowerShell 5.1  ã§å®Ÿè¡Œã™ã‚‹å ´åˆ
    powershell -NoProfile -ExecutionPolicy Unrestricted -File "%~dp0\source\powershell\Main.ps1"
    @REM powershell -NoProfile -ExecutionPolicy RemoteSigned -File "%~dp0\source\powershell\Main.ps1"
)
```

```powershell:
# 'pwsh' ã‚³ãƒãƒ³ãƒ‰ã®ãƒ‘ã‚¹ã‚’æ¤œç´¢ã—ã€çµæœãŒã‚ã‚Œã°è¡¨ç¤ºã—ã¾ã™ã€‚
[System.String]$pwsh_path = (Get-Command 'pws' -ErrorAction SilentlyContinue)
[System.String]$pwsh_path = (Get-Command 'pwsh' -ErrorAction SilentlyContinue)Source
if ($commandPath) {
    Write-Host "ã‚³ãƒãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ: $commandPath"
} else {
    Write-Host "ã‚³ãƒãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚"
}

```

è‡ªå‹•å¤‰æ•°ã®ä¸€è¦§ã®è¨˜äº‹ã‚’ç´¹ä»‹ã€‚

---
title: "Core環境かチェック"
emoji: "🌟"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["powershell"]
published: false
---

```powershell:
#################################################################################
# 処理名　 | VerificationExecutionEnv
# 機能　　 | PowerShell環境チェック
#--------------------------------------------------------------------------------
# 戻り値　 | MESSAGECODE（enum）
# 引数　　 | なし
#################################################################################
Function VerificationExecutionEnv {
    [MESSAGECODE]$messagecode = [MESSAGECODE]::Successful
    [System.String]$messagecode_messages = ''

    # 環境情報を取得
    [System.Collections.Hashtable]$powershell_ver = $PSVersionTable

    # 環境の判定：Coreではない場合
    if ($powershell_ver.PSEdition -ne 'Core') {
        $messagecode = [MESSAGECODE]::Error_NotCore
        $messagecode_messages = RetrieveMessage $messagecode
        Write-Host $messagecode_messages -ForegroundColor Red
    }
    # 環境の判定：メジャーバージョンが7より小さい場合
    elseif ($powershell_ver.PSVersion.Major -lt 7) {
        $messagecode = [MESSAGECODE]::Error_NotSupportedVersion
        $messagecode_messages = RetrieveMessage $messagecode
        Write-Host $messagecode_messages -ForegroundColor Red
    }
    # 環境の判定：Windows OSではない場合
    elseif (-Not($IsWindows)) {
        $messagecode = [MESSAGECODE]::Error_NotWindows
        $messagecode_messages = RetrieveMessage $messagecode
        Write-Host $messagecode_messages -ForegroundColor Red
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        [void](Write-Host '### DEBUG PRINT ###')
        [void](Write-Host '')

        [void](Write-Host "Function VerificationExecutionEnv: messagecode [${messagecode}]")

        [void](Write-Host '')
        [void](Write-Host '###################')
        [void](Write-Host '')
        [void](Write-Host '')
    }

    return $messagecode
}
```

```:コマンドプロンプト
WHERE /Q pwsh
IF %ERRORLEVEL% == 0 (
    @REM PowerShell Core で実行する場合
    pwsh -NoProfile -ExecutionPolicy Unrestricted -File "%~dp0\source\powershell\Main.ps1"
    @REM pwsh -NoProfile -ExecutionPolicy RemoteSigned -File "%~dp0\source\powershell\Main.ps1"
) ELSE (
    @REM PowerShell 5.1  で実行する場合
    powershell -NoProfile -ExecutionPolicy Unrestricted -File "%~dp0\source\powershell\Main.ps1"
    @REM powershell -NoProfile -ExecutionPolicy RemoteSigned -File "%~dp0\source\powershell\Main.ps1"
)
```

```powershell:
# 'pwsh' コマンドのパスを検索し、結果があれば表示します。
[System.String]$pwsh_path = (Get-Command 'pws' -ErrorAction SilentlyContinue)
[System.String]$pwsh_path = (Get-Command 'pwsh' -ErrorAction SilentlyContinue)Source
if ($commandPath) {
    Write-Host "コマンドが見つかりました: $commandPath"
} else {
    Write-Host "コマンドが見つかりませんでした。"
}

```

自動変数の一覧の記事を紹介。

---
title: "Core環境かチェック"
emoji: "🌟"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["powershell"]
published: false
---

```powershell:
# エラーコード enum設定
Add-Type -TypeDefinition @"
    public enum MESSAGECODE {
        Successful = 0,
        Abend,
        Cancel,
        Error_NotCore,
        Error_NotSupportedVersion,
        Error_NotWindows
    }
"@
#################################################################################
# 処理名　 | VerificationExecutionEnv
# 機能　　 | PowerShell環境チェック
#--------------------------------------------------------------------------------
# 戻り値　 | MESSAGECODE（enum）
# 引数　　 | なし
#################################################################################
Function VerificationExecutionEnv {
    [MESSAGECODE]$messagecode = [MESSAGECODE]::Successful

    # 環境情報を取得
    [System.Collections.Hashtable]$powershell_ver = $PSVersionTable

    # 環境の判定：Coreではない場合
    if ($powershell_ver.PSEdition -ne 'Core') {
        $messagecode = [MESSAGECODE]::Error_NotCore
        Write-Host 'Core（6.0以降）の環境ではない' -ForegroundColor Red
    }
    # 環境の判定：メジャーバージョンが7より小さい場合
    elseif ($powershell_ver.PSVersion.Major -lt 7) {
        $messagecode = [MESSAGECODE]::Error_NotSupportedVersion
        Write-Host 'Core（6.0以降）の環境だが、7以上 の環境ではない' -ForegroundColor Red
    }
    # 環境の判定：Windows OSではない場合
    elseif (-Not($IsWindows)) {
        $messagecode = [MESSAGECODE]::Error_NotWindows
        Write-Host 'Core（6.0以降）の環境で、かつ 7以上 の環境だが、Windows OS の環境ではない' -ForegroundColor Red
    }
    else {
        Write-Host 'Core（6.0以降）の環境で、かつ 7以上 の環境、Windows OS の環境である'
    }

    return $messagecode
}
```

$IsCoreCLR: PowerShellがCoreCLR上で実行されているかどうかを示します。
$IsLinux: システムがLinuxベースであるかどうかを示します。
$IsMacOS: システムがmacOSであるかどうかを示します。
$IsWindows: システムがWindowsベースであるかどうかを示します。

5.1で実行すると、Nullで返ってくる。○○から実装された自動変数。

他の自動変数を紹介。

```:コマンドプロンプト
WHERE /Q pwsh
IF %ERRORLEVEL% == 0 (
    @REM PowerShell Core で実行する場合
    pwsh -NoProfile -ExecutionPolicy Unrestricted -File "%~dp0\source\powershell\Main.ps1"
    @REM pwsh -NoProfile -ExecutionPolicy RemoteSigned -File "%~dp0\source\powershell\Main.ps1"
) ELSE (
    @REM PowerShell 5.1  で実行する場合
    powershell -NoProfile -ExecutionPolicy Unrestricted -File "%~dp0\source\powershell\Main.ps1"
    @REM powershell -NoProfile -ExecutionPolicy RemoteSigned -File "%~dp0\source\powershell\Main.ps1"
)
```

```powershell:
# 'pwsh' コマンドのパスを検索し、結果があれば表示します。
[System.String]$pwsh_path = (Get-Command 'pws' -ErrorAction SilentlyContinue)
[System.String]$pwsh_path = (Get-Command 'pwsh' -ErrorAction SilentlyContinue)Source
if ($commandPath) {
    Write-Host "コマンドが見つかりました: $commandPath"
} else {
    Write-Host "コマンドが見つかりませんでした。"
}

```

自動変数の一覧の記事を紹介。

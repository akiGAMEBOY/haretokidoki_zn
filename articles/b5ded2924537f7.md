---
title: "[PowerShell]ログインユーザーがAdministratorsに所属しているかBoolで判定するFunction"
emoji: "👩‍⚖️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["windows", "powershell"]
published: true
---

Windows環境で任意のグループに所属しているユーザーを確認するコマンドレットは、「**Get-LocalGroupMember**」です。

実際に実行すると下記のような結果に。

```powershell:Get-LocalGroupMemberのコマンド結果
PS C:\Users\"ログインユーザー名"> Get-LocalGroupMember -Name 'Administrators'

ObjectClass Name                     PrincipalSource
----------- ----                     ---------------
ユーザー    "コンピューター名"\Administrator   Local
ユーザー    "コンピューター名"\"ログインユーザー名" Local


PS C:\Users\"ログインユーザー名">
```

このコマンドレットを使って、現在ログインしているユーザーがAdministratorsグループに含まれているか、
判定可能なFunctionを作成してみました。

## この記事のターゲット

- PowerShellユーザーの方
- 下記の条件の自作Functionを知りたい方
    1. 対象はログインユーザー、もしくは任意のユーザー
    1. （対象のユーザーが）Administratorsグループ、もしくは任意のグループに所属しているか
    1. 確認した結果、グループに所属していれば `True`。所属していない場合は `False` を返すFunction

## 対象のユーザー・グループに所属しているかBool判定するFunction

このFuncitonにおける引数の初期値は、対象ユーザーが「現在のログインユーザー（`$($env:COMPUTERNAME)\$($env:USERNAME)`）」となり、
対象グループは「管理者グループ（`Administrators`）」となっています。

要件に応じて引数やコード本文に手を加えてください。

```powershell:対象ユーザーが指定したグループに所属しているかBool判定するFunction
function Test-AdminMembership {
    param (
        # 初期値は、現在のコンピューター名とユーザー名を設定
        [System.String]$currentUser = "$($env:COMPUTERNAME)\$($env:USERNAME)",
        # 初期値は、Administrators
        [System.String]$groupName = 'Administrators'
    )
    # 対象グループのメンバーを取得
    $adminMembers = (Get-LocalGroupMember -Name $groupName)

    # 現在のユーザーがAdministratorsグループに含まれているか確認
    $isAdmin = $adminMembers.Name -contains $currentUser

    return $isAdmin
}
```

## 実際に実行した結果

### 引数無しの初期値で動作検証した結果

```powershell:コピー用
if (Test-AdminMembership) {
    Write-Output "現在のユーザー「$($env:USERNAME)」は Administrators グループに所属しています。"
} else {
    Write-Output "現在のユーザー「$($env:USERNAME)」は Administrators グループに所属していません。"
}
```

```powershell:事前にAdministratorsグループに所属するユーザーを確認
PS C:\Users\"ユーザー名"> Get-LocalGroupMember -Name Administrators

ObjectClass Name                     PrincipalSource
----------- ----                     ---------------
ユーザー    "コンピューター名"\Administrator   Local
ユーザー    "コンピューター名"\"ユーザー名" Local


PS C:\Users\"ユーザー名">
```

```powershell:引数無しの初期値で動作検証した結果
PS C:\Users\"ユーザー名"> if (Test-AdminMembership) {
>>     Write-Output "現在のユーザー「$($env:USERNAME)」は Administrators グループに所属しています。"
>> } else {
>>     Write-Output "現在のユーザー「$($env:USERNAME)」は Administrators グループに所属していません。"
>> }
現在のユーザー「"ユーザー名"」は Administrators グループに所属しています。
PS C:\Users\"ユーザー名">
```

### 任意のユーザー名・グループ名で動作検証した結果

```powershell:コピー用
$userName = 'HOMEPC\Ichitaro'
$groupName = 'Users'
if (Test-AdminMembership $userName) {
    Write-Output "現在のユーザー「$userName」は $groupName グループに所属しています。"
} else {
    Write-Output "現在のユーザー「$userName」は $groupName グループに所属していません。"
}
```

```powershell:事前にUsersグループに所属するユーザーを確認
PS C:\Users\"ユーザー名"> Get-LocalGroupMember -Name Users

ObjectClass Name                             PrincipalSource
----------- ----                             ---------------
グループ    NT AUTHORITY\Authenticated Users Unknown
グループ    NT AUTHORITY\INTERACTIVE         Unknown
ユーザー    "コンピューター名"\"ユーザー名"         Local


PS C:\Users\"ユーザー名">
```

```powershell:任意のユーザー名・グループ名で動作検証した結果
PS C:\Users\"ユーザー名"> $userName = 'HOMEPC\Ichitaro'
>> $groupName = 'Users'
>> if (Test-AdminMembership $userName) {
>>     Write-Output "現在のユーザー「$userName」は $groupName グループに所属しています。"
>> } else {
>>     Write-Output "現在のユーザー「$userName」は $groupName グループに所属していません。"
>> }
現在のユーザー「HOMEPC\Ichitaro」は Users グループに所属していません。
PS C:\Users\"ユーザー名">
```

## まとめ

- Windowsのグループに所属するユーザーを確認するコマンドレットは…
    「`Get-LocalGroupMember`」

- 自作Function「`Test-AdminMembership`」により…
    現在のログインユーザーが管理者グループに所属しているかBoolで判定可能。
    引数を指定することでユーザーとグループの条件を変更可能。

という感じです。

もう少し肉付けするとなるとローカルユーザーのみで判定する場合は、コンピューター名を除いた形式で、
引数を指定する仕様にしたり、
判定する前に指定されたグループが存在するかチェックするなども考慮した方がいいかもしれません。

要件にあわせて変更してみてください 🤖

## 関連記事

https://haretokidoki-blog.com/pasocon_powershell-startup/
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960
https://zenn.dev/haretokidoki/articles/fb6830f9155de5

---
title: "[PowerShell]Markdownã®ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã§å„åˆ—ã®é–‹å§‹ä½ç½®ã‚’åˆã‚ã›æ•´å½¢ã™ã‚‹Function"
emoji: "ğŸ“˜"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell", "markdown"]
published: true
---
## æ¦‚è¦

Markdownã®ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã‚’ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§è¡¨ç¤ºã™ã‚‹ã¨ã€åˆ—ã®é–‹å§‹ä½ç½®ãŒãƒãƒ©ãƒãƒ©ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
è¦–èªæ€§ã‚’å‘ä¸Šã™ã‚‹ãŸã‚ã€å†…å®¹ã¯å¤‰ãˆãšã«ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚’æƒãˆã¦ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’æ•´ç†ã™ã‚‹Functionã‚’ä½œæˆã€‚

ã“ã®è¨˜äº‹ã®ã‚³ãƒ¼ãƒ‰ã¯PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯ãªãã€PowerShellã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚„ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãªã©ã® **ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Šã§ã®å®Ÿè¡Œ** ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚

## ã“ã®è¨˜äº‹ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

- PowerShellãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–¹
- Markdownãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã‚’æƒãˆã¦ã‚³ãƒ¼ãƒ‰ã®è¦–èªæ€§ã‚’ä¸Šã’ãŸã„æ–¹

## ç’°å¢ƒ

### PowerShell 5.1

```powershell:PowerShell 5.1
PS C:\WINDOWS\system32> $PSVersionTable

Name                           Value
----                           -----
PSVersion                      5.1.19041.4046
PSEdition                      Desktop
PSCompatibleVersions           {1.0, 2.0, 3.0, 4.0...}
BuildVersion                   10.0.19041.4046
CLRVersion                     4.0.30319.42000
WSManStackVersion              3.0
PSRemotingProtocolVersion      2.3
SerializationVersion           1.1.0.1


PS C:\WINDOWS\system32>
```

### PowerShell 7ï¼ˆ2025.06.10 è¿½è¨˜ï¼‰

```powershell:PowerShell 7
PS C:\Users\XXXX> $PSVersionTable

Name                           Value
----                           -----
PSVersion                      7.5.1
PSEdition                      Core
GitCommitId                    7.5.1
OS                             Microsoft Windows 10.0.19045
Platform                       Win32NT
PSCompatibleVersions           {1.0, 2.0, 3.0, 4.0â€¦}
PSRemotingProtocolVersion      2.3
SerializationVersion           1.1.0.1
WSManStackVersion              3.0

PS C:\Users\XXXX>
```

## è‡ªä½œã—ãŸã‚³ãƒ¼ãƒ‰

:::message
**2025.06.10 PowerShell 7ã§ã‚‚å‹•ä½œã™ã‚‹ã‚ˆã†å¤‰æ›´**

è¨˜äº‹ã‚’ä½œæˆã—ãŸå½“åˆã¯Windows 10/11 ã§æ¨™æº–æ­è¼‰ã—ã¦ã„ã‚‹ **Windows PowerShell 5.1** å‘ã‘ã«æŠ•ç¨¿ã—ã¾ã—ãŸãŒã€
2025å¹´6æœˆ10æ—¥ç¾åœ¨ã€æœ€æ–°ã® **PowerShell 7** ã§ä½œæ¥­ã™ã‚‹äº‹ãŒå¤šããªã‚Šã€ã“ã“ã§ç´¹ä»‹ã—ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ãŸçµæœã€ä¸‹è¨˜ã®ç®‡æ‰€ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

`[System.Byte[]]$first_3bytes = (Get-Content -Path $FilePath -Encoding Byte -TotalCount 3)`

ãã®ç‚ºã€**PowerShell 7** ã¨ **Windows PowerShell 5.1** ã®ä¸¡æ–¹ã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ä¸‹è¨˜ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¦ã„ã¾ã™ã€‚

```diff powershell
Function Test-UTF8Bom {
    param (
        [Parameter(Mandatory=$true)][System.String]$FilePath
    )
    
    # BOMã®ãƒã‚¤ãƒˆã‚·ãƒ¼ã‚±ãƒ³ã‚¹
    $UTF8_BOM = [System.Byte[]](0xEF, 0xBB, 0xBF)
    
-    # å…ˆé ­è¡Œã‚’ãƒã‚¤ãƒˆã§èª­ã¿è¾¼ã¿å…ˆé ­ã‹ã‚‰3ãƒã‚¤ãƒˆåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
-    [System.Byte[]]$first_3bytes = (Get-Content -Path $FilePath -Encoding Byte -TotalCount 3)
-    
-    # å…ˆé ­ãƒã‚¤ãƒˆã§BOMä»˜ãã‹åˆ¤å®š
-    if ($null -eq (Compare-Object $first_3bytes $UTF8_BOM -SyncWindow 0)) {
+    $fileBytes = [System.IO.File]::ReadAllBytes($FilePath)
+    if ($fileBytes[0..2] -join "," -eq $UTF8_BOM -join ",") {
        return $true
    } else {
        return $false
    }
}
```

:::

```powershell:è‡ªä½œã—ãŸFunction
# ã‚µãƒ–Function
Function Test-UTF8Bom {
    param (
        [Parameter(Mandatory=$true)][System.String]$FilePath
    )
    
    # BOMã®ãƒã‚¤ãƒˆã‚·ãƒ¼ã‚±ãƒ³ã‚¹
    $UTF8_BOM = [System.Byte[]](0xEF, 0xBB, 0xBF)
    
    # ãƒã‚¤ãƒˆãƒ‡ãƒ¼ã‚¿ã§èª­ã¿è¾¼ã¿
    $fileBytes = [System.IO.File]::ReadAllBytes($FilePath)
    # å…ˆé ­ã‹ã‚‰3ãƒã‚¤ãƒˆåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã§BOMä»˜ãã‹åˆ¤å®š
    if ($fileBytes[0..2] -join "," -eq $UTF8_BOM -join ",") {
        return $true
    } else {
        return $false
    }
}
# ãƒ¡ã‚¤ãƒ³Function
Function Format-MarkdownTableColumnWidth {
    param (
        [System.String]$FilePath
    )

    # æ–‡å­—ã‚³ãƒ¼ãƒ‰ã®åˆ¤å®š
    if (-not (Test-UTF8Bom $FilePath)) {
        Write-Warning 'Not UTF8 BOM'
        return $null
    }

    # ãƒãƒ«ãƒãƒã‚¤ãƒˆæ–‡å­—ã‚’è€ƒæ…®ã—ã¦æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
    Function Get-DisplayWidth {
        param (
            [string]$InputString
        )
        $width = 0

        foreach ($char in $InputString.ToCharArray()) {
            if ([System.Text.Encoding]::UTF8.GetByteCount($char) -gt 1) {
                # ãƒãƒ«ãƒãƒã‚¤ãƒˆæ–‡å­—ã®å ´åˆã¯2æ–‡å­—åˆ†ã¨ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆ
                $width += 2
            } else {
                # ã‚·ãƒ³ã‚°ãƒ«ãƒã‚¤ãƒˆæ–‡å­—ã®å ´åˆã¯1æ–‡å­—åˆ†ã¨ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆ
                $width += 1
            }
        }

        return $width
    }


    # ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å…¥åŠ›ã‚’èª­ã¿è¾¼ã‚€
    $MarkdownTable = (Get-Content -Path $FilePath -Raw)

    # å…¥åŠ›ã‚’è¡Œã”ã¨ã«åˆ†å‰²
    $lines = $MarkdownTable -split "`n"

    # å„åˆ—ã®æœ€å¤§å¹…ã‚’è¨ˆç®—
    $maxWidths = @{}
    foreach ($line in $lines) {
        if (-not ([System.String]::IsNullOrWhiteSpace($line))) {
            $columns = $line -split '\|'
            for ($i = 1; $i -lt $columns.Length - 1; $i++) {
                $column = $columns[$i].Trim()
                $byteLength = (Get-DisplayWidth $column)
                if (-not $maxWidths.ContainsKey($i)) {
                    $maxWidths[$i] = $byteLength
                } else {
                    if ($byteLength -gt $maxWidths[$i]) {
                        $maxWidths[$i] = $byteLength
                    }
                }
            }
        }
    }

    # åˆ—ã®å¹…ã‚’æƒãˆã¦å†æ§‹ç¯‰
    $alignedTable = @()
    foreach ($line in $lines) {
        if (-not ([System.String]::IsNullOrWhiteSpace($line))) {
            $columns = $line -split '\|'
            $newLine = '|'
            for ($i = 1; $i -lt $columns.Length - 1; $i++) {
                $column = $columns[$i].Trim()
                $padding = " " * ($maxWidths[$i] - (Get-DisplayWidth $column))
                $newLine += " " + $column + $padding + ' |'
            }
            $alignedTable += $newLine
        }
    }

    return $alignedTable -join "`r`n"
}
```

## å¯¾å¿œæ–¹æ³•

1. PowerShellã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã€ã‚‚ã—ãã¯ã‚¿ãƒ¼ãƒŸãƒŠãƒ«çµŒç”±ã§ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’èµ·å‹•

1. è‡ªä½œã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã«ã‚³ãƒ”ãƒš

1. å…¥å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã‚’å®šç¾©

    ```powershell:å…¥å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®šç¾©
    # å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’æŒ‡å®š
    $inputFilePath = "D:\Downloads\input_markdowntable.md"
    $outputFilePath = "D:\Downloads\output_markdowntable.md"
    ```

1. å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—æŒ‡å®šã®å ´æ‰€ã«ä¿å­˜

    ãã‚Œãã‚Œã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆãŒã‚ºãƒ¬ã¦ã„ã‚‹çŠ¶æ…‹ã‚’ä½œæˆ

    ```markdown:å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã€Œinput_markdowntable.mdã€
    | column-A | column-B | column-C |
    | --- | --- | --- |
    | value-A1 | B1 | C1 |
    | A2 | column-B2 | C2 |
    | A3 | B3 | column-C3 |

    ```

1. è‡ªä½œã®ã‚³ãƒ¼ãƒ‰ï¼ˆFunctionï¼‰ã‚’å‘¼ã³å‡ºã—ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã§ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›

    ```powershell:è‡ªä½œFunctionã®å‘¼ã³å‡ºã—
    # é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦çµæœã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›
    Format-MarkdownTableColumnWidth $inputFilePath > $outputFilePath
    ```

1. ã‚ã‚‰ã‹ã˜ã‚è¨­å®šã—ãŸå‡ºåŠ›å…ˆã‚’ç¢ºèªã—ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆãŒåˆã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

    ```markdown:å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã€Œoutput_markdowntable.mdã€
    | column-A | column-B  | column-C  |
    | ---      | ---       | ---       |
    | value-A1 | B1        | C1        |
    | A2       | column-B2 | C2        |
    | A3       | B3        | column-C3 |

    ```

## ã¾ã¨ã‚

æ‰‹ä½œæ¥­ã§ã‚„ã£ã¦ã„ãŸã“ã¨ã‚’ã‚³ãƒ¼ãƒ‰åŒ–ã€‚é•·æœŸé‹ç”¨ã—ã¦ã„ãªã„ã®ã§å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚±ãƒ¼ã‚¹ã«ã‚ˆã‚Šã€
ä¸å…·åˆãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

## å‚è€ƒæ–‡çŒ®

ãªã—

## é–¢é€£è¨˜äº‹

https://haretokidoki-blog.com/pasocon_powershell-startup/
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960
https://zenn.dev/haretokidoki/articles/fb6830f9155de5

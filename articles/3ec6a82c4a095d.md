---
title: "[PowerShell]Markdownã®ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã§å„åˆ—ã®å¹…ã‚’æƒãˆã‚‹Function"
emoji: "ğŸ“˜"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: false
---
## æ¦‚è¦

åˆ—ã®å¹…ãŒãƒãƒ©ãƒãƒ©ã«ãªã£ã¦ã„ã‚‹Markdownã®ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã®é–‹å§‹ä½ç½®ã‚’åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã§æ•´é “ã™ã‚‹Funcitonã‚’ä½œæˆã€‚

```powershell:
# UTF8 BOMä»˜ãã‹åˆ¤å®šã™ã‚‹Function
function Test-UTF8Bom {
    param (
        [Parameter(Mandatory=$true)][System.String]$FilePath
    )
    
    # BOMã®ãƒã‚¤ãƒˆã‚·ãƒ¼ã‚±ãƒ³ã‚¹
    $UTF8_BOM = [System.Byte[]](0xEF,0xBB,0xBF)
    
    # å…ˆé ­è¡Œã‚’ãƒã‚¤ãƒˆã§èª­ã¿è¾¼ã¿å…ˆé ­ã‹ã‚‰3ãƒã‚¤ãƒˆåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    [System.Byte[]]$first_4bytes = (Get-Content -Path $FilePath -Encoding Byte -TotalCount 4)
    [System.Byte[]]$first_3bytes = $first_4bytes[0..2]
    [System.Byte[]]$first_2bytes = $first_4bytes[0..1]
    
    # å…ˆé ­ãƒã‚¤ãƒˆã§BOMä»˜ãã‹åˆ¤å®š
    # UTF-8
    if ($null -eq (Compare-Object $first_3bytes $UTF8_BOM -SyncWindow 0)) {
        return $true
    }
    else {
        return $false
    }
}
function Format-MarkdownTableColumnWidth {
    param (
        [System.String]$FilePath
    )

    # æ–‡å­—ã‚³ãƒ¼ãƒ‰ã®åˆ¤å®š
    if (-not (Test-UTF8Bom $FilePath)) {
        Write-Warning 'Not UTF8 BOM'
        return
    }

    # ãƒãƒ«ãƒãƒã‚¤ãƒˆæ–‡å­—ã‚’è€ƒæ…®ã—ã¦æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
    function Get-ByteLength {
        param (
            [string]$InputString
        )
        $length = 0
        foreach ($char in $InputString.ToCharArray()) {
            if ([System.Text.Encoding]::UTF8.GetByteCount($char) -gt 1) {
                $length += 2
            } else {
                $length += 1
            }
        }
        return $length
    }

    # ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å…¥åŠ›ã‚’èª­ã¿è¾¼ã‚€
    $MarkdownTable = (Get-Content -Path $FilePath -Raw)

    # å…¥åŠ›ã‚’è¡Œã”ã¨ã«åˆ†å‰²
    $lines = $MarkdownTable -split "`n"

    # å„åˆ—ã®æœ€å¤§å¹…ã‚’è¨ˆç®—
    $maxWidths = @{}
    foreach ($line in $lines) {
        if (-not ([System.String]::IsNullOrWhiteSpace($line))) {
            $columns = $line -split '\|'
            for ($i = 1; $i -lt $columns.Length - 1; $i++) {
                $column = $columns[$i].Trim()
                $byteLength = (Get-ByteLength $column)
                if (-not $maxWidths.ContainsKey($i)) {
                    $maxWidths[$i] = $byteLength
                } else {
                    if ($byteLength -gt $maxWidths[$i]) {
                        $maxWidths[$i] = $byteLength
                    }
                }
            }
        }
    }

    # åˆ—ã®å¹…ã‚’æƒãˆã¦å†æ§‹ç¯‰
    $alignedTable = @()
    foreach ($line in $lines) {
        if ($line.Trim() -eq "") { continue } # ç©ºè¡Œã‚’ç„¡è¦–
        $columns = $line -split '\|'
        $newLine = "|"
        for ($i = 1; $i -lt $columns.Length - 1; $i++) {
            $column = $columns[$i].Trim()
            $padding = " " * ($maxWidths[$i] - (Get-ByteLength $column))
            $newLine += " " + $column + $padding + " |"
        }
        $alignedTable += $newLine
    }

    # ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚ŒãŸç‰¹æ®Šæ–‡å­—ã‚’å…ƒã«æˆ»ã™
    $alignedTable = $alignedTable -join "`r`n" -replace '\\\$', '\$' -replace '\\\|', '\|' -replace '\\\*', '\*' -replace '\\_', '_'
    
    return $alignedTable
}

# å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’æŒ‡å®š
$inputFilePath = "D:\Downloads\input_markdowntable.md"
$outputFilePath = "D:\Downloads\output_markdowntable.md"

# é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦çµæœã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›
Format-MarkdownTableColumnWidth $inputFilePath > $outputFilePath
```

```markdown:å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã€Œinput_markdowntable.mdã€
| column-A | column-B | column-C |
| --- | --- | --- |
| value-A1 | B1 | C1 |
| A2 | column-B2 | C2 |
| A3 | B3 | column-C3 |

```

```markdown:å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã€Œoutput_markdowntable.mdã€
| column-A | column-B  | column-C  |
| ---      | ---       | ---       |
| value-A1 | B1        | C1        |
| A2       | column-B2 | C2        |
| A3       | B3        | column-C3 |

```

---
title: "[PowerShell]Markdownのテーブル形式で各列の幅を揃えるFunction"
emoji: "📘"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["powershell"]
published: false
---
## 概要

列の幅がバラバラになっているMarkdownのテーブル形式の開始位置を半角スペースで整頓するFuncitonを作成。

```powershell:
Function Format-MarkdownTableColumnWidth {
    param (
        [System.String]$FilePath
    )

    # マルチバイト文字を考慮して文字列のバイト数を計算する関数
    function Get-ByteLength {
        param (
            [string]$InputString
        )
        $length = 0
        foreach ($char in $InputString.ToCharArray()) {
            if ([System.Text.Encoding]::UTF8.GetByteCount($char) -gt 1) {
                $length += 2
            } else {
                $length += 1
            }
        }
        return $length
    }

    # ファイルから入力を読み込む
    $MarkdownTable = (Get-Content -Path $FilePath -Raw)

    # 入力を行ごとに分割
    $lines = $MarkdownTable -split "`n"

    # 各列の最大幅を計算
    $maxWidths = @{}
    foreach ($line in $lines) {
        $columns = $line -split '\|'
        for ($i = 1; $i -lt $columns.Length - 1; $i++) {
            $column = $columns[$i].Trim()
            $byteLength = Get-ByteLength $column
            if (-not $maxWidths.ContainsKey($i)) {
                $maxWidths[$i] = $byteLength
            } else {
                if ($byteLength -gt $maxWidths[$i]) {
                    $maxWidths[$i] = $byteLength
                }
            }
        }
    }

    # 列の幅を揃えて再構築
    $alignedTable = @()
    foreach ($line in $lines) {
        $columns = $line -split '\|'
        $newLine = "|"
        for ($i = 1; $i -lt $columns.Length - 1; $i++) {
            $column = $columns[$i].Trim()
            $padding = " " * ($maxWidths[$i] - (Get-ByteLength $column))
            $newLine += " " + $column + $padding + " |"
        }
        $alignedTable += $newLine
    }

    # エスケープされた$記号を元に戻す
    $alignedTable = $alignedTable -join "`r`n" -replace '\\\$', '\$'
    
    return $alignedTable
}

# 入力ファイルのパスを指定
$inputFilePath = "D:\Downloads\input_markdowntable.md"
$outputFilePath = "D:\Downloads\output_markdowntable.md"

# 関数を呼び出して結果をファイルに出力
Format-MarkdownTableColumnWidth $inputFilePath > $outputFilePath
```

```markdown:input_markdowntable.md
| ランキング | ドメイン名       | ドメインパワー | サイト説明 | 運営会社       | 本社所在地 | 株価 (2024年7月22日) |
|------------|------------------|----------------|------------|----------------|------------|----------------------|
| 1          | google.com              | 100            | 検索エンジン、広告、クラウドサービス | Alphabet Inc.  | アメリカ   | \$181\.67             |
| 2          | youtube.com            | 99             | 動画共有プラットフォーム | Alphabet Inc.  | アメリカ   | \$181\.67             |
| 3          | facebook.com          | 98             | ソーシャルネットワーキングサービス | Meta Platforms, Inc. | アメリカ   | \$487\.40             |
| 4          | twitter.com            | 97             | マイクロブログサービス | X Corp.        | アメリカ   | 非公開               |
| 5          | instagram.com        | 96             | 写真・動画共有プラットフォーム | Meta Platforms, Inc.) | アメリカ   | \$487\.40             |
| 6          | wikipedia.org        | 95             | オンライン百科事典 | Wikimedia      | アメリカ   | 非営利               |
| 7          | amazon.com              | 94             | 電子商取引、クラウドコンピューティング | Amazon.com, Inc.| アメリカ   | \$182\.55             |

```

```markdown:output_markdowntable.md
| ランキング   | ドメイン名         | ドメインパワー   | サイト説明                             | 運営会社              | 本社所在地   | 株価 (2024年7月22日)   |
| ------------ | ------------------ | ---------------- | ------------                           | ----------------      | ------------ | ---------------------- |
| 1            | google.com         | 100              | 検索エンジン、広告、クラウドサービス   | Alphabet Inc.         | アメリカ     | \$181\.67              |
| 2            | youtube.com        | 99               | 動画共有プラットフォーム               | Alphabet Inc.         | アメリカ     | \$181\.67              |
| 3            | facebook.com       | 98               | ソーシャルネットワーキングサービス     | Meta Platforms, Inc.  | アメリカ     | \$487\.40              |
| 4            | twitter.com        | 97               | マイクロブログサービス                 | X Corp.               | アメリカ     | 非公開                 |
| 5            | instagram.com      | 96               | 写真・動画共有プラットフォーム         | Meta Platforms, Inc.) | アメリカ     | \$487\.40              |
| 6            | wikipedia.org      | 95               | オンライン百科事典                     | Wikimedia             | アメリカ     | 非営利                 |
| 7            | amazon.com         | 94               | 電子商取引、クラウドコンピューティング | Amazon.com, Inc.      | アメリカ     | \$182\.55              |
|

```

---
title: "[PowerShell]â€œMarkdownã®ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼â€ã¨â€œExcelãƒ•ã‚¡ã‚¤ãƒ«â€ã‚’ç›¸äº’å¤‰æ›ã§ãã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ"
emoji: "ğŸŒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell", "markdown", "excel"]
published: false
---
## æ¦‚è¦

Excel ã®ã‚¢ãƒ‰ã‚ªãƒ³ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹ä»•äº‹åŠ¹ç‡åŒ–ã®ãƒ„ãƒ¼ãƒ«ã‚’å°å…¥ã™ã‚‹ã¨ã€ã€ŒExcelãƒ•ã‚¡ã‚¤ãƒ« ã‹ã‚‰ Markdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ« ã¸ã®å¤‰æ›ã€ã¯ç°¡å˜ã«å®Ÿç¾ã§ãã¾ã—ãŸãŒã€
2024å¹´6æœˆç¾åœ¨ã€èª¿ã¹ãŸã‹ãã‚Šã€ŒMarkdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ« ã‹ã‚‰ Excelãƒ•ã‚¡ã‚¤ãƒ« ã¸ã®å¤‰æ›ã€ã«ã¤ã„ã¦ã¯ã‚ªãƒ³ãƒ©ã‚¤ãƒ³Webãƒ„ãƒ¼ãƒ« ã‚„ Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆ ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚

ã¨ãã«ã‚ªãƒ³ãƒ©ã‚¤ãƒ³Webãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹éš›ã€æ©Ÿå¯†æƒ…å ±ã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¯å±é™ºã§ã™ã€‚
ã¾ãŸã€Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã¯ã€ï¼ˆãã“ã¾ã§é›£ã—ããªã„ã§ã™ãŒï¼‰å®Ÿè¡Œç’°å¢ƒãŒå¿…è¦ã ã£ãŸã‚Šã—ã¾ã™ã€‚

ãã“ã§ä»Šå›ã€Windowsç’°å¢ƒã«ãŠã„ã¦æ¨™æº–æ­è¼‰ã•ã‚Œã¦ã„ã‚‹PowerShellã§å®Ÿç¾ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## ã“ã®è¨˜äº‹ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

- Windows OS ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–¹
- Markdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ« ã‹ã‚‰ Excelãƒ•ã‚¡ã‚¤ãƒ« ã«å¤‰æ›ã—ãŸã„æ–¹
    ã¾ãŸã¯ã€
- Excelãƒ•ã‚¡ã‚¤ãƒ« ã‹ã‚‰ Markdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ« ã«å¤‰æ›ã—ãŸã„æ–¹

## å¯¾å¿œæ–¹æ³•

Windows OSã§ã¯ã€ã™ãã«PowerShellã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
ãŸã ã€ä»Šå›ä½œæˆã—ãŸPowerShellã‚³ãƒ¼ãƒ‰ã§ã¯ã€Excelã‚’å–ã‚Šæ‰±ã†ãŸã‚ã«å°‚ç”¨ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’äº‹å‰ã«å°å…¥ãŒå¿…è¦ã€‚

ãªãŠã€ãã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹éš›ã¯ã€ç®¡ç†è€…æ¨©é™ã§ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã€Œ`Install-Module`ã€ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### äº‹å‰æº–å‚™

PowerShellã§Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ¶å¾¡ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ç‚ºã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€ãŒå¿…è¦ã§ã™ã€‚

ä¸‹è¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¯èƒ½ã€‚
ãªãŠã€ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹PowerShellã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¯â€œç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œâ€ã§èµ·å‹•ï¼ˆ**ç®¡ç†è€…æ¨©é™**ï¼‰ãŒå¿…è¦ã§ã™ã€‚

```powershell:PowerShellã§Excelãƒ•ã‚¡ã‚¤ãƒ«ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€
#################################################################################
# å‡¦ç†åã€€ | Test-ModuleInstalled
# æ©Ÿèƒ½ã€€ã€€ | ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å°å…¥æœ‰ç„¡ã‚’ç¢ºèª
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/0a94c0f83bd428
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Booleanï¼ˆTrue: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å°å…¥æ¸ˆã¿, False: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æœªå°å…¥ï¼‰
# å¼•æ•°ã€€ã€€ | MoudleName: ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å
#################################################################################
function Test-ModuleInstalled {
    param (
        [System.String]$ModuleName
    )
    $module = (Get-Module -ListAvailable -Name $ModuleName)
    if ($module) {
        return $true
    } else {
        return $false
    }
}
#################################################################################
# å‡¦ç†åã€€ | Test-IsAdmin
# æ©Ÿèƒ½ã€€ã€€ | PowerShellãŒç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã—ã¦ã„ã‚‹ã‹ç¢ºèª
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/67788ca9b47b27
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Booleanï¼ˆTrue: ç®¡ç†è€…æ¨©é™ã‚ã‚Š, False: ç®¡ç†è€…æ¨©é™ãªã—ï¼‰
# å¼•æ•°ã€€ã€€ | -
#################################################################################
function Test-IsAdmin {
    $win_id = [System.Security.Principal.WindowsIdentity]::GetCurrent()
    $win_principal = new-object System.Security.Principal.WindowsPrincipal($win_id)
    $admin_permission = [System.Security.Principal.WindowsBuiltInRole]::Administrator
    return $win_principal.IsInRole($admin_permission)
}

# ImportExcel ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
$moduleName = 'ImportExcel'
if (-Not(Test-ModuleInstalled $moduleName)) {
    if (-Not(Test-IsAdmin)) {
        Write-Warning 'ç®¡ç†è€…æ¨©é™ãŒãªã„ç‚ºã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒã§ãã¾ã›ã‚“ã€‚å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚'
        return
    }
    # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®ãŸã‚ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’â€œTLS1.2â€ã«è¨­å®š
    [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
    # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    Install-Module -Name $moduleName -Scope CurrentUser -Force
    Write-Host "$($moduleName) ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸã€‚"
} else {
    Write-Host "$($moduleName) ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã™ã€‚"
}
```

::::details ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€ã‚’ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã„å ´åˆã®æ‰‹é †

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€ãŒä¸è¦ã¨ãªã£ãŸå ´åˆã€ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¯èƒ½ã€‚
ãªãŠã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã¨åŒæ§˜ã« **ç®¡ç†è€…æ¨©é™ãŒå¿…è¦** ã§ã™ã€‚

```powershell:ã‚³ãƒ”ãƒ¼ç”¨
Uninstall-Module -Name ImportExcel -AllVersions
```

```powershell:å®Ÿéš›ã®å®Ÿè¡Œçµæœï¼ˆç®¡ç†è€…æ¨©é™ã§å®Ÿè¡Œï¼‰
# ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‰ï¼šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã“ã¨
PS C:\WINDOWS\system32> Get-Module -ListAvailable -Name ImportExcel


    ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: D:\Documents\WindowsPowerShell\Modules


ModuleType Version    Name                                ExportedCommands
---------- -------    ----                                ----------------
Script     7.8.9      ImportExcel                         {Add-ConditionalFormatting, Add-ExcelChart, Add-ExcelDataV...


PS C:\WINDOWS\system32>
# ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Ÿè¡Œ
PS C:\WINDOWS\system32> Uninstall-Module -Name ImportExcel -AllVersions
PS C:\WINDOWS\system32>
# ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œï¼šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸã“ã¨
PS C:\WINDOWS\system32> Get-Module -ListAvailable -Name ImportExcel
PS C:\WINDOWS\system32>
```

:::details å‚è€ƒæƒ…å ±ï¼šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€ã®ä½¿ç”¨ç›´å¾Œã«ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ

ä»Šå›ç´¹ä»‹ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ãŸç›´å¾Œã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€ã‚’`Uninstall-Module`ã§ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã‚‡ã†ã¨ã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

```powershell:ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼
PS C:\WINDOWS\system32> Uninstall-Module ImportExcel
è­¦å‘Š: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ '7.8.9' ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« 'ImportExcel'
ã¯ç¾åœ¨ä½¿ç”¨ä¸­ã§ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’çµ‚äº†ã—ãŸå¾Œã§ã€æ“ä½œã‚’ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„ã€‚
PackageManagement\Uninstall-Package : ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« 'ImportExcel' ã¯ç¾åœ¨ä½¿ç”¨ä¸­ã‹ã€å¿…è¦ãªã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
ç™ºç”Ÿå ´æ‰€ C:\Program Files\WindowsPowerShell\Modules\PowerShellGet\1.0.0.1\PSModule.psm1:2194 æ–‡å­—:21
+ ...        $null = PackageManagement\Uninstall-Package @PSBoundParameters
+                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (Microsoft.Power...ninstallPackage:UninstallPackage) [Uninstall-Packag
   e]ã€Exception
    + FullyQualifiedErrorId : ModuleIsInUse,Uninstall-Package,Microsoft.PowerShell.PackageManagement.Cmdlets.Uninstall
   Package

PS C:\WINDOWS\system32>
```

ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã®ã¯ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ãŸæ™‚ã®ã¿ç™ºç”Ÿã™ã‚‹äº‹ã‚’ç¢ºèªã€‚
ãŠãã‚‰ãã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è§£æ”¾å‡¦ç†ã§å•é¡ŒãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚æ˜ç¤ºçš„ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’é–‹æ”¾ã™ã‚‹æ–¹æ³•ã‚’æ¢ã—ã¾ã—ãŸãŒã€
è¦‹ã¤ã‘ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚

ã“ã®ã‚ˆã†ãªã‚±ãƒ¼ã‚¹ã«ãªã£ãŸå ´åˆã¯ã€å¤‰æ›å‡¦ç†ã‚’å®Ÿè¡Œã—ãŸã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆPowerShellã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ ã‚„ Windowsã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãªã©ï¼‰ã‚’é–‰ã˜ã¦å†åº¦ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç«‹ã¡ä¸Šã’ã¦ã‹ã‚‰ `Uninstall-Module` ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

:::

::::

### Markdown-Table -> Excelãƒ•ã‚¡ã‚¤ãƒ« ã«å¤‰æ›

```powershell:Markdownå½¢å¼ ã‹ã‚‰ Excelãƒ•ã‚¡ã‚¤ãƒ« ã«å¤‰æ›ã™ã‚‹ã‚³ãƒ¼ãƒ‰
#################################################################################
# å‡¦ç†åã€€ | Test-FileLocked
# æ©Ÿèƒ½ã€€ã€€ | ãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‹ã‚Œã¦ã„ã‚‹ã‹ï¼ˆãƒ­ãƒƒã‚¯çŠ¶æ…‹ã‚’ï¼‰ç¢ºèª
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/b4f4399570000a
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Boolean
#     ã€€ã€€ |  True: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦ã„ã‚‹çŠ¶æ…‹ï¼ˆãƒ­ãƒƒã‚¯çŠ¶æ…‹ï¼‰, False: é–‹ã„ã¦ã„ãªã„çŠ¶æ…‹
# å¼•æ•°ã€€ã€€ | -
#################################################################################
function Test-FileLocked {
    param (
        [Parameter(Mandatory=$true)][System.String]$Path
    )

    if (-Not(Test-Path $Path)) {
        Write-Error 'å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚' -ErrorAction Stop
    }

    # ç›¸å¯¾ãƒ‘ã‚¹ã ã¨Openãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£å¸¸å‹•ä½œã—ãªã„ç‚ºã€çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›
    $fullPath = (Resolve-Path -Path $Path -ErrorAction SilentlyContinue).Path

    $fileLocked = $false
    try {
        # èª­ã¿å–ã‚Šå°‚ç”¨ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãå‡¦ç†ã‚’å®Ÿè¡Œ
        $fileStream = [System.IO.File]::Open($fullPath, 'Open', 'ReadWrite', 'None')
    }
    catch {
        # ãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‘ãªã„å ´åˆã€ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã¨åˆ¤æ–­
        $fileLocked = $true
    }
    finally {
        if ($null -ne $fileStream) {
            $fileStream.Close()
        }
    }

    return $fileLocked
}

# ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å¤‰æ›ã™ã‚‹å‡¦ç†
function Get-ExcelTable {
    param (
        [Parameter(Mandatory=$true)]
        [string]$FromMarkdownPath
    )

    # å†…å®¹ã‚’èª­ã¿å–ã‚‹
    $inputContents = (Get-Content $FromMarkdownPath -Raw)

    # è¡¨ã®é–‹å§‹ã¨çµ‚äº†ã‚’æ¤œå‡ºã™ã‚‹æ­£è¦è¡¨ç¾
    $tableRegex = '(?smi)^\|.*(?<!\\)\|.*$'
    $headerSplitRegex = '^\|?(.*?)(?<!\\)\|$'
    $rowSplitRegex = '^\|(.+?)(?<!\\)\|$'

    # è¡¨ã®å†…å®¹ã‚’æŠ½å‡ºã—ã¾ã™
    $excelTables = @()
    [regex]::Matches($inputContents, $tableRegex) | ForEach-Object {
        $tableText = $_.Value

        # ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è§£æã—ã¾ã™
        $headerCount = 0
        $rows = @()

        $tableText -split "`n" | ForEach-Object {
            if ($headerCount -eq 0) {
                $header = [regex]::Split($_, '(?<!\\)\|')
                $header = $header[1..($header.Length-2)] # æœ€åˆã¨æœ€å¾Œã®ç©ºã®è¦ç´ ã‚’å‰Šé™¤
                $headerCount += 1
            }
            elseif ($headerCount -eq 1) {
                # ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åŒºåˆ‡ã‚Šè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
                $headerCount += 1
            }
            else {
                $row = [regex]::Split($_, '(?<!\\)\|')
                $row = $row[1..($row.Length-2)] # æœ€åˆã¨æœ€å¾Œã®ç©ºã®è¦ç´ ã‚’å‰Šé™¤
                if ($row.Count -eq $header.Count) {
                    $rows += ,$row
                }
            }
        }

        # å„è¡Œã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã—ã¾ã™
        $rows | ForEach-Object {
            $rowObject = New-Object psobject
            for ($i = 0; $i -lt $header.Count; $i++) {
                $rowObject | Add-Member -MemberType NoteProperty -Name $header[$i].Trim() -Value $_[$i].Trim()
            }
            $excelTables += ,$rowObject
        }
    }

    return $excelTables
}

# Markdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ« ã‹ã‚‰ Excelãƒ•ã‚¡ã‚¤ãƒ« ã«å¤‰æ›ã™ã‚‹Funciton
function Convert-MarkdownTableToExcel {
    param (
        [Parameter(Mandatory=$true)]
        [System.String]$FromMarkdownPath,
        [Parameter(Mandatory=$true)]
        [System.String]$ToExcelPath

    )

    # Markdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ« ã‚’ Excel
    $excelTable = (Get-ExcelTable -FromMarkdownPath $FromMarkdownPath)

    if ($null -eq $excelTable) {
        Write-Error 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚Šã¾ã—ãŸãŒã€ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚'
        return
    }

    if (Test-Path -Path $ToExcelPath) {
        # ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¾ã™
        if (Test-FileLocked -Path $ToExcelPath) {
            Write-Warning 'Excelãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‹ã‚Œã¦ã„ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‰ã˜ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚'
            return
        }

        # å…¥åŠ›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        $userInput = Read-Host 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ (Yes/No)'
        $yesPatterns = '[Yy][Ee][Ss]|[Yy]'
        $noPatterns = '[Nn][Oo]|[Nn]'
        $isYes = $false
        # è©¦è¡Œå›æ•°: 3å›
        $maxCount = 2
        for ($i = 0; $i -lt $maxCount; $i++) {
            if ($userInput -match $yesPatterns) {
                $isYes = $true    
                break
            }
            else {
                Write-Host 'ä¸Šæ›¸ãä¿å­˜ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚'
                return
            }
        }
        if (-Not ($isYes)) {
            Write-Warning 'è©¦è¡Œå›æ•°ã‚’è¶…éã—ã¾ã—ãŸã€‚å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚'
            return
        }

        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œã¯ã„ã€ã‚’é¸æŠã—ãŸå ´åˆã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãä¿å­˜ã—ã¾ã™
        try {
            $excelTable | Export-Excel -Path $toExcelPath -Show
            Write-Host 'ä¸Šæ›¸ãä¿å­˜ã—ã¾ã—ãŸã€‚'
        }
        catch {
            Write-Error 'ä¸Šæ›¸ãä¿å­˜ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'
        }
    }
    else {
        # æ–°è¦ä¿å­˜
        try {
            $excelTable | Export-Excel -Path $toExcelPath -Show
            Write-Host "æ–°è¦ä¿å­˜ã—ã¾ã—ãŸã€‚"
        }
        catch {
            Write-Error 'æ–°è¦ä¿å­˜ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'
        }
    }
}
```

```powershell:
# å®Ÿè¡Œ
$markdownPath = 'D:\Downloads\inputMarkdownTable.md'
$excelPath = 'D:\Downloads\outputExcel.xlsx'
Convert-MarkdownTableToExcel $markdownPath $excelPath
```

### Excelãƒ•ã‚¡ã‚¤ãƒ« -> Markdown-Table ã«å¤‰æ›

```powershell:Excelãƒ•ã‚¡ã‚¤ãƒ« ã‹ã‚‰ Markdownå½¢å¼ ã«å¤‰æ›ã™ã‚‹ã‚³ãƒ¼ãƒ‰
#################################################################################
# å‡¦ç†åã€€ | Test-FileLocked
# æ©Ÿèƒ½ã€€ã€€ | ãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‹ã‚Œã¦ã„ã‚‹ã‹ï¼ˆãƒ­ãƒƒã‚¯çŠ¶æ…‹ã‚’ï¼‰ç¢ºèª
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/b4f4399570000a
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Boolean
#     ã€€ã€€ |  True: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦ã„ã‚‹çŠ¶æ…‹ï¼ˆãƒ­ãƒƒã‚¯çŠ¶æ…‹ï¼‰, False: é–‹ã„ã¦ã„ãªã„çŠ¶æ…‹
# å¼•æ•°ã€€ã€€ | -
#################################################################################
function Test-FileLocked {
    param (
        [Parameter(Mandatory=$true)][System.String]$Path
    )

    if (-Not(Test-Path $Path)) {
        Write-Error 'å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚' -ErrorAction Stop
    }

    # ç›¸å¯¾ãƒ‘ã‚¹ã ã¨Openãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£å¸¸å‹•ä½œã—ãªã„ç‚ºã€çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›
    $fullPath = (Resolve-Path -Path $Path -ErrorAction SilentlyContinue).Path

    $fileLocked = $false
    try {
        # èª­ã¿å–ã‚Šå°‚ç”¨ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãå‡¦ç†ã‚’å®Ÿè¡Œ
        $fileStream = [System.IO.File]::Open($fullPath, 'Open', 'ReadWrite', 'None')
    }
    catch {
        # ãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‘ãªã„å ´åˆã€ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã¨åˆ¤æ–­
        $fileLocked = $true
    }
    finally {
        if ($null -ne $fileStream) {
            $fileStream.Close()
        }
    }

    return $fileLocked
}

function Get-MarkdownTable {
    param (
        [Parameter(Mandatory=$true)]
        [string]$FromExcelPath
    )

    # å†…å®¹ã‚’èª­ã¿å–ã‚‹
    $inputContents = (Import-Excel -Path $FromExcelPath)

    # Markdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ§‹ç¯‰ã—ã¾ã™
    $markdownTables = ''
    #$headers = $inputContents | Get-Member -MemberType NoteProperty | Select-Object -ExpandProperty Name
    $headers = $inputContents[0].PSObject.Properties.Name

    # ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’è¿½åŠ ã—ã¾ã™
    $markdownTables += '| ' + ($headers -join ' | ') + ' |' + "`n"

    # åŒºåˆ‡ã‚Šè¡Œã‚’è¿½åŠ ã—ã¾ã™
    $markdownTables += '| ' + (($headers | ForEach-Object { '---' }) -join ' | ') + ' |' + "`n"

    # ãƒ‡ãƒ¼ã‚¿è¡Œã‚’è¿½åŠ ã—ã¾ã™
    foreach ($row in $inputContents) {
        $rowData = @()
        foreach ($header in $headers) {
            #$cellValue = $row."$header" -replace '\|', '\|' # ãƒ‘ã‚¤ãƒ—æ–‡å­—ã‚’æ­£ã—ãã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
            $cellValue = $row."$header"
            $rowData += $cellValue
        }
        $markdownTables += '| ' + ($rowData -join ' | ') + ' |' + "`n"
    }

    return $markdownTables
}

# Exelãƒ•ã‚¡ã‚¤ãƒ« ã‹ã‚‰ Markdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ« ã«å¤‰æ›ã™ã‚‹Function
function Convert-ExcelToMarkdownTable {
    param (
        [Parameter(Mandatory=$true)]
        [System.String]$FromExcelPath,
        [Parameter(Mandatory=$true)]
        [System.String]$ToMarkdownPath
    )

    $markdownTable = (Get-MarkdownTable -FromExcelPath $FromExcelPath)

    if ($null -eq $markdownTable) {
        Write-Error 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚Šã¾ã—ãŸãŒã€ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚'
        return
    }

    if (Test-Path -Path $ToMarkdownPath) {
        if (Test-FileLocked -Path $ToMarkdownPath) {
            Write-Warning 'Markdownãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‹ã‚Œã¦ã„ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‰ã˜ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚'
            return
        }

        # å…¥åŠ›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        $userInput = Read-Host 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ (Yes/No)'
        $yesPatterns = '[Yy][Ee][Ss]|[Yy]'
        $noPatterns = '[Nn][Oo]|[Nn]'
        $isYes = $false
        # è©¦è¡Œå›æ•°: 3å›
        $maxCount = 2
        for ($i = 0; $i -lt $maxCount; $i++) {
            if ($userInput -match $yesPatterns) {
                $isYes = $true    
                break
            }
            else {
                Write-Host 'ä¸Šæ›¸ãä¿å­˜ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚'
                return
            }
        }
        if (-Not ($isYes)) {
            Write-Warning 'è©¦è¡Œå›æ•°ã‚’è¶…éã—ã¾ã—ãŸã€‚å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚'
            return
        }

        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œã¯ã„ã€ã‚’é¸æŠã—ãŸå ´åˆã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãä¿å­˜ã—ã¾ã™
        try {
            $markdownTable | Out-File -FilePath $ToMarkdownPath -Encoding utf8
            Write-Host 'ä¸Šæ›¸ãä¿å­˜ã—ã¾ã—ãŸã€‚'
        }
        catch {
            Write-Error 'ä¸Šæ›¸ãä¿å­˜ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'
        }
    }
    else {
        # æ–°è¦ä¿å­˜
        try {
            $markdownTable | Out-File -FilePath $ToMarkdownPath -Encoding utf8
            Write-Host "æ–°è¦ä¿å­˜ã—ã¾ã—ãŸã€‚"
        }
        catch {
            Write-Error 'æ–°è¦ä¿å­˜ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'
        }
    }
}
```

```powershell:
# å®Ÿè¡Œ
$excelPath = 'D:\Downloads\inputExcel.xlsx'
$markdownPath = 'D:\Downloads\outputMarkdownTable.md'
Convert-ExcelToMarkdownTable $excelPath $markdownPath
```

---
title: "Markdown-ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ ã¨ Excelãƒ•ã‚¡ã‚¤ãƒ« ã‚’ç›¸äº’å¤‰æ›ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ"
emoji: "ğŸŒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: false
---
èª¿ã¹ãŸé™ã‚Šã€Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å®Ÿç¾ã§ããã†ã ãŒã€PowerShellã®ã¿ã§å®Ÿç¾ã§ãã‚‹ã‚“ã ã£ãŸã‚‰ã€
è‡ªä½œFunctionã‚’ä½œæˆã™ã‚‹ã¨ä¾¿åˆ©ãã†ã€‚

Markdownã®è¡¨ã‚’è§£æã—ã¦Excelã«å¤‰æ›ã™ã‚‹ãŸã‚ã®PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€Markdownãƒ•ã‚¡ã‚¤ãƒ«å†…ã®è¡¨ã‚’æ¤œå‡ºã—ã€ãã‚Œã‚’Excelãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ›ã—ã¾ã™ã€‚`ImportExcel`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€Excelãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆã‚’è¡Œã„ã¾ã™ã€‚

```powershell
#################################################################################
# å‡¦ç†åã€€ | isAdminPowerShell
# æ©Ÿèƒ½ã€€ã€€ | PowerShellãŒç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã—ã¦ã„ã‚‹ã‹ç¢ºèª
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/67788ca9b47b27
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Booleanï¼ˆTrue: ç®¡ç†è€…æ¨©é™ã‚ã‚Š, False: ç®¡ç†è€…æ¨©é™ãªã—ï¼‰
# å¼•æ•°ã€€ã€€ | -
#################################################################################
function isAdminPowerShell {
    $win_id = [System.Security.Principal.WindowsIdentity]::GetCurrent()
    $win_principal = new-object System.Security.Principal.WindowsPrincipal($win_id)
    $admin_permission = [System.Security.Principal.WindowsBuiltInRole]::Administrator
    return $win_principal.IsInRole($admin_permission)
}

function 
# ImportExcel ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã€å¿…è¦ã«å¿œã˜ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™
if (-not (Get-Module -ListAvailable -Name ImportExcel)) {
    if (-Not(isAdminPowerShell)) {
        Write-Warning 'ç®¡ç†è€…æ¨©é™ãŒãªã„ç‚ºã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒã§ãã¾ã›ã‚“ã€‚å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚'
        return
    }
    [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
    Install-Module -Name ImportExcel -Scope CurrentUser -Force
    Write-Host 'ImportExcel ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸã€‚'
} else {
    Write-Host 'ImportExcel ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã™ã€‚'
}

# Markdownãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
$markdownPath = 'D:\Downloads\inputMarkdownTable.md'

# Excelãƒ•ã‚¡ã‚¤ãƒ«ã®å‡ºåŠ›ãƒ‘ã‚¹
$excelPath = 'D:\Downloads\outputExcelData.xlsx'

# Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã™
$markdownContent = Get-Content $markdownPath -Raw

# è¡¨ã‚’è§£æã™ã‚‹é–¢æ•°ã‚’å®šç¾©ã—ã¾ã™
Function Convert-MarkdownTableToExcel {
    param(
        [Parameter(Mandatory=$true)]
        [string]$markdownContent
    )

    # è¡¨ã®é–‹å§‹ã¨çµ‚äº†ã‚’æ¤œå‡ºã™ã‚‹æ­£è¦è¡¨ç¾
    $tableRegex = '(?smi)^\|.*(?<!\\)\|.*$'
    $headerSplitRegex = '^\|?(.*?)(?<!\\)\|$'
    $rowSplitRegex = '^\|(.+?)(?<!\\)\|$'

    # è¡¨ã®å†…å®¹ã‚’æŠ½å‡ºã—ã¾ã™
    $tables = @()
    [regex]::Matches($markdownContent, $tableRegex) | ForEach-Object {
        $tableText = $_.Value

        # ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è§£æã—ã¾ã™
        $headerCount = 0
        $rows = @()

        $tableText -split "`n" | ForEach-Object {
            if ($headerCount -eq 0) {
                $header = [regex]::Split($_, '(?<!\\)\|')
                $header = $header[1..($header.Length-2)] # æœ€åˆã¨æœ€å¾Œã®ç©ºã®è¦ç´ ã‚’å‰Šé™¤
                $headerCount += 1
            }
            elseif ($headerCount -eq 1) {
                # ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åŒºåˆ‡ã‚Šè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
                $headerCount += 1
            }
            else {
                $row = [regex]::Split($_, '(?<!\\)\|')
                $row = $row[1..($row.Length-2)] # æœ€åˆã¨æœ€å¾Œã®ç©ºã®è¦ç´ ã‚’å‰Šé™¤
                if ($row.Count -eq $header.Count) {
                    $rows += ,$row
                }
            }
        }

        # å„è¡Œã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã—ã¾ã™
        $rows | ForEach-Object {
            $rowObject = New-Object psobject
            for ($i = 0; $i -lt $header.Count; $i++) {
                $rowObject | Add-Member -MemberType NoteProperty -Name $header[$i].Trim() -Value $_[$i].Trim()
            }
            $tables += ,$rowObject
        }
    }

    return $tables
}

# è¡¨ã‚’è§£æã—ã¾ã™
$tables = Convert-MarkdownTableToExcel -markdownContent $markdownContent

if ($null -eq $tables) {
    Write-Error 'Markdownå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚Šã¾ã—ãŸãŒã€ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã—ãŸã€‚'
    return
}

# Excelãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‹ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™
function Test-FileLock {
    param (
        [Parameter(Mandatory=$true)][string]$Path
    )

    $fileLocked = $false
    try {
        # ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦ã¿ã¦ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¾ã™
        $file = [System.IO.File]::Open($Path, 'Open', 'Read', 'None')
        $file.Close()
    } catch {
        # ãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‘ãªã„å ´åˆã¯ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã¨åˆ¤æ–­ã—ã¾ã™
        $fileLocked = $true
    }
    return $fileLocked
}

if (Test-Path -Path $excelPath) {
    # ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¾ã™
    if (Test-FileLock -path $excelPath) {
        Write-Host 'Excelãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‹ã‚Œã¦ã„ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‰ã˜ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚'
        return
    }

    $userInput = Read-Host 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ (Yes/No)'
    $yesPatterns = '[Yy][Ee][Ss]|[Yy]'
    $noPatterns = '[Nn][Oo]|[Nn]'
    $isYes = $false
    for ($i = 0; $i -lt 2; $i++) {
        if ($userInput -match $yesPatterns) {
            $isYes = $true    
            break
        }
        else {
            Write-Host 'ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸Šæ›¸ãä¿å­˜ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚'
            return
        }
    }
    if (-Not ($isYes)) {
        Write-Warning 'è©¦è¡Œå›æ•°ã‚’è¶…éã—ã¾ã—ãŸã€‚'
        return
    }

    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œã¯ã„ã€ã‚’é¸æŠã—ãŸå ´åˆã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãä¿å­˜ã—ã¾ã™
    try {
        $tables | Export-Excel -Path $excelPath -Show
        Write-Host 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãä¿å­˜ã—ã¾ã—ãŸã€‚'
    }
    catch {
        Write-Error 'ä¸Šæ›¸ãã§Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã™ã‚‹å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã€‚'
    }
}
else {
    # æ–°è¦ä¿å­˜
    try {
        $tables | Export-Excel -Path $excelPath -Show
        Write-Host "æ–°è¦ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚"
    }
    catch {
        Write-Error 'æ–°è¦ã§Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã™ã‚‹å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã€‚'
    }
}
```

:::details Functionã§å°å…¥ã—ãŸImportExcelã‚’ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ–¹æ³•

Functionã®å†’é ­ã§Install-Moduleã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã§ImportExcelã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã¾ã™ã€‚
ä¸è¦ã¨ãªã‚Šã€ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æ–¹æ³•ã‚‚ç´¹ä»‹ã€‚

```powershell:ã‚³ãƒ”ãƒ¼ç”¨
Uninstall-Module -Name ImportExcel -AllVersions
```

`Uninstall-Module`ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã¯ `Install-Module` ã¨åŒæ§˜ã€ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ãªã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚
ä»¥é™ã®ä½œæ¥­ã§ã¯ã€PowerShellã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ç®¡ç†è€…æ¨©é™ã®ã‚ã‚‹çŠ¶æ…‹ã§å®Ÿè¡Œã—ã¾ã—ãŸã€‚

```powershell:å®Ÿéš›ã®å®Ÿè¡Œçµæœ
# ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‰ï¼šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã“ã¨
PS C:\WINDOWS\system32> Get-Module -ListAvailable -Name ImportExcel


    ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: D:\Documents\WindowsPowerShell\Modules


ModuleType Version    Name                                ExportedCommands
---------- -------    ----                                ----------------
Script     7.8.9      ImportExcel                         {Add-ConditionalFormatting, Add-ExcelChart, Add-ExcelDataV...


PS C:\WINDOWS\system32>
# ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Ÿè¡Œ
PS C:\WINDOWS\system32> Uninstall-Module -Name ImportExcel -AllVersions
PS C:\WINDOWS\system32>
# ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œï¼šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸã“ã¨
PS C:\WINDOWS\system32> Get-Module -ListAvailable -Name ImportExcel
PS C:\WINDOWS\system32>
```

ä»Šå›ã®ã‚³ãƒãƒ³ãƒ‰ã§ã¯ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã™ã¹ã¦ã‚’å‰Šé™¤ã™ã‚‹ã€Œ`-AllVersions`ã€ã‚’æŒ‡å®šã—å®Ÿè¡Œã—ã¦ã„ã¾ã™ãŒã€
ä»–ã«ã‚‚ ä¸€æ„ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ `RequiredVersion` ã‚„ å¼·åˆ¶çš„ã«ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ `-Force` ã€ äº‹å‰ã«ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ `-Confirm` ãªã©ã€ã•ã¾ã–ã¾ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã™ã€‚

ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è©³ç´°ã¯ã€ä¸‹è¨˜ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

Uninstall-Moduleã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã®å…¬å¼ãƒ˜ãƒ«ãƒ—
https://learn.microsoft.com/ja-jp/powershell/module/powershellget/uninstall-module

:::details ImportExcelã‚’ä½¿ç”¨ã—ãŸç›´å¾Œã«Uninstall-Moduleã§æ¶ˆãã†ã¨ã—ã¦ã‚‚ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹

```powershell:ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼
PS C:\WINDOWS\system32> Uninstall-Module ImportExcel
è­¦å‘Š: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ '7.8.9' ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« 'ImportExcel'
ã¯ç¾åœ¨ä½¿ç”¨ä¸­ã§ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’çµ‚äº†ã—ãŸå¾Œã§ã€æ“ä½œã‚’ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„ã€‚
PackageManagement\Uninstall-Package : ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« 'ImportExcel' ã¯ç¾åœ¨ä½¿ç”¨ä¸­ã‹ã€å¿…è¦ãªã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
ç™ºç”Ÿå ´æ‰€ C:\Program Files\WindowsPowerShell\Modules\PowerShellGet\1.0.0.1\PSModule.psm1:2194 æ–‡å­—:21
+ ...        $null = PackageManagement\Uninstall-Package @PSBoundParameters
+                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (Microsoft.Power...ninstallPackage:UninstallPackage) [Uninstall-Packag
   e]ã€Exception
    + FullyQualifiedErrorId : ModuleIsInUse,Uninstall-Package,Microsoft.PowerShell.PackageManagement.Cmdlets.Uninstall
   Package

PS C:\WINDOWS\system32>
```

ä¸Šè¨˜ã®ã‚ˆã†ãªå ´åˆã€å®Ÿè¡Œã—ãŸPowerShellã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ä¸€åº¦ã€çµ‚äº†ã—ã¦ã‹ã‚‰ `Uninstall-Module`ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

:::

---
title: "Markdown-テーブル形式 と Excelファイル を相互変換するスクリプト"
emoji: "🎉"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["powershell"]
published: false
---
調べた限り、Pythonスクリプトで実現できそうだが、PowerShellのみで実現できるんだったら、
自作Functionを作成すると便利そう。

Markdownの表を解析してExcelに変換するためのPowerShellスクリプトを以下に示します。このスクリプトは、Markdownファイル内の表を検出し、それをExcelファイルに変換します。`ImportExcel`モジュールを使用して、Excelファイルの生成を行います。

```powershell
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12

Find-Module -Name PowerShellGet | Install-Module
Find-Module -Name ImportExcel | Install-Module

# 必要なモジュールをインストールします
Install-Module -Name ImportExcel -Scope CurrentUser

# Markdownファイルのパス
$markdownPath = "D:\Downloads\inputMarkdownTable.md"

# Excelファイルの出力パス
$excelPath = "D:\Downloads\outputExcelData.xlsx"

# Markdownファイルを読み込みます
$markdownContent = Get-Content $markdownPath -Raw

# 表を解析する関数を定義します
Function Convert-MarkdownTableToExcel {
    param(
        [Parameter(Mandatory=$true)]
        [string]$markdownContent
    )

    # 表の開始と終了を検出する正規表現
    $tableRegex = '(?smi)(^\|.*\|$)+'
    $headerSplitRegex = '^\|?(.*?)\|$'
    $rowSplitRegex = '^\|(.*)\|$'

    # 表の内容を抽出します
    $tables = @()
    [regex]::Matches($markdownContent, $tableRegex) | ForEach-Object {
        $tableText = $_.Value

        # ヘッダーを解析します
        $header = $null
        $rows = @()

        $tableText -split "`n" | ForEach-Object {
            if ($null -eq $header) {
                $header = $_ -replace $headerSplitRegex, '$1' -split '\|'
            }
            else {
                $row = $_ -replace $rowSplitRegex, '$1' -split '\|'
                if ($row.Count -eq $header.Count) {
                    $rows += ,$row
                }
            }
        }

        # 各行をオブジェクトに変換します
        $rows | ForEach-Object {
            $rowObject = New-Object psobject
            for ($i = 0; $i -lt $header.Count; $i++) {
                $rowObject | Add-Member -MemberType NoteProperty -Name $header[$i].Trim() -Value $_[$i].Trim()
            }
            $tables += ,$rowObject
        }
    }

    return $tables
}

# 表を解析します
$tables = Convert-MarkdownTableToExcel -markdownContent $markdownContent

# Excelファイルに書き出します
$tables | Export-Excel -Path $excelPath
```

このスクリプトは、Markdownファイル内の表を検出し、それぞれの表をExcelファイルに変換するためのものです。表の解析は正規表現を使用して行われ、各行は配列に変換されます。その後、`Export-Excel` コマンドレットを使用して、解析したデータをExcelファイルに出力します。

スクリプトを実行する前に、`ImportExcel`モジュールがインストールされていることを確認してください。また、スクリプト内のファイルパスは適宜変更してください。このスクリプトは基本的な例であり、実際のMarkdownファイルの構造に応じてカスタマイズが必要になる場合があります。🔧

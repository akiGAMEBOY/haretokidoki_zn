---
title: "PowerShellã§â€œMarkdownãƒ†ãƒ¼ãƒ–ãƒ«â€ã¨â€œExcelãƒ•ã‚¡ã‚¤ãƒ«â€ã‚’ç›¸äº’å¤‰æ›ã™ã‚‹æ–¹æ³•"
emoji: "ğŸŒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell", "markdown", "excel"]
published: false
---
## æ¦‚è¦

ã€ŒExcelãƒ•ã‚¡ã‚¤ãƒ« â†’ Markdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ« ã®å¤‰æ›ã€ã¯Excel ã®ã‚¢ãƒ‰ã‚ªãƒ³ãªã©ã®ä»•äº‹åŠ¹ç‡åŒ–ãƒ„ãƒ¼ãƒ«ã‚’å°å…¥ã™ã‚‹ã“ã¨ã§å®Ÿç¾ã§ãã¾ã—ãŸãŒã€
2024å¹´6æœˆç¾åœ¨ã€ã€ŒMarkdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ« â†’ Excelãƒ•ã‚¡ã‚¤ãƒ« ã®å¤‰æ›ã€ã¯èª¿ã¹ãŸã‹ãã‚Šã‚ªãƒ³ãƒ©ã‚¤ãƒ³Webãƒ„ãƒ¼ãƒ«ã‚„Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå¿…è¦ãã†ã§ã—ãŸã€‚

ã‚ªãƒ³ãƒ©ã‚¤ãƒ³Webãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æ©Ÿå¯†æƒ…å ±ã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿ãŒå–ã‚Šæ‰±ãˆã¾ã›ã‚“ã€‚
ã¾ãŸã€Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã¯ã€é›£ã—ãã¯ã‚ã‚Šã¾ã›ã‚“ãŒå®Ÿè¡Œç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ãã“ã§ä»Šå›ã€Windowsç’°å¢ƒã«ãŠã„ã¦æ¨™æº–æ­è¼‰ã•ã‚Œã¦ã„ã‚‹PowerShellã§ç›¸äº’ã®å¤‰æ›ã‚’å®Ÿç¾ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## ã“ã®è¨˜äº‹ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

- Windows OS ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–¹
- Markdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ« ã‹ã‚‰ Excelãƒ•ã‚¡ã‚¤ãƒ« ã«å¤‰æ›ã—ãŸã„æ–¹
- Excelãƒ•ã‚¡ã‚¤ãƒ« ã‹ã‚‰ Markdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ« ã«å¤‰æ›ã—ãŸã„æ–¹

## å¯¾å¿œæ–¹æ³•

Windows OSã§ã¯ã€ã™ãã«PowerShellã®ä½¿ç”¨ãŒå¯èƒ½ã§ã™ã€‚
ãŸã ã€ä»Šå›ã¯PowerShellã®ã‚³ãƒ¼ãƒ‰ã§Excelã‚’å–ã‚Šæ‰±ã†ãŸã‚ã€äº‹å‰ã«ExcelãŒåˆ¶å¾¡å¯èƒ½ã¨ãªã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€ã®å°å…¥ãŒå¿…è¦ã€‚

ã¾ãŸã€ãã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹éš›ã¯ã€ç®¡ç†è€…æ¨©é™ã§ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã€Œ`Install-Module`ã€ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

### äº‹å‰æº–å‚™

å‰è¿°ã—ãŸã¨ãŠã‚Šã€äº‹å‰ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

#### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ä¸‹è¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€ã‚’å°å…¥ã§ãã¾ã™ã€‚
ç¹°ã‚Šè¿”ã—ã«ã¯ãªã‚Šã¾ã™ãŒã€ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹PowerShellã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¯â€œç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œâ€ã§èµ·å‹•ï¼ˆ**ç®¡ç†è€…æ¨©é™**ï¼‰ã—ã¦å®Ÿè¡ŒãŒå¿…è¦ã§ã™ã€‚

```powershell:PowerShellã§Excelãƒ•ã‚¡ã‚¤ãƒ«ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€
#################################################################################
# å‡¦ç†åã€€ | Test-ModuleInstalled
# æ©Ÿèƒ½ã€€ã€€ | ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å°å…¥æœ‰ç„¡ã‚’ç¢ºèª
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/0a94c0f83bd428
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Booleanï¼ˆTrue: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å°å…¥æ¸ˆã¿, False: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æœªå°å…¥ï¼‰
# å¼•æ•°ã€€ã€€ | MoudleName: ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å
#################################################################################
function Test-ModuleInstalled {
    param (
        [System.String]$ModuleName
    )

    $moduleInstalled = $false
    # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æƒ…å ±ã‚’å–å¾—
    $module = (Get-Module -ListAvailable -Name $ModuleName)
    if ($null -ne $module) {
        $moduleInstalled = $true
    }
    
    return $moduleInstalled
}
#################################################################################
# å‡¦ç†åã€€ | Test-IsAdmin
# æ©Ÿèƒ½ã€€ã€€ | PowerShellãŒç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã—ã¦ã„ã‚‹ã‹ç¢ºèª
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/67788ca9b47b27
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Booleanï¼ˆTrue: ç®¡ç†è€…æ¨©é™ã‚ã‚Š, False: ç®¡ç†è€…æ¨©é™ãªã—ï¼‰
# å¼•æ•°ã€€ã€€ | -
#################################################################################
function Test-IsAdmin {
    $win_id = [System.Security.Principal.WindowsIdentity]::GetCurrent()
    $win_principal = new-object System.Security.Principal.WindowsPrincipal($win_id)
    $admin_permission = [System.Security.Principal.WindowsBuiltInRole]::Administrator
    return $win_principal.IsInRole($admin_permission)
}

# ImportExcel ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
$moduleName = 'ImportExcel'
if (-Not(Test-ModuleInstalled $moduleName)) {
    if (-Not(Test-IsAdmin)) {
        Write-Warning 'ç®¡ç†è€…æ¨©é™ãŒãªã„ç‚ºã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒã§ãã¾ã›ã‚“ã€‚å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚'
        return
    }
    # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®ãŸã‚ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’â€œTLS1.2â€ã«è¨­å®š
    [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
    # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    Install-Module -Name $moduleName -Scope CurrentUser -Force
    Write-Host "$($moduleName) ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸã€‚"
} else {
    Write-Host "$($moduleName) ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã™ã€‚"
}
```

#### ï¼ˆåˆ‡ã‚Šæˆ»ã—æ‰‹é †ï¼‰ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€ã®ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€ãŒä¸è¦ã¨ãªã£ãŸå ´åˆã€ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¯èƒ½ã€‚
ãªãŠã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã¨åŒæ§˜ã« **ç®¡ç†è€…æ¨©é™ãŒå¿…è¦** ã§ã™ã€‚

```powershell:ã‚³ãƒ”ãƒ¼ç”¨
Uninstall-Module -Name ImportExcel -AllVersions
```

```powershell:å®Ÿéš›ã®å®Ÿè¡Œçµæœï¼ˆç®¡ç†è€…æ¨©é™ã§å®Ÿè¡Œï¼‰
# ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‰ï¼šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã“ã¨
PS C:\WINDOWS\system32> Get-Module -ListAvailable -Name ImportExcel


    ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: D:\Documents\WindowsPowerShell\Modules


ModuleType Version    Name                                ExportedCommands
---------- -------    ----                                ----------------
Script     7.8.9      ImportExcel                         {Add-ConditionalFormatting, Add-ExcelChart, Add-ExcelDataV...


PS C:\WINDOWS\system32>
# ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Ÿè¡Œ
PS C:\WINDOWS\system32> Uninstall-Module -Name ImportExcel -AllVersions
PS C:\WINDOWS\system32>
# ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œï¼šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸã“ã¨
PS C:\WINDOWS\system32> Get-Module -ListAvailable -Name ImportExcel
PS C:\WINDOWS\system32>
```

:::details å‚è€ƒæƒ…å ±ï¼šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€ã®ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆ

ä»Šå›ç´¹ä»‹ã—ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€ã‚’ä½¿ç”¨ã—ãŸã‚³ãƒ¼ãƒ‰ã®ç›´å¾Œã«ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚
å®Ÿéš›ã«ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼ã¯ä¸‹è¨˜ã®ã¨ãŠã‚Šã§ã™ã€‚

```powershell:ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼
PS C:\WINDOWS\system32> Uninstall-Module ImportExcel
è­¦å‘Š: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ '7.8.9' ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« 'ImportExcel'
ã¯ç¾åœ¨ä½¿ç”¨ä¸­ã§ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’çµ‚äº†ã—ãŸå¾Œã§ã€æ“ä½œã‚’ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„ã€‚
PackageManagement\Uninstall-Package : ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« 'ImportExcel' ã¯ç¾åœ¨ä½¿ç”¨ä¸­ã‹ã€å¿…è¦ãªã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
ç™ºç”Ÿå ´æ‰€ C:\Program Files\WindowsPowerShell\Modules\PowerShellGet\1.0.0.1\PSModule.psm1:2194 æ–‡å­—:21
+ ...        $null = PackageManagement\Uninstall-Package @PSBoundParameters
+                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (Microsoft.Power...ninstallPackage:UninstallPackage) [Uninstall-Packag
   e]ã€Exception
    + FullyQualifiedErrorId : ModuleIsInUse,Uninstall-Package,Microsoft.PowerShell.PackageManagement.Cmdlets.Uninstall
   Package

PS C:\WINDOWS\system32>
```

ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ŒImportExcelã€ã‚’ä½¿ç”¨ã—ãŸæ™‚ã®ã¿ã ã¨è¤‡æ•°å›æ¤œè¨¼ã—ç¢ºèªæ¸ˆã¿ã€‚
ãŠãã‚‰ããƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è§£æ”¾å‡¦ç†ã§å•é¡ŒãŒã‚ã‚‹ã‚ˆã†ã§ã€ã“ã®ã‚ˆã†ãªäº‹è±¡ãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã¨æ€ã‚ã‚Œã‚‹ã€‚

æ˜ç¤ºçš„ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’é–‹æ”¾ã™ã‚‹æ–¹æ³•ã‚’èª¿ã¹ã¾ã—ãŸãŒã€è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚

åŒã˜äº‹è±¡ãŒç™ºç”Ÿã—ãŸå ´åˆã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿å®Ÿè¡Œã—ãŸã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆPowerShellã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ ã‚„ Windowsã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãªã©ï¼‰ã‚’é–‰ã˜ã¦ã€
å†åº¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç«‹ã¡ä¸Šã’ãŸå¾Œã« `Uninstall-Module` ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

:::

### Markdown-Table -> Excelãƒ•ã‚¡ã‚¤ãƒ« ã«å¤‰æ›

é–¢é€£ã™ã‚‹Functionã‚’å«ã‚ãŸã‚³ãƒ¼ãƒ‰ã€‚ãƒ¡ã‚¤ãƒ³ã®Functionã¯ã€Œ`Convert-MarkdownTableToExcel`ã€ã§ã™ã€‚

```powershell:Markdownå½¢å¼ ã‹ã‚‰ Excelãƒ•ã‚¡ã‚¤ãƒ« ã«å¤‰æ›ã™ã‚‹ã‚³ãƒ¼ãƒ‰
#################################################################################
# å‡¦ç†åã€€ | Test-FileLocked
# æ©Ÿèƒ½ã€€ã€€ | ãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‹ã‚Œã¦ã„ã‚‹ã‹ï¼ˆãƒ­ãƒƒã‚¯çŠ¶æ…‹ã‚’ï¼‰ç¢ºèª
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/b4f4399570000a
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Boolean
#     ã€€ã€€ |  True: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦ã„ã‚‹çŠ¶æ…‹ï¼ˆãƒ­ãƒƒã‚¯çŠ¶æ…‹ï¼‰, False: é–‹ã„ã¦ã„ãªã„çŠ¶æ…‹
# å¼•æ•°ã€€ã€€ | -
#################################################################################
function Test-FileLocked {
    param (
        [Parameter(Mandatory=$true)][System.String]$Path
    )

    if (-Not(Test-Path $Path)) {
        Write-Error 'å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚' -ErrorAction Stop
    }

    # ç›¸å¯¾ãƒ‘ã‚¹ã ã¨Openãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£å¸¸å‹•ä½œã—ãªã„ç‚ºã€çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›
    $fullPath = (Resolve-Path -Path $Path -ErrorAction SilentlyContinue).Path

    $fileLocked = $false
    try {
        # èª­ã¿å–ã‚Šå°‚ç”¨ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãå‡¦ç†ã‚’å®Ÿè¡Œ
        $fileStream = [System.IO.File]::Open($fullPath, 'Open', 'ReadWrite', 'None')
    }
    catch {
        # ãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‘ãªã„å ´åˆã€ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã¨åˆ¤æ–­
        $fileLocked = $true
    }
    finally {
        if ($null -ne $fileStream) {
            $fileStream.Close()
        }
    }

    return $fileLocked
}

# ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å¤‰æ›ã™ã‚‹å‡¦ç†
function Get-ExcelTable {
    param (
        [Parameter(Mandatory=$true)]
        [string]$FromMarkdownPath
    )

    # å†…å®¹ã‚’èª­ã¿å–ã‚‹
    $inputContents = (Get-Content $FromMarkdownPath -Raw)

    # è¡¨ã®é–‹å§‹ã¨çµ‚äº†ã‚’æ¤œå‡ºã™ã‚‹æ­£è¦è¡¨ç¾
    $tableRegex = '(?smi)^\|.*(?<!\\)\|.*$'
    $headerSplitRegex = '^\|?(.*?)(?<!\\)\|$'
    $rowSplitRegex = '^\|(.+?)(?<!\\)\|$'

    # è¡¨ã®å†…å®¹ã‚’æŠ½å‡ºã—ã¾ã™
    $excelTables = @()
    [regex]::Matches($inputContents, $tableRegex) | ForEach-Object {
        $tableText = $_.Value

        # ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è§£æã—ã¾ã™
        $rowCount = 0
        $rows = @()

        $tableText -split "`n" | ForEach-Object {
            if ($rowCount -eq 0) {
                $headers = [regex]::Split($_, '(?<!\\)\|')
                $headers = $headers[1..($headers.Length-2)] # æœ€åˆã¨æœ€å¾Œã®ç©ºã®è¦ç´ ã‚’å‰Šé™¤
                $rowCount += 1
            }
            elseif ($rowCount -eq 1) {
                # ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åŒºåˆ‡ã‚Šè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
                $rowCount += 1
            }
            else {
                $row = [regex]::Split($_, '(?<!\\)\|')
                $row = $row[1..($row.Length-2)] # æœ€åˆã¨æœ€å¾Œã®ç©ºã®è¦ç´ ã‚’å‰Šé™¤

                # ãƒ˜ãƒƒãƒ€ãƒ¼é …ç›®æ•° ã¨ ãƒ‡ãƒ¼ã‚¿é …ç›®æ•°ã‚’æ¯”è¼ƒ
                if ($row.Count -eq $headers.Count) {
                    $rows += ,$row
                }
                else {
                    # ç©ºè¡Œä»¥å¤–
                    if (-Not([System.String]::IsNullOrEmpty($_.Trim()))) {
                        Write-Host "ãƒ˜ãƒƒãƒ€ãƒ¼ã®é …ç›®æ•°ã¨åˆã‚ãªã‹ã£ãŸç‚ºã€ä¸‹è¨˜ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸã€‚[ãƒ˜ãƒƒãƒ€ãƒ¼é …ç›®æ•°: $($headers.Count), ãƒ‡ãƒ¼ã‚¿é …ç›®æ•°: $($row.Count)]"
                        Write-Host '```:markdown'
                        Write-Host "$_"
                        Write-Host '```'
                    }
                }
            }
        }

        # å„è¡Œã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã—ã¾ã™
        $rows | ForEach-Object {
            $rowObject = New-Object psobject
            for ($i = 0; $i -lt $headers.Count; $i++) {
                $rowObject | Add-Member -MemberType NoteProperty -Name $headers[$i].Trim() -Value $_[$i].Trim()
            }
            $excelTables += ,$rowObject
        }
    }

    return $excelTables
}

# Markdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ« ã‹ã‚‰ Excelãƒ•ã‚¡ã‚¤ãƒ« ã«å¤‰æ›ã™ã‚‹Funciton
function Convert-MarkdownTableToExcel {
    param (
        [Parameter(Mandatory=$true)]
        [System.String]$FromMarkdownPath,
        [Parameter(Mandatory=$true)]
        [System.String]$ToExcelPath

    )

    # Markdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ« ã‚’ Excel
    $excelTables = (Get-ExcelTable -FromMarkdownPath $FromMarkdownPath)

    if ($null -eq $excelTables) {
        Write-Error 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚Šã¾ã—ãŸãŒã€ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚'
        return
    }

    if (Test-Path -Path $ToExcelPath) {
        # ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¾ã™
        if (Test-FileLocked -Path $ToExcelPath) {
            Write-Warning 'Excelãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‹ã‚Œã¦ã„ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‰ã˜ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚'
            return
        }

        # å…¥åŠ›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        $userInput = Read-Host 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ (Yes/No)'
        $yesPatterns = '[Yy][Ee][Ss]|[Yy]'
        $noPatterns = '[Nn][Oo]|[Nn]'
        $isYes = $false
        # è©¦è¡Œå›æ•°: 3å›
        $maxCount = 2
        for ($i = 0; $i -lt $maxCount; $i++) {
            if ($userInput -match $yesPatterns) {
                $isYes = $true
                break
            }
            else {
                Write-Host 'ä¸Šæ›¸ãä¿å­˜ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚'
                return
            }
        }
        if (-Not ($isYes)) {
            Write-Warning 'è©¦è¡Œå›æ•°ã‚’è¶…éã—ã¾ã—ãŸã€‚å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚'
            return
        }

        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œã¯ã„ã€ã‚’é¸æŠã—ãŸå ´åˆã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãä¿å­˜ã—ã¾ã™
        try {
            $excelTables | Export-Excel -Path $toExcelPath -Show
            Write-Host 'ä¸Šæ›¸ãä¿å­˜ã—ã¾ã—ãŸã€‚'
        }
        catch {
            Write-Error 'ä¸Šæ›¸ãä¿å­˜ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'
        }
    }
    else {
        # æ–°è¦ä¿å­˜
        try {
            $excelTables | Export-Excel -Path $toExcelPath -Show
            Write-Host "æ–°è¦ä¿å­˜ã—ã¾ã—ãŸã€‚"
        }
        catch {
            Write-Error 'æ–°è¦ä¿å­˜ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'
        }
    }
}
```

ä¸‹è¨˜ã§ãƒ¡ã‚¤ãƒ³ã®Functionã€Œ`Convert-MarkdownTableToExcel`ã€ã‚’å®Ÿè¡Œã€‚

```powershell:Functionã€ŒConvert-MarkdownTableToExcelã€ã‚’å®Ÿè¡Œ
# å®Ÿè¡Œ
$markdownPath = 'D:\Downloads\inputMarkdownTable.md'
$excelPath = 'D:\Downloads\outputExcel.xlsx'
Convert-MarkdownTableToExcel $markdownPath $excelPath
```

:::details è£œè¶³æƒ…å ±ï¼šMarkdownãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰Excelãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®å¤‰æ›æ™‚ã®å…¥å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ä¸€å¼

https://github.com/akiGAMEBOY/haretokidoki-zn_articles_35f534e04e731c/tree/main/MarkdownToExcel

- å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ï¼šãƒ†ãƒ¼ãƒ–ãƒ«ã®ã¿è¨˜è¿°ã—ãŸMarkdownå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«

https://github.com/akiGAMEBOY/haretokidoki-zn_articles_35f534e04e731c/blob/main/MarkdownToExcel/inputMarkdownTable.md#L1-L47

- å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ï¼š- å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ï¼šå…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã«å¤‰æ›ã—ãŸExcelãƒ•ã‚¡ã‚¤ãƒ«

https://github.com/akiGAMEBOY/haretokidoki-zn_articles_35f534e04e731c/blob/main/MarkdownToExcel/outputExcel.xlsx

:::

### Excelãƒ•ã‚¡ã‚¤ãƒ« -> Markdown-Table ã«å¤‰æ›

é–¢é€£ã™ã‚‹Functionã‚’å«ã‚ãŸã‚³ãƒ¼ãƒ‰ã€‚ãƒ¡ã‚¤ãƒ³ã®Functionã¯ã€Œ`Convert-ExcelToMarkdownTable`ã€ã§ã™ã€‚

```powershell:Excelãƒ•ã‚¡ã‚¤ãƒ« ã‹ã‚‰ Markdownå½¢å¼ ã«å¤‰æ›ã™ã‚‹ã‚³ãƒ¼ãƒ‰
#################################################################################
# å‡¦ç†åã€€ | Test-FileLocked
# æ©Ÿèƒ½ã€€ã€€ | ãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‹ã‚Œã¦ã„ã‚‹ã‹ï¼ˆãƒ­ãƒƒã‚¯çŠ¶æ…‹ã‚’ï¼‰ç¢ºèª
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/b4f4399570000a
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Boolean
#     ã€€ã€€ |  True: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦ã„ã‚‹çŠ¶æ…‹ï¼ˆãƒ­ãƒƒã‚¯çŠ¶æ…‹ï¼‰, False: é–‹ã„ã¦ã„ãªã„çŠ¶æ…‹
# å¼•æ•°ã€€ã€€ | -
#################################################################################
function Test-FileLocked {
    param (
        [Parameter(Mandatory=$true)][System.String]$Path
    )

    if (-Not(Test-Path $Path)) {
        Write-Error 'å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚' -ErrorAction Stop
    }

    # ç›¸å¯¾ãƒ‘ã‚¹ã ã¨Openãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£å¸¸å‹•ä½œã—ãªã„ç‚ºã€çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›
    $fullPath = (Resolve-Path -Path $Path -ErrorAction SilentlyContinue).Path

    $fileLocked = $false
    try {
        # èª­ã¿å–ã‚Šå°‚ç”¨ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãå‡¦ç†ã‚’å®Ÿè¡Œ
        $fileStream = [System.IO.File]::Open($fullPath, 'Open', 'ReadWrite', 'None')
    }
    catch {
        # ãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‘ãªã„å ´åˆã€ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã¨åˆ¤æ–­
        $fileLocked = $true
    }
    finally {
        if ($null -ne $fileStream) {
            $fileStream.Close()
        }
    }

    return $fileLocked
}

# ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å¤‰æ›ã™ã‚‹å‡¦ç†
function Get-MarkdownTable {
    param (
        [Parameter(Mandatory=$true)]
        [string]$FromExcelPath
    )

    # å†…å®¹ã‚’èª­ã¿å–ã‚‹
    $inputContents = (Import-Excel -Path $FromExcelPath)

    # Markdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ§‹ç¯‰ã—ã¾ã™
    $markdownTables = ''
    $headers = $inputContents[0].PSObject.Properties.Name

    # ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’è¿½åŠ ã—ã¾ã™
    $markdownTables += '| ' + ($headers -join ' | ') + ' |' + "`r`n"

    # åŒºåˆ‡ã‚Šè¡Œã‚’è¿½åŠ ã—ã¾ã™
    $markdownTables += '| ' + (($headers | ForEach-Object { '---' }) -join ' | ') + ' |' + "`r`n"

    # ãƒ‡ãƒ¼ã‚¿è¡Œã‚’è¿½åŠ ã—ã¾ã™
    for ($i = 0; $i -lt $inputContents.Count; $i++) {
        $rowData = @()
        foreach ($header in $headers) {
            $cellValue = $inputContents[$i]."$header"
            $rowData += $cellValue
        }
        $markdownTables += '| ' + ($rowData -join ' | ') + ' |'
        # æœ€å¾Œã®è¡Œä»¥å¤–ã¯æ”¹è¡Œã‚’è¿½åŠ 
        if ($i -lt $inputContents.Count - 1) {
            $markdownTables += "`r`n"
        }
    }
    return $markdownTables
}

# Exelãƒ•ã‚¡ã‚¤ãƒ« ã‹ã‚‰ Markdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ« ã«å¤‰æ›ã™ã‚‹Function
function Convert-ExcelToMarkdownTable {
    param (
        [Parameter(Mandatory=$true)]
        [System.String]$FromExcelPath,
        [Parameter(Mandatory=$true)]
        [System.String]$ToMarkdownPath
    )

    $markdownTables = (Get-MarkdownTable -FromExcelPath $FromExcelPath)

    if ($null -eq $markdownTables) {
        Write-Error 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚Šã¾ã—ãŸãŒã€ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚'
        return
    }

    if (Test-Path -Path $ToMarkdownPath) {
        if (Test-FileLocked -Path $ToMarkdownPath) {
            Write-Warning 'Markdownãƒ•ã‚¡ã‚¤ãƒ«ãŒé–‹ã‹ã‚Œã¦ã„ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‰ã˜ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚'
            return
        }

        # å…¥åŠ›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        $userInput = Read-Host 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ (Yes/No)'
        $yesPatterns = '[Yy][Ee][Ss]|[Yy]'
        $noPatterns = '[Nn][Oo]|[Nn]'
        $isYes = $false
        # è©¦è¡Œå›æ•°: 3å›
        $maxCount = 2
        for ($i = 0; $i -lt $maxCount; $i++) {
            if ($userInput -match $yesPatterns) {
                $isYes = $true
                break
            }
            else {
                Write-Host 'ä¸Šæ›¸ãä¿å­˜ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚'
                return
            }
        }
        if (-Not ($isYes)) {
            Write-Warning 'è©¦è¡Œå›æ•°ã‚’è¶…éã—ã¾ã—ãŸã€‚å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚'
            return
        }

        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œã¯ã„ã€ã‚’é¸æŠã—ãŸå ´åˆã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãä¿å­˜ã—ã¾ã™
        try {
            $markdownTables | Out-File -FilePath $ToMarkdownPath -Encoding utf8
            Write-Host 'ä¸Šæ›¸ãä¿å­˜ã—ã¾ã—ãŸã€‚'
        }
        catch {
            Write-Error 'ä¸Šæ›¸ãä¿å­˜ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'
        }
    }
    else {
        # æ–°è¦ä¿å­˜
        try {
            $markdownTables | Out-File -FilePath $ToMarkdownPath -Encoding utf8
            Write-Host "æ–°è¦ä¿å­˜ã—ã¾ã—ãŸã€‚"
        }
        catch {
            Write-Error 'æ–°è¦ä¿å­˜ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'
        }
    }
}
```

ä¸‹è¨˜ã§ãƒ¡ã‚¤ãƒ³ã®Functionã¯ã€Œ`Convert-ExcelToMarkdownTable`ã€ã‚’å®Ÿè¡Œã€‚

```powershell:Functionã€ŒConvert-ExcelToMarkdownTableã€ã‚’å®Ÿè¡Œ
# å®Ÿè¡Œ
$excelPath = 'D:\Downloads\inputExcel.xlsx'
$markdownPath = 'D:\Downloads\outputMarkdownTable.md'
Convert-ExcelToMarkdownTable $excelPath $markdownPath
```

:::details è£œè¶³æƒ…å ±ï¼šMarkdownãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰Excelãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®å¤‰æ›æ™‚ã®å…¥å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ä¸€å¼

https://github.com/akiGAMEBOY/haretokidoki-zn_articles_35f534e04e731c/tree/main/ExcelToMarkdown

- å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ï¼šã‚»ãƒ«ä½ç½®ã€ŒA1ã€ã«ãƒ˜ãƒƒãƒ€ãƒ¼ã€ã€ŒA2ã€ä»¥é™ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚ã‚‹Excelãƒ•ã‚¡ã‚¤ãƒ«

https://github.com/akiGAMEBOY/haretokidoki-zn_articles_35f534e04e731c/blob/main/ExcelToMarkdown/inputExcel.xlsx

- å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ï¼šå…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã«å¤‰æ›ã—ãŸMarkdownãƒ•ã‚¡ã‚¤ãƒ«

https://github.com/akiGAMEBOY/haretokidoki-zn_articles_35f534e04e731c/blob/main/ExcelToMarkdown/inputMarkdownTable.md#L1-L47

:::

:::details è£œè¶³æƒ…å ±ï¼šã‚µãƒ³ãƒ—ãƒ«ã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆï¼ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã®ãƒ‡ãƒ¼ã‚¿

- å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ï¼šA1ã‹ã‚‰ãƒ˜ãƒƒãƒ€ãƒ¼A2ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¨˜è¿°ã—ã¦ã„ã‚‹Excelãƒ•ã‚¡ã‚¤ãƒ«
    inputExcel.xlsx
- å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ï¼šä¸Šè¨˜ã®Markdownå½¢å¼ãƒ•ã‚¡ã‚¤ãƒ«ã§å‡ºåŠ›ã—ãŸMarkdownå½¢å¼ãƒ•ã‚¡ã‚¤ãƒ«
    outputMarkdownTable.md

:::

## ã¾ã¨ã‚

- ä¸‹è¨˜ã®Functionã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ããŸ
    - Markdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ« ã‚’å…ƒã« Excelãƒ•ã‚¡ã‚¤ãƒ« ã‚’å‡ºåŠ›ã™ã‚‹Function
    - Excelãƒ•ã‚¡ã‚¤ãƒ« ã‚’å…ƒã« Markdownå½¢å¼ã®ãƒ†ãƒ¼ãƒ–ãƒ« ã‚’å‡ºåŠ›ã™ã‚‹Function
- å…¥å‡ºåŠ›ã®è¦ä»¶ãŒç´°ã‹ãã‚ã‚‹å ´åˆã¯ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒå¿…è¦
    ã¨ãã«Excelãƒ•ã‚¡ã‚¤ãƒ«ãŒã‹ã‚‰ã‚€å ´åˆã¯ãƒ˜ãƒƒãƒ€ãƒ¼ã®ä½ç½®ã‚„æ›¸ãå‡ºã—ä½ç½®ãªã©å¿…è¦ã«å¿œã˜ã¦ã‚³ãƒ¼ãƒ‰ã®ä¿®æ­£ãŒå¿…è¦

## é–¢é€£è¨˜äº‹

https://zenn.dev/haretokidoki/articles/67788ca9b47b27
https://zenn.dev/haretokidoki/articles/b4f4399570000a
https://haretokidoki-blog.com/pasocon_powershell-startup/
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960
https://zenn.dev/haretokidoki/articles/fb6830f9155de5

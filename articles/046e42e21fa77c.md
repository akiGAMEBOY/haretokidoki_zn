---
title: "PowerShellで指定したファイル内容が存在するかチェックするFunction"
emoji: "👻"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["powershell"]
published: false
---
## 概要

ファイルそのものが存在するかについては、標準コマンドレット、`Test-Path` により判定できますが、
データの中身を検証するコマンドレットはありません。

おそらく検索すれば数多く他の記事がありそうな内容だった為、これまで記事を作成していませんでしたが、
別の記事でこのFunctionを使う用途が発生しました。

どうせなら、自身が決めた命名規則や処理内容でFunctionを自作しようと思い、この記事を投稿します。

## この記事のターゲット

- PowerShellユーザーの方
- 処理前にファイルの中身が存在するかチェックしたい方

## 自作したFunction

```powershell:Test-FileHasContent
function Test-FileHasContent {
    param (
        [System.String]$Path
    )

    try {
        $fileContents = (Get-Content $Path)
    }
    catch {
        Write-Error 'ファイル内容を読み込む際にエラーが発生しました。'
    }

    if ([System.String]::IsNullOrWhiteSpace($fileContents)) {
        $isContent = $false
    }
    else {
        $isContent = $true
    }

    return $isContent
}
```

## Functionの実行方法

### 中身が存在しないファイルを対象にFunctionを実行

```:中身のないテキストファイル「D:\Downloads\WithNoContent.txt」
```

```powershell:検証したコード（コンテンツなしパターン）
$targetFile = 'D:\Downloads\WithNoContent.txt'
if (Test-FileHasContent $targetFile) {
    Write-Host 'ファイルの中身が存在する'
}
else {
    Write-Host 'ファイルの中身が存在しない'
}
```

```powershell:実際の実行結果
PS C:\Users\"ユーザー名"> $targetFile = 'D:\Downloads\WithNoContent.txt'
>> if (Test-FileHasContent $targetFile) {
>>     Write-Host 'ファイルの中身が存在する'
>> }
>> else {
>>     Write-Host 'ファイルの中身が存在しない'
>> }
ファイルの中身が存在しない
PS C:\Users\"ユーザー名">
```

上記の結果のとおり、中身のないテキストファイルで期待通り動作することを確認。

### 中身が存在するファイルを対象にFunctionを実行

```:中身のあるテキストファイル「D:\Downloads\WithContents.txt」
aaa
```

```powershell:検証したコード（コンテンツありパターン）
$targetFile = 'D:\Downloads\WithContents.txt'
if (Test-FileHasContent $targetFile) {
    Write-Host 'ファイルの中身が存在する'
}
else {
    Write-Host 'ファイルの中身が存在しない'
}
```

```powershell:実際の実行結果
PS C:\Users\"ユーザー名"> $targetFile = 'D:\Downloads\WithContents.txt'
>> if (Test-FileHasContent $targetFile) {
>>     Write-Host 'ファイルの中身が存在する'
>> }
>> else {
>>     Write-Host 'ファイルの中身が存在しない'
>> }
ファイルの中身が存在する
PS C:\Users\"ユーザー名">
```

上記の結果のとおり、中身のあるテキストファイルで期待通り動作することを確認。

## まとめ

- ファイル自体の存在チェックは標準コマンドレットの「`Test-Path`」で対応
- 今回、自作したFunction「`Test-FileHasContent`」でファイル内容の存在チェックを実現できた

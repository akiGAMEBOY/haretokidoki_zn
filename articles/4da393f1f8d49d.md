---
title: "PowerShellãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•ç™»éŒ²ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆè‡ªä½œFunctionã®è¿½åŠ ã§ä½¿ç”¨ï¼‰"
emoji: "ğŸ•Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: false
---
## æ¦‚è¦

[ã“ã¡ã‚‰](https://zenn.dev/haretokidoki/articles/1632e92c37ea98)ã®è¨˜äº‹ã§ãƒ‡ãƒ¼ã‚¿å‹ã‚’ç¢ºèªã§ãã‚‹Functionã‚’è‡ªä½œã—ã¾ã—ãŸã€‚
ã“ã®ã‚ˆã†ãªè‡ªä½œFunctionã¯ã€PowerShellã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«ç™»éŒ²ã™ã‚‹äº‹ã§ã€èµ·å‹•ã™ã‚‹ãŸã³ã«å®šç¾©ã—ãªãã¦ã‚‚ç°¡å˜ã«å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚

ãŸã ã€ç’°å¢ƒãŒå¤‰ã‚ã‚Šæ–°ã—ã„ãƒ‘ã‚½ã‚³ãƒ³ã§ä½œæ¥­ã™ã‚‹äº‹ã«ãªã£ãŸå ´åˆã€å†åº¦ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç™»éŒ²ã‚„è‡ªä½œã—ãŸFunctionã‚’ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šé¢å€’ã«æ„Ÿã˜ã¦ã„ã¾ã—ãŸã€‚

ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ç‚ºã€ä»Šå›ã¯PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã§è‡ªä½œã—ãŸFunctionã®PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ*.ps1ï¼‰ã‚’èª­ã¿è¾¼ã¿ã€
ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®å®šç¾©ã«è¿½åŠ ã™ã‚‹PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚

## ã‚³ãƒ¼ãƒ‰

https://www.zacoding.com/post/powershell-profile/

```:kick.bat
@REM PowerShell Core ã§å®Ÿè¡Œã™ã‚‹å ´åˆ
cd "ps1ãƒ•ã‚¡ã‚¤ãƒ«ã®æ ¼ç´å ´æ‰€"

@REM PowerShell Core ã§å®Ÿè¡Œã™ã‚‹å ´åˆ
pwsh -NoProfile -ExecutionPolicy RemoteSigned -File "%~dp0\Main.ps1"

@REM PowerShell 5.1  ã§å®Ÿè¡Œã™ã‚‹å ´åˆ
REM powershell -NoProfile -ExecutionPolicy RemoteSigned -File "%~dp0\Main.ps1"
```

```powershell:
# PowerShellãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ˜ãƒƒãƒ€ãƒ¼
[System.String[]]$header = 
@"
#################################################################################
# PowerShellãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
# ï¼ˆ$($PROFILE)ï¼‰
#
#################################################################################

"@

# PowerShellãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½è¨˜ã™ã‚‹è‡ªä½œFunction
[System.String[]]$ps_source = 
@'
#################################################################################
# å‡¦ç†åã€€ | VerificationEnv
# æ©Ÿèƒ½ã€€ã€€ | PowerShellç’°å¢ƒãƒã‚§ãƒƒã‚¯
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/3bd4ace5083238
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | MESSAGECODEï¼ˆenumï¼‰
# å¼•æ•°ã€€ã€€ | ãªã—
#################################################################################
# ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ enumè¨­å®š
Add-Type -TypeDefinition @"
    public enum MESSAGECODE {
        Successful = 0,
        Abend,
        Cancel,
        Error_NotCore,
        Error_NotSupportedVersion,
        Error_NotWindows
    }
"@
Function VerificationEnv {
    [MESSAGECODE]$return_code = [MESSAGECODE]::Successful

    # ç’°å¢ƒæƒ…å ±ã‚’å–å¾—
    [System.Collections.Hashtable]$ps_ver = $PSVersionTable

    # ç’°å¢ƒã®åˆ¤å®šï¼šCoreã§ã¯ãªã„å ´åˆï¼ˆ5.1ã ã¨'Desktop'ã¨ãªã‚‹ï¼‰
    if ($ps_ver.PSEdition -ne 'Core') {
        $return_code = [MESSAGECODE]::Error_NotCore
        Write-Host 'Coreï¼ˆ6.0ä»¥é™ï¼‰ã®ç’°å¢ƒã§ã¯ãªã„' -ForegroundColor Red
    }
    # ç’°å¢ƒã®åˆ¤å®šï¼šãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ7ã‚ˆã‚Šå°ã•ã„å ´åˆ
    elseif ($ps_ver.PSVersion.Major -lt 7) {
        $return_code = [MESSAGECODE]::Error_NotSupportedVersion
        Write-Host 'Coreï¼ˆ6.0ä»¥é™ï¼‰ã®ç’°å¢ƒã ãŒã€7ä»¥ä¸Š ã®ç’°å¢ƒã§ã¯ãªã„' -ForegroundColor Red
    }
    # ç’°å¢ƒã®åˆ¤å®šï¼šWindows OSã§ã¯ãªã„å ´åˆï¼ˆPowerShell Coreã®ã¿ä½¿ç”¨ã§ãã‚‹è‡ªå‹•å¤‰æ•°ï¼‰
    elseif (-Not($IsWindows)) {
        $return_code = [MESSAGECODE]::Error_NotWindows
        Write-Host 'Coreï¼ˆ6.0ä»¥é™ï¼‰ã®ç’°å¢ƒã§ã€ã‹ã¤ 7ä»¥ä¸Š ã®ç’°å¢ƒã ãŒã€Windows OS ã®ç’°å¢ƒã§ã¯ãªã„' -ForegroundColor Red
    }
    else {
        Write-Host 'Coreï¼ˆ6.0ä»¥é™ï¼‰ã®ç’°å¢ƒã§ã€ã‹ã¤ 7ä»¥ä¸Š ã®ç’°å¢ƒã€Windows OS ã®ç’°å¢ƒã§ã‚ã‚‹'
    }

    return $return_code
}
#################################################################################
# å‡¦ç†åã€€ | Get-Datatype
# æ©Ÿèƒ½ã€€ã€€ | å¤‰æ•°ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ç¢ºèª
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/1632e92c37ea98
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | ãƒ‡ãƒ¼ã‚¿å‹ã‚’è¡¨ç¤ºï¼ˆé …ç›®1:BaseTypeã€é …ç›®2ï¼šTypeï¼‰
# å¼•æ•°ã€€ã€€ | $variable èª¿æŸ»å¯¾è±¡ã®å¤‰æ•°
#################################################################################
Function Get-Datatype {
	param (
	    [Parameter(Mandatory=$true)]$variable
	)

    # æ–‡å­—åˆ—é…åˆ—ã‚’å®£è¨€
	[System.String[]]$rowdata = @(
		$variable.GetType().BaseType.FullName,      # å¤‰æ•°ã®ãƒ™ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—
		$variable.GetType().FullName                # å¤‰æ•°ã®ãƒ‡ãƒ¼ã‚¿å‹
	)
	
    # PSCustomObjectã§é …ç›®åã‚’è¨­å®š
	$types_table = [PSCustomObject]@{
		BaseType = $rowdata[0]
		DataType = $rowdata[1]
	}

    # ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§è¡¨ç¤º
    $types_table | Format-Table -Property BaseType, DataType -AutoSize -Wrap
}

#################################################################################
# å‡¦ç†åã€€ | isAdminPowerShell
# æ©Ÿèƒ½ã€€ã€€ | PowerShellãŒç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã—ã¦ã„ã‚‹ã‹ç¢ºèª
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/67788ca9b47b27
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Booleanï¼ˆTrue: ç®¡ç†è€…æ¨©é™ã‚ã‚Š, False: ç®¡ç†è€…æ¨©é™ãªã—ï¼‰
# å¼•æ•°ã€€ã€€ | -
#################################################################################
Function isAdminPowerShell {
    $win_id = [System.Security.Principal.WindowsIdentity]::GetCurrent()
    $win_principal = new-object System.Security.Principal.WindowsPrincipal($win_id)
    $admin_permission = [System.Security.Principal.WindowsBuiltInRole]::Administrator
    return $win_principal.IsInRole($admin_permission)
}

#################################################################################
# å‡¦ç†åã€€ | GetPsCharcode
# æ©Ÿèƒ½ã€€ã€€ | PowerShellã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/67788ca9b47b27
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | ps_charcode[]
#          |  - é …ç›®01 æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã§ãã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã®æ—¢å®šå€¤
#          |  - é …ç›®02 PowerShellã‹ã‚‰å¤–éƒ¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«æ¸¡ã™æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®è¨­å®š
#          |  - é …ç›®01 PowerShellã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã™ã‚‹æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®è¨­å®š
# å¼•æ•°ã€€ã€€ | -
#################################################################################
Function GetPsCharcode {
    [System.String[]]$ps_charcode = @()
    $ps_charcode = @(
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã§ãã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã®æ—¢å®šå€¤
        ($PSDefaultParameterValues['*:Encoding']),
        # PowerShellã‹ã‚‰å¤–éƒ¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«æ¸¡ã™æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®è¨­å®š
        ($global:OutputEncoding).WebName,
        # PowerShellã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã™ã‚‹æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®è¨­å®š
        ([console]::OutputEncoding).WebName
    )

    return $ps_charcode
}

#################################################################################
# å‡¦ç†åã€€ | ChangeWindowTitle
# æ©Ÿèƒ½ã€€ã€€ | PowerShellã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´ï¼ˆæ–‡å­—ã‚³ãƒ¼ãƒ‰ã¨PowerShellã®ç®¡ç†è€…æ¨©é™æœ‰ç„¡ã‚’è¿½åŠ ï¼‰
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/67788ca9b47b27
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | -
# å¼•æ•°ã€€ã€€ | -
#################################################################################
# PowerShellã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´
Function ChangeWindowTitle {
    # åŒºåˆ‡ã‚Šæ–‡å­—ã®è¨­å®š
    [System.String]$pos1 = '|'
    [System.String]$pos2 = ';'

    # ç¾åœ¨ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å–å¾—
    [System.String]$title = $Host.UI.RawUI.WindowTitle
    [System.String]$base_title = $title

    # æ—¢ã«ã“ã®Functionã§ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´ã—ã¦ã„ã‚‹å ´åˆã€ä¸€ç•ªå·¦ã«ã‚ã‚‹æ–‡å­—åˆ—ã‚’æŠ½å‡º
    [System.String[]]$title_array = $title.Split($pos1)
    if ($title_array.Length -ne 0) {
        $base_title = ($title_array[0]).TrimEnd()
    }

    # ç¾åœ¨ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã‚¿ã‚¤ãƒˆãƒ«ã«è¿½åŠ 
    [System.String[]]$ps_charcode = GetPsCharcode

    [System.String]$change_title = $base_title
    if (isAdminPowerShell) {
        # ç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã—ã¦ã„ã‚‹å ´åˆ
        $change_title = $base_title + " $pos1 " +
                        "DefaultParameter='$($ps_charcode[0])'" + " $pos2 " +
                        "GlobalEncoding='$($ps_charcode[1])'" + " $pos2 " +
                        "ConsoleEncoding='$($ps_charcode[2])'" + " $pos2 " +
                        "#Administrator"
    }
    else {
        # ç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã—ã¦ã„ãªã„å ´åˆ
        $change_title = $base_title + " $pos1 " +
                        "DefaultParameter='$($ps_charcode[0])'" + " $pos2 " +
                        "GlobalEncoding='$($ps_charcode[1])'" + " $pos2 " +
                        "ConsoleEncoding='$($ps_charcode[2])'" + " $pos2 " +
                        "#Not_Administrator"
    }
    $Host.UI.RawUI.WindowTitle = $change_title

    # å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    Write-Host 'ã‚¿ã‚¤ãƒˆãƒ«ã«â€œæ–‡å­—ã‚³ãƒ¼ãƒ‰â€ã¨â€œç®¡ç†è€…æ¨©é™ã®æœ‰ç„¡â€ã®æƒ…å ±ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚' -ForegroundColor Cyan
}

#################################################################################
# å‡¦ç†åã€€ | SetPsOutputEncoding
# æ©Ÿèƒ½ã€€ã€€ | PowerShellã«ãŠã‘ã‚‹è¤‡æ•°ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰è¨­å®šã‚’ä¸€æ‹¬å¤‰æ›´
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/8946231076f129
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | -
# å¼•æ•°ã€€ã€€ | $charcodeï¼ˆå¼•æ•°ã‚’çœç•¥ã—ãŸå ´åˆã¯ã€'reset_encoding'ã§è¨­å®šï¼‰
# ã€€ã€€ã€€ã€€ |  - 'utf8'          : UTF-8ã«è¨­å®š
# ã€€ã€€ã€€ã€€ |  - 'sjis'          : Shift-JISã«è¨­å®š
# ã€€ã€€ã€€ã€€ |  - 'ascii'         : US-ASCIIã«è¨­å®š
# ã€€ã€€ã€€ã€€ |  - 'rm_encoding'   : ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¼ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’å‰Šé™¤
# ã€€ã€€ã€€ã€€ |  - 'reset_encoding': è¦å®šå€¤ã«æˆ»ã™
#################################################################################
Function SetPsOutputEncoding {
    param (
        [System.String]$charcode = 'reset_encoding'
    )

    switch ($charcode) {
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’UTF8ã«è¨­å®šã™ã‚‹
        'utf8' {
            $PSDefaultParameterValues['*:Encoding'] = 'utf8'
            $global:OutputEncoding = [System.Text.Encoding]::UTF8
            [console]::OutputEncoding = [System.Text.Encoding]::UTF8
        }
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’Shift JISï¼ˆSJISï¼‰ã«è¨­å®šã™ã‚‹
        'sjis' {
            # $PSDefaultParameterValues['*:Encoding'] = 'default'ã«ã¤ã„ã¦
            #   ã“ã®è¨­å®šã¯Coreä»¥å¤–ï¼ˆ5.1ä»¥å‰ï¼‰ã®ç’°å¢ƒã§ã®ã¿Shift JISã§è¨­å®šã•ã‚Œã‚‹ã€‚
            #   Coreç’°å¢ƒã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯ã€UTF-8ã§ã‚ã‚ŠUTF-8ã§è¨­å®šã•ã‚Œã¦ã—ã¾ã†ã€‚
            #   ã¾ãŸã€Shift JISã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚‚å­˜åœ¨ã—ãªã„ç‚ºã€Coreç’°å¢ƒã§Shift JISã®è¨­å®šã¯ä¸å¯ã¨ãªã‚‹ã€‚
            $PSDefaultParameterValues['*:Encoding'] = 'default'
            $global:OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
            [console]::OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
        }
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ASCIIã«è¨­å®šã™ã‚‹
        'ascii' {
            $PSDefaultParameterValues.Remove('*:Encoding')
            $global:OutputEncoding = [System.Text.Encoding]::ASCII
            [console]::OutputEncoding = [System.Text.Encoding]::ASCII
        }
        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æŒ‡å®šã‚’è§£é™¤ã™ã‚‹
        'rm_encoding' {
            $PSDefaultParameterValues.Remove('*:Encoding')
        }
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰è¨­å®šã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
        'reset_encoding' {
            $PSDefaultParameterValues.Remove('*:Encoding')

            If ($PSVersionTable.PSEdition -eq 'Core') {
                # Core ã®å ´åˆ
                $global:OutputEncoding = [System.Text.Encoding]::UTF8
                [console]::OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
            }
            else {
                # Core ä»¥å¤–ã®å ´åˆï¼ˆPowerShell 5.1 ä»¥å‰ï¼‰
                $global:OutputEncoding = [System.Text.Encoding]::ASCII
                [console]::OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
            }
        }
    }
    # ã‚¿ã‚¤ãƒˆãƒ«ã®è¡¨ç¤ºåˆ‡æ›¿Functionå‘¼ã³å‡ºã—
    ChangeWindowTitle
}
#################################################################################
# å‡¦ç†åã€€ | Get-PsEncoding
# æ©Ÿèƒ½ã€€ã€€ | PowerShellã§ãƒ•ã‚¡ã‚¤ãƒ«ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’åˆ¤å®š
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/962a7fc6c51b47
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | -
# å¼•æ•°ã€€ã€€ | $targetfile å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
#################################################################################
Function Get-PsEncoding {
	param (
		[Parameter(Mandatory=$true)][System.String]$targetfile
	)
	$stream_reader = [System.IO.StreamReader] $targetfile
	$profile_encoding = $stream_reader.CurrentEncoding
	$stream_reader.Close()

	Write-Host "EncodingName: [$($profile_encoding.EncodingName)]"
}
#################################################################################
# å‡¦ç†åã€€ | Check-BOMStatus
# æ©Ÿèƒ½ã€€ã€€ | PowerShellã§ãƒ•ã‚¡ã‚¤ãƒ«ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã«ãŠã‘ã‚‹BOMã‚’åˆ¤å®š
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/962a7fc6c51b47
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | -
# å¼•æ•°ã€€ã€€ | $targetfile å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
#################################################################################
Function Check-BOMStatus {
	param (
		[Parameter(Mandatory=$true)][System.String]$targetfile
	)

    if (-Not (Test-Path $targetfile)) {
        Write-Host 'The target file does not exist.' -ForegroundColor Red
        return
    }

	# BOMã®ãƒã‚¤ãƒˆã‚·ãƒ¼ã‚±ãƒ³ã‚¹
    $UTF7_BOM1 = [System.Byte[]](0x2B,0x2F,0x76,0x38)
    $UTF7_BOM2 = [System.Byte[]](0x2B,0x2F,0x76,0x39)
    $UTF7_BOM3 = [System.Byte[]](0x2B,0x2F,0x76,0x2B)
    $UTF7_BOM4 = [System.Byte[]](0x2B,0x2F,0x76,0x2F)
	$UTF8_BOM = [System.Byte[]](0xEF,0xBB,0xBF)
	$UTF16BE_BOM = [System.Byte[]](0xFE,0xFF)
    $UTF16LE_BOM = [System.Byte[]](0xFF,0xFE)
	$UTF32BE_BOM = [System.Byte[]](0x00,0x00,0xFE,0xFF)
    $UTF32LE_BOM = [System.Byte[]](0xFF,0xFE,0x00,0x00)

	# å…ˆé ­è¡Œã‚’ãƒã‚¤ãƒˆã§èª­ã¿è¾¼ã¿å…ˆé ­ã‹ã‚‰3ãƒã‚¤ãƒˆåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
	[System.Byte[]]$first_4bytes = (Get-Content -Path $targetfile -Encoding Byte -TotalCount 4)
    [System.Byte[]]$first_3bytes = $first_4bytes[0..2]
    [System.Byte[]]$first_2bytes = $first_4bytes[0..1]

	# å…ˆé ­ãƒã‚¤ãƒˆã§BOMä»˜ãã‹åˆ¤å®š
    # UTF-7
    if (($null -eq (Compare-Object $first_4bytes $UTF7_BOM1)) -Or
        ($null -eq (Compare-Object $first_4bytes $UTF7_BOM2)) -Or
        ($null -eq (Compare-Object $first_4bytes $UTF7_BOM3)) -Or
        ($null -eq (Compare-Object $first_4bytes $UTF7_BOM4))) {
        Write-Host "[$($targetfile)] is UTF-7 BOM."
    }
	# UTF-8
	elseif ($null -eq (Compare-Object $first_3bytes $UTF8_BOM -SyncWindow 0)) {
	    Write-Host "[$($targetfile)] is UTF-8 BOM."
    # UTF-16 BE
	} elseif ($null -eq (Compare-Object $first_2bytes $UTF16BE_BOM -SyncWindow 0)) {
	    Write-Host "[$($targetfile)] is UTF-16 BE BOM."
    # UTF-16 LE
	} elseif ($null -eq (Compare-Object $first_2bytes $UTF16LE_BOM -SyncWindow 0)) {
	    Write-Host "[$($targetfile)] is UTF-16 LE BOM."
	# UTF-32 BE
	} elseif ($null -eq (Compare-Object $first_4bytes $UTF32BE_BOM -SyncWindow 0)) {
	    Write-Host "[$($targetfile)] is UTF-32 BE BOM."
    # UTF-32 LE
	} elseif ($null -eq (Compare-Object $first_4bytes $UTF32LE_BOM -SyncWindow 0)) {
	    Write-Host "[$($targetfile)] is UTF-32 LE BOM."
	} else {
        Write-Host "[$($targetfile)] is not BOM." -ForegroundColor Red
    }
}
#################################################################################
# å‡¦ç†åã€€ | Get-PyEncoding
# æ©Ÿèƒ½ã€€ã€€ | Pythonã§ãƒ•ã‚¡ã‚¤ãƒ«ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’åˆ¤å®š
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/aea5b45679d966
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | -
# å¼•æ•°ã€€ã€€ | $targetfile å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
#################################################################################
Function Get-PyEncoding {
    param (
        [Parameter(Mandatory=$true)][System.String]$targetfile
    )

    # python ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
    if (-Not(Get-Command 'python' -ErrorAction SilentlyContinue)) {
        Write-Host 'Python is not install.' -ForegroundColor Red
        return
    }

    # å­˜åœ¨ãƒã‚§ãƒƒã‚¯ãŠã‚ˆã³ãƒ‡ãƒ¼ã‚¿ç¨®é¡ã®ãƒã‚§ãƒƒã‚¯
    [System.String]$fullpath_targetfile = (Convert-Path $targetfile)
    if (-Not(Test-Path $fullpath_targetfile -PathType Leaf)) {
        Write-Host "[$fullpath_targetfile] does not exist or is not a file." -ForegroundColor Red
        return
    }

    # Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã‚³ãƒ¼ãƒ‰
    [System.String[]]$py_source = 
@"
import subprocess
import sys

# chardet ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
try:
    import chardet
except ImportError:
    subprocess.check_call([sys.executable, '-m', 'pip', 'install', 'chardet', '--user'])
    import chardet

# æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’åˆ¤å®šã™ã‚‹Function
def determine_encoding(file_path):
    with open(file_path, 'rb') as file:
        raw_data = file.read()
        result = chardet.detect(raw_data)
        print(f"Detected encoding for [{file_path}] is {result['encoding']} with {result['confidence']*100}% confidence.")

# ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã®å¼•æ•°ã‚’å–å¾—
file_path = sys.argv[1]

# å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®æ–‡å­—åˆ—ã‚’åˆ¤å®š
determine_encoding(file_path)

"@ -split "`r`n"

    # Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æº–å‚™
    #   Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ ¼ç´ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãŒãªã„å ´åˆã¯ã€æ–°è¦ä½œæˆ
    [System.String]$pyfolder_path = "$PROFILE\..\user-defined-py"
    if (-Not(Test-Path $pyfolder_path)) {
        New-Item -Path $pyfolder_path -ItemType 'directory' -Force > $null
    }
    #   ä»Šå›å®Ÿè¡Œã™ã‚‹Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒãªã„å ´åˆã¯ã€æ–°è¦ä½œæˆ
    [System.String]$pyscript_path = "$PROFILE\..\user-defined-py\chardet_runner.py"
    if (-Not(Test-Path $pyscript_path)) {
        $utf8Encoding = New-Object System.Text.UTF8Encoding
        [System.IO.File]::WriteAllText($pyscript_path, $py_source, $utf8Encoding)
    }

    # Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ
    try {
        python $pyscript_path $fullpath_targetfile
    }
    catch {
        Write-Host 'Python script execution error.'
        return
    }
}
'@ -split "`r`n"

# ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒãªã„å ´åˆã¯ã€æ–°è¦ä½œæˆ
if (-Not(Test-Path $PROFILE)) {
    # ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒãªã„ãŸã‚ã€æ–°è¦ä½œæˆ
    $utf8Encoding = New-Object System.Text.UTF8Encoding $true
    [System.IO.File]::WriteAllText($PROFILE, ($header + $ps_source, $utf8Encoding)
}

# è‡ªä½œFunctionã‚’æ ¼ç´ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãŒãªã„å ´åˆã¯ã€æ–°è¦ä½œæˆ
[System.String]$psfolder_path = "$PROFILE\..\user-defined-ps"
if (-Not(Test-Path $psfolder_path)) {
    # ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹å ´æ‰€ã«ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’ä½œæˆ
    New-Item -Path $psfolder_path -ItemType 'directory' -Force
}

# $PROFILE ãŒ UTF-8BOMã§ã‚ã‚‹ã‹ç¢ºèª
$UTF8_BOM = [System.Byte[]](0xEF,0xBB,0xBF)
[System.Byte[]]$first_3bytes = (Get-Content -Path $targetfile -Encoding Byte -TotalCount 3)
if (-Not($null -eq (Compare-Object $first_3bytes $UTF8_BOM -SyncWindow 0))) {
    Write-Host "ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆ[$PROFILE]ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ãŒUTF-8 BOMã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚" -ForegroundColor Red
    return
}

# $ps_source å†…ã®FunctionãŒã„ãšã‚Œã‚‚$PROFILEã«ç™»éŒ²ã•ã‚Œã¦ã„ãªã„å ´åˆã«è¿½åŠ 
$func_lines = $ps_source -split "`n" | Where-Object { $_ -match "^Function " }
if ($func_lines.Count -gt 0) {
    foreach ($line in $func_lines) {
        [System.String]$func_name = ($line -split ' ' | Select-Object -First 2)
        Write-Host $func_name
    }
}
Add-Content -Path $PROFILE -Value $ps_source

# è‡ªä½œFunctionæ ¼ç´ç”¨ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ å†…ã®FunctionãŒã„ãšã‚Œã‚‚$PROFILEã«ç™»éŒ²ã•ã‚Œã¦ã„ãªã„å ´åˆã«è¿½åŠ 

Add-Content -Path $PROFILE -Value (Get-ChildItem "$psfolder_path\*.ps1")
```

## é–¢é€£è¨˜äº‹

https://haretokidoki-blog.com/pasocon_powershell-startup/
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960

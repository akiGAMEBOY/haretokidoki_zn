---
title: "PowerShellãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•ç™»éŒ²ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆè‡ªä½œFunctionã®è¿½åŠ ã§ä½¿ç”¨ï¼‰"
emoji: "ğŸ•Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell"]
published: false
---
## æ¦‚è¦

[ã“ã¡ã‚‰](https://zenn.dev/haretokidoki/articles/1632e92c37ea98)ã®è¨˜äº‹ã§ãƒ‡ãƒ¼ã‚¿å‹ã‚’ç¢ºèªã§ãã‚‹Functionã‚’è‡ªä½œã—ã¾ã—ãŸã€‚
ã“ã®ã‚ˆã†ãªè‡ªä½œFunctionã¯ã€PowerShellã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«ç™»éŒ²ã™ã‚‹äº‹ã§ã€èµ·å‹•ã™ã‚‹ãŸã³ã«å®šç¾©ã—ãªãã¦ã‚‚ç°¡å˜ã«å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚

ãŸã ã€ç’°å¢ƒãŒå¤‰ã‚ã‚Šæ–°ã—ã„ãƒ‘ã‚½ã‚³ãƒ³ã§ä½œæ¥­ã™ã‚‹äº‹ã«ãªã£ãŸå ´åˆã€å†åº¦ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç™»éŒ²ã‚„è‡ªä½œã—ãŸFunctionã‚’ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šé¢å€’ã«æ„Ÿã˜ã¦ã„ã¾ã—ãŸã€‚

ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ç‚ºã€ä»Šå›ã¯PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã§è‡ªä½œã—ãŸFunctionã®PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ*.ps1ï¼‰ã‚’èª­ã¿è¾¼ã¿ã€
ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®å®šç¾©ã«è¿½åŠ ã™ã‚‹PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚

## ã‚³ãƒ¼ãƒ‰

https://www.zacoding.com/post/powershell-profile/

```:kick.bat
@REM PowerShell Core ã§å®Ÿè¡Œã™ã‚‹å ´åˆ
cd "ps1ãƒ•ã‚¡ã‚¤ãƒ«ã®æ ¼ç´å ´æ‰€"

@REM PowerShell Core ã§å®Ÿè¡Œã™ã‚‹å ´åˆ
pwsh -NoProfile -ExecutionPolicy RemoteSigned -File "%~dp0\Main.ps1"

@REM PowerShell 5.1  ã§å®Ÿè¡Œã™ã‚‹å ´åˆ
REM powershell -NoProfile -ExecutionPolicy RemoteSigned -File "%~dp0\Main.ps1"
```

```powershell:
# PowerShellãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ˜ãƒƒãƒ€ãƒ¼
[System.String[]]$header = @"
#################################################################################
# PowerShellãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
# ï¼ˆ$($PROFILE)ï¼‰
#
#################################################################################


"@

# PowerShellãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½è¨˜ã™ã‚‹è‡ªä½œFunction
[System.String[]]$source_code = @'
#################################################################################
# å‡¦ç†åã€€ | Get-Datatype
# æ©Ÿèƒ½ã€€ã€€ | å¤‰æ•°ã®ãƒ‡ãƒ¼ã‚¿å‹ã‚’ç¢ºèª
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/1632e92c37ea98
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | ãƒ‡ãƒ¼ã‚¿å‹ã‚’è¡¨ç¤ºï¼ˆé …ç›®1:BaseTypeã€é …ç›®2ï¼šTypeï¼‰
# å¼•æ•°ã€€ã€€ | $variable èª¿æŸ»å¯¾è±¡ã®å¤‰æ•°
#################################################################################
Function Get-Datatype {
	param (
	    [Parameter(Mandatory=$true)]$variable
	)

    # æ–‡å­—åˆ—é…åˆ—ã‚’å®£è¨€
	[System.String[]]$rowdata = @(
		$variable.GetType().BaseType.FullName,      # å¤‰æ•°ã®ãƒ™ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—
		$variable.GetType().FullName                # å¤‰æ•°ã®ãƒ‡ãƒ¼ã‚¿å‹
	)
	
    # PSCustomObjectã§é …ç›®åã‚’è¨­å®š
	$types_table = [PSCustomObject]@{
		BaseType = $rowdata[0]
		DataType = $rowdata[1]
	}

    # ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§è¡¨ç¤º
    $types_table | Format-Table -Property BaseType, DataType -AutoSize -Wrap
}

#################################################################################
# å‡¦ç†åã€€ | isAdminPowerShell
# æ©Ÿèƒ½ã€€ã€€ | PowerShellãŒç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã—ã¦ã„ã‚‹ã‹ç¢ºèª
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/67788ca9b47b27
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Booleanï¼ˆTrue: ç®¡ç†è€…æ¨©é™ã‚ã‚Š, False: ç®¡ç†è€…æ¨©é™ãªã—ï¼‰
# å¼•æ•°ã€€ã€€ | -
#################################################################################
Function isAdminPowerShell {
    $win_id = [System.Security.Principal.WindowsIdentity]::GetCurrent()
    $win_principal = new-object System.Security.Principal.WindowsPrincipal($win_id)
    $admin_permission = [System.Security.Principal.WindowsBuiltInRole]::Administrator
    return $win_principal.IsInRole($admin_permission)
}

#################################################################################
# å‡¦ç†åã€€ | GetPsCharcode
# æ©Ÿèƒ½ã€€ã€€ | PowerShellã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/67788ca9b47b27
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | ps_charcode[]
#          |  - é …ç›®01 æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã§ãã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã®æ—¢å®šå€¤
#          |  - é …ç›®02 PowerShellã‹ã‚‰å¤–éƒ¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«æ¸¡ã™æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®è¨­å®š
#          |  - é …ç›®01 PowerShellã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã™ã‚‹æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®è¨­å®š
# å¼•æ•°ã€€ã€€ | -
#################################################################################
Function GetPsCharcode {
    [System.String[]]$ps_charcode = @()
    $ps_charcode = @(
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã§ãã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã®æ—¢å®šå€¤
        ($PSDefaultParameterValues['*:Encoding']),
        # PowerShellã‹ã‚‰å¤–éƒ¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«æ¸¡ã™æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®è¨­å®š
        ($global:OutputEncoding).WebName,
        # PowerShellã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã™ã‚‹æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®è¨­å®š
        ([console]::OutputEncoding).WebName
    )

    return $ps_charcode
}

#################################################################################
# å‡¦ç†åã€€ | ChangeWindowTitle
# æ©Ÿèƒ½ã€€ã€€ | PowerShellã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´ï¼ˆæ–‡å­—ã‚³ãƒ¼ãƒ‰ã¨PowerShellã®ç®¡ç†è€…æ¨©é™æœ‰ç„¡ã‚’è¿½åŠ ï¼‰
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/67788ca9b47b27
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | -
# å¼•æ•°ã€€ã€€ | -
#################################################################################
# PowerShellã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´
Function ChangeWindowTitle {
    # åŒºåˆ‡ã‚Šæ–‡å­—ã®è¨­å®š
    [System.String]$pos1 = '|'
    [System.String]$pos2 = ';'

    # ç¾åœ¨ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å–å¾—
    [System.String]$title = $Host.UI.RawUI.WindowTitle
    [System.String]$base_title = $title

    # æ—¢ã«ã“ã®Functionã§ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´ã—ã¦ã„ã‚‹å ´åˆã€ä¸€ç•ªå·¦ã«ã‚ã‚‹æ–‡å­—åˆ—ã‚’æŠ½å‡º
    [System.String[]]$title_array = $title.Split($pos1)
    if ($title_array.Length -ne 0) {
        $base_title = ($title_array[0]).TrimEnd()
    }

    # ç¾åœ¨ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã‚¿ã‚¤ãƒˆãƒ«ã«è¿½åŠ 
    [System.String[]]$ps_charcode = GetPsCharcode

    [System.String]$change_title = $base_title
    if (isAdminPowerShell) {
        # ç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã—ã¦ã„ã‚‹å ´åˆ
        $change_title = $base_title + " $pos1 " +
                        "DefaultParameter='$($ps_charcode[0])'" + " $pos2 " +
                        "GlobalEncoding='$($ps_charcode[1])'" + " $pos2 " +
                        "ConsoleEncoding='$($ps_charcode[2])'" + " $pos2 " +
                        "#Administrator"
    }
    else {
        # ç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã—ã¦ã„ãªã„å ´åˆ
        $change_title = $base_title + " $pos1 " +
                        "DefaultParameter='$($ps_charcode[0])'" + " $pos2 " +
                        "GlobalEncoding='$($ps_charcode[1])'" + " $pos2 " +
                        "ConsoleEncoding='$($ps_charcode[2])'" + " $pos2 " +
                        "#Not_Administrator"
    }
    $Host.UI.RawUI.WindowTitle = $change_title

    # å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    Write-Host 'ã‚¿ã‚¤ãƒˆãƒ«ã«â€œæ–‡å­—ã‚³ãƒ¼ãƒ‰â€ã¨â€œç®¡ç†è€…æ¨©é™ã®æœ‰ç„¡â€ã®æƒ…å ±ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚' -ForegroundColor Cyan
}

#################################################################################
# å‡¦ç†åã€€ | SetPsOutputEncoding
# æ©Ÿèƒ½ã€€ã€€ | PowerShellã«ãŠã‘ã‚‹è¤‡æ•°ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰è¨­å®šã‚’ä¸€æ‹¬å¤‰æ›´
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/8946231076f129
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | -
# å¼•æ•°ã€€ã€€ | $charcodeï¼ˆå¼•æ•°ã‚’çœç•¥ã—ãŸå ´åˆã¯ã€'reset_encoding'ã§è¨­å®šï¼‰
# ã€€ã€€ã€€ã€€ |  - 'utf8'          : UTF-8ã«è¨­å®š
# ã€€ã€€ã€€ã€€ |  - 'sjis'          : Shift-JISã«è¨­å®š
# ã€€ã€€ã€€ã€€ |  - 'ascii'         : US-ASCIIã«è¨­å®š
# ã€€ã€€ã€€ã€€ |  - 'rm_encoding'   : ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¼ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’å‰Šé™¤
# ã€€ã€€ã€€ã€€ |  - 'reset_encoding': è¦å®šå€¤ã«æˆ»ã™
#################################################################################
Function SetPsOutputEncoding {
    param (
        [System.String]$charcode = 'reset_encoding'
    )

    switch ($charcode) {
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’UTF8ã«è¨­å®šã™ã‚‹
        'utf8' {
            $PSDefaultParameterValues['*:Encoding'] = 'utf8'
            $global:OutputEncoding = [System.Text.Encoding]::UTF8
            [console]::OutputEncoding = [System.Text.Encoding]::UTF8
        }
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’Shift JISï¼ˆSJISï¼‰ã«è¨­å®šã™ã‚‹
        'sjis' {
            # $PSDefaultParameterValues['*:Encoding'] = 'default'ã«ã¤ã„ã¦
            #   ã“ã®è¨­å®šã¯Coreä»¥å¤–ï¼ˆ5.1ä»¥å‰ï¼‰ã®ç’°å¢ƒã§ã®ã¿Shift JISã§è¨­å®šã•ã‚Œã‚‹ã€‚
            #   Coreç’°å¢ƒã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯ã€UTF-8ã§ã‚ã‚ŠUTF-8ã§è¨­å®šã•ã‚Œã¦ã—ã¾ã†ã€‚
            #   ã¾ãŸã€Shift JISã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚‚å­˜åœ¨ã—ãªã„ç‚ºã€Coreç’°å¢ƒã§Shift JISã®è¨­å®šã¯ä¸å¯ã¨ãªã‚‹ã€‚
            $PSDefaultParameterValues['*:Encoding'] = 'default'
            $global:OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
            [console]::OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
        }
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ASCIIã«è¨­å®šã™ã‚‹
        'ascii' {
            $PSDefaultParameterValues.Remove('*:Encoding')
            $global:OutputEncoding = [System.Text.Encoding]::ASCII
            [console]::OutputEncoding = [System.Text.Encoding]::ASCII
        }
        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æŒ‡å®šã‚’è§£é™¤ã™ã‚‹
        'rm_encoding' {
            $PSDefaultParameterValues.Remove('*:Encoding')
        }
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰è¨­å®šã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
        'reset_encoding' {
            $PSDefaultParameterValues.Remove('*:Encoding')

            If ($PSVersionTable.PSEdition -eq 'Core') {
                # Core ã®å ´åˆ
                $global:OutputEncoding = [System.Text.Encoding]::UTF8
                [console]::OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
            }
            else {
                # Core ä»¥å¤–ã®å ´åˆï¼ˆPowerShell 5.1 ä»¥å‰ï¼‰
                $global:OutputEncoding = [System.Text.Encoding]::ASCII
                [console]::OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
            }
        }
    }
    # ã‚¿ã‚¤ãƒˆãƒ«ã®è¡¨ç¤ºåˆ‡æ›¿Functionå‘¼ã³å‡ºã—
    ChangeWindowTitle
}

'@ -split "`r`n"

# ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒãªã„å ´åˆã¯ã€æ–°è¦ä½œæˆ
if (-Not(Test-Path $PROFILE)) {
    # False ã® å ´åˆã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒãªã„ãŸã‚ã€æ–°è¦ä½œæˆ
    $utf8Encoding = New-Object System.Text.UTF8Encoding $true
    [System.IO.File]::WriteAllText($PROFILE, $header, $utf8Encoding)
}

# è‡ªä½œFunctionã‚’æ ¼ç´ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãŒãªã„å ´åˆã¯ã€æ–°è¦ä½œæˆ
[System.String]$psfolder_path = "$PROFILE\..\user-defined-ps"
if (-Not(Test-Path $psfolder_path)) {
    # ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹å ´æ‰€ã«ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’ä½œæˆ
    New-Item -Path $psfolder_path -ItemType 'directory' -Force
}

# $PROFILE ãŒ UTF-8BOMã§ã‚ã‚‹ã‹ç¢ºèª
$stream_reader = [System.IO.StreamReader] $PROFILE
$profile_encoding = $stream_reader.CurrentEncoding
$stream_reader.Close()
$profile_encoding

# ä¸‹è¨˜ãŒã‚³ãƒãƒ³ãƒ‰ã§ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«ç™»éŒ²ã™ã‚‹å ´åˆ
Add-Content -Path $PROFILE -Value $source_code

# ä¸‹è¨˜ã®ã‚³ãƒ¼ãƒ‰ãŒPowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªä½œFunctionæ ¼ç´ç”¨ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«ä¿å­˜ã—ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«ç™»éŒ²ã™ã‚‹æ–¹æ³•
Add-Content -Path $PROFILE -Value (Get-ChildItem "$psfolder_path\*.ps1")

# ä¸‹è¨˜ã®ã‚³ãƒ¼ãƒ‰ãŒPowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰è‡ªä½œFunctionæ ¼ç´ç”¨ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’ç›´æ¥å‚ç…§ã—ã€å®šç¾©ã™ã‚‹æ–¹æ³•
# (https://www.zacoding.com/post/powershell-profile/#ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†é›¢ã—ã¦èª­ã¿è¾¼ã‚€)
Get-ChildItem "$psfolder_path\*.ps1" | %{.$_}

```

PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ*.ps1ï¼‰ã‚’ä½œæˆã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

1. PowerShellã‚’é–‹ãã¾ã™ã€‚
2. æ–°ã—ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ã€`New-Item` ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€`New-Item -Path "C:\path\to\your\script.ps1" -ItemType File` ã¨å…¥åŠ›ã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚
3. ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã«ã¯ã€`Add-Content` ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã¾ãŸã¯ `Set-Content` ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€`Add-Content -Path "C:\path\to\your\script.ps1" -Value "ã“ã“ã«ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ "` ã¨å…¥åŠ›ã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚

è¤‡æ•°è¡Œã®ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ‹¬ã§è¿½åŠ ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚

```powershell
$code = @"
ã“ã“ã«
è¤‡æ•°è¡Œã®
ã‚³ãƒ¼ãƒ‰ã‚’
è¿½åŠ 
"@

Add-Content -Path "C:\path\to\your\script.ps1" -Value $code
```

```powershell:
$source_code = @"

"@

#################################################################################
# å‡¦ç†åã€€ | WindowsUpdateTool
# æ©Ÿèƒ½ã€€ã€€ | è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ã®å˜èªæ¤œç´¢ãƒ„ãƒ¼ãƒ«
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | MESSAGECODEï¼ˆenumï¼‰
# å¼•æ•°ã€€ã€€ | ãªã—
#################################################################################
# è¨­å®š
# å®šç¾©ã•ã‚Œã¦ã„ãªã„å¤‰æ•°ãŒã‚ã£ãŸå ´åˆã«ã‚¨ãƒ©ãƒ¼ã¨ã™ã‚‹
Set-StrictMode -Version Latest
# ã‚¢ã‚»ãƒ³ãƒ–ãƒªèª­ã¿è¾¼ã¿
#   ãƒ•ã‚©ãƒ¼ãƒ ç”¨
Add-Type -AssemblyName System.Windows.Forms
Add-Type -AssemblyName System.Drawing
# try-catchã®éš›ã€ä¾‹å¤–æ™‚ã«catchã®å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹
$ErrorActionPreference = 'Stop'
# ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ enumè¨­å®š
Add-Type -TypeDefinition @"
    public enum MESSAGECODE {
        Successful = 0,
        Abend,
        Cancel,
        Info_LoadedSettingfile,
        Info_SkipUpdate,
        Info_SkipMSDefenderInvalid,
        Info_SkipSelectWindowsUpdate,
        Info_SkipSelectMSDefender,
        Info_SkipSelectWinget,
        Confirm_ExecutionTool,
        Confirm_ExecuteWindowsUpdate,
        Confirm_ExecuteMSDedender,
        Confirm_ExecuteWinget,
        Confirm_ExecuteWinget_Individual,
        Error_NotCore,
        Error_NotSupportedVersion,
        Error_NotWindows,
        Error_LoadingSettingfile,
        Error_EmptyTargetfolder,
        Error_NotCheckbox,
        Error_MaxRetries,
        Error_InstallModules,
        Error_GetWinUpdate,
        Error_WinUpdate_all,
        Error_WinUpdate_Individual,
        Error_MSDefenderStatusCheck,
        Error_UpdateMSDefender_Exception,
        Error_UpdateMSDefender_Returnerror,
        Error_UpdateWinget_Exception,
        Error_UpdateWinget_Returnerror,
        Error_CheckWinget,
        Error_WingetNotInstall,
        Error_WingetUpgrade
    }
"@

### DEBUG ###
Set-Variable -Name "DEBUG_ON" -Value $false -Option Constant

### Function --- é–‹å§‹ --->
#################################################################################
# å‡¦ç†åã€€ | isAdminPowerShell
# æ©Ÿèƒ½ã€€ã€€ | PowerShellãŒç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã—ã¦ã„ã‚‹ã‹ç¢ºèª
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/67788ca9b47b27
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Booleanï¼ˆTrue: ç®¡ç†è€…æ¨©é™ã‚ã‚Š, False: ç®¡ç†è€…æ¨©é™ãªã—ï¼‰
# å¼•æ•°ã€€ã€€ | -
#################################################################################
Function isAdminPowerShell {
    $win_id = [System.Security.Principal.WindowsIdentity]::GetCurrent()
    $win_principal = new-object System.Security.Principal.WindowsPrincipal($win_id)
    $admin_permission = [System.Security.Principal.WindowsBuiltInRole]::Administrator
    return $win_principal.IsInRole($admin_permission)
}

#################################################################################
# å‡¦ç†åã€€ | GetPsCharcode
# æ©Ÿèƒ½ã€€ã€€ | PowerShellã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/67788ca9b47b27
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | ps_charcode[]
#          |  - é …ç›®01 æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã§ãã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã®æ—¢å®šå€¤
#          |  - é …ç›®02 PowerShellã‹ã‚‰å¤–éƒ¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«æ¸¡ã™æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®è¨­å®š
#          |  - é …ç›®01 PowerShellã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã™ã‚‹æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®è¨­å®š
# å¼•æ•°ã€€ã€€ | -
#################################################################################
Function GetPsCharcode {
    [System.String[]]$ps_charcode = @()
    $ps_charcode = @(
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã§ãã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã®æ—¢å®šå€¤
        ($PSDefaultParameterValues['*:Encoding']),
        # PowerShellã‹ã‚‰å¤–éƒ¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«æ¸¡ã™æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®è¨­å®š
        ($global:OutputEncoding).WebName,
        # PowerShellã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã™ã‚‹æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®è¨­å®š
        ([console]::OutputEncoding).WebName
    )

    return $ps_charcode
}

#################################################################################
# å‡¦ç†åã€€ | ChangeWindowTitle
# æ©Ÿèƒ½ã€€ã€€ | PowerShellã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´ï¼ˆæ–‡å­—ã‚³ãƒ¼ãƒ‰ã¨PowerShellã®ç®¡ç†è€…æ¨©é™æœ‰ç„¡ã‚’è¿½åŠ ï¼‰
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/67788ca9b47b27
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | -
# å¼•æ•°ã€€ã€€ | -
#################################################################################
# PowerShellã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´
Function ChangeWindowTitle {
    # åŒºåˆ‡ã‚Šæ–‡å­—ã®è¨­å®š
    [System.String]$pos1 = '|'
    [System.String]$pos2 = ';'

    # ç¾åœ¨ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å–å¾—
    [System.String]$title = $Host.UI.RawUI.WindowTitle
    [System.String]$base_title = $title

    # æ—¢ã«ã“ã®Functionã§ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´ã—ã¦ã„ã‚‹å ´åˆã€ä¸€ç•ªå·¦ã«ã‚ã‚‹æ–‡å­—åˆ—ã‚’æŠ½å‡º
    [System.String[]]$title_array = $title.Split($pos1)
    if ($title_array.Length -ne 0) {
        $base_title = ($title_array[0]).TrimEnd()
    }

    # ç¾åœ¨ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã‚¿ã‚¤ãƒˆãƒ«ã«è¿½åŠ 
    [System.String[]]$ps_charcode = GetPsCharcode

    [System.String]$change_title = $base_title
    if (isAdminPowerShell) {
        # ç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã—ã¦ã„ã‚‹å ´åˆ
        $change_title = $base_title + " $pos1 " +
                        "DefaultParameter='$($ps_charcode[0])'" + " $pos2 " +
                        "GlobalEncoding='$($ps_charcode[1])'" + " $pos2 " +
                        "ConsoleEncoding='$($ps_charcode[2])'" + " $pos2 " +
                        "#Administrator"
    }
    else {
        # ç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã—ã¦ã„ãªã„å ´åˆ
        $change_title = $base_title + " $pos1 " +
                        "DefaultParameter='$($ps_charcode[0])'" + " $pos2 " +
                        "GlobalEncoding='$($ps_charcode[1])'" + " $pos2 " +
                        "ConsoleEncoding='$($ps_charcode[2])'" + " $pos2 " +
                        "#Not_Administrator"
    }
    $Host.UI.RawUI.WindowTitle = $change_title

    # å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    Write-Host 'ã‚¿ã‚¤ãƒˆãƒ«ã«â€œæ–‡å­—ã‚³ãƒ¼ãƒ‰â€ã¨â€œç®¡ç†è€…æ¨©é™ã®æœ‰ç„¡â€ã®æƒ…å ±ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚' -ForegroundColor Cyan
}

#################################################################################
# å‡¦ç†åã€€ | SetPsOutputEncoding
# æ©Ÿèƒ½ã€€ã€€ | PowerShellã«ãŠã‘ã‚‹è¤‡æ•°ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰è¨­å®šã‚’ä¸€æ‹¬å¤‰æ›´
#          | å‚è€ƒæƒ…å ±ï¼šhttps://zenn.dev/haretokidoki/articles/8946231076f129
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | -
# å¼•æ•°ã€€ã€€ | $charcodeï¼ˆå¼•æ•°ã‚’çœç•¥ã—ãŸå ´åˆã¯ã€'reset_encoding'ã§è¨­å®šï¼‰
# ã€€ã€€ã€€ã€€ |  - 'utf8'          : UTF-8ã«è¨­å®š
# ã€€ã€€ã€€ã€€ |  - 'sjis'          : Shift-JISã«è¨­å®š
# ã€€ã€€ã€€ã€€ |  - 'ascii'         : US-ASCIIã«è¨­å®š
# ã€€ã€€ã€€ã€€ |  - 'rm_encoding'   : ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¼ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’å‰Šé™¤
# ã€€ã€€ã€€ã€€ |  - 'reset_encoding': è¦å®šå€¤ã«æˆ»ã™
#################################################################################
Function SetPsOutputEncoding {
    param (
        [System.String]$charcode = 'reset_encoding'
    )

    switch ($charcode) {
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’UTF8ã«è¨­å®šã™ã‚‹
        'utf8' {
            $PSDefaultParameterValues['*:Encoding'] = 'utf8'
            $global:OutputEncoding = [System.Text.Encoding]::UTF8
            [console]::OutputEncoding = [System.Text.Encoding]::UTF8
        }
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’Shift JISï¼ˆSJISï¼‰ã«è¨­å®šã™ã‚‹
        'sjis' {
            # $PSDefaultParameterValues['*:Encoding'] = 'default'ã«ã¤ã„ã¦
            #   ã“ã®è¨­å®šã¯Coreä»¥å¤–ï¼ˆ5.1ä»¥å‰ï¼‰ã®ç’°å¢ƒã§ã®ã¿Shift JISã§è¨­å®šã•ã‚Œã‚‹ã€‚
            #   Coreç’°å¢ƒã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯ã€UTF-8ã§ã‚ã‚ŠUTF-8ã§è¨­å®šã•ã‚Œã¦ã—ã¾ã†ã€‚
            #   ã¾ãŸã€Shift JISã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚‚å­˜åœ¨ã—ãªã„ç‚ºã€Coreç’°å¢ƒã§Shift JISã®è¨­å®šã¯ä¸å¯ã¨ãªã‚‹ã€‚
            $PSDefaultParameterValues['*:Encoding'] = 'default'
            $global:OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
            [console]::OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
        }
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ASCIIã«è¨­å®šã™ã‚‹
        'ascii' {
            $PSDefaultParameterValues.Remove('*:Encoding')
            $global:OutputEncoding = [System.Text.Encoding]::ASCII
            [console]::OutputEncoding = [System.Text.Encoding]::ASCII
        }
        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æŒ‡å®šã‚’è§£é™¤ã™ã‚‹
        'rm_encoding' {
            $PSDefaultParameterValues.Remove('*:Encoding')
        }
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰è¨­å®šã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
        'reset_encoding' {
            $PSDefaultParameterValues.Remove('*:Encoding')

            If ($PSVersionTable.PSEdition -eq 'Core') {
                # Core ã®å ´åˆ
                $global:OutputEncoding = [System.Text.Encoding]::UTF8
                [console]::OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
            }
            else {
                # Core ä»¥å¤–ã®å ´åˆï¼ˆPowerShell 5.1 ä»¥å‰ï¼‰
                $global:OutputEncoding = [System.Text.Encoding]::ASCII
                [console]::OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
            }
        }
    }
    # ã‚¿ã‚¤ãƒˆãƒ«ã®è¡¨ç¤ºåˆ‡æ›¿Functionå‘¼ã³å‡ºã—
    ChangeWindowTitle
}

#################################################################################
# å‡¦ç†åã€€ | AcquisitionFormsize
# æ©Ÿèƒ½ã€€ã€€ | Windowsãƒ•ã‚©ãƒ¼ãƒ ç”¨ã®ã‚µã‚¤ã‚ºã‚’ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚µã‚¤ã‚ºã‹ã‚‰é™¤ç®—ã§è¨­å®š
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | String[]ï¼ˆå¤‰æ›å¾Œã®ã‚µã‚¤ã‚ºï¼š1è¦ç´ ç›® æ¨ªã‚µã‚¤ã‚ºã€2è¦ç´ ç›® ç¸¦ã‚µã‚¤ã‚ºï¼‰
# å¼•æ•°ã€€ã€€ | divisor: é™¤æ•°ï¼ˆãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚µã‚¤ã‚ºã‹ã‚‰é™¤ç®—ã™ã‚‹ãŸã‚ï¼‰
#################################################################################
Function AcquisitionFormsize {
    param (
        [System.UInt32]$divisor
    )

    # ç¾åœ¨ã®ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚µã‚¤ã‚ºã‚’å–å¾—
    [Microsoft.Management.Infrastructure.CimInstance]$graphics_info = (Get-CimInstance -ClassName Win32_VideoController)
    [System.UInt32]$width = $graphics_info.CurrentHorizontalResolution
    [System.UInt32]$height = $graphics_info.CurrentVerticalResolution

    # ãƒ¢ãƒ‹ã‚¿ãƒ¼ã®ã‚µã‚¤ã‚ºã‹ã‚‰é™¤æ•°ã§å‰²ã‚‹
    [System.UInt32]$form_width = $width / $divisor
    [System.UInt32]$form_height = $height / $divisor
    
    [System.UInt32[]]$form_size = @($form_width, $form_height)

    ### DEBUG ###
    if ($DEBUG_ON) {
        [void](Write-Host '### DEBUG PRINT ###')
        [void](Write-Host '')

        [void](Write-Host "Function AcquisitionFormsize: form_size [${form_size}]")

        [void](Write-Host '')
        [void](Write-Host '###################')
        [void](Write-Host '')
        [void](Write-Host '')
    }

    return $form_size
}

#################################################################################
# å‡¦ç†åã€€ | ConfirmYesno
# æ©Ÿèƒ½ã€€ã€€ | YesNoå…¥åŠ›ï¼ˆWindowsãƒ•ã‚©ãƒ¼ãƒ ï¼‰
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Booleanï¼ˆTrue: æ­£å¸¸çµ‚äº†, False: å‡¦ç†ä¸­æ–­ï¼‰
# å¼•æ•°ã€€ã€€ | prompt_message: å…¥åŠ›å¿œç­”å¾…ã¡æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹
#################################################################################
Function ConfirmYesno {
    param (
        [System.String]$prompt_message,
        [System.String]$prompt_title='å®Ÿè¡Œå‰ã®ç¢ºèª'
    )

    # é™¤æ•°ã€Œ6ã€ã§å‰²ã£ãŸå€¤ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã‚µã‚¤ã‚ºã¨ã™ã‚‹
    [System.UInt32[]]$form_size = AcquisitionFormsize(6)

    # ãƒ•ã‚©ãƒ¼ãƒ ã®ä½œæˆ
    [System.Windows.Forms.Form]$form = New-Object System.Windows.Forms.Form
    $form.Text = $prompt_title
    $form.Size = New-Object System.Drawing.Size($form_size[0],$form_size[1])
    $form.StartPosition = 'CenterScreen'
    $form.Icon = [System.Drawing.Icon]::ExtractAssociatedIcon("${root_dir}\source\icon\shell32-296.ico")
    $form.MaximizeBox = $false
    $form.MinimizeBox = $false
    $form.FormBorderStyle = 'FixedSingle'

    # ãƒ”ã‚¯ãƒãƒ£ãƒœãƒƒã‚¯ã‚¹ä½œæˆ
    [System.Windows.Forms.PictureBox]$pic = New-Object System.Windows.Forms.PictureBox
    $pic.Size = New-Object System.Drawing.Size(($form_size[0] * 0.016), ($form_size[1] * 0.030))
    $pic.Image = [System.Drawing.Image]::FromFile("${root_dir}\source\icon\shell32-296.ico")
    $pic.Location = New-Object System.Drawing.Point(($form_size[0] * 0.0156),($form_size[1] * 0.0285))
    $pic.SizeMode = [System.Windows.Forms.PictureBoxSizeMode]::Zoom

    # ãƒ©ãƒ™ãƒ«ä½œæˆ
    [System.Windows.Forms.Label]$label = New-Object System.Windows.Forms.Label
    $label.Location = New-Object System.Drawing.Point(($form_size[0] * 0.04),($form_size[1] * 0.07))
    # $label.Size = New-Object System.Drawing.Size(($form_size[0] * 0.75),($form_size[1] * 0.075))
    $label.Size = New-Object System.Drawing.Size(($form_size[0] * 0.75),($form_size[1] * 0.3))
    $label.Text = $prompt_message
    $label.Font = New-Object System.Drawing.Font('ï¼­ï¼³ ã‚´ã‚·ãƒƒã‚¯',11)

    # OKãƒœã‚¿ãƒ³ã®ä½œæˆ
    [System.Windows.Forms.Button]$btnOkay = New-Object System.Windows.Forms.Button
    $btnOkay.Location = New-Object System.Drawing.Point(($form_size[0] - 205), ($form_size[1] - 90))
    $btnOkay.Size = New-Object System.Drawing.Size(75,30)
    $btnOkay.Text = 'OK'
    $btnOkay.DialogResult = [System.Windows.Forms.DialogResult]::OK

    # Cancelãƒœã‚¿ãƒ³ã®ä½œæˆ
    [System.Windows.Forms.Button]$btnCancel = New-Object System.Windows.Forms.Button
    $btnCancel.Location = New-Object System.Drawing.Point(($form_size[0] - 115), ($form_size[1] - 90))
    $btnCancel.Size = New-Object System.Drawing.Size(75,30)
    $btnCancel.Text = 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«'
    $btnCancel.DialogResult = [System.Windows.Forms.DialogResult]::Cancel

    # ãƒœã‚¿ãƒ³ã®ç´ã¥ã‘
    $form.AcceptButton = $btnOkay
    $form.CancelButton = $btnCancel

    # ãƒ•ã‚©ãƒ¼ãƒ ã«ç´ã¥ã‘
    $form.Controls.Add($pic)
    $form.Controls.Add($label)
    $form.Controls.Add($btnOkay)
    $form.Controls.Add($btnCancel)

    # ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º
    [System.Boolean]$is_selected = ($form.ShowDialog() -eq [System.Windows.Forms.DialogResult]::OK)
    $pic.Image.Dispose()
    $pic.Image = $null
    $form = $null

    ### DEBUG ###
    if ($DEBUG_ON) {
        [void](Write-Host '### DEBUG PRINT ###')
        [void](Write-Host '')

        [void](Write-Host "Function ConfirmYesno: is_selected [${is_selected}]")

        [void](Write-Host '')
        [void](Write-Host '###################')
        [void](Write-Host '')
        [void](Write-Host '')
    }

    return $is_selected
}

#################################################################################
# å‡¦ç†åã€€ | ValidateInputValues
# æ©Ÿèƒ½ã€€ã€€ | å…¥åŠ›å€¤ã®æ¤œè¨¼
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | MESSAGECODEï¼ˆenumï¼‰
# å¼•æ•°ã€€ã€€ | setting_parameters[]
# ã€€ã€€ã€€ã€€ |  - é …ç›®01 Windows Update ã‚’æ›´æ–°ã™ã‚‹
# ã€€ã€€ã€€ã€€ |  - é …ç›®02 Microsoft Defender ã‚’æ›´æ–°ã™ã‚‹
# ã€€ã€€ã€€ã€€ |  - é …ç›®03 ã‚¢ãƒ—ãƒª ã‚’æ›´æ–°ã™ã‚‹
#################################################################################
Function ValidateInputValues {
    param (
        [System.String[]]$setting_parameters
    )

    [MESSAGECODE]$messagecode = [MESSAGECODE]::Successful

    # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ç”¨
    [System.String]$messagebox_title = ''
    [System.String]$messagebox_messages = ''

    # ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
    # Windows Update / Microsoft Defnerder / ã‚¢ãƒ—ãƒª ã„ãšã‚Œã‚‚ã‹ã«ãƒã‚§ãƒƒã‚¯ãŒã‚ã‚‹äº‹
    if ((-Not([System.Convert]::ToBoolean($setting_parameters[0]))) -and
        (-Not([System.Convert]::ToBoolean($setting_parameters[1]))) -and
        (-Not([System.Convert]::ToBoolean($setting_parameters[2])))) {
        $messagecode = [MESSAGECODE]::Error_NotCheckbox
        $messagebox_messages = RetrieveMessage $messagecode
        $messagebox_title = 'å…¥åŠ›ãƒã‚§ãƒƒã‚¯'
        ShowMessagebox $messagebox_messages $messagebox_title
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        [void](Write-Host '### DEBUG PRINT ###')
        [void](Write-Host '')

        [void](Write-Host "Function ConfirmYesno: return [${messagecode}]")

        [void](Write-Host '')
        [void](Write-Host '###################')
        [void](Write-Host '')
        [void](Write-Host '')
    }

    return $messagecode
}

#################################################################################
# å‡¦ç†åã€€ | SwitchActiveWindow
# æ©Ÿèƒ½ã€€ã€€ | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®åˆ‡ã‚Šæ›¿ãˆ
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | ãªã—
# å¼•æ•°ã€€ã€€ | cscode: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦åˆ‡ã‚Šæ›¿ãˆã‚‹C#ã®ã‚³ãƒ¼ãƒ‰
# ã€€ã€€ã€€ã€€ | window_name: åˆ‡ã‚Šæ›¿ãˆã‚‹ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®åå‰
#################################################################################
Function SwitchActiveWindow {
    param (
        [System.String]$cscode_filepath,
        [System.String]$window_name
    )

    add-type -AssemblyName microsoft.VisualBasic
    add-type -AssemblyName System.Windows.Forms

    [System.String]$cscode = Get-Content $cscode_filepath -Raw -Encoding utf8

    $Win32 = add-type -memberDefinition $cscode -name "Win32ApiFunctions" -passthru
    
    $ps = Get-Process | Where-Object {$_.Name -match $window_name}
    foreach($process in $ps){
        $Win32::ActiveWindow($process.MainWindowHandle);
    }
}

#################################################################################
# å‡¦ç†åã€€ | SettingInputValues
# æ©Ÿèƒ½ã€€ã€€ | å…¥åŠ›ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®è¨­å®šï¼ˆWindowsãƒ•ã‚©ãƒ¼ãƒ ï¼‰
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Object[]
# ã€€ã€€ã€€ã€€ |  - é …ç›®01 å¯¾è±¡ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼        : ç”»é¢ã§ã®è¨­å®šå€¤ - ãƒ„ãƒ¼ãƒ«ã®ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã¨ã—ã¦ä½¿ç”¨
# å¼•æ•°ã€€ã€€ | function_parameters[]
# ã€€ã€€ã€€ã€€ |  - é …ç›®01 ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œå ´æ‰€                : ãƒ„ãƒ¼ãƒ«ã®å®Ÿè¡Œå ´æ‰€
# ã€€ã€€ã€€ã€€ |  - é …ç›®02 Windows Update ã‚’æ›´æ–°ã™ã‚‹     : åˆæœŸè¡¨ç¤ºç”¨ã®å€¤ - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®šå€¤ãŒåæ˜ 
# ã€€ã€€ã€€ã€€ |  - é …ç›®03 Microsoft Defender ã‚’æ›´æ–°ã™ã‚‹ : åˆæœŸè¡¨ç¤ºç”¨ã®å€¤ - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®šå€¤ãŒåæ˜ 
# ã€€ã€€ã€€ã€€ |  - é …ç›®04 ã‚¢ãƒ—ãƒª ã‚’æ›´æ–°ã™ã‚‹             : åˆæœŸè¡¨ç¤ºç”¨ã®å€¤ - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®šå€¤ãŒåæ˜ 
# ã€€ã€€ã€€ã€€ |  - é …ç›®05 ä¸€æ‹¬ or å€‹åˆ¥ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«     : åˆæœŸè¡¨ç¤ºç”¨ã®å€¤ - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®šå€¤ãŒåæ˜ 
#################################################################################
Function SettingInputValues {
    param (
        [System.Object[]]$function_parameters
    )

    # é™¤æ•°ã€Œ3ã€ã§å‰²ã£ãŸå€¤ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã‚µã‚¤ã‚ºã¨ã™ã‚‹
    [System.UInt32[]]$form_size = AcquisitionFormsize(3)

    # ãƒ•ã‚©ãƒ¼ãƒ ã®ä½œæˆ
    [System.String]$prompt_title = 'å®Ÿè¡Œå‰ã®è¨­å®š'
    [System.Windows.Forms.Form]$form = New-Object System.Windows.Forms.Form
    $form.Text = $prompt_title
    $form.Size = New-Object System.Drawing.Size($form_size[0],$form_size[1])
    $form.StartPosition = 'CenterScreen'
    $form.Icon = [System.Drawing.Icon]::ExtractAssociatedIcon("$($function_parameters[0])\source\icon\shell32-296.ico")
    $form.MaximizeBox = $false
    $form.MinimizeBox = $false
    $form.FormBorderStyle = 'FixedSingle'

    # Windows Update ã‚’æ›´æ–°ã™ã‚‹ - ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ä½œæˆ
    [System.Windows.Forms.CheckBox]$checkbox_selected_windowsupdate = New-Object System.Windows.Forms.CheckBox
    $checkbox_selected_windowsupdate.Location = New-Object System.Drawing.Point(($form_size[0] * 0.04), ($form_size[1] * 0.070))
    $checkbox_selected_windowsupdate.Size = New-Object System.Drawing.Size(20, 20)
    $checkbox_selected_windowsupdate.Checked = [System.Convert]::ToBoolean($function_parameters[1])
    $checkbox_selected_windowsupdate.Font = New-Object System.Drawing.Font('ï¼­ï¼³ ã‚´ã‚·ãƒƒã‚¯',11)

    # Windows Update ã‚’æ›´æ–°ã™ã‚‹ - ãƒ©ãƒ™ãƒ«ä½œæˆ
    [System.Windows.Forms.Label]$label_selected_windowsupdate = New-Object System.Windows.Forms.Label
    $label_selected_windowsupdate.Location = New-Object System.Drawing.Point(($form_size[0] *0.08),($form_size[1] * 0.070))
    $label_selected_windowsupdate.Size = New-Object System.Drawing.Size(($form_size[0] * 0.75),($form_size[1] * 0.075))
    $label_selected_windowsupdate.Text = 'Windows Update ã®æ›´æ–°ã‚’å®Ÿæ–½ã™ã‚‹'
    $label_selected_windowsupdate.Font = New-Object System.Drawing.Font('ï¼­ï¼³ ã‚´ã‚·ãƒƒã‚¯',11)

    # Microsoft Defender ã‚’æ›´æ–°ã™ã‚‹ - ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ä½œæˆ
    [System.Windows.Forms.CheckBox]$checkbox_selected_msdefender = New-Object System.Windows.Forms.CheckBox
    $checkbox_selected_msdefender.Location = New-Object System.Drawing.Point(($form_size[0] * 0.04), ($form_size[1] * 0.175))
    $checkbox_selected_msdefender.Size = New-Object System.Drawing.Size(20, 20)
    $checkbox_selected_msdefender.Checked = [System.Convert]::ToBoolean($function_parameters[2])
    $checkbox_selected_msdefender.Font = New-Object System.Drawing.Font('ï¼­ï¼³ ã‚´ã‚·ãƒƒã‚¯',11)

    # Microsoft Defender ã‚’æ›´æ–°ã™ã‚‹ - ãƒ©ãƒ™ãƒ«ä½œæˆ
    [System.Windows.Forms.Label]$label_selected_msdefender = New-Object System.Windows.Forms.Label
    $label_selected_msdefender.Location = New-Object System.Drawing.Point(($form_size[0] *0.08),($form_size[1] * 0.175))
    $label_selected_msdefender.Size = New-Object System.Drawing.Size(($form_size[0] * 0.75),($form_size[1] * 0.075))
    $label_selected_msdefender.Text = 'Microsoft Defender ã‚’æ›´æ–°ã™ã‚‹'
    $label_selected_msdefender.Font = New-Object System.Drawing.Font('ï¼­ï¼³ ã‚´ã‚·ãƒƒã‚¯',11)

    # ã‚¢ãƒ—ãƒª ã‚’æ›´æ–°ã™ã‚‹ - ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ä½œæˆ
    [System.Windows.Forms.CheckBox]$checkbox_selected_application = New-Object System.Windows.Forms.CheckBox
    $checkbox_selected_application.Location = New-Object System.Drawing.Point(($form_size[0] * 0.04), ($form_size[1] * 0.28))
    $checkbox_selected_application.Size = New-Object System.Drawing.Size(20, 20)
    $checkbox_selected_application.Checked = [System.Convert]::ToBoolean($function_parameters[3])
    $checkbox_selected_application.Font = New-Object System.Drawing.Font('ï¼­ï¼³ ã‚´ã‚·ãƒƒã‚¯',11)

    # ã‚¢ãƒ—ãƒª ã‚’æ›´æ–°ã™ã‚‹ - ãƒ©ãƒ™ãƒ«ä½œæˆ
    [System.Windows.Forms.Label]$label_selected_application = New-Object System.Windows.Forms.Label
    $label_selected_application.Location = New-Object System.Drawing.Point(($form_size[0] *0.08),($form_size[1] * 0.28))
    $label_selected_application.Size = New-Object System.Drawing.Size(($form_size[0] * 0.75),($form_size[1] * 0.075))
    $label_selected_application.Text = 'ã‚¢ãƒ—ãƒª ã‚’æ›´æ–°ã™ã‚‹'
    $label_selected_application.Font = New-Object System.Drawing.Font('ï¼­ï¼³ ã‚´ã‚·ãƒƒã‚¯',11)

    # ã‚¢ãƒ—ãƒª ã‚’æ›´æ–°ã™ã‚‹ - ç¢ºèªãƒœã‚¿ãƒ³ã®ä½œæˆ
    [System.Windows.Forms.Button]$btnCheck = New-Object System.Windows.Forms.Button
    $btnCheck.Location = New-Object System.Drawing.Point(($form_size[0] * 0.820), ($form_size[1] * 0.28))
    # $btnCheck.Size = New-Object System.Drawing.Size(75,25)
    $btnCheck.Size = New-Object System.Drawing.Size(60,25)
    $btnCheck.Text = 'ç¢ºèª'

    # Windows Update / ã‚¢ãƒ—ãƒª ä¸€æ‹¬æ›´æ–°ã™ã‚‹ - ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ä½œæˆ
    [System.Windows.Forms.CheckBox]$checkbox_all_update = New-Object System.Windows.Forms.CheckBox
    $checkbox_all_update.Location = New-Object System.Drawing.Point(($form_size[0] * 0.04), ($form_size[1] * 0.385))
    $checkbox_all_update.Size = New-Object System.Drawing.Size(20, 20)
    $checkbox_all_update.Checked = [System.Convert]::ToBoolean($function_parameters[4])
    $checkbox_all_update.Font = New-Object System.Drawing.Font('ï¼­ï¼³ ã‚´ã‚·ãƒƒã‚¯',11)

    # Windows Update / ã‚¢ãƒ—ãƒª ã‚’ä¸€æ‹¬æ›´æ–°ã™ã‚‹ - ãƒ©ãƒ™ãƒ«ä½œæˆ
    [System.Windows.Forms.Label]$label_all_update = New-Object System.Windows.Forms.Label
    $label_all_update.Location = New-Object System.Drawing.Point(($form_size[0] *0.08),($form_size[1] * 0.385))
    $label_all_update.Size = New-Object System.Drawing.Size(($form_size[0] * 0.75),($form_size[1] * 0.075))
    $label_all_update.Text = 'ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰Windows Update / ã‚¢ãƒ—ãƒª ã‚’ä¸€æ‹¬æ›´æ–°ã™ã‚‹'
    $label_all_update.Font = New-Object System.Drawing.Font('ï¼­ï¼³ ã‚´ã‚·ãƒƒã‚¯',11)

    # OKãƒœã‚¿ãƒ³ã®ä½œæˆ
    [System.Windows.Forms.Button]$btnOkay = New-Object System.Windows.Forms.Button
    $btnOkay.Location = New-Object System.Drawing.Point(($form_size[0] - 205), ($form_size[1] - 90))
    $btnOkay.Size = New-Object System.Drawing.Size(75,30)
    $btnOkay.Text = 'æ¬¡ã¸'
    $btnOkay.DialogResult = [System.Windows.Forms.DialogResult]::OK

    # Cancelãƒœã‚¿ãƒ³ã®ä½œæˆ
    [System.Windows.Forms.Button]$btnCancel = New-Object System.Windows.Forms.Button
    $btnCancel.Location = New-Object System.Drawing.Point(($form_size[0] - 115), ($form_size[1] - 90))
    $btnCancel.Size = New-Object System.Drawing.Size(75,30)
    $btnCancel.Text = 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«'
    $btnCancel.DialogResult = [System.Windows.Forms.DialogResult]::Cancel

    # ãƒœã‚¿ãƒ³ã®ç´ã¥ã‘
    $form.AcceptButton = $btnOkay
    $form.CancelButton = $btnCancel

    # ãƒ•ã‚©ãƒ¼ãƒ ã«ç´ã¥ã‘
    $form.Controls.Add($checkbox_selected_windowsupdate)
    $form.Controls.Add($label_selected_windowsupdate)
    $form.Controls.Add($checkbox_selected_msdefender)
    $form.Controls.Add($label_selected_msdefender)
    $form.Controls.Add($checkbox_selected_application)
    $form.Controls.Add($label_selected_application)
    $form.Controls.Add($checkbox_all_update)
    $form.Controls.Add($label_all_update)
    $form.Controls.Add($btnCheck)
    $form.Controls.Add($btnOkay)
    $form.Controls.Add($btnCancel)

    # Windows Update ã‚’æ›´æ–°ã™ã‚‹ ãƒ©ãƒ™ãƒ«ã®å‡¦ç†
    $label_selected_windowsupdate.add_click{
        $checkbox_selected_windowsupdate.Checked = !($checkbox_selected_windowsupdate.Checked)
    }

    # Microsoft Defender ã‚’æ›´æ–°ã™ã‚‹ ãƒ©ãƒ™ãƒ«ã®å‡¦ç†
    $label_selected_msdefender.add_click{
        $checkbox_selected_msdefender.Checked = !($checkbox_selected_msdefender.Checked)
    }

    # ã‚¢ãƒ—ãƒª ã‚’æ›´æ–°ã™ã‚‹ ãƒ©ãƒ™ãƒ«ã®å‡¦ç†
    $label_selected_application.add_click{
        $checkbox_selected_application.Checked = !($checkbox_selected_application.Checked)
    }

    # ã‚¢ãƒ—ãƒª ã‚’ä¸€æ‹¬æ›´æ–°ã™ã‚‹ ãƒ©ãƒ™ãƒ«ã®å‡¦ç†
    $label_all_update.add_click{
        $checkbox_all_update.Checked = !($checkbox_all_update.Checked)
    }

    # ç¢ºèªãƒœã‚¿ãƒ³ã®å‡¦ç†
    $btnCheck.add_click{
        # ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨ã™ã‚‹
        [System.String]$cscode_filepath = "$($function_parameters[0])\source\csharp\ActiveWindow.cs"
        SwitchActiveWindow $cscode_filepath 'cmd'
        Write-Host 'winget ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆçŠ¶æ³ã‚’ç¢ºèªä¸­ã§ã™...'
        Write-Host ''

        # ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå¯èƒ½ãªã‚¢ãƒ—ãƒªç¢ºèª
        [System.String[]]$command_result = (winget upgrade)
        Write-Host $command_result
        Write-Host ''
        Write-Host 'winget ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆçŠ¶æ³ã‚’ç¢ºèªãŒå®Œäº†ã—ã¾ã—ãŸã€‚å…ƒã®ç”»é¢ã«æˆ»ã‚Šä½œæ¥­ã‚’å†é–‹ã—ã¦ãã ã•ã„ã€‚'
    }

    # ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º
    [MESSAGECODE]$messagecode = [MESSAGECODE]::Successful
    [System.Int32]$max_retries = 3
    for ([System.Int32]$i=0; $i -le $max_retries; $i++) {
        if ($form.ShowDialog() -eq [System.Windows.Forms.DialogResult]::OK) {
            # å…¥åŠ›å€¤ã®ãƒã‚§ãƒƒã‚¯
            [System.String[]]$setting_parameters = @()
            $setting_parameters = @(
                $checkbox_selected_windowsupdate.Checked,
                $checkbox_selected_msdefender.Checked,
                $checkbox_selected_application.Checked
                $checkbox_all_update.Checked
            )
            $messagecode = ValidateInputValues $setting_parameters

            # ãƒã‚§ãƒƒã‚¯çµæœãŒæ­£å¸¸ã®å ´åˆ
            if ($messagecode -eq [MESSAGECODE]::Successful) {
                $form = $null
                break
            }
        }
        else {
            $setting_parameters = @()
            $form = $null
            break
        }
        # å†è©¦è¡Œå›æ•°ã‚’è¶…éå‰ã®å‡¦ç†
        if ($i -eq $max_retries) {
            $messagecode = [MESSAGECODE]::Error_MaxRetries
            $messagebox_messages = RetrieveMessage $messagecode
            $messagebox_title = 'å†è©¦è¡Œå›æ•°ã®è¶…é'
            ShowMessagebox $messagebox_messages $messagebox_title
            $setting_parameters = @()
            $form = $null
        }
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        [void](Write-Host '### DEBUG PRINT ###')
        [void](Write-Host '')

        [void](Write-Host "Function SettingInputValues: setting_parameters [${setting_parameters}]")

        [void](Write-Host '')
        [void](Write-Host '###################')
        [void](Write-Host '')
        [void](Write-Host '')
    }

    return $setting_parameters
}

#################################################################################
# å‡¦ç†åã€€ | RetrieveMessage
# æ©Ÿèƒ½ã€€ã€€ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã‚’å–å¾—
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Stringï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ï¼‰
# å¼•æ•°ã€€ã€€ | target_code; å¯¾è±¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚³ãƒ¼ãƒ‰, append_message: è¿½åŠ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä»»æ„ï¼‰
#################################################################################
Function RetrieveMessage {
    param (
        [MESSAGECODE]$target_code,
        [System.String]$append_message=''
    )

    [System.String]$return_messages = ''
    [System.String]$message = ''

    switch($target_code) {
        Successful                          {$message='æ­£å¸¸çµ‚äº†';break}
        Abend                               {$message='ç•°å¸¸çµ‚äº†';break}
        Cancel                              {$message='ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚';break}
        Info_LoadedSettingfile              {$message='è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã€‚';break}
        Info_SkipUpdate                     {$message='æœ€æ–°ã®çŠ¶æ…‹ã§ã‚ã‚‹ç‚ºã€æ›´æ–°å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—ã€‚';break}
        Info_SkipMSDefenderInvalid          {$message='Microsoft DefenderãŒç„¡åŠ¹çŠ¶æ…‹ã®ç‚ºã€æ›´æ–°å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—ã€‚';break}
        Info_SkipSelectWindowsUpdate        {$message='Windows Updateã®æ›´æ–°ã§ã‚¹ã‚­ãƒƒãƒ—ãŒé¸æŠã—ã¾ã—ãŸã€‚';break}
        Info_SkipSelectMSDefender           {$message='Microsoft Defenderã®æ›´æ–°ã§ã‚¹ã‚­ãƒƒãƒ—ãŒé¸æŠã—ã¾ã—ãŸã€‚';break}
        Info_SkipSelectWinget               {$message='winget ã®æ›´æ–°ã§ã‚¹ã‚­ãƒƒãƒ—ãŒé¸æŠã—ã¾ã—ãŸã€‚';break}
        Confirm_ExecutionTool               {$message='ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚';break}
        Confirm_ExecuteWindowsUpdate        {$message='Windows Updateã®æ›´æ–°ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚';break}
        Confirm_ExecuteMSDedender           {$message='Microsoft Defenderã®æ›´æ–°ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚';break}
        Confirm_ExecuteWinget               {$message='winget ã®æ›´æ–°ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚';break}
        Confirm_ExecuteWinget_Individual    {$message='å€‹åˆ¥ã« ã‚¢ãƒ—ãƒª ã®æ›´æ–°ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚';break}
        Error_NotCore                       {$message='PowerShellã‚¨ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ãŒã€Œ Core ã€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚';break}
        Error_NotSupportedVersion           {$message='PowerShellãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚µãƒãƒ¼ãƒˆå¯¾è±¡å¤–ã§ã™ã€‚ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³7æœªæº€ï¼‰';break}
        Error_NotWindows                    {$message='å®Ÿè¡Œç’°å¢ƒãŒWindows OSã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚';break}
        Error_LoadingSettingfile            {$message='è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';break}
        Error_EmptyTargetfolder             {$message='ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãŒç©ºã§æŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚';break}
        Error_NotCheckbox                   {$message='Windows Update / Microsoft Defender / ã‚¢ãƒ—ãƒª ã„ãšã‚Œã‚‚æœªé¸æŠ';break}
        Error_MaxRetries                    {$message='å†è©¦è¡Œå›æ•°ã‚’è¶…éã—ã¾ã—ãŸã€‚';break}
        Error_InstallModules                {$message='ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®å®Ÿè¡Œæ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';break}
        Error_GetWinUpdate                  {$message='Windows Updateã®æœ€æ–°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®ãƒã‚§ãƒƒã‚¯ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚';break}
        Error_UpdateWinUpdate_all           {$message='Windows Updateã®ä¸€æ‹¬æ›´æ–°ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';break}
        Error_UpdateWinUpdate_Individual    {$message='Windows Updateã®å€‹åˆ¥æ›´æ–°ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';break}
        Error_MSDefenderStatusCheck         {$message='Microsoft Defenderã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒã‚§ãƒƒã‚¯ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';break}
        Error_UpdateMSDefender_Exception    {$message='Microsoft Defenderã®æ›´æ–°å‡¦ç†ã§ä¾‹å¤–ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';break}
        Error_UpdateMSDefender_Returnerror  {$message='Microsoft Defenderã®æ›´æ–°çµæœãŒã‚¨ãƒ©ãƒ¼ã§ã—ãŸã€‚';break}
        Error_UpdateWinget_Exception        {$message='wingetã®æ›´æ–°å‡¦ç†ã§ä¾‹å¤–ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';break}
        Error_UpdateWinget_Returnerror      {$message='wingetã®æ›´æ–°çµæœãŒã‚¨ãƒ©ãƒ¼ã§ã—ãŸã€‚';break}
        Error_WingetNotInstall              {$message='winget å‹•ä½œãƒã‚§ãƒƒã‚¯ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã€‚ã‚¢ãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’å°å…¥ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚';break}
        Error_CheckWinget                   {$message='winget å‹•ä½œãƒã‚§ãƒƒã‚¯ã§ä¾‹å¤–ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';break}
        Error_WingetUpgrade                 {$message='winget ã«ãŠã‘ã‚‹æ›´æ–°ã‚¢ãƒ—ãƒªã®ç¢ºèªã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';break}
        default                             {break}
    }

    $sbtemp=New-Object System.Text.StringBuilder
    @("${message}`r`n",`
      "${append_message}`r`n")|
    ForEach-Object{[void]$sbtemp.Append($_)}
    $return_messages = $sbtemp.ToString()

    ### DEBUG ###
    if ($DEBUG_ON) {
        [void](Write-Host '### DEBUG PRINT ###')
        [void](Write-Host '')

        [void](Write-Host "Function RetrieveMessage: return_messages [${return_messages}]")

        [void](Write-Host '')
        [void](Write-Host '###################')
        [void](Write-Host '')
        [void](Write-Host '')
    }

    return $return_messages
}

#################################################################################
# å‡¦ç†åã€€ | ShowMessagebox
# æ©Ÿèƒ½ã€€ã€€ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ã®è¡¨ç¤º
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | ãªã—
# å¼•æ•°ã€€ã€€ | target_code; å¯¾è±¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚³ãƒ¼ãƒ‰, append_message: è¿½åŠ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä»»æ„ï¼‰
#################################################################################
Function ShowMessagebox {
    param (
        [System.String]$messages,
        [System.String]$title,
        [System.String]$level='Information'
        # æŒ‡å®šå¯èƒ½ãªãƒ¬ãƒ™ãƒ«ä¸€è¦§ï¼ˆ$levelï¼‰
        #   None
        #   Hand
        #   Error
        #   Stop
        #   Question
        #   Exclamation
        #   Waring
        #   Asterisk
        #   Information
    )

    [System.Windows.Forms.DialogResult]$dialog_result = [System.Windows.Forms.MessageBox]::Show($messages, $title, "OK", $level)
    
    switch($dialog_result) {
        {$_ -eq [System.Windows.Forms.DialogResult]::OK} {
            break
        }
    }
}

#################################################################################
# å‡¦ç†åã€€ | CreateExportFolder
# æ©Ÿèƒ½ã€€ã€€ | ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ ¼ç´ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’æ–°è¦ä½œæˆ
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Stringï¼ˆä½œæˆã—ãŸãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã€‚è©¦è¡Œå›æ•°ã®è¶…éã‚‚ã—ãã¯ã‚¨ãƒ©ãƒ¼ã§ä½œæˆã§ããªã‹ã£ãŸå ´åˆã¯ç©ºæ–‡å­—ã‚’è¿”ã™ï¼‰
# å¼•æ•°ã€€ã€€ | current_dir: ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ãƒ‘ã‚¹
# ã€€ã€€ã€€ã€€ | foldername : å¯¾è±¡ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼å
# ã€€ã€€ã€€ã€€ | max_retries: æœ€å¤§ã®ãƒªãƒˆãƒ©ã‚¤å›æ•°
#################################################################################
Function CreateExportFolder {
    param (
        [System.String]$current_dir,
        [System.String]$foldername,
        [System.Int32]$max_retries=30
    )

    [System.String]$newfoldername = $foldername
    [System.Int32]$i = 0
    [System.String]$nowdate = (Get-Date).ToString("yyyyMMdd")
    [System.String]$number = ''
    for ($i=1; $i -le $max_retries; $i++) {
        # ã‚«ã‚¦ãƒ³ãƒˆæ•°ã®æ•°å€¤ã‚’3æ¡ã§0åŸ‹ã‚ã—ãŸæ–‡å­—åˆ—ã«ã™ã‚‹
        $number = "{0:000}" -f $i
        # ä½œæˆã—ãŸã„ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã‚’ç”Ÿæˆ
        $newfoldername = "${foldername}_${nowdate}-${number}"
        # ä½œæˆã—ãŸã„ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
        if (-Not (Test-Path "${current_dir}\${newfoldername}")) {
            break
        }

        # ãƒªãƒˆãƒ©ã‚¤å›æ•°ã‚’è¶…éã—ä½œæˆã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã‚’æ±ºå®šã§ããªã‹ã£ãŸå ´åˆ
        if ($i -eq $max_retries) {
            $newfoldername = ''
        }
    }

    [System.String]$newfolder_path = ''
    if ($newfoldername -ne '') {
        $newfolder_path = "${current_dir}\${newfoldername}"
        try {
            New-Item -Path "${newfolder_path}" -Type Directory > $null
        }
        catch {
            $newfolder_path = ''
        }
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        [void](Write-Host '### DEBUG PRINT ###')
        [void](Write-Host '')

        [void](Write-Host "Function CreateTempFolder: newfolder_path [${newfolder_path}]")

        [void](Write-Host '')
        [void](Write-Host '###################')
        [void](Write-Host '')
        [void](Write-Host '')
    }

    return $newfolder_path
}

#################################################################################
# å‡¦ç†åã€€ | InstallModules
# æ©Ÿèƒ½ã€€ã€€ | ãƒªã‚¹ãƒˆã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | MESSAGECODEï¼ˆenumï¼‰
# å¼•æ•°ã€€ã€€ | install_modules : ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯¾è±¡ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
#################################################################################
Function InstallModules {
    param (
        [System.String[]]$function_parameters
    )

    [MESSAGECODE]$messagecode = [MESSAGECODE]::Successful

    [System.String[]]$modules_array = $function_parameters[0].Split(',')

    foreach ($module_name in $modules_array) {
        # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®æœ‰ç„¡ã‚’ãƒã‚§ãƒƒã‚¯
        if ($null -eq (Get-Module -Name "$module_name")) {
            # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒãªã„ç‚ºã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
            try {
                [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
                Install-Module -Name "$module_name"
                Import-Module -Name "$module_name"

                Write-Host "$module_name has been installed." -ForegroundColor Cyan
            }
            catch {
                $messagecode = [MESSAGECODE]::Error_InstallModules
            }
        }
        else {
            # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã®ç‚ºã€ã‚¹ã‚­ãƒƒãƒ—
            Write-Host "$module_name has been already installed."
        }
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        [void](Write-Host '### DEBUG PRINT ###')
        [void](Write-Host '')

        [void](Write-Host "Function InstallModules: messagecode [${messagecode}]")

        [void](Write-Host '')
        [void](Write-Host '###################')
        [void](Write-Host '')
        [void](Write-Host '')
    }

    return $messagecode
}
#################################################################################
# å‡¦ç†åã€€ | ExecuteWindowsUpdate
# æ©Ÿèƒ½ã€€ã€€ | WindowsUpdateã®å®Ÿè¡Œ
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | MESSAGECODEï¼ˆenumï¼‰
# å¼•æ•°ã€€ã€€ | ï¼
#################################################################################
Function ExecuteWindowsUpdate {
    param (
        [System.Boolean]$all_update
    )

    [MESSAGECODE]$messagecode = [MESSAGECODE]::Successful
    [System.String]$messagecode_messages = ''

    # æœ€æ–°ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’ãƒã‚§ãƒƒã‚¯
    try {
        # Get-WindowsUpdateã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã®ãƒ‡ãƒ¼ã‚¿å‹ã¯ã€ã‚­ãƒ¼ãƒˆãƒ¼ã‚¯ãƒ³ãªã©ã®æƒ…å ±ãŒã‚ã‚‹ç‚ºã€ãƒ‡ãƒ¼ã‚¿å‹ã®æŒ‡å®šã¯çœç•¥
        # System.Collections.ObjectModel.Collection`1[[System.Management.Automation.PSObject, System.Management.Automation, Version=7.3.10.500, Culture=neutral, PublicKeyToken=XXXXXXXXXXXXXXXX]]

        ### DEBUG ###
        if ($DEBUG_ON) {
            # ãƒ‡ãƒãƒƒã‚°ã ã¨ç®¡ç†è€…æ¨©é™ã§å®Ÿè¡Œã§ããªã„ç‚ºã€ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒãªã‹ã£ãŸã‚‚ã®ã¨ã—ã¦å‡¦ç†ã‚’é€²ã‚ã‚‹
            $update_target = ''
        }
        else {
            $update_target = (Get-WindowsUpdate | Out-String)
            Write-Host $update_target
        }
    }
    catch {
        $messagecode = [MESSAGECODE]::Error_GetWinUpdate
    }
    
    if ($messagecode -eq [MESSAGECODE]::Successful) {
        if ($update_target -eq '') {
            $messagecode_messages = RetrieveMessage ([MESSAGECODE]::Info_SkipUpdate)
            Write-Host $messagecode_messages

            return $messagecode
        }
    }

    # ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå®Ÿè¡Œï¼ˆã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒã‚ã‚‹å ´åˆï¼‰
    if ($messagecode -eq [MESSAGECODE]::Successful) {
        $messagecode_messages = RetrieveMessage ([MESSAGECODE]::Confirm_ExecuteWindowsUpdate)
        If (ConfirmYesno $messagecode_messages) {
            if ($all_update) {
                # ä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
                try {
                    Install-WindowsUpdate -AcceptAll
                }
                catch {
                    $messagecode = [MESSAGECODE]::Error_UpdateWinUpdate_all
                }
            }
            else {
                # å€‹åˆ¥ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
                try {
                    Install-WindowsUpdate
                }
                catch {
                    $messagecode = [MESSAGECODE]::Error_WinUpdate_Individual
                }
            }
        }
        else {
            $messagecode_messages = RetrieveMessage ([MESSAGECODE]::Info_SkipSelectWindowsUpdate)
            Write-Host $messagecode_messages
        }
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        Write-Host '### DEBUG PRINT ###'
        Write-Host ''

        Write-Host "Function ExecuteWindowsUpdate: messagecode [${messagecode}]"

        Write-Host ''
        Write-Host '###################'
        Write-Host ''
        Write-Host ''
    }

    return $messagecode
}
#################################################################################
# å‡¦ç†åã€€ | ExecuteMicrosoftDefender
# æ©Ÿèƒ½ã€€ã€€ | WindowsUpdateã®å®Ÿè¡Œ
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | MESSAGECODEï¼ˆenumï¼‰
# å¼•æ•°ã€€ã€€ | ï¼
#################################################################################
Function ExecuteMicrosoftDefender {
    [MESSAGECODE]$messagecode = [MESSAGECODE]::Successful
    [System.String]$messagecode_messages = ''

    # Microsoft DefenderãŒæœ‰åŠ¹çŠ¶æ…‹ã‹ãƒã‚§ãƒƒã‚¯
    try {
        [System.String]$status = (Get-Service -Name "WinDefend").Status
        [System.Boolean]$is_running = ($status -eq 'Running')
        if ($status -eq 'Running') {
            $is_running = $true
        }
        else {
            $messagecode = [MESSAGECODE]::Info_SkipMSDefenderInvalid
            $messagecode_messages = RetrieveMessage $messagecode
            Write-Host $messagecode_messages

            return [MESSAGECODE]::Successful
        }
    }
    catch {
        $messagecode = [MESSAGECODE]::Error_MSDefenderStatusCheck
    }

    # ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå®Ÿæ–½ã™ã‚‹ã‹æœ‰ç„¡
    if ($messagecode -eq [MESSAGECODE]::Successful) {
        $messagecode_messages = RetrieveMessage ([MESSAGECODE]::Confirm_ExecuteMSDedender)
        If (-Not(ConfirmYesno $messagecode_messages)) {
            $messagecode = [MESSAGECODE]::Info_SkipSelectMSDefender
            $messagecode_messages = RetrieveMessage $messagecode
            Write-Host $messagecode_messages

            return [MESSAGECODE]::Successful
        }
    }

    # ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå®Ÿè¡Œã¨çµæœè¡¨ç¤º
    if ($messagecode -eq [MESSAGECODE]::Successful) {
        # ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå‡¦ç†
        try {
            Update-MpSignature
        }
        catch {
            $messagecode = [MESSAGECODE]::Error_UpdateMSDefender_Exception
        }
        # å®Ÿè¡Œçµæœ
        if (-Not($?)) {
            $messagecode = [MESSAGECODE]::Error_UpdateMSDefender_Returnerror
        }
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        [void](Write-Host '### DEBUG PRINT ###')
        [void](Write-Host '')

        [void](Write-Host "Function ExecuteMicrosoftDefender: messagecode [${messagecode}]")

        [void](Write-Host '')
        [void](Write-Host '###################')
        [void](Write-Host '')
        [void](Write-Host '')
    }

    return $messagecode
}

#################################################################################
# å‡¦ç†åã€€ | ExecuteWinget
# æ©Ÿèƒ½ã€€ã€€ | wingetã®å®Ÿè¡Œ
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | MESSAGECODEï¼ˆenumï¼‰
# å¼•æ•°ã€€ã€€ | all_update: ã‚¢ãƒ—ãƒªä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã®æœ‰ç„¡ï¼ˆTrue: ä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã€False: å€‹åˆ¥ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼‰
# æ³¨æ„äº‹é … | Appxãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ãŒãªã‹ã£ãŸãŸã‚ã€wingetã‚’ä½¿ç”¨ã€‚
# ã€€ã€€ã€€ã€€ | ãªãŠã€winget upgrade ã§ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§ãã‚‹ã®ã¯ã€ã‚½ãƒ¼ã‚¹ãŒã€Œwingetã€ãŒå¯¾è±¡ã¨ãªã‚‹ã€‚
# ã€€ã€€ã€€ã€€ | ã‚½ãƒ¼ã‚¹ãŒã€Œmsstoreã€ã‚„ã€Œï¼ˆç©ºæ¬„ï¼‰ã€ã®ã‚¢ãƒ—ãƒªã¯æ›´æ–°ã§ããªã„ã€‚
# æ©Ÿèƒ½æ‹¡å¼µ | winget pin add ã§æ›´æ–°å¯¾è±¡å¤–ã‚’æŒ‡å®šã§ãã‚‹ã®ã§å¯¾è±¡å¤–ãƒªã‚¹ãƒˆã®æ©Ÿèƒ½ã‚’è¿½åŠ ã—ãŸæ–¹ãŒä¾¿åˆ©ã‹ã‚‚ã€‚
#################################################################################
Function ExecuteWinget {
    param (
        [System.Boolean]$all_update
    )

    [MESSAGECODE]$messagecode = [MESSAGECODE]::Successful
    [System.String]$messagecode_messages = ''
    [System.String]$append_message = ''
    [System.Text.StringBuilder]$sbtemp=New-Object System.Text.StringBuilder

    # wingetã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã‚¢ãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®å°å…¥çŠ¶æ…‹ã‚’ç¢ºèª
    try {
        [void](winget)
        if ($? -eq $false) {
            $messagecode = [MESSAGECODE]::Error_WingetNotInstall
        }
    }
    catch {
        $messagecode = [MESSAGECODE]::Error_CheckWinget
    }

    # ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæœ‰ç„¡ã®ç¢ºèª
    if ($messagecode -eq [MESSAGECODE]::Successful) {
        try {
            [System.String[]]$command_result = (winget upgrade)
            Write-Host $command_result
            
        }
        catch {
            $messagecode = [MESSAGECODE]::Error_WingetUpgrade
        }
    }

    # ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’å®Ÿæ–½ã™ã‚‹ã‹
    if ($messagecode -eq [MESSAGECODE]::Successful) {
        $messagecode_messages = RetrieveMessage ([MESSAGECODE]::Confirm_ExecuteWinget)
        If (-Not(ConfirmYesno $messagecode_messages)) {
            $messagecode = [MESSAGECODE]::Info_SkipSelectWinget
            $messagecode_messages = RetrieveMessage $messagecode
            Write-Host $messagecode_messages

            return [MESSAGECODE]::Successful
        }
    }
    
    # ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå®Ÿè¡Œ
    if ($messagecode -eq [MESSAGECODE]::Successful) {
        if ($all_update) {
            try {
                # ä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
                winget upgrade --all
            }
            catch {
                $messagecode = [MESSAGECODE]::Error_UpdateWinget_Exception
            }
            # å®Ÿè¡Œçµæœ
            if (-Not($?)) {
                $messagecode = [MESSAGECODE]::Error_UpdateWinget_Returnerror
            }
        }
        else {
            # å€‹åˆ¥ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
            # //TODO: ExecuteWingetã®å€‹åˆ¥ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’Functionã«å¤–ã ã—ã—ã¦å¤‰æ›´ã«å¯¾å¿œã™ã‚‹

            # ã‚³ãƒãƒ³ãƒ‰çµæœã‚’2æ¬¡å…ƒé…åˆ—ã«å¤‰æ›
            # wingetã®ã‚³ãƒãƒ³ãƒ‰ã¯Objectå‹ã§ã¯ãªã„ç‚ºã€æ–‡å­—åˆ—åŠ å·¥ã—ã¦å¯¾è±¡ã®IDã‚’æŠ½å‡º
            [System.String[]]$rows = $command_result -split "`n"
            [System.String]$row = ''
            [System.Int32]$unnecessary_char_digi = 48
            [System.String[]]$columns = @()
            [System.String[][]]$command_result_array = @()
            foreach ($row in $rows) {
                # IDã®å€¤ãŒå§‹ã¾ã‚‹æ¡æ•°ã«æº€ãŸãªã„è¡Œ ã¯ã‚¹ã‚­ãƒƒãƒ—
                if ($row.Length -le $unnecessary_char_digi) {
                    continue
                }
                # IDã®å€¤ãŒå§‹ã¾ã‚‹æ¡æ•°ã‹ã‚‰æœ€çµ‚è¡Œã¾ã§ã‚’æŠœç²‹
                $row = $row.Substring($unnecessary_char_digi)

                
                # IDé–‹å§‹ä½ç½®ã‹ã‚‰æ•°ãˆã¦32æ¡ã‚’è¶…ãˆã‚‹ä½ç½®ã«åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ãŒã‚ã‚‹å ´åˆã¯IDã®æ¬¡ã®é …ç›®ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ãªã‚‹ã€‚
                # 32æ¡ã‚’è¶…ãˆã‚‹ä½ç½®ã«åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ãŒã‚ã‚‹å ´åˆã¯åˆ‡ã‚Šæ¨ã¦å‡¦ç†ã¯è¡Œã‚ãªã„ã€‚
                # IndexOfã§ã¯1æ¡ç›®ã‹ã‚‰0ã§ã‚«ã‚¦ãƒ³ãƒˆã—ã¦ã„ã‚‹ã®ã§32æ¡ã¯ã€Œ31ã€ã§è¨­å®š
                if ($row.IndexOf(' ') -ge 31) {
                    # ä»–ã®è¡Œã¨åˆã‚ã›å…ˆé ­ã«åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’å…¥ã‚Œã‚‹
                    $row = " $row"
                }
                # åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’å«ã‚€å ´åˆã€å…ˆé ­ã‹ã‚‰è©²å½“æ¡ã¾ã§åˆ‡ã‚Šæ¨ã¦ã‚‹
                if ($row.IndexOf(' ') -ne -1) {
                    $row = $row.Substring($row.IndexOf(' '))
                }

                # ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã§é…åˆ—ã«ä»£å…¥
                $columns = $row -split "\s+"
                # ã‚³ãƒãƒ³ãƒ‰çµæœã‚’2æ¬¡å…ƒé…åˆ—ã«ä»£å…¥
                $command_result_array += ,($columns)
            }

            #   2æ¬¡å…ƒé…åˆ—ã‚ˆã‚Šé …ç›®åãŒè¡¨ç¤ºã•ã‚Œã‚‹è¡Œæ•°ã‚’å–å¾—
            [System.Int32]$i = 0
            [System.Int32]$label_id = 0
            foreach ($rows in $command_result_array) {
                if ($rows[1] -eq 'ID') {
                    $label_id = $i
                    break
                }
                $i++
            }
            #   IDã®å€¤ãŒå§‹ã¾ã‚‹ä½ç½®ã‚’è¨­å®šï¼ˆé …ç›®è¡Œã‹ã‚‰2è¡Œå…ˆã®ä½ç½®ï¼‰
            [System.Int32]$id_value_start = $label_id + 2
            #   IDã®å€¤ãŒçµ‚ã‚ã‚‹ä½ç½®ã‚’è¨­å®š
            [System.Int32]$id_value_end = $command_result_array.Length

            #   IDã®å€¤ãŒçµ‚ã‚ã‚Šã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¯èƒ½ãªæ•°ãŒè¡¨ç¤ºã•ã‚Œã‚‹è¡Œæ•°ã‚’å–å¾—
            for ($i=$id_value_start; $i -lt $command_result_array.Length; $i++) {
                if ($command_result_array[$i].Length -ge 1) {
                    # ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®šã§ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãŒå¿…è¦ãªå ´åˆ
                    if ($command_result_array[$i][1] -eq 'ã‚½ãƒ¼ã‚¹') {
                        $id_value_end = $i + 1
                        break
                    }
                }
            }

            # IDã”ã¨ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
            try {
                for ($i=$id_value_start; $i -lt $id_value_end; $i++) {
                    if ($command_result_array[$i].Length -ge 1) {
                        $sbtemp=New-Object System.Text.StringBuilder
                        @("`r`n",`
                        "ã€€å¯¾è±¡ID: [$($command_result_array[$i][1])]`r`n")|
                        ForEach-Object{[void]$sbtemp.Append($_)}
                        $append_message = $sbtemp.ToString()
                        $messagecode_messages = RetrieveMessage ([MESSAGECODE]::Confirm_ExecuteWinget_Individual) $append_message
                        If (ConfirmYesno $messagecode_messages) {
                            winget upgrade --id "$($command_result_array[$i][1])"

                            # å®Ÿè¡Œçµæœ
                            if (-Not($?)) {
                                $messagecode = [MESSAGECODE]::Error_UpdateWinget_Returnerror
                                return $messagecode
                            }
                        }
                    }
                }
            }
            catch {
                $messagecode = [MESSAGECODE]::Error_UpdateWinget_Exception
            }
        }
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        [void](Write-Host '### DEBUG PRINT ###')
        [void](Write-Host '')

        [void](Write-Host "Function ExecuteWinget: messagecode [${messagecode}]")

        [void](Write-Host '')
        [void](Write-Host '###################')
        [void](Write-Host '')
        [void](Write-Host '')
    }

    return $messagecode
}
### Function <--- çµ‚äº† ---

### Main process --- é–‹å§‹ --->
#################################################################################
# å‡¦ç†åã€€ | ãƒ¡ã‚¤ãƒ³å‡¦ç†
# æ©Ÿèƒ½ã€€ã€€ | åŒä¸Š
#--------------------------------------------------------------------------------
# ã€€ã€€ã€€ã€€ | -
#################################################################################
# åˆæœŸè¨­å®š
#   ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é–¢é€£
[MESSAGECODE]$messagecode = [MESSAGECODE]::Successful
[System.String]$messagecode_messages = ''
[System.String]$append_message = ''
[System.Text.StringBuilder]$sbtemp=New-Object System.Text.StringBuilder

# PowerShellç’°å¢ƒãƒã‚§ãƒƒã‚¯
$messagecode = VerificationExecutionEnv

# æ–‡å­—ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´
if ($messagecode -eq [MESSAGECODE]::Successful) {
    # ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã™ã‚‹æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’ã€ŒUTF-8ã€ã«å¤‰æ›´
    SetPsOutputEncoding 'utf8'
}

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
if ($messagecode -eq [MESSAGECODE]::Successful) {
    # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å–å¾—
    [System.String]$current_dir=Split-Path ( & { $myInvocation.ScriptName } ) -parent
    Set-Location $current_dir'\..\..'
    [System.String]$root_dir = (Convert-Path .)

    # Configãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ãƒ«ãƒ‘ã‚¹ã‚’ä½œæˆ  
    $sbtemp=New-Object System.Text.StringBuilder
    @("${current_dir}",`
      '\',`
      "${c_config_file}")|
    ForEach-Object{[void]$sbtemp.Append($_)}
    [System.String]$config_fullpath = $sbtemp.ToString()

    # èª­ã¿è¾¼ã¿å‡¦ç†
    try {
        [System.Collections.Hashtable]$config = (Get-Content $config_fullpath -Raw -Encoding UTF8).Replace('\','\\') | ConvertFrom-StringData

        # å¤‰æ•°ã«æ ¼ç´
        [System.String]$CONFIG_INSTALL_MODULES=(RemoveDoubleQuotes($config.install_modules))
        [System.Boolean]$CONFIG_SELECETED_WINDOWSUPDATE=[System.Convert]::ToBoolean((RemoveDoubleQuotes($config.selected_windowsupdate)))
        [System.Boolean]$CONFIG_SELECETED_MSDEFENDER=[System.Convert]::ToBoolean((RemoveDoubleQuotes($config.selected_msdefender)))
        [System.Boolean]$CONFIG_SELECETED_APPLICATION=[System.Convert]::ToBoolean((RemoveDoubleQuotes($config.selected_application)))
        [System.Boolean]$CONFIG_ALL_UPDATE=[System.Convert]::ToBoolean((RemoveDoubleQuotes($config.all_update)))
        [System.Boolean]$CONFIG_AUTO_MODE=[System.Convert]::ToBoolean((RemoveDoubleQuotes($config.auto_mode)))

        # é€šçŸ¥
        $sbtemp=New-Object System.Text.StringBuilder
        @("`r`n",`
          "å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«: [${config_fullpath}]`r`n")|
        ForEach-Object{[void]$sbtemp.Append($_)}
        $append_message = $sbtemp.ToString()
        $messagecode_messages = RetrieveMessage ([MESSAGECODE]::Info_LoadedSettingfile) $append_message
        [void](Write-Host $messagecode_messages)
    }
    catch {
        $messagecode = [MESSAGECODE]::Error_LoadingSettingfile
        $sbtemp=New-Object System.Text.StringBuilder
        @("`r`n",`
          "ã‚¨ãƒ©ãƒ¼ã®è©³ç´°: [${config_fullpath}$($_.Exception.Message)]`r`n")|
        ForEach-Object{[void]$sbtemp.Append($_)}
        $append_message = $sbtemp.ToString()
        $messagecode_messages = RetrieveMessage $messagecode $append_message
    }   
}

# å…¥åŠ›å€¤ã®è¨­å®šãƒ»æ¤œè¨¼
if ($messagecode -eq [MESSAGECODE]::Successful) {
    [System.Object[]]$function_parameters = @()
    [System.Object[]]$setting_parameters = @()
    if (-Not($CONFIG_AUTO_MODE)) {
        # å¯¾è©±å¼ã®å ´åˆï¼šå…¥åŠ›å€¤ã‚’ç”»é¢ã§è¨­å®šï¼ˆå…¥åŠ›å€¤ã®æ¤œè¨¼ã‚’å«ã‚€ï¼‰
        $function_parameters = @(
            $root_dir,
            $CONFIG_SELECETED_WINDOWSUPDATE,        # Windows Update æ›´æ–°ã®æœ‰ç„¡
            $CONFIG_SELECETED_MSDEFENDER,           # Microsoft Defender æ›´æ–°ã®æœ‰ç„¡
            $CONFIG_SELECETED_APPLICATION,          # winget upgrade æ›´æ–°ã®æœ‰ç„¡
            $CONFIG_ALL_UPDATE                      # ä¸€æ‹¬æ›´æ–°ã®æœ‰ç„¡
        )
        
        $setting_parameters = SettingInputValues $function_parameters
        if ($null -eq $setting_parameters) {
            $messagecode = [MESSAGECODE]::Cancel
        }
    }
    else {
        # è‡ªå‹•å®Ÿè¡Œã®å ´åˆï¼šå…¥åŠ›å€¤ã®æ¤œè¨¼ã®ã¿
        #   å…¥åŠ›å€¤ã®ãƒã‚§ãƒƒã‚¯
        [System.String[]]$setting_parameters = @()
        $setting_parameters = @(
            $CONFIG_SELECETED_WINDOWSUPDATE,        # Windows Update æ›´æ–°ã®æœ‰ç„¡
            $CONFIG_SELECETED_MSDEFENDER,           # Microsoft Defender æ›´æ–°ã®æœ‰ç„¡
            $CONFIG_SELECETED_APPLICATION,          # winget upgrade æ›´æ–°ã®æœ‰ç„¡
            $CONFIG_ALL_UPDATE                      # ä¸€æ‹¬æ›´æ–°ã®æœ‰ç„¡
        )
        $messagecode = ValidateInputValues $setting_parameters
    }
}

# å®Ÿè¡Œæœ‰ç„¡ã®ç¢ºèª
if ($messagecode -eq [MESSAGECODE]::Successful) {
    $messagecode_messages = RetrieveMessage ([MESSAGECODE]::Confirm_ExecutionTool)
    If (-Not(ConfirmYesno $messagecode_messages)) {
        $messagecode = [MESSAGECODE]::Cancel
    }
}

# ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
if ($messagecode -eq [MESSAGECODE]::Successful) {
    $function_parameters = @(
        $CONFIG_INSTALL_MODULES     # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
    )

    # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæœªå°å…¥ã®å ´åˆï¼‰
    $messagecode = InstallModules $function_parameters
}

# Windows Update
if ($messagecode -eq [MESSAGECODE]::Successful) {
    if ([System.Convert]::ToBoolean($setting_parameters[0])) {
        $messagecode = ExecuteWindowsUpdate ([System.Convert]::ToBoolean($setting_parameters[3]))
    }
}

# Microsoft Defender
if ($messagecode -eq [MESSAGECODE]::Successful) {
    if ([System.Convert]::ToBoolean($setting_parameters[1])) {
        $messagecode = ExecuteMicrosoftDefender
    }
}

# Winget
if ($messagecode -eq [MESSAGECODE]::Successful) {
    if ([System.Convert]::ToBoolean($setting_parameters[2])) {
        $messagecode = ExecuteWinget ([System.Convert]::ToBoolean($setting_parameters[3]))
    }
}

# ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã™ã‚‹æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’ã€ŒåˆæœŸå€¤ã«æˆ»ã™ã€ã«å¤‰æ›´
SetPsOutputEncoding 'reset_encoding'

#   å‡¦ç†çµæœã®è¡¨ç¤º
[System.String]$append_message = ''
$sbtemp=New-Object System.Text.StringBuilder
if ($messagecode -eq [MESSAGECODE]::Successful) {
    @("`r`n",`
      "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚³ãƒ¼ãƒ‰: [${messagecode}]`r`n")|
    ForEach-Object{[void]$sbtemp.Append($_)}
    $append_message = $sbtemp.ToString()
    $messagecode_messages = RetrieveMessage $messagecode $append_message
    Write-Host $messagecode_messages
}
else {
    @("`r`n",`
      "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚³ãƒ¼ãƒ‰: [${messagecode}]`r`n",`
      $messagecode_messages)|
    ForEach-Object{[void]$sbtemp.Append($_)}
    $append_message = $sbtemp.ToString()
    $messagecode_messages = RetrieveMessage ([MESSAGECODE]::Abend) $append_message
    Write-Host $messagecode_messages -ForegroundColor Red
}
# çµ‚äº†

# PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆä¸Šã§ä¸€æ™‚åœæ­¢ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆ
# [System.Windows.Forms.MessageBox]::Show(â€œOK Button to Continue.â€)

exit $messagecode
### Main process <--- çµ‚äº† ---

```

```powershell:



[System.String]$target_folder = $args[0]

if ($target_folder -eq '') {
    $target_folder = "$($Env:USERPROFILE)\Documents"    # åˆæœŸå€¤ã€ŒC:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"\Documentsã€
}

# å¯¾è±¡ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãƒ‘ã‚¹ã‚’æŒ‡å®š
$targetFolderPath = "C:\Path\To\Your\Functions"

# PowerShellã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’å–å¾—
$profilePath = $PROFILE

# å¯¾è±¡ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼å†…ã®.ps1ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢ã—ã€ãã‚Œãã‚Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦å‡¦ç†ã‚’å®Ÿè¡Œ
Get-ChildItem -Path $targetFolderPath -Filter *.ps1 | ForEach-Object {
    # ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰Functionå®šç¾©ã‚’èª­ã¿è¾¼ã‚€
    $functionDefinitions = Get-Content $_.FullName

    # ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«Functionå®šç¾©ã‚’è¿½åŠ 
    Add-Content -Path $profilePath -Value $functionDefinitions
}

# ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã•ã‚ŒãŸFunctionã‚’ç¢ºèª
Write-Host "ä»¥ä¸‹ã®FunctionãŒãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã•ã‚Œã¾ã—ãŸ:"
Get-Content $profilePath | Select-String -Pattern "function"
```

## Copilot

PowerShellã§è‡ªä½œã®Functionã‚’ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

1. å¯¾è±¡ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«ã‚ã‚‹`.ps1`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢ã—ã¾ã™ã€‚
2. å„`.ps1`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€ãã®ä¸­ã«ã‚ã‚‹Functionå®šç¾©ã‚’å–å¾—ã—ã¾ã™ã€‚
3. å–å¾—ã—ãŸFunctionå®šç¾©ã‚’PowerShellã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã—ã¾ã™ã€‚

ä»¥ä¸‹ã«ã€ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’å®Ÿè¡Œã™ã‚‹PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚

```powershell:
# å¯¾è±¡ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãƒ‘ã‚¹ã‚’æŒ‡å®š
$targetFolderPath = "C:\Path\To\Your\Functions"

# PowerShellã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’å–å¾—
$profilePath = $PROFILE

# å¯¾è±¡ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼å†…ã®.ps1ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢ã—ã€ãã‚Œãã‚Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦å‡¦ç†ã‚’å®Ÿè¡Œ
Get-ChildItem -Path $targetFolderPath -Filter *.ps1 | ForEach-Object {
    # ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰Functionå®šç¾©ã‚’èª­ã¿è¾¼ã‚€
    $functionDefinitions = Get-Content $_.FullName

    # ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«Functionå®šç¾©ã‚’è¿½åŠ 
    Add-Content -Path $profilePath -Value $functionDefinitions
}

# ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã•ã‚ŒãŸFunctionã‚’ç¢ºèª
Write-Host "ä»¥ä¸‹ã®FunctionãŒãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã•ã‚Œã¾ã—ãŸ:"
Get-Content $profilePath | Select-String -Pattern "function"
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€æŒ‡å®šã•ã‚ŒãŸãƒ•ã‚©ãƒ«ãƒ€ãƒ¼å†…ã®ã™ã¹ã¦ã®`.ps1`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œç´¢ã—ã€ãã‚Œãã‚Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰Functionå®šç¾©ã‚’èª­ã¿è¾¼ã‚“ã§ã€PowerShellã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã—ã¾ã™ã€‚æœ€å¾Œã«ã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã•ã‚ŒãŸFunctionã®ä¸€è¦§ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹å‰ã«ã€`$targetFolderPath`å¤‰æ•°ã«è‡ªä½œFunctionãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ãƒ‘ã‚¹ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚ã¾ãŸã€ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯æ—¢å­˜ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã™ã‚‹ãŸã‚ã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯äº‹å‰ã«ä½œæˆã™ã‚‹ã‹ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆå‡¦ç†ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€PowerShellã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«ç›´æ¥Functionã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã€å®Ÿè¡Œã™ã‚‹éš›ã«ã¯ååˆ†ãªæ¨©é™ãŒå¿…è¦ã§ã™ã€‚ã¾ãŸã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã¯ã‚·ã‚¹ãƒ†ãƒ ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€æ³¨æ„ã—ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚\<|/im_end|>

## é–¢é€£è¨˜äº‹

https://haretokidoki-blog.com/pasocon_powershell-startup/
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960

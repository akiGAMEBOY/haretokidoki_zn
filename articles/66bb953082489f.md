---
title: "[PowerShell]å…±é€šåŒ–ã—ãŸFunctionã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ï¼ˆã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚ˆã‚ŠæŠœç²‹ï¼‰"
emoji: "ğŸ’­"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell", "ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰", "ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ "]
published: false
---
## æ¦‚è¦

## ã“ã®è¨˜äº‹ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

- PowerShellãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–¹
- é »ç¹ã«æ›¸ãå‡¦ç†ã‚’å…±é€šåŒ–ã—ãŸã„æ–¹
- å…±é€šåŒ–ã—ãŸãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«ã—ãŸã„æ–¹

## Functionä¸€è¦§

### ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚ˆã‚ŠæŠœç²‹

[PowerShell_CD-DetermineStringTool](https://zenn.dev/haretokidoki/articles/f1634c386ffc1d)

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œOpenCdtray
# æ©Ÿèƒ½ã€€ã€€ï½œCDãƒˆãƒ¬ã‚¤ã‚’è‡ªå‹•ã§ã‚ªãƒ¼ãƒ—ãƒ³
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œBooleanï¼ˆTrue: æ­£å¸¸çµ‚äº†, False: ç•°å¸¸çµ‚äº†ï¼‰
# å¼•æ•°ã€€ã€€ï½œdrive_full: å¯¾è±¡ãƒ‰ãƒ©ã‚¤ãƒ–
#################################################################################
Function OpenCdtray([System.String]$drive_full) {
    [System.Boolean]$return = $false
    [System.String]$prompt_message = ''
    [System.Text.StringBuilder]$sbtemp=New-Object System.Text.StringBuilder

    # CDãƒˆãƒ¬ã‚¤ã®ã‚ªãƒ¼ãƒ—ãƒ³
    try {
        (New-Object -com Shell.Application).Namespace(17).ParseName("${drive_full}").InvokeVerb("Eject")
        $return = $true
    }
    catch {
        $sbtemp=New-Object System.Text.StringBuilder
        @("ã‚¨ãƒ©ãƒ¼ã€€ã€€: CDãƒˆãƒ¬ã‚¤ ã‚ªãƒ¼ãƒ—ãƒ³å‡¦ç†`r`n",`
          "ã€€ã€€ã€€ã€€ã€€ã€€å‡¦ç†ãŒå¤±æ•—ã—ã¾ã—ãŸã€‚`r`n")|
        ForEach-Object{[void]$sbtemp.Append($_)}
        $prompt_message = $sbtemp.ToString()
        Write-Host $prompt_message -ForegroundColor DarkRed
    }

    return $return
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œConfirmYesno
# æ©Ÿèƒ½ã€€ã€€ï½œYesNoå…¥åŠ›
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œBooleanï¼ˆTrue: æ­£å¸¸çµ‚äº†, False: å‡¦ç†ä¸­æ–­ï¼‰
# å¼•æ•°ã€€ã€€ï½œprompt_message: å…¥åŠ›å¿œç­”å¾…ã¡æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹
#################################################################################
Function ConfirmYesno([System.String]$prompt_message) {
    [System.Boolean]$return = $false
    [System.String]$value = $null
    [System.Text.StringBuilder]$sbtemp=New-Object System.Text.StringBuilder

    for($i=1; $i -le $c_retry_count; $i++) {
        # å…¥åŠ›å—ä»˜
        try {
            [ValidateSet("y","Y","n","N")]$value = Read-Host $prompt_message
        }
        catch {
            $value = $null
        }
        Write-Host ''

        # å…¥åŠ›å€¤ãƒã‚§ãƒƒã‚¯
        if ($value.ToLower() -eq "y") {
            $return = $true
            break
        }
        elseif ($value.ToLower() -eq "n") {
            $return = $false
            $sbtemp=New-Object System.Text.StringBuilder
            @("ã‚¨ãƒ©ãƒ¼ã€€ã€€: ã„ã„ãˆã‚’é¸æŠ`r`n", `
              "ã€€ã€€ã€€ã€€ã€€ã€€å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚`r`n")|
            ForEach-Object{[void]$sbtemp.Append($_)}
            $prompt_message = $sbtemp.ToString()
            Write-Host $prompt_message -ForegroundColor DarkRed
            break
        }
        elseif ($i -eq $c_retry_count) {
            $return = $false
            $sbtemp=New-Object System.Text.StringBuilder
            @("ã‚¨ãƒ©ãƒ¼ã€€ã€€: ãƒªãƒˆãƒ©ã‚¤å›æ•°ã‚’è¶…é`r`n", `
              "ã€€ã€€ã€€ã€€ã€€ã€€ãƒªãƒˆãƒ©ã‚¤å›æ•°ï¼ˆ", `
              [System.String]$c_retry_count, `
              "å›ï¼‰ã‚’è¶…éã—ãŸç‚ºã€å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚`r`n")|
            ForEach-Object{[void]$sbtemp.Append($_)}
            $prompt_message = $sbtemp.ToString()
            Write-Host $prompt_message -ForegroundColor DarkRed
        }
    }

    return $return
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œValidateDrive
# æ©Ÿèƒ½ã€€ã€€ï½œCDãƒ‰ãƒ©ã‚¤ãƒ–ã®æ¤œè¨¼
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œBooleanï¼ˆTrue: æ­£å¸¸çµ‚äº†, False: ç•°å¸¸çµ‚äº†ï¼‰
# å¼•æ•°ã€€ã€€ï½œdrive: å¯¾è±¡ãƒ‰ãƒ©ã‚¤ãƒ–ï¼ˆãƒ‰ãƒ©ã‚¤ãƒ–ãƒ¬ã‚¿ãƒ¼ã®ã¿ï¼‰, drive_full: å¯¾è±¡ãƒ‰ãƒ©ã‚¤ãƒ–
#################################################################################
Function ValidateDrive([System.String]$drive, [System.String]$drive_full) {
    [System.Boolean]$return = $false
    [System.String]$prompt_message = ''
    [System.Text.StringBuilder]$sbtemp=New-Object System.Text.StringBuilder
    [System.Boolean]$is_exists = $false

    [System.Int32]$now = 1
    [System.Int32]$max = $c_wait_sec * $c_interval_sec
    [System.Management.Automation.PSDriveInfo]$psdrive = $null
    for($i=1; $i -le $c_interval_sec; $i++) {
        $psdrive = Get-PSDrive $drive 2> $null
        if ($null -ne $psdrive) {
            [Object[]]$itemlist = Get-ChildItem "${drive_full}" | Sort-Object -Descending {$_.Name}
            # CDå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ä»¶æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            if ($itemlist.Count -ge 1) {
                $return = $true
                $sbtemp=New-Object System.Text.StringBuilder
                @("é€šçŸ¥ã€€ã€€ã€€: CDãƒ‰ãƒ©ã‚¤ãƒ–ã®æ¤œè¨¼`r`n",`
                  "ã€€ã€€ã€€ã€€ã€€ã€€æ­£å¸¸ã«CDãƒ‰ãƒ©ã‚¤ãƒ–ã‚’èªè­˜ã—ã¾ã—ãŸã€‚`r`n")|
                ForEach-Object{[void]$sbtemp.Append($_)}
                $prompt_message = $sbtemp.ToString()
                Write-Host $prompt_message
                break
            }
            else {
                $is_exists = $true
                $sbtemp=New-Object System.Text.StringBuilder
                @("ã‚¨ãƒ©ãƒ¼ã€€ã€€: CDãƒ‰ãƒ©ã‚¤ãƒ–ã®æ¤œè¨¼`r`n",`
                  "ã€€ã€€ã€€ã€€ã€€ã€€CDãƒ‰ãƒ©ã‚¤ãƒ–å†…ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚`r`n",`
                  "ã€€ã€€ã€€ã€€ã€€ã€€å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚`r`n")|
                ForEach-Object{[void]$sbtemp.Append($_)}
                $prompt_message = $sbtemp.ToString()
                Write-Host $prompt_message -ForegroundColor DarkRed
                break
            }
        }
        # ã‚¹ãƒªãƒ¼ãƒ—ã§å¾…ã¡åˆã‚ã›ï¼ˆèª­ã¿è¾¼ã¿ã«æ™‚é–“ãŒã‹ã‹ã£ãŸå ´åˆã€å¾Œç¶šå‡¦ç†ãŒå‹•ã„ã¦ã—ã¾ã†ç‚ºï¼‰
        Start-Sleep $c_wait_sec
        $now = $c_wait_sec * $i
        $sbtemp=New-Object System.Text.StringBuilder
        @("é€šçŸ¥ã€€ã€€ã€€: CDãƒ‰ãƒ©ã‚¤ãƒ–ã®æ¤œè¨¼`r`n",`
          "ã€€ã€€ã€€ã€€ã€€ã€€ãƒã‚§ãƒƒã‚¯ä¸­ã€‚ã€€çµŒéæ™‚é–“ / å¾…ã¡æ™‚é–“ [ ${now} / ${max} sec ]`r`n",`
          "ã€€ã€€ã€€ã€€ã€€ã€€CDã‚’èªè­˜ã™ã‚‹ã¾ã§å°‘ã€…ã€ãŠå¾…ã¡ãã ã•ã„ã€‚`r`n")|
        ForEach-Object{[void]$sbtemp.Append($_)}
        $prompt_message = $sbtemp.ToString()
        Write-Host $prompt_message
    }
    # å¾…ã¡åˆã‚ã›ãŸãŒã€èªè­˜ã§ããªã‹ã£ãŸå ´åˆ
    if ((-Not $return) -And (-Not $is_exists)) {
        $sbtemp=New-Object System.Text.StringBuilder
        @("ã‚¨ãƒ©ãƒ¼ã€€ã€€: CDãƒ‰ãƒ©ã‚¤ãƒ–ã®æ¤œè¨¼`r`n",`
          "ã€€ã€€ã€€ã€€ã€€ã€€CDã‚’èªè­˜ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚`r`n",`
          "ã€€ã€€ã€€ã€€ã€€ã€€å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚`r`n")|
        ForEach-Object{[void]$sbtemp.Append($_)}
        $prompt_message = $sbtemp.ToString()
        Write-Host $prompt_message -ForegroundColor DarkRed
    }

  return $return
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œValidateFileformat
# æ©Ÿèƒ½ã€€ã€€ï½œãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åã¨æ‹¡å¼µå­ï¼‰ã®æ¤œè¨¼
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œBooleanï¼ˆTrue: æ­£å¸¸çµ‚äº†, False: ç•°å¸¸çµ‚äº†ï¼‰
# å¼•æ•°ã€€ã€€ï½œdrive_full: å¯¾è±¡ãƒ‰ãƒ©ã‚¤ãƒ–
#################################################################################
Function ValidateFileformat([System.String]$drive_full) {
    [System.Boolean]$return = $false

    # ãƒ•ã‚¡ã‚¤ãƒ«ã®å‘½åè¦å‰‡ã‚’ãƒã‚§ãƒƒã‚¯
    $return = $true
    [Object[]]$itemlist = Get-ChildItem "${drive_full}" | Sort-Object {$_.Name}
    foreach($item in $itemlist) {
        # ãƒ•ã‚¡ã‚¤ãƒ«åãŒä¸‹è¨˜ã®é€šã‚Šã§ã‚ã‚‹äº‹ã‚’æ¤œè¨¼
        #   1ï½4æ¡ç›®ã€€ã€€: ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆï¼ˆå¤§æ–‡å­—ãƒ»å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„ï¼‰
        #   ãƒ•ã‚¡ã‚¤ãƒ«ç¨®é¡: csvãƒ•ã‚¡ã‚¤ãƒ« or ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
        if (-Not(($item.Name -match '^[A-z][A-z][A-z][A-z]') -And `
            (($item.Name.ToLower() -match '\.csv$') -Or `
             ($item.Name.ToLower() -match '\.txt$')))) {
            $return = $false
            $sbtemp=New-Object System.Text.StringBuilder
            @("ã‚¨ãƒ©ãƒ¼ã€€ã€€: ãƒ•ã‚¡ã‚¤ãƒ«åã®æ¤œè¨¼`r`n",`
              "ã€€ã€€ã€€ã€€ã€€ã€€æ—¢å®šã®ãƒ•ã‚¡ã‚¤ãƒ«åã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚`r`n",`
              "ã€€ã€€ã€€ã€€ã€€ã€€å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«: [$($item.FullName)]`r`n")|
            ForEach-Object{[void]$sbtemp.Append($_)}
            $prompt_message = $sbtemp.ToString()
            Write-Host $prompt_message -ForegroundColor DarkRed
            break
        }
    }

  return $return
}
```

[PowerShell_FileCopybackupTool](https://zenn.dev/haretokidoki/articles/d93f7608754bff)

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œRotationBackupfile
# æ©Ÿèƒ½ã€€ã€€ï½œãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œInt
# ã€€ã€€ã€€ã€€ï½œ       0: æ­£å¸¸çµ‚äº†
# ã€€ã€€ã€€ã€€ï½œ    -301: ã‚¨ãƒ©ãƒ¼ å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€â€•ã¸ã®æ¥ç¶š - æ¥ç¶šæ™‚ã€å¤±æ•—
# ã€€ã€€ã€€ã€€ï½œ    -302: ã‚¨ãƒ©ãƒ¼ å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€â€•ã¸ã®æ¥ç¶š - æ¥ç¶šå¾Œã€å¤±æ•—
# ã€€ã€€ã€€ã€€ï½œ    -303: ã‚¨ãƒ©ãƒ¼ å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€â€•ã¸ã®åˆ‡æ–­ - åˆ‡æ–­æ™‚ã€å¤±æ•—
# ã€€ã€€ã€€ã€€ï½œ    -401: ã‚¨ãƒ©ãƒ¼ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ - ãƒ•ã‚©ãƒ«ãƒ€ã®å‰Šé™¤
# å¼•æ•°ã€€ã€€ï½œãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å…ˆ
# ã€€ã€€ã€€ã€€ï½œBackuptoHost: ãƒ›ã‚¹ãƒˆåã€ã¾ãŸã¯IP, BackuptoId: ãƒ¦ãƒ¼ã‚¶å,
# ã€€ã€€ã€€ã€€ï½œBackuptoPass: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰, BackuptoPath: ãƒ‘ã‚¹, BackuptoGene: ä¿æŒä¸–ä»£æ•°
#################################################################################
Function RotationBackupfile([System.String]$BackuptoHost, [System.String]$BackuptoId,
                            [System.String]$BackuptoPass, [System.String]$BackuptoPath, [System.Int32]$BackuptoGene) {
    [System.Int32]$result = 0    

    # å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€æ¥ç¶š
    ## æ¥ç¶šå…ˆã®è¨­å®š
    [SecureString]$securepass = ConvertTo-SecureString $BackuptoPass -AsPlainText -Force
    [PSCredential]$cred = New-Object System.Management.Automation.PSCredential "${BackuptoHost}\${BackuptoId}", $securepass
    try {
        New-PSDrive -Name $c_backupdrive -PSProvider FileSystem -Root $BackuptoPath -Credential $cred 2>&1>$null
    } catch {
        $result = -301
    }
    ## æ¥ç¶šç¢ºèª
    if ($result -eq 0) {
        [System.Management.Automation.PSDriveInfo]$psdrive = $null
        $psdrive = Get-PSDrive $c_backupdrive 2> $null
        if ($null -eq $psdrive) {
            $result = -302
        }
    }

    # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
    if ($result -eq 0) {
        [System.Int32]$generation = 0
        [Object[]]$itemlist = Get-ChildItem "${c_backupdrive}`:\" | Sort-Object -Descending {$_.Name}
        [System.DateTime]$parseddate = [System.DateTime]::MinValue
        foreach($item in $itemlist) {
            [System.Boolean]$parseresult = [System.DateTime]::TryParseExact(
                $item.Name,
                $c_dateformats,
                [Globalization.DateTimeFormatInfo]::CurrentInfo,
                [Globalization.DateTimeStyles]::AllowWhiteSpaces,
                [ref]$parseddate
            )

            # ã‚³ãƒ”ãƒ¼å¯¾è±¡å¤–ã¯ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹
            ## æ—¥ä»˜ãƒ•ã‚©ãƒ«ãƒ€ä»¥å¤–ã®å ´åˆ
            ## ã¾ãŸã¯ã€ãƒ•ã‚©ãƒ«ãƒ€åãŒç¿Œæ—¥ä»¥é™ã®å ´åˆã€
            ## ã¾ãŸã¯ã€ãƒ•ã‚©ãƒ«ãƒ€ä»¥å¤–ã®å ´åˆ
            if ((-Not($parseresult)) -Or `
                    ($item.Name -gt $today) -Or `
                    (-Not($item.PSIsContainer))) {
                continue
            }

            # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¯¾è±¡ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            $generation = $generation + 1
            # æŒ‡å®šãƒ•ã‚©ãƒ«ãƒ€ãƒ¼é…ä¸‹ã«ã‚ã‚‹ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ã®æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹å ´åˆ
            # $generation += [System.Int32]((Get-ChildItem "${c_backupdrive}`:\$($item.Name)" | Where-Object { $_.PSIsContainer } | Measure-Object).Count)

            # ã‚³ãƒ”ãƒ¼ã•ã‚ŒãŸãƒ•ã‚©ãƒ«ãƒ€æ•°ãŒæ—¢å®šã®ä¸–ä»£æ•°ã‚’è¶…ãˆã‚‹å ´åˆ
            if ($generation -gt $BackuptoGene) {
                # å‰Šé™¤ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’è¨­å®š
                $deldate = [DateTime]::ParseExact($item.Name,"yyyyMMdd", $null)
            }

            # ãƒ•ã‚©ãƒ«ãƒ€å‰Šé™¤
            if ($deldate -ne [System.DateTime]::MaxValue) {
                try {
                    # Forceã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã‚‹ã¨ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦ã‚¨ãƒ©ãƒ¼
                    # Remove-Item "${c_backupdrive}`:\$($item.Name)" -Recurse -Force
                    Remove-Item "${c_backupdrive}`:\$($item.Name)" -Recurse

                    $sbprompt=New-Object System.Text.StringBuilder
                    @("é€šçŸ¥ã€€ã€€ã€€: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†`r`n",`
                    "ã€€ã€€ã€€ã€€ã€€ã€€ãƒ•ã‚©ãƒ«ãƒ€ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`r`n",`
                    "ã€€ã€€ã€€ã€€ã€€ã€€å¯¾è±¡ [$($item.FullName)]`r`n")|
                    ForEach-Object{[void]$sbprompt.Append($_)}
                    $prompt_message = $sbprompt.ToString()
                    Write-Host $prompt_message
                } catch {
                    $result = -401
                    break
                }
            }
        }
    }

    # å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€åˆ‡æ–­
    If (-Not($result -in @(-301,-302))) {
        [System.Management.Automation.PSDriveInfo]$psdrive = $null
        $psdrive = Get-PSDrive $c_backupdrive 2> $null
        if ($null -ne $psdrive) {
            try {
                Remove-PSDrive -Name $c_backupdrive
            } catch {
                $result = -303
            }
        }
    }

    return $result
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œCopyBackupfile
# æ©Ÿèƒ½ã€€ã€€ï½œã‚³ãƒ”ãƒ¼ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œInt
# ã€€ã€€ã€€ã€€ï½œ       0: æ­£å¸¸çµ‚äº†
# ã€€ã€€ã€€ã€€ï½œ    -301: ã‚¨ãƒ©ãƒ¼ å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€â€•ã¸ã®æ¥ç¶š - æ¥ç¶šæ™‚ã€å¤±æ•—
# ã€€ã€€ã€€ã€€ï½œ    -302: ã‚¨ãƒ©ãƒ¼ å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€â€•ã¸ã®æ¥ç¶š - æ¥ç¶šå¾Œã€å¤±æ•—
# ã€€ã€€ã€€ã€€ï½œ    -303: ã‚¨ãƒ©ãƒ¼ å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€â€•ã¸ã®åˆ‡æ–­ - åˆ‡æ–­æ™‚ã€å¤±æ•—
# ã€€ã€€ã€€ã€€ï½œ    -501: ã‚¨ãƒ©ãƒ¼ ã‚³ãƒ”ãƒ¼ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— - ãƒ•ã‚©ãƒ«ãƒ€ã®å‰Šé™¤
# ã€€ã€€ã€€ã€€ï½œ    -502: ã‚¨ãƒ©ãƒ¼ ã‚³ãƒ”ãƒ¼ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— - ãƒ•ã‚©ãƒ«ãƒ€ã®ã‚³ãƒ”ãƒ¼
# å¼•æ•°ã€€ã€€ï½œãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å…ˆ
# ã€€ã€€ã€€ã€€ï½œBackuptoHost: ãƒ›ã‚¹ãƒˆåã€ã¾ãŸã¯IP, BackuptoId: ãƒ¦ãƒ¼ã‚¶å, $BackuptoPass: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰, BackuptoPath: ãƒ‘ã‚¹, BackuptoGene: ä¿æŒä¸–ä»£æ•°
# ã€€ã€€ã€€ã€€ï½œãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å…ƒ
# ã€€ã€€ã€€ã€€ï½œBackupfmPath: ãƒ‘ã‚¹
#################################################################################
Function CopyBackupfile([System.String]$BackuptoHost, [System.String]$BackuptoId,
                        [System.String]$BackuptoPass, [System.String]$BackuptoPath, [System.String]$BackupfmPath) {
    [System.Int32]$result = 0    

    # å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€æ¥ç¶š
    ## æ¥ç¶šå…ˆã®è¨­å®š
    [SecureString]$securepass = ConvertTo-SecureString $BackuptoPass -AsPlainText -Force
    [PSCredential]$cred = New-Object System.Management.Automation.PSCredential "${BackuptoHost}\${BackuptoId}", $securepass
    try {
        New-PSDrive -Name $c_backupdrive -PSProvider FileSystem -Root $BackuptoPath -Credential $cred 2>&1>$null
    } catch {
        $result = -301
    }
    ## æ¥ç¶šç¢ºèª
    if ($result -eq 0) {
        [System.Management.Automation.PSDriveInfo]$psdrive = $null
        $psdrive = Get-PSDrive $c_backupdrive 2> $null
        if ($null -eq $psdrive) {
            $result = -302
        }
    }

    # ã‚³ãƒ”ãƒ¼ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
    if ($result -eq 0) {
        # ãƒ•ã‚©ãƒ«ãƒ€ãŒã‚ã‚‹å ´åˆã¯å‰Šé™¤
        if (Test-Path "${c_backupdrive}`:\${today}") {
            try {
                Remove-Item "${c_backupdrive}`:\${today}" -Recurse -Force
                $sbprompt=New-Object System.Text.StringBuilder
                @("é€šçŸ¥ã€€ã€€ã€€: ã‚³ãƒ”ãƒ¼ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å‡¦ç†`r`n",`
                "ã€€ã€€ã€€ã€€ã€€ã€€ãƒ•ã‚©ãƒ«ãƒ€ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`r`n",`
                "ã€€ã€€ã€€ã€€ã€€ã€€å¯¾è±¡ [${BackuptoPath}\${today}]`r`n")|
                ForEach-Object{[void]$sbprompt.Append($_)}
                $prompt_message = $sbprompt.ToString()
                Write-Host $prompt_message
            } catch {
                $result = -501
            }
        }

        # ã‚³ãƒ”ãƒ¼
        if ($result -eq 0) {
            try {
                Copy-Item "${BackupfmPath}" -Recurse "${c_backupdrive}`:\${today}"
                $sbprompt=New-Object System.Text.StringBuilder
                @("é€šçŸ¥ã€€ã€€ã€€: ã‚³ãƒ”ãƒ¼ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å‡¦ç†`r`n",`
                  "ã€€ã€€ã€€ã€€ã€€ã€€ã‚³ãƒ”ãƒ¼ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸã€‚`r`n",`
                  "ã€€ã€€ã€€ã€€ã€€ã€€å¯¾è±¡ [${BackuptoPath}\${today}]`r`n")|
                ForEach-Object{[void]$sbprompt.Append($_)}
                $prompt_message = $sbprompt.ToString()
                Write-Host $prompt_message
            } catch {
                $result = -502
            }
        }
    }

    # å…±æœ‰ãƒ•ã‚©ãƒ«ãƒ€åˆ‡æ–­
    If (-Not($result -in @(-301,-302))) {
        [System.Management.Automation.PSDriveInfo]$psdrive = $null
        $psdrive = Get-PSDrive $c_backupdrive 2> $null
        if ($null -ne $psdrive) {
            try {
                Remove-PSDrive -Name $c_backupdrive
            } catch {
                $result = -303
            }
        }
    }

    return $result
}
```

[PowerShell_IMEdictionarySearchTool](https://zenn.dev/haretokidoki/articles/a1a89282137299)

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œRemoveDoubleQuotes
# æ©Ÿèƒ½ã€€ã€€ï½œå…ˆé ­æ¡ã¨æœ€çµ‚æ¡ã«ã‚ã‚‹ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œStringï¼ˆå‰Šé™¤å¾Œã®æ–‡å­—åˆ—ï¼‰
# å¼•æ•°ã€€ã€€ï½œtarget_str: å¯¾è±¡æ–‡å­—åˆ—
#################################################################################
Function RemoveDoubleQuotes {
    param (
        [System.String]$target_str
    )
    [System.String]$removed_str = $target_str
    
    If ($target_str.Length -ge 2) {
        if (($target_str.Substring(0, 1) -eq '"') -and
            ($target_str.Substring($target_str.Length - 1, 1) -eq '"')) {
            # å…ˆé ­æ¡ã¨æœ€çµ‚æ¡ã®ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å‰Šé™¤
            $removed_str = $target_str.Substring(1, $target_str.Length - 2)
        }
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        Write-Host '### DEBUG PRINT ###'
        Write-Host ''

        Write-Host "Function RemoveDoubleQuotes: target_str  [${target_str}]"
        Write-Host "                             removed_str [${removed_str}]"

        Write-Host ''
        Write-Host '###################'
        Write-Host ''
        Write-Host ''
    }

    return $removed_str
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œAcquisitionFormsize
# æ©Ÿèƒ½ã€€ã€€ï½œWindowsãƒ•ã‚©ãƒ¼ãƒ ç”¨ã®ã‚µã‚¤ã‚ºã‚’ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚µã‚¤ã‚ºã‹ã‚‰é™¤ç®—ã§è¨­å®š
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œString[]ï¼ˆå¤‰æ›å¾Œã®ã‚µã‚¤ã‚ºï¼š1è¦ç´ ç›® æ¨ªã‚µã‚¤ã‚ºã€2è¦ç´ ç›® ç¸¦ã‚µã‚¤ã‚ºï¼‰
# å¼•æ•°ã€€ã€€ï½œdivisor: é™¤æ•°ï¼ˆãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚µã‚¤ã‚ºã‹ã‚‰é™¤ç®—ã™ã‚‹ãŸã‚ï¼‰
#################################################################################
Function AcquisitionFormsize {
    param (
        [System.UInt32]$divisor
    )
    # ç¾åœ¨ã®ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚µã‚¤ã‚ºã‚’å–å¾—
    [Microsoft.Management.Infrastructure.CimInstance]$graphics_info = (Get-CimInstance -ClassName Win32_VideoController)
    [System.UInt32]$width = $graphics_info.CurrentHorizontalResolution
    [System.UInt32]$height = $graphics_info.CurrentVerticalResolution

    # ãƒ¢ãƒ‹ã‚¿ãƒ¼ã®ã‚µã‚¤ã‚ºã‹ã‚‰é™¤æ•°ã§å‰²ã‚‹
    [System.UInt32]$form_width = $width / $divisor
    [System.UInt32]$form_height = $height / $divisor
    
    [System.UInt32[]]$form_size = @($form_width, $form_height)

    ### DEBUG ###
    if ($DEBUG_ON) {
        Write-Host '### DEBUG PRINT ###'
        Write-Host ''

        Write-Host "Function AcquisitionFormsize: form_size [${form_size}]"

        Write-Host ''
        Write-Host '###################'
        Write-Host ''
        Write-Host ''
    }

    return $form_size
}

#################################################################################
# å‡¦ç†åã€€ï½œConfirmYesno
# æ©Ÿèƒ½ã€€ã€€ï½œYesNoå…¥åŠ›ï¼ˆWindowsãƒ•ã‚©ãƒ¼ãƒ ï¼‰
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œBooleanï¼ˆTrue: æ­£å¸¸çµ‚äº†, False: å‡¦ç†ä¸­æ–­ï¼‰
# å¼•æ•°ã€€ã€€ï½œprompt_message: å…¥åŠ›å¿œç­”å¾…ã¡æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹
#################################################################################
Function ConfirmYesno {
    param (
        [System.String]$prompt_message,
        [System.String]$prompt_title='å®Ÿè¡Œå‰ã®ç¢ºèª'
    )

    # é™¤æ•°ã€Œ6ã€ã§å‰²ã£ãŸå€¤ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã‚µã‚¤ã‚ºã¨ã™ã‚‹
    [System.UInt32[]]$form_size = AcquisitionFormsize(6)

    # ãƒ•ã‚©ãƒ¼ãƒ ã®ä½œæˆ
    [System.Windows.Forms.Form]$form = New-Object System.Windows.Forms.Form
    $form.Text = $prompt_title
    $form.Size = New-Object System.Drawing.Size($form_size[0],$form_size[1])
    $form.StartPosition = 'CenterScreen'
    $form.Icon = [System.Drawing.Icon]::ExtractAssociatedIcon("${root_dir}\source\icon\shell32-296.ico")
    $form.MaximizeBox = $false
    $form.MinimizeBox = $false
    $form.FormBorderStyle = 'FixedSingle'

    # ãƒ”ã‚¯ãƒãƒ£ãƒœãƒƒã‚¯ã‚¹ä½œæˆ
    [System.Windows.Forms.PictureBox]$pic = New-Object System.Windows.Forms.PictureBox
    $pic.Size = New-Object System.Drawing.Size(($form_size[0] * 0.016), ($form_size[1] * 0.030))
    $pic.Image = [System.Drawing.Image]::FromFile("${root_dir}\source\icon\shell32-296.ico")
    $pic.Location = New-Object System.Drawing.Point(($form_size[0] * 0.0156),($form_size[1] * 0.0285))
    $pic.SizeMode = [System.Windows.Forms.PictureBoxSizeMode]::Zoom

    # ãƒ©ãƒ™ãƒ«ä½œæˆ
    [System.Windows.Forms.Label]$label = New-Object System.Windows.Forms.Label
    $label.Location = New-Object System.Drawing.Point(($form_size[0] * 0.04),($form_size[1] * 0.07))
    $label.Size = New-Object System.Drawing.Size(($form_size[0] * 0.75),($form_size[1] * 0.075))
    $label.Text = $prompt_message
    $label.Font = New-Object System.Drawing.Font('ï¼­ï¼³ ã‚´ã‚·ãƒƒã‚¯',11)

    # OKãƒœã‚¿ãƒ³ã®ä½œæˆ
    [System.Windows.Forms.Button]$btnOkay = New-Object System.Windows.Forms.Button
    $btnOkay.Location = New-Object System.Drawing.Point(($form_size[0] - 205), ($form_size[1] - 90))
    $btnOkay.Size = New-Object System.Drawing.Size(75,30)
    $btnOkay.Text = 'OK'
    $btnOkay.DialogResult = [System.Windows.Forms.DialogResult]::OK

    # Cancelãƒœã‚¿ãƒ³ã®ä½œæˆ
    [System.Windows.Forms.Button]$btnCancel = New-Object System.Windows.Forms.Button
    $btnCancel.Location = New-Object System.Drawing.Point(($form_size[0] - 115), ($form_size[1] - 90))
    $btnCancel.Size = New-Object System.Drawing.Size(75,30)
    $btnCancel.Text = 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«'
    $btnCancel.DialogResult = [System.Windows.Forms.DialogResult]::Cancel

    # ãƒœã‚¿ãƒ³ã®ç´ã¥ã‘
    $form.AcceptButton = $btnOkay
    $form.CancelButton = $btnCancel

    # ãƒ•ã‚©ãƒ¼ãƒ ã«ç´ã¥ã‘
    $form.Controls.Add($pic)
    $form.Controls.Add($label)
    $form.Controls.Add($btnOkay)
    $form.Controls.Add($btnCancel)

    # ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º
    [System.Boolean]$is_selected = ($form.ShowDialog() -eq [System.Windows.Forms.DialogResult]::OK)
    $pic.Image.Dispose()
    $pic.Image = $null
    $form = $null

    ### DEBUG ###
    if ($DEBUG_ON) {
        Write-Host '### DEBUG PRINT ###'
        Write-Host ''

        Write-Host "Function ConfirmYesno: is_selected [${is_selected}]"

        Write-Host ''
        Write-Host '###################'
        Write-Host ''
        Write-Host ''
    }

    return $is_selected
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œRetrieveMessage
# æ©Ÿèƒ½ã€€ã€€ï½œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã‚’å–å¾—
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œStringï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ï¼‰
# å¼•æ•°ã€€ã€€ï½œtarget_code; å¯¾è±¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚³ãƒ¼ãƒ‰, append_message: è¿½åŠ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä»»æ„ï¼‰
#################################################################################
Function RetrieveMessage {
    param (
        [MESSAGECODE]$target_code,
        [System.String]$append_message=''
    )
    [System.String]$return_messages = ''
    [System.String]$message = ''

    switch($target_code) {
        Successful                          {$message='æ­£å¸¸çµ‚äº†';break}
        Abend                               {$message='ç•°å¸¸çµ‚äº†';break}
        Cancel                              {$message='ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚';break}
        Info_LoadedSettingfile              {$message='è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã€‚';break}
        Confirm_ExecutionTool               {$message='ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚';break}
        Error_NotCore                       {$message='PowerShellã‚¨ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ãŒã€Œ Core ã€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚';break}
        Error_NotSupportedVersion           {$message='PowerShellãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚µãƒãƒ¼ãƒˆå¯¾è±¡å¤–ã§ã™ã€‚ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³7æœªæº€ï¼‰';break}
        Error_NotWindows                    {$message='å®Ÿè¡Œç’°å¢ƒãŒWindows OSã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚';break}
        Error_LoadingSettingfile            {$message='è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';break}
        Error_NotExistsTargetpath           {$message='æ‰€å®šã®å ´æ‰€ã«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“ã€‚';break}
        Error_EmptyTargetfolder             {$message='ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãŒç©ºã§æŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚';break}
        Error_EmptySearchkeywords           {$message='æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒç©ºã§æŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚';break}
        Error_NotMatchDatatype              {$message='ãƒ‡ãƒ¼ã‚¿å‹ã¨å€¤ãŒã‚ã£ã¦ã„ã¾ã›ã‚“ã€‚';break}
        Error_MaxRetries                    {$message='å†è©¦è¡Œå›æ•°ã‚’è¶…éã—ã¾ã—ãŸã€‚';break}
        Error_CountKeywordDictionary        {$message='è¾æ›¸ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚«ã‚¦ãƒ³ãƒˆå®Ÿè¡Œæ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';break}
        default                             {break}
    }

    $sbtemp=New-Object System.Text.StringBuilder
    @("${message}`r`n",`
      "${append_message}`r`n")|
    ForEach-Object{[void]$sbtemp.Append($_)}
    $return_messages = $sbtemp.ToString()

    ### DEBUG ###
    if ($DEBUG_ON) {
        Write-Host '### DEBUG PRINT ###'
        Write-Host ''

        Write-Host "Function RetrieveMessage: return_messages [${return_messages}]"

        Write-Host ''
        Write-Host '###################'
        Write-Host ''
        Write-Host ''
    }

    return $return_messages
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œShowMessagebox
# æ©Ÿèƒ½ã€€ã€€ï½œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ã®è¡¨ç¤º
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œãªã—
# å¼•æ•°ã€€ã€€ï½œtarget_code; å¯¾è±¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚³ãƒ¼ãƒ‰, append_message: è¿½åŠ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä»»æ„ï¼‰
#################################################################################
Function ShowMessagebox {
    param (
        [System.String]$messages,
        [System.String]$title,
        [System.String]$level='Information'
        # æŒ‡å®šå¯èƒ½ãªãƒ¬ãƒ™ãƒ«ä¸€è¦§ï¼ˆ$levelï¼‰
        #   None
        #   Hand
        #   Error
        #   Stop
        #   Question
        #   Exclamation
        #   Waring
        #   Asterisk
        #   Information
    )

    [System.Windows.Forms.DialogResult]$dialog_result = [System.Windows.Forms.MessageBox]::Show($messages, $title, "OK", $level)
    
    switch($dialog_result) {
        {$_ -eq [System.Windows.Forms.DialogResult]::OK} {
            break
        }
    }
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œCreateCountlists
# æ©Ÿèƒ½ã€€ã€€ï½œã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œç´¢ã—ä»¶æ•°ã‚’å–å¾—
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œString[]ï¼ˆæ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ã‚«ã‚¦ãƒ³ãƒˆæ•°ï¼‰
# ã€€ã€€ã€€ã€€ï½œ - næ¬¡å…ƒç›® é …ç›®01 æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
# ã€€ã€€ã€€ã€€ï½œ - næ¬¡å…ƒç›® é …ç›®02 ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ä»¶æ•°
# å¼•æ•°ã€€ã€€ï½œtargetfile   : æ¤œç´¢å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«
# ã€€ã€€ã€€ã€€ï½œkeyword_lists: æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ
# ã€€ã€€ã€€ã€€ï½œcasesensitive: å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã‚’åŒºåˆ¥ï¼ˆtrue: åŒºåˆ¥ã™ã‚‹ã€false: åŒºåˆ¥ã—ãªã„ï¼‰
#################################################################################
Function CreateCountlists {
    param (
        [System.String]$targetfile,
        [System.String[]]$keyword_lists,
        [System.Boolean]$casesensitive
    )
    [System.String]$keyword = ''
    [System.Int32]$keyword_count = 0
    [System.Object[]]$count_lists = @()

    # ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å†…ã®æ–‡å­—åˆ—ãƒã‚§ãƒƒã‚¯
    [System.String]$textdata = (Get-Content $targetfile)
    if ([string]::IsNullOrEmpty($textdata)){
        ### DEBUG ###
        if ($DEBUG_ON) {
            Write-Host '### DEBUG PRINT ###'
            Write-Host ''

            Write-Host "Function CreateCountlists: count_lists [${count_lists}]"

            Write-Host ''
            Write-Host '###################'
            Write-Host ''
            Write-Host ''
        }

        # ç©ºã®ãŸã‚æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³
        exit
    }

    # è¤‡æ•°ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢
    foreach($keyword in $keyword_lists) {
        if ($casesensitive) {
            # å¤§æ–‡å­—ãƒ»å°æ–‡å­—åŒºåˆ¥ã™ã‚‹
            $keyword_count = @(Select-String "${targetfile}" -Pattern "${keyword}" -CaseSensitive).Count
        }
        else {
            # å¤§æ–‡å­—ãƒ»å°æ–‡å­—åŒºåˆ¥ã—ãªã„
            $keyword_count = @(Select-String "${targetfile}" -Pattern "${keyword}").Count
        }

        $count_lists += ,@($keyword, $keyword_count)
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        Write-Host '### DEBUG PRINT ###'
        Write-Host ''

        Write-Host "Function CreateCountlists: count_lists [${count_lists}]"

        Write-Host ''
        Write-Host '###################'
        Write-Host ''
        Write-Host ''
    }

    return $count_lists
}
#################################################################################
# å‡¦ç†åã€€ï½œShowCountlists
# æ©Ÿèƒ½ã€€ã€€ï½œã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã—ãŸçµæœã‚’è¡¨ç¤º
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œãªã—
# å¼•æ•°ã€€ã€€ï½œcount_lists: æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¯ã«æ§‹æˆã•ã‚ŒãŸã‚«ã‚¦ãƒ³ãƒˆæ•°ã®ãƒªã‚¹ãƒˆ
# ã€€ã€€ã€€ã€€ï½œtargetfile : æ¤œç´¢å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ãƒ«ãƒ‘ã‚¹
#################################################################################
Function ShowCountlists {
    param (
        [System.Object[]]$count_lists,
        [System.String]$targetfile
    )
    # ãƒªã‚¹ãƒˆå†…ã®æ–‡å­—åˆ—ãƒã‚§ãƒƒã‚¯
    if ([string]::IsNullOrEmpty($count_lists)){
        ### DEBUG ###
        if ($DEBUG_ON) {
            Write-Host '### DEBUG PRINT ###'
            Write-Host ''

            Write-Host "Function ShowCountlists: count_lists [${count_lists}]"

            Write-Host ''
            Write-Host '###################'
            Write-Host ''
            Write-Host ''
        }

        # ç©ºã®ãŸã‚æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³
        exit
    }

    # é…åˆ—å†…ã§æœ€å¤§ã®ãƒã‚¤ãƒˆæ•°ï¼ˆShift-JISï¼‰ã‚’å–å¾—
    [System.Object[]]$to_bytes = [Management.Automation.PSSerializer]::DeSerialize([Management.Automation.PSSerializer]::Serialize($count_lists))
    [System.Int32]$i = 0
    [System.Int32]$max_length = 0
    for ($i = 0; $i -lt $to_bytes.Count; $i++) {
        $to_bytes[$i][0] = [System.Text.Encoding]::GetEncoding("shift_jis").GetByteCount($to_bytes[$i][0])
        if ($max_length -lt $to_bytes[$i][0]) {
            $max_length = $to_bytes[$i][0]
        }
    }

    # è¤‡æ•°ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢
    Write-Host ' ============ æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ ã¨ ä»¶æ•° ============ '
    Write-Host ''
    Write-Host " å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«   [${targetfile}]"
    Write-Host ''
    Write-Host ' ------------------------------------------------ '
    Write-Host ''
    [System.Int32]$tab_count = 0
    [System.Int32]$tab_width = 4
    for ($i = 0; $i -lt $to_bytes.Count; $i++) {
        # æŒ¿å…¥ã™ã‚‹ã‚¿ãƒ–æ•°ã‚’è¨ˆç®—
        $tab_count = [Math]::Ceiling(($max_length - [System.Int32]$to_bytes[$i][0]) / $tab_width)
        if ($tab_count -eq 0) {
            $tab_count = 1
        }

        if ($count_lists[$i][1] -eq 0) {
            Write-Host " æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ [$($count_lists[$i][0])]$("`t" * $tab_count)ã€ä»¶æ•° [$($count_lists[$i][1])ä»¶] "
        }
        else {
            Write-Host " æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ [$($count_lists[$i][0])]$("`t" * $tab_count)ã€ä»¶æ•° [$($count_lists[$i][1])ä»¶] " -ForegroundColor DarkRed
        }
    }
    Write-Host ''
    Write-Host ' ================================================ '
    Write-Host ''
    Write-Host ''
    Write-Host ''
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œCreateExportFolder
# æ©Ÿèƒ½ã€€ã€€ï½œä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ ¼ç´ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’æ–°è¦ä½œæˆ
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œStringï¼ˆä½œæˆã—ãŸãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã€‚è©¦è¡Œå›æ•°ã®è¶…éã‚‚ã—ãã¯ã‚¨ãƒ©ãƒ¼ã§ä½œæˆã§ããªã‹ã£ãŸå ´åˆã¯ç©ºæ–‡å­—ã‚’è¿”ã™ï¼‰
# å¼•æ•°ã€€ã€€ï½œcurrent_dir: ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€â€•ã®ãƒ‘ã‚¹
# ã€€ã€€ã€€ã€€ï½œfoldername : å¯¾è±¡ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼å
# ã€€ã€€ã€€ã€€ï½œmax_retries: æœ€å¤§ã®ãƒªãƒˆãƒ©ã‚¤å›æ•°
#################################################################################
Function CreateExportFolder {
    param (
        [System.String]$current_dir,
        [System.String]$foldername,
        [System.Int32]$max_retries=30
    )
    [System.String]$newfoldername = $foldername
    [System.Int32]$i = 0
    [System.String]$nowdate = (Get-Date).ToString("yyyyMMdd")
    [System.String]$number = ''
    for ($i=1; $i -le $max_retries; $i++) {
        # ã‚«ã‚¦ãƒ³ãƒˆæ•°ã®æ•°å€¤ã‚’3æ¡ã§0åŸ‹ã‚ã—ãŸæ–‡å­—åˆ—ã«ã™ã‚‹
        $number = "{0:000}" -f $i
        # ä½œæˆã—ãŸã„ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã‚’ç”Ÿæˆ
        $newfoldername = "${foldername}_${nowdate}-${number}"
        # ä½œæˆã—ãŸã„ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
        if (-Not (Test-Path "${current_dir}\${newfoldername}")) {
            break
        }

        # ãƒªãƒˆãƒ©ã‚¤å›æ•°ã‚’è¶…éã—ä½œæˆã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã‚’æ±ºå®šã§ããªã‹ã£ãŸå ´åˆ
        if ($i -eq $max_retries) {
            $newfoldername = ''
        }
    }

    [System.String]$newfolder_path = ''
    if ($newfoldername -ne '') {
        $newfolder_path = "${current_dir}\${newfoldername}"
        try {
            New-Item -Path "${newfolder_path}" -Type Directory > $null
        }
        catch {
            $newfolder_path = ''
        }
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        Write-Host '### DEBUG PRINT ###'
        Write-Host ''

        Write-Host "Function CreateTempFolder: newfolder_path [${newfolder_path}]"

        Write-Host ''
        Write-Host '###################'
        Write-Host ''
        Write-Host ''
    }

    return $newfolder_path
}
```

[PowerShell_mysql-to-csv](https://zenn.dev/haretokidoki/articles/28a7467dedabfc)

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œIsValidDatetime
# æ©Ÿèƒ½ã€€ã€€ï½œæ—¥ä»˜ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œBooleanï¼ˆTrue: æœ‰åŠ¹, False: ç„¡åŠ¹ï¼‰
# å¼•æ•°ã€€ã€€ï½œtargetdate: å¯¾è±¡æ–‡å­—åˆ—
#################################################################################
Function IsValidDatetime([System.String]$targetdate){
    [System.Boolean]$return = $false
    [System.String]$prompt_message = ''
    [System.Text.StringBuilder]$sbtemp=New-Object System.Text.StringBuilder
    try {
        # é–‹å§‹æ—¥ä»˜æ¤œè¨¼
        [System.String[]]$dateformats = @(
            "yyyyMMdd"
        )
        [System.DateTime]$parseddate = [System.DateTime]::MinValue

        $return = [System.DateTime]::TryParseExact(
            $targetdate,
            $dateformats,
            [Globalization.DateTimeFormatInfo]::CurrentInfo,
            [Globalization.DateTimeStyles]::AllowWhiteSpaces,
            [ref]$parseddate
        )
    } catch {
        $return = $false
    }

    if (-Not $return) {
        $sbtemp=New-Object System.Text.StringBuilder
        @("ã‚¨ãƒ©ãƒ¼ã€€ã€€: æ—¥ä»˜ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼`r`n",`
          "ã€€ã€€ã€€ã€€ã€€ã€€æ—¥ä»˜ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼ãŒå¤±æ•—ã—ã¾ã—ãŸã€‚`r`n",`
          "ã€€ã€€ã€€ã€€ã€€ã€€å¯¾è±¡[{0}]`r`n" -f $targetdate)|
        ForEach-Object{[void]$sbtemp.Append($_)}
        $prompt_message = $sbtemp.ToString()
        Write-Host $prompt_message -ForegroundColor DarkRed
    }

    return  $return
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œIsValidPerioddate
# æ©Ÿèƒ½ã€€ã€€ï½œæ—¥ä»˜ã®æœŸé–“ã‚’æ¤œè¨¼
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œBooleanï¼ˆTrue: æœ‰åŠ¹, False: ç„¡åŠ¹ï¼‰
# å¼•æ•°ã€€ã€€ï½œbegindate: é–‹å§‹æ—¥ä»˜, enddate: çµ‚äº†æ—¥ä»˜
#################################################################################
Function IsValidPerioddate([System.String]$begindate, [System.String]$enddate){
    [System.Boolean]$return = $false
    try {
        if($begindate -le $enddate){
            $return = $true
        }
    } catch {
        $return = $false
    }

    return  $return
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œConnectMysql
# æ©Ÿèƒ½ã€€ã€€ï½œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œMySql.Data.MySqlClient.MySqlConnection
# å¼•æ•°ã€€ã€€ï½œMySQLConnectionString: æ¥ç¶šæƒ…å ±
#################################################################################
Function ConnectMysql([System.String]$MySQLConnectionString) {
    [MySql.Data.MySqlClient.MySqlConnection]$dbsession = $null

    $dbsession = New-Object MySql.Data.MySqlClient.MySqlConnection($MySQLConnectionString)
    $dbsession.ConnectionString = $MySQLConnectionString
    try {
        $dbsession.Open()
        $sbtemp=New-Object System.Text.StringBuilder
        @("é€šçŸ¥ã€€ã€€ã€€: DBæ¥ç¶š - æˆåŠŸ`r`n",`
          "ã€€ã€€ã€€ã€€ã€€ã€€DBæ¥ç¶šã«æˆåŠŸã—ã¾ã—ãŸã€‚`r`n")|
        ForEach-Object{[void]$sbtemp.Append($_)}
        $prompt_message = $sbtemp.ToString()
        Write-Host $prompt_message -ForegroundColor Blue
    } catch {
        $dbsession.Close()
        $sbtemp=New-Object System.Text.StringBuilder
        @("ã‚¨ãƒ©ãƒ¼ã€€ã€€: DBæ¥ç¶š - å¤±æ•—`r`n",`
          "ã€€ã€€ã€€ã€€ã€€ã€€DBæ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚`r`n")|
        ForEach-Object{[void]$sbtemp.Append($_)}
        $prompt_message = $sbtemp.ToString()
        Write-Host $prompt_message -ForegroundColor DarkRed
    }
    
    return $dbsession
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œExecutereaderMysql
# æ©Ÿèƒ½ã€€ã€€ï½œSQLå®Ÿè¡Œ
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œMySql.Data.MySqlClient.MySqlConnection
# å¼•æ•°ã€€ã€€ï½œdbsession: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒã‚·ãƒ§ãƒ³, command: å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
#################################################################################
Function ExecutereaderMysql([MySql.Data.MySqlClient.MySqlConnection]$dbsession, [System.String]$command) {
    [MySql.Data.MySqlClient.MySqlCommand]$mySqlCommand = $dbsession.CreateCommand()
    $mySqlCommand.CommandText = $command
    [MySql.Data.MySqlClient.MySqlDataReader]$datareader = $null

    try {
        $datareader = $mySqlCommand.ExecuteReader()
    } catch {
        $sbtemp=New-Object System.Text.StringBuilder
        @("ã‚¨ãƒ©ãƒ¼ã€€ã€€: SQLå®Ÿè¡Œã«å¤±æ•—`r`n",`
          "ã€€ã€€ã€€ã€€ã€€ã€€SQLå®Ÿè¡Œã«å¤±æ•—ã—ã¾ã—ãŸã€‚`r`n",`
          "ã€€ã€€ã€€ã€€ã€€ã€€ã‚¨ãƒ©ãƒ¼å†…å®¹[{0}]`r`n" -f $_.Exception.Message)|
        ForEach-Object{[void]$sbtemp.Append($_)}
        $prompt_message = $sbtemp.ToString()
        Write-Host $prompt_message -ForegroundColor DarkRed
    }

    # datareader -> datatable
    $datatable = New-Object System.Data.DataTable
    $datatable.Load($datareader)

    return $datatable
}
```

ã¾ã Zennã§è¨˜äº‹ã«ã—ã¦ã„ãªã„PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã€‚
[PowerShell_ResizeImageTool](https://github.com/akiGAMEBOY/PowerShell_ResizeImageTool)

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œIsOnlyAsciiChar
# æ©Ÿèƒ½ã€€ã€€ï½œASCIIæ–‡å­—ã ã‘ã§æ§‹æˆã•ã‚ŒãŸæ–‡å­—åˆ—ã‹ãƒã‚§ãƒƒã‚¯
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œBooleanï¼ˆTrue; ASCIIæ–‡å­—ã ã‘ã®æ–‡å­—åˆ—ã€False: ASCIIæ–‡å­—åˆ—ä»¥å¤–ã‚‚å«ã‚€æ–‡å­—åˆ—ï¼‰
# å¼•æ•°ã€€ã€€ï½œtarget_str   : å¯¾è±¡æ–‡å­—åˆ—
#################################################################################
Function IsOnlyAsciiChar {
    param (
        [System.String]$target_str
    )
    # ã™ã¹ã¦ã®æ–‡å­—ãŒASCIIæ–‡å­—ã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã‹
    return ($target_str -match "^[\x00-\x7F]+$")
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œGenerateFilename
# æ©Ÿèƒ½ã€€ã€€ï½œä½¿ç”¨ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ç”Ÿæˆ
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œStringï¼ˆåå‰ã‚’æ±ºã‚ãŸãƒ•ã‚¡ã‚¤ãƒ«åã€‚è©¦è¡Œå›æ•°ã®è¶…éã‚‚ã—ãã¯ã‚¨ãƒ©ãƒ¼ã§ä½œæˆã§ããªã‹ã£ãŸå ´åˆã¯nullã‚’è¿”ã™ï¼‰
# å¼•æ•°ã€€ã€€ï½œtarget_dir      : ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ãƒ‘ã‚¹
# ã€€ã€€ã€€ã€€ï½œfilename        : ãƒ•ã‚¡ã‚¤ãƒ«å
# ã€€ã€€ã€€ã€€ï½œmax_retries     : æœ€å¤§ã®ãƒªãƒˆãƒ©ã‚¤å›æ•°
#################################################################################
Function GenerateFilename {
    param (
        [System.String]$target_dir,
        [System.String]$generate_filename,
        [System.Int32]$max_retries=30
    )
    [System.String]$newfilename = ''
    [System.String]$filename_without_ext = [System.IO.Path]::GetFileNameWithoutExtension(("${generate_filename}"))
    [System.String]$extension = ([System.IO.Path]::GetExtension("${generate_filename}")).ToLower()
    [System.Int32]$i = 0
    [System.String]$nowdate = (Get-Date).ToString("yyyyMMdd")
    [System.String]$number = ''
    for ($i=1; $i -le $max_retries; $i++) {
        # ã‚«ã‚¦ãƒ³ãƒˆæ•°ã®æ•°å€¤ã‚’3æ¡ã§0åŸ‹ã‚ã—ãŸæ–‡å­—åˆ—ã«ã™ã‚‹
        $number = "{0:000}" -f $i
        # ç¢ºèªã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ç”Ÿæˆ
        $newfilename = "${filename_without_ext}_${nowdate}-${number}${extension}"
        # ä½œæˆã—ãŸã„ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
        if (-Not (Test-Path "${target_dir}\${newfilename}")) {
            break
        }

        # ãƒªãƒˆãƒ©ã‚¤å›æ•°ã‚’è¶…éã—ä½œæˆã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã‚’æ±ºå®šã§ããªã‹ã£ãŸå ´åˆ
        if ($i -eq $max_retries) {
            $newfilename = ''
        }
    }

    [System.String]$newfile_path = ''
    if ($newfilename -ne '') {
        $newfile_path = "${target_dir}\${newfilename}"
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        Write-Host '### DEBUG PRINT ###'
        Write-Host ''

        Write-Host "Function GenerateFilename: newfile_path [${newfile_path}]"

        Write-Host ''
        Write-Host '###################'
        Write-Host ''
        Write-Host ''
    }

    return $newfile_path
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œCreateResizeFolder
# æ©Ÿèƒ½ã€€ã€€ï½œãƒªã‚µã‚¤ã‚ºã—ãŸç”»åƒã‚’æ ¼ç´ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’æ–°è¦ä½œæˆ
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œStringï¼ˆä½œæˆã—ãŸãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã€‚è©¦è¡Œå›æ•°ã®è¶…éã‚‚ã—ãã¯ã‚¨ãƒ©ãƒ¼ã§ä½œæˆã§ããªã‹ã£ãŸå ´åˆã¯ç©ºæ–‡å­—ã‚’è¿”ã™ï¼‰
# å¼•æ•°ã€€ã€€ï½œcurrent_dir: ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã®ãƒ‘ã‚¹
# ã€€ã€€ã€€ã€€ï½œfoldername : ä½œæˆã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼å
# ã€€ã€€ã€€ã€€ï½œmax_retries: æœ€å¤§ã®ãƒªãƒˆãƒ©ã‚¤å›æ•°
#################################################################################
Function CreateResizeFolder {
    param (
        [System.String]$current_dir,
        [System.String]$foldername,
        [System.Int32]$max_retries=30
    )
    [System.String]$newfoldername = $foldername
    [System.Int32]$i = 0
    [System.String]$nowdate = (Get-Date).ToString("yyyyMMdd")
    [System.String]$number = ''
    for ($i=1; $i -le $max_retries; $i++) {
        # ã‚«ã‚¦ãƒ³ãƒˆæ•°ã®æ•°å€¤ã‚’3æ¡ã§0åŸ‹ã‚ã—ãŸæ–‡å­—åˆ—ã«ã™ã‚‹
        $number = "{0:000}" -f $i
        # ä½œæˆã—ãŸã„ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã‚’ç”Ÿæˆ
        $newfoldername = "${foldername}_${nowdate}-${number}"
        # ä½œæˆã—ãŸã„ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
        if (-Not (Test-Path "${current_dir}\${newfoldername}")) {
            break
        }

        # ãƒªãƒˆãƒ©ã‚¤å›æ•°ã‚’è¶…éã—ä½œæˆã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã‚’æ±ºå®šã§ããªã‹ã£ãŸå ´åˆ
        if ($i -eq $max_retries) {
            $newfoldername = ''
        }
    }

    [System.String]$newfolder_path = ''
    if ($newfoldername -ne '') {
        $newfolder_path = "${current_dir}\${newfoldername}"
        try {
            New-Item -Path "${newfolder_path}" -Type Directory > $null
        }
        catch {
            $newfolder_path = ''
        }
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        Write-Host '### DEBUG PRINT ###'
        Write-Host ''

        Write-Host "Function CreateResizeFolder: newfolder_path [${newfolder_path}]"

        Write-Host ''
        Write-Host '###################'
        Write-Host ''
        Write-Host ''
    }

    return $newfolder_path
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œExecuteTesseractOcr
# æ©Ÿèƒ½ã€€ã€€ï½œOCRã§ç”»åƒã®æ–‡å­—åˆ—ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œInt[]ï¼ˆæ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨è¨€èªæ¯ã®ã‚«ã‚¦ãƒ³ãƒˆæ•°ï¼‰
# ã€€ã€€ã€€ã€€ï½œ - næ¬¡å…ƒç›® é …ç›®01 æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ nå€‹ç›® + OCRè‹±èªã®å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ« ã®ã‚«ã‚¦ãƒ³ãƒˆæ•°
# ã€€ã€€ã€€ã€€ï½œ - næ¬¡å…ƒç›® é …ç›®02 æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ nå€‹ç›® + OCRæ—¥æœ¬èª       ï¼ˆæ¨ªæ›¸ãï¼‰ã®å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ« ã®ã‚«ã‚¦ãƒ³ãƒˆæ•°
# ã€€ã€€ã€€ã€€ï½œ - næ¬¡å…ƒç›® é …ç›®03 æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ nå€‹ç›® + OCRæ—¥æœ¬èª - vertï¼ˆç¸¦æ›¸ãï¼‰ã®å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ« ã®ã‚«ã‚¦ãƒ³ãƒˆæ•°
# å¼•æ•°ã€€ã€€ï½œexepath         : OCRå®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ãƒ«ãƒ‘ã‚¹
# ã€€ã€€ã€€ã€€ï½œocr_lang        : OCRã®è¨€èªè¨­å®š
# ã€€ã€€ã€€ã€€ï½œargument_lists  : OCRå®Ÿè¡Œæ™‚ã®å¼•æ•°
# ã€€ã€€ã€€ã€€ï½œ                    - å¼•æ•°01 å¯¾è±¡ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ãƒ«ãƒ‘ã‚¹ 
# ã€€ã€€ã€€ã€€ï½œ                    - å¼•æ•°02 å‡ºåŠ›ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆæ‹¡å¼µå­txtã®è¨˜è¼‰ãªã—ï¼‰
# ã€€ã€€ã€€ã€€ï½œ                    - å¼•æ•°03 OCRã®è¨€èªè¨­å®šï¼ˆocr_langã‚’å‚ç…§ï¼‰
# ã€€ã€€ã€€ã€€ï½œtargetfile      : OCRã§å‡ºåŠ›ã—ãŸãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ãƒ«ãƒ‘ã‚¹ï¼ˆæ‹¡å¼µå­txtã‚’å«ã‚€ï¼‰
# ã€€ã€€ã€€ã€€ï½œkeyword_lists   : æ¤œç´¢ã™ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ãƒªã‚¹ãƒˆ
# ã€€ã€€ã€€ã€€ï½œcasesensitive   : æ¤œç´¢ã™ã‚‹éš›ã«å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã‚’åŒºåˆ¥ã™ã‚‹ã‹ï¼ˆTrueï¼šåŒºåˆ¥ã™ã‚‹ã€Falseï¼šåŒºåˆ¥ã—ãªã„ï¼‰
#################################################################################
Function ExecuteTesseractOcr {
    param (
        [System.String]$exepath,
        [System.String]$ocr_lang,
        [System.String[]]$argument_lists,
        [System.String]$targetfile,
        [System.String[]]$keyword_lists,
        [System.Boolean]$casesensitive

    )
    [MESSAGECODE]$messagecode = [MESSAGECODE]::Successful
    [System.String]$messagecode_message = ''

    [System.Object[]]$count_lists = @()
    [System.String]$imagefile = $argument_lists[0]

    # ãƒ•ã‚¡ã‚¤ãƒ«åã«ASCIIæ–‡å­—ä»¥å¤–ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
    [System.String]$original_fullpath = ''
    [System.String]$current_dir = ''
    [System.String]$temp_fullpath = ''
    [System.String]$filename_without_ext = [System.IO.Path]::GetFileNameWithoutExtension($argument_lists[0])
    [System.String]$extension = ([System.IO.Path]::GetExtension("$($argument_lists[0])")).ToLower()
    if (-Not(IsOnlyAsciiChar($filename_without_ext))) {
        $original_fullpath = $argument_lists[0]
        # ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆå ´æ‰€ã‚’å–å¾—
        $current_dir = [System.IO.Path]::Combine([System.IO.Path]::GetDirectoryName($argument_lists[1]))
        $temp_fullpath = GenerateFilename $current_dir "OcrTempFile${extension}"

        try {
            Copy-Item $original_fullpath $temp_fullpath -Force
        }
        catch {
            $messagecode = [MESSAGECODE]::Error_CopyTempfile
            $messagecode_message = RetrieveMessage $messagecode
            Write-Host $messagecode_message -ForegroundColor DarkRed
        }
        # OCRå®Ÿè¡Œæ™‚ã®å¼•æ•°ã«ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’æŒ‡å®š
        $argument_lists[0] = $temp_fullpath
    }

    # OCRå®Ÿè¡Œ
    if ($messagecode -eq [MESSAGECODE]::Successful) {
        try {
            Start-Process -FilePath "${exepath}" -ArgumentList "${argument_lists}" -WindowStyle Hidden -Wait
            $count_lists = RetrieveKeywordCount "${targetfile}" $keyword_lists $casesensitive
    
            ShowCountlists $count_lists $imagefile $targetfile
        }
        catch {
            $messagecode = [MESSAGECODE]::Error_ExecuteTesseractOcr
            $messagecode_message = RetrieveMessage $messagecode
            Write-Host $messagecode_message -ForegroundColor DarkRed
        }
    }

    # ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤
    if (($messagecode -eq [MESSAGECODE]::Successful) -and
        ($temp_fullpath -ne '')) {
        try {
            Remove-Item $temp_fullpath -Force
        }
        catch {
            $messagecode = [MESSAGECODE]::Error_RemoveTempfile
            $messagecode_message = RetrieveMessage $messagecode
            Write-Host $messagecode_message -ForegroundColor DarkRed
        }
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        Write-Host '### DEBUG PRINT ###'
        Write-Host ''

        Write-Host "Function ExecuteTesseractOcr: messagecode [${messagecode}]"

        Write-Host ''
        Write-Host '###################'
        Write-Host ''
        Write-Host ''
    }

    return $messagecode
}
#################################################################################
# å‡¦ç†åã€€ï½œBatchOcrKeywordcount
# æ©Ÿèƒ½ã€€ã€€ï½œOCRã§ç”»åƒã®æ–‡å­—åˆ—ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œMESSAGECODEï¼ˆenumï¼‰
# å¼•æ•°ã€€ã€€ï½œfunction_parameters: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å€¤
# ã€€ã€€ã€€ã€€ï½œ - é …ç›®01 ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼       : ç”»é¢ã§ã®è¨­å®šå€¤ - ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ã—å¤‰æ›ã™ã‚‹ä½œæ¥­å¯¾è±¡ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼
# ã€€ã€€ã€€ã€€ï½œ - é …ç›®02 ãƒªã‚µã‚¤ã‚ºã®æ¨ªã‚µã‚¤ã‚º   : ç”»é¢ã§ã®è¨­å®šå€¤ - ãƒªã‚µã‚¤ã‚ºå¾Œã®æ¨ªã‚µã‚¤ã‚ºï¼ˆpxï¼‰
# ã€€ã€€ã€€ã€€ï½œ - é …ç›®03 ãƒªã‚µã‚¤ã‚ºã®ç¸¦ã‚µã‚¤ã‚º   : ç”»é¢ã§ã®è¨­å®šå€¤ - ãƒªã‚µã‚¤ã‚ºå¾Œã®ç¸¦ã‚µã‚¤ã‚ºï¼ˆpxï¼‰
# ã€€ã€€ã€€ã€€ï½œ - é …ç›®04 OCRå®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã®è¨­å®šå€¤ - Tesseract OCRã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ‘ã‚¹ã®é…ä¸‹ã«ã‚ã‚‹EXEãƒ•ã‚¡ã‚¤ãƒ«ã¾ã§ã®ãƒ•ãƒ«ãƒ‘ã‚¹
# ã€€ã€€ã€€ã€€ï½œ - é …ç›®05 OCRçµæœã®ä¸€æ™‚ä¿å­˜å…ˆã€€: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã®è¨­å®šå€¤ - Tesseract OCRã®ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã§å‡ºåŠ›ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ä¸€æ™‚ä¿å­˜å…ˆ
# ã€€ã€€ã€€ã€€ï½œ - é …ç›®06 æ¤œç´¢ã™ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰   : è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã®è¨­å®šå€¤ - OCRçµæœã®ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢ã™ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŒ‡å®šï¼ˆè¤‡æ•°æŒ‡å®šå¯èƒ½ï¼‰
# ã€€ã€€ã€€ã€€ï½œ - é …ç›®07 æ¤œç´¢ã‚ªãƒ—ã‚·ãƒ§ãƒ³       : è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã®è¨­å®šå€¤ - OCRçµæœã®ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢ã™ã‚‹éš›ã«å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã‚’åŒºåˆ¥ã™ã‚‹ï¼ˆTrueï¼šåŒºåˆ¥ã™ã‚‹ã€Falseï¼šåŒºåˆ¥ã—ãªã„ï¼‰
#################################################################################
Function BatchOcrKeywordcount {
    param (
        [System.Object[]]$function_parameters
    )

    [MESSAGECODE]$messagecode = [MESSAGECODE]::Successful
    [System.String]$messagebox_messages = ''
    [System.String]$messagebox_title = ''

    # å…¥åŠ›ãƒã‚§ãƒƒã‚¯
    if ($messagecode -eq [MESSAGECODE]::Successful) {
        #   OCRå®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
        if ($function_parameters[3] -eq '') {
            $messagecode = [MESSAGECODE]::Error_EmptyOcrExepath
            $messagebox_messages = RetrieveMessage $messagecode
            $messagebox_title = 'å…¥åŠ›ãƒã‚§ãƒƒã‚¯'
            ShowMessagebox $messagebox_messages $messagebox_title
        }
        #   OCRçµæœã®ä¸€æ™‚ä¿å­˜å…ˆ
        if ($function_parameters[4] -eq '') {
            $messagecode = [MESSAGECODE]::Error_EmptyOcrTemppath
            $messagebox_messages = RetrieveMessage $messagecode
            $messagebox_title = 'å…¥åŠ›ãƒã‚§ãƒƒã‚¯'
            ShowMessagebox $messagebox_messages $messagebox_title
        }
        #   æ¤œç´¢ã™ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
        if ($function_parameters[5] -eq '') {
            $messagecode = [MESSAGECODE]::Error_EmptyOcrSearchKeyword
            $messagebox_messages = RetrieveMessage $messagecode
            $messagebox_title = 'å…¥åŠ›ãƒã‚§ãƒƒã‚¯'
            ShowMessagebox $messagebox_messages $messagebox_title
        }
    }

    # å­˜åœ¨ãƒã‚§ãƒƒã‚¯
    if ($messagecode -eq [MESSAGECODE]::Successful) {
        #   OCRå®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
        if (-Not(Test-Path $function_parameters[3])) {
            $messagecode = [MESSAGECODE]::Error_NotExistsOcrExepath
            $messagebox_messages = RetrieveMessage $messagecode
            $messagebox_title = 'å­˜åœ¨ãƒã‚§ãƒƒã‚¯'
            ShowMessagebox $messagebox_messages $messagebox_title
        }
        #   OCRçµæœã®ä¸€æ™‚ä¿å­˜å…ˆ
        if (-Not(Test-Path $function_parameters[4])) {
            $messagecode = [MESSAGECODE]::Error_NotExistsOcrTemppath
            $messagebox_messages = RetrieveMessage $messagecode
            $messagebox_title = 'å­˜åœ¨ãƒã‚§ãƒƒã‚¯'
            ShowMessagebox $messagebox_messages $messagebox_title
        }
    }

    # å¯¾è±¡ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«ã‚ã‚‹å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«æ¯ã«ãã‚Šè¿”ã—å‡¦ç†ã‚’é–‹å§‹
    [System.String]$item = ''
    [System.String]$item_basename = ''
    [System.String[]]$target_lists = Get-ChildItem -File "$($function_parameters[0])\*.*" -Include *.jpg,*jpeg,*.png,*.webp -Name
    [System.String]$ocr_lang = ''
    [System.String[]]$argument_lists = @()
    [System.String]$targetfile = ''
    [System.String]$exepath = $function_parameters[3]
    [System.String[]]$keyword_lists = $function_parameters[5].Split(',')
    [System.Boolean]$casesensitive = $function_parameters[6]
    [System.String]$extension = ''
    foreach($item in $target_lists) {
        # WebPã®å ´åˆã¯å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
        $extension = ([System.IO.Path]::GetExtension("${item}")).ToLower()
        if ($extension -eq '.webp') {
            $sbtemp=New-Object System.Text.StringBuilder
            @("`r`n",`
              "å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«: [$($function_parameters[0])\$item]`r`n")|
            ForEach-Object{[void]$sbtemp.Append($_)}
            $append_message = $sbtemp.ToString()
            $prompt_message = RetrieveMessage ([MESSAGECODE]::Info_WebpSkipBatchOcrKeywordcount) $append_message
            Write-Host $prompt_message
            continue
        }
        $item_basename = (Get-Item "$($function_parameters[0])\$item").BaseName
        # OCRå®Ÿè¡Œ
        #   è‹±èªã§OCRã§æ–‡å­—åˆ—ãƒã‚§ãƒƒã‚¯
        if ($messagecode -eq [MESSAGECODE]::Successful) {
            $ocr_lang = 'eng'
            $argument_lists = @("$($function_parameters[0])\$item", "$($function_parameters[4])\Tesseract-OCR_$($ocr_lang)", '-l', $ocr_lang)
            $targetfile = "$($function_parameters[4])\Tesseract-OCR_$($ocr_lang).txt"
            $messagecode = ExecuteTesseractOcr $exepath $ocr_lang $argument_lists $targetfile $keyword_lists $casesensitive
            if ($messagecode -ne [MESSAGECODE]::Successful) {
                exit
            }
        }

        #   æ—¥æœ¬èªï¼ˆæ¨ªæ›¸ãï¼‰ã§OCRã§æ–‡å­—åˆ—ãƒã‚§ãƒƒã‚¯
        if ($messagecode -eq [MESSAGECODE]::Successful) {
            $ocr_lang = 'jpn'
            $argument_lists = @("$($function_parameters[0])\$item", "$($function_parameters[4])\Tesseract-OCR_$($ocr_lang)", '-l', $ocr_lang)
            $targetfile = "$($function_parameters[4])\Tesseract-OCR_$($ocr_lang).txt"
            $messagecode = ExecuteTesseractOcr $exepath $ocr_lang $argument_lists $targetfile $keyword_lists $casesensitive
            if ($messagecode -ne [MESSAGECODE]::Successful) {
                exit
            }
        }

        #   æ—¥æœ¬èªï¼ˆç¸¦æ›¸ãï¼‰ã§OCRã§æ–‡å­—åˆ—ãƒã‚§ãƒƒã‚¯
        if ($messagecode -eq [MESSAGECODE]::Successful) {
            $ocr_lang = 'jpn_vert'
            $argument_lists = @("$($function_parameters[0])\$item", "$($function_parameters[4])\Tesseract-OCR_$($ocr_lang)", '-l', $ocr_lang)
            $targetfile = "$($function_parameters[4])\Tesseract-OCR_$($ocr_lang).txt"
            $messagecode = ExecuteTesseractOcr $exepath $ocr_lang $argument_lists $targetfile $keyword_lists $casesensitive
            if ($messagecode -ne [MESSAGECODE]::Successful) {
                exit
            }
        }
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        Write-Host '### DEBUG PRINT ###'
        Write-Host ''

        Write-Host "Function BatchOcrKeywordcount: messagecode [${messagecode}]"

        Write-Host ''
        Write-Host '###################'
        Write-Host ''
        Write-Host ''
    }

    return $messagecode
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œChangeExtension
# æ©Ÿèƒ½ã€€ã€€ï½œæŒ‡å®šã—ãŸãƒ‘ã‚¹ã®æ‹¡å¼µå­ã‚’å¤‰æ›
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œStringï¼ˆæ‹¡å¼µå­ã‚’å¤‰æ›´ã—ãŸãƒ•ãƒ«ãƒ‘ã‚¹ã€‚æ‹¡å¼µå­ãŒå¤‰ã‚ã‚‰ãªã„å ´åˆã¯ç©ºæ–‡å­—ã‚’è¿”ã™ï¼‰
# å¼•æ•°ã€€ã€€ï½œtargetpath   : å¤‰æ›å¯¾è±¡ã®ãƒ•ãƒ«ãƒ‘ã‚¹
# ã€€ã€€ã€€ã€€ï½œnew_extension: å¤‰æ›ã™ã‚‹æ‹¡å¼µå­
#################################################################################
function ChangeExtension {
    param (
        [System.String]$targetpath,
        [System.String]$new_extension
    )

    # ç¾åœ¨ã®ãƒ‘ã‚¹ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«åã¨æ‹¡å¼µå­ã‚’æŠ½å‡º
    [System.String]$filename_without_ext = [System.IO.Path]::GetFileNameWithoutExtension($targetpath)
    [System.String]$old_extension = [System.IO.Path]::GetExtension($targetpath)
    
    [System.String]$new_fullpath = ''
    $new_extension = $new_extension.ToLower()
    $old_extension = $old_extension.ToLower()
    # æ–°æ—§ã®æ‹¡å¼µå­ãŒç•°ãªã‚‹å ´åˆã®ã¿å‡¦ç†ã™ã‚‹
    if ($new_extension -ne $old_extension) {
        # æ–°ã—ã„ãƒ•ãƒ«ãƒ‘ã‚¹ã‚’ä½œæˆ
        [System.String]$new_filename = $filename_without_ext + $new_extension
        $new_fullpath = [System.IO.Path]::Combine([System.IO.Path]::GetDirectoryName($targetpath), $new_filename)
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        Write-Host '### DEBUG PRINT ###'
        Write-Host ''

        Write-Host "Function ChangeExtension: new_fullpath [${new_fullpath}]"

        Write-Host ''
        Write-Host '###################'
        Write-Host ''
        Write-Host ''
    }

    return $new_fullpath
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œConvertWebp
# æ©Ÿèƒ½ã€€ã€€ï½œWebpã¸ã®å¤‰æ›
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œMESSAGECODEï¼ˆenumï¼‰
# å¼•æ•°ã€€ã€€ï½œé …ç›®01 å¤‰æ›ã™ã‚‹cwebp.exeã®ãƒ•ãƒ«ãƒ‘ã‚¹
# ã€€ã€€ã€€ã€€ï½œé …ç›®02 å¤‰æ›å¯¾è±¡ã®ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
#################################################################################
Function ConvertWebp {
    param (
        [System.String]$webp_exe_path,
        [System.String]$resize_output_path
    )

    [MESSAGECODE]$messagecode = [MESSAGECODE]::Successful
    [System.String]$messagecode_message = ''

    [System.Text.StringBuilder]$sbtemp=New-Object System.Text.StringBuilder
    [System.String]$prompt_message = ''
    [System.String]$append_message = ''

    # æ‹¡å¼µå­ã®ã¿å¤‰æ›´ã—å¤‰æ›å¾Œã®ãƒ•ãƒ«ãƒ‘ã‚¹ã®ç”Ÿæˆ
    [System.String]$webp_output_path = ''
    try {
        $webp_output_path = ChangeExtension $resize_output_path '.webp'
    }
    catch {
        $messagecode = [MESSAGECODE]::Error_ChangeExtension
        $messagecode_message = RetrieveMessage $messagecode
        Write-Host $messagecode_message -ForegroundColor DarkRed
    }

    # ãƒ•ãƒ«ãƒ‘ã‚¹ã‚’ç”Ÿæˆã§ããŸå ´åˆ
    if ($messagecode -eq [MESSAGECODE]::Successful) {
        if ($webp_output_path -ne '') {
            try {
                # WebPã¸ã®å¤‰æ›å‡¦ç†
                Start-Process -FilePath "${webp_exe_path}" -ArgumentList """${resize_output_path}"" -o ""${webp_output_path}""" -WindowStyle Hidden -Wait
            }
            catch {
                $messagecode = [MESSAGECODE]::Error_ConvertWebp
                $messagecode_message = RetrieveMessage $messagecode
                Write-Host $messagecode_message -ForegroundColor DarkRed
            }

            if ($messagecode -eq [MESSAGECODE]::Successful) {
                try {
                    # å¤‰æ›ã§ããŸå¾Œã«å…ƒç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
                    Remove-Item "${resize_output_path}" -Force
                }
                catch {
                    $messagecode = [MESSAGECODE]::Error_RemoveFile
                    $messagecode_message = RetrieveMessage $messagecode
                    Write-Host $messagecode_message -ForegroundColor DarkRed
                }
                
                # é€šçŸ¥
                $sbtemp=New-Object System.Text.StringBuilder
                @("`r`n",`
                "ã€€å¤‰æ›ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«: [${webp_output_path}]`r`n",`
                "ã€€å‰Šé™¤ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«: [${resize_output_path}]`r`n")|
                ForEach-Object{[void]$sbtemp.Append($_)}
                $append_message = $sbtemp.ToString()
                $prompt_message = RetrieveMessage ([MESSAGECODE]::Info_ComplateConvertWebp) $append_message
                Write-Host $prompt_message
            }
        }
        else {
            # æ‹¡å¼µå­ãŒæ—¢ã«WebPã§ã‚ã‚‹ãŸã‚é€šçŸ¥ã—ã¦å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
            $sbtemp=New-Object System.Text.StringBuilder
            @("`r`n",`
            "å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«: [${resize_output_path}]`r`n")|
            ForEach-Object{[void]$sbtemp.Append($_)}
            $append_message = $sbtemp.ToString()
            $prompt_message = RetrieveMessage ([MESSAGECODE]::Info_WebpSkipConvertWebp) $append_message
            Write-Host $prompt_message
        }
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        Write-Host '### DEBUG PRINT ###'
        Write-Host ''

        Write-Host "Function ConvertWebp: messagecode [${messagecode}]"

        Write-Host ''
        Write-Host '###################'
        Write-Host ''
        Write-Host ''
    }

    return $messagecode
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œResizeImage
# æ©Ÿèƒ½ã€€ã€€ï½œç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚µã‚¤ã‚º
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œMESSAGECODEï¼ˆenumï¼‰
# å¼•æ•°ã€€ã€€ï½œsetting_parameters[]
# ã€€ã€€ã€€ã€€ï½œ - é …ç›®01 ä½œæ¥­ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼    
# ã€€ã€€ã€€ã€€ï½œ - é …ç›®02 ãƒªã‚µã‚¤ã‚ºã®æ¨ªã‚µã‚¤ã‚º
# ã€€ã€€ã€€ã€€ï½œ - é …ç›®03 ãƒªã‚µã‚¤ã‚ºã®ç¸¦ã‚µã‚¤ã‚º
# ã€€ã€€ã€€ã€€ï½œ - é …ç›®04 å…ƒç”»åƒã®ã‚µã‚¤ã‚ºã‚ˆã‚Šã‚‚ä½ã„ã‚µã‚¤ã‚ºã§æŒ‡å®šã—ãŸå ´åˆã«ãƒªã‚µã‚¤ã‚ºã™ã‚‹ã‹ï¼ˆTrueï¼šãƒªã‚µã‚¤ã‚ºã™ã‚‹ã€Falseï¼šãƒªã‚µã‚¤ã‚ºã—ãªã„ï¼‰
# ã€€ã€€ã€€ã€€ï½œ - é …ç›®05 è‡ªå‹•ã§ä½œæˆã™ã‚‹å‡ºåŠ›ç”¨ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼å
# ã€€ã€€ã€€ã€€ï½œ - é …ç›®06 WEBPã«å¤‰æ›ã™ã‚‹ã‹ï¼ˆTrueï¼šå¤‰æ›ã™ã‚‹ã€Falseï¼šå¤‰æ›ã—ãªã„ï¼‰
#################################################################################
Function ResizeImage {
    param (
        [System.Object[]]$function_parameters
    )

    [MESSAGECODE]$messagecode = [MESSAGECODE]::Successful
    [System.String]$messagecode_message = ''

    # ãƒã‚§ãƒƒã‚¯å‡¦ç†ï¼ˆå…¥åŠ›ãƒã‚§ãƒƒã‚¯ã‚„å­˜åœ¨ãƒã‚§ãƒƒã‚¯ï¼‰ã¯ã€SettingInputValues ã§å®Ÿæ–½æ¸ˆã¿ã®ãŸã‚å‰²æ„›ã€‚

    # ãƒªã‚µã‚¤ã‚ºå¾Œã®ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ ¼ç´ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’æº–å‚™
    [System.String]$resize_output_path = CreateResizeFolder $function_parameters[0] $function_parameters[4]

    # ãƒªã‚µã‚¤ã‚ºå‡¦ç†
    #   æ¨ªã‚µã‚¤ã‚ºãŒæŒ‡å®šã•ã‚ŒãŸå€¤ã‚’å„ªå…ˆã•ã‚Œã‚‹ã€‚æ¨ªã‚µã‚¤ã‚ºãŒæŒ‡å®šãªã—ã§ç¸¦ã‚µã‚¤ã‚ºã®ã¿æŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ç¸¦ã‚µã‚¤ã‚ºã‚’ä½¿ç”¨ã—ãƒªã‚µã‚¤ã‚ºã€‚
    [System.Int32]$before_width = 0
    [System.Int32]$before_height = 0
    [System.Int32]$after_width = 0
    [System.Int32]$after_height = 0
    [System.Double]$raito = 0
    [System.String]$item = ''
    [System.String[]]$target_lists = Get-ChildItem -File "$($function_parameters[0])\*.*" -Include *.jpg,*jpeg,*.png,*.webp -Name
    [System.Drawing.Bitmap]$before_image = $null
    [System.Drawing.Bitmap]$after_image = $null
    [System.Drawing.Graphics]$graphics = $null
    [System.String]$extension = ''
    foreach($item in $target_lists) {
        # WebPã®å ´åˆã¯å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
        $extension = ([System.IO.Path]::GetExtension("${item}")).ToLower()
        if ($extension -eq '.webp') {
            $sbtemp=New-Object System.Text.StringBuilder
            @("`r`n",`
              "å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«: [$($function_parameters[0])\$item]`r`n")|
            ForEach-Object{[void]$sbtemp.Append($_)}
            $append_message = $sbtemp.ToString()
            $prompt_message = RetrieveMessage ([MESSAGECODE]::Info_WebpSkipResizeImage) $append_message
            Write-Host $prompt_message
            continue
        }
        # ç¾åœ¨ã®ã‚µã‚¤ã‚ºå–å¾—
        $before_image = New-Object System.Drawing.Bitmap("$($function_parameters[0])\$item")
        $before_width  = $before_image.Width
        $before_height = $before_image.Height
        
        # ãƒªã‚µã‚¤ã‚ºã™ã‚‹å€¤ã‚’è¨ˆç®—
        #   æ¨ªã‚µã‚¤ã‚ºã®å€¤ãŒã‚ã‚‹å ´åˆ
        if ($function_parameters[1] -ne '') {
            # æ¨ªã‚µã‚¤ã‚ºã§ãƒªã‚µã‚¤ã‚ºã®æ¯”ç‡ã‚’è¨ˆç®—
            $after_width = $function_parameters[1]
            $raito = $after_width / $before_width
            # ç¸¦ã‚µã‚¤ã‚ºã«åæ˜ 
            $after_height = $before_height * $raito
        }
        #   ç¸¦ã‚µã‚¤ã‚ºã®ã¿å€¤ãŒã‚ã‚‹å ´åˆ
        else {
            # ç¸¦ã‚µã‚¤ã‚ºã§ãƒªã‚µã‚¤ã‚ºã®æ¯”ç‡ã‚’è¨ˆç®—
            $after_height = $function_parameters[2]
            $raito = $after_height / $before_height
            # æ¨ªã‚µã‚¤ã‚ºã«åæ˜ 
            $after_width = $beforewitdh * $raito
        }

        # æŒ‡å®šã—ãŸå€¤ãŒå…ƒç”»åƒã®ã‚µã‚¤ã‚ºä»¥ä¸Šã®å ´åˆã«æ‹¡å¤§ã—ãªã„å ´åˆ
        if (-Not($function_parameters[3])) {
            # æ¨ªã‚µã‚¤ã‚ºã®å€¤ãŒã‚ã‚‹å ´åˆ
            if ($function_parameters[1] -ne '') {
                if ($after_width -ge $before_width) {
                    $sbtemp=New-Object System.Text.StringBuilder
                    @("`r`n",`
                      "å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«: [$($function_parameters[0])\$item]`r`n")|
                    ForEach-Object{[void]$sbtemp.Append($_)}
                    $append_message = $sbtemp.ToString()
                    $prompt_message = RetrieveMessage ([MESSAGECODE]::Info_WebpSkipSettingSizeIsBigger) $append_message
                    Write-Host $prompt_message
                    continue
                }
            }
            # ç¸¦ã‚µã‚¤ã‚ºã®ã¿å€¤ãŒã‚ã‚‹å ´åˆ
            else {
                if ($after_height -ge $before_height) {
                    $sbtemp=New-Object System.Text.StringBuilder
                    @("`r`n",`
                      "å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«: [$($function_parameters[0])\$item]`r`n")|
                    ForEach-Object{[void]$sbtemp.Append($_)}
                    $append_message = $sbtemp.ToString()
                    $prompt_message = RetrieveMessage ([MESSAGECODE]::Info_WebpSkipSettingSizeIsBigger) $append_message
                    Write-Host $prompt_message
                    continue
                }
            }
        }

        # ãƒªã‚µã‚¤ã‚ºã®å®Ÿè¡Œ
        if ($messagecode -eq [MESSAGECODE]::Successful) {
            try {
                $after_image = New-Object System.Drawing.Bitmap ($after_width, $after_height)
                $graphics = [System.Drawing.Graphics]::FromImage($after_image)
                $graphics.DrawImage($before_image, 0, 0, $after_width, $after_height)
            }
            catch {
                $messagecode = [MESSAGECODE]::Error_ExecuteResize
                $messagecode_message = RetrieveMessage $messagecode
                Write-Host $messagecode_message -ForegroundColor DarkRed
                break
            }
            finally {
                # ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾
                if ($null -ne $graphics) {
                    $graphics.Dispose()   
                }
                if ($null -ne $before_image) {
                    $before_image.Dispose()   
                }
            }
        }

        # ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ä½œæˆ ã¨ ä¿å­˜
        if ($messagecode -eq [MESSAGECODE]::Successful) {
            # æ–°è¦ä½œæˆã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼åã‚’æ±ºå®šã™ã‚‹
            if ($resize_output_path -eq '') {
                $messagecode = [MESSAGECODE]::Error_CreateResizeFolder
                $messagecode_message = RetrieveMessage $messagecode
                Write-Host $messagecode_message -ForegroundColor DarkRed
            }
            # ä¿å­˜
            try {
                $after_image.Save("${resize_output_path}\${item}")
            }
            catch {
                $messagecode = [MESSAGECODE]::Error_ResizefileSave
                $messagecode_message = RetrieveMessage $messagecode
                Write-Host $messagecode_message -ForegroundColor DarkRed
                break
            }
            finally {
                # ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾
                if ($null -ne $after_image) {
                    $after_image.Dispose()   
                }
            }

            # é€šçŸ¥
            if ($messagecode -eq [MESSAGECODE]::Successful) {
                $sbtemp=New-Object System.Text.StringBuilder
                @("`r`n",`
                  "ã€€ãƒªã‚µã‚¤ã‚ºã—ãŸãƒ•ã‚¡ã‚¤ãƒ«: [${resize_output_path}\${item}]`r`n")|
                ForEach-Object{[void]$sbtemp.Append($_)}
                $append_message = $sbtemp.ToString()
                $prompt_message = RetrieveMessage ([MESSAGECODE]::Info_ComplateResizeImage) $append_message
                Write-Host $prompt_message
            }
        }

        # WEBPå¤‰æ›
        if ($messagecode -eq [MESSAGECODE]::Successful) {
            # å¤‰æ›ã®æœ‰ç„¡
            if (($function_parameters[5]) -and
                ($resize_output_path -ne '')) {
                $messagecode = ConvertWebp $function_parameters[6] "${resize_output_path}\${item}"
                if ($messagecode -ne [MESSAGECODE]::Successful) {
                    break
                }
            }
        }
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        Write-Host '### DEBUG PRINT ###'
        Write-Host ''

        Write-Host "Function ResizeImage: messagecode [${messagecode}]"

        Write-Host ''
        Write-Host '###################'
        Write-Host ''
        Write-Host ''
    }
    
    return $messagecode
}
```

[PowerShell_SearchForPdffileStrings](https://zenn.dev/haretokidoki/articles/cad8b141202136)

```
# æ³¨æ„äº‹é …ï½œiTextSharp 5.5.13 ã‚’ä½¿ç”¨    : https://www.nuget.org/packages/iTextSharp/5.5.13
# ã€€ã€€ã€€ã€€ï½œiTextSharp 5 ã¯ã€ŒAGPLv3ã€   : https://opensource.org/license/agpl-v3/
# ã€€ã€€ã€€ã€€ï½œãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®è©³ç´°ã¯          : https://github.com/itext/itextsharp/blob/develop/LICENSE.md
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œSearchPdffile
# æ©Ÿèƒ½ã€€ã€€ï½œPDFãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œç´¢å‡¦ç†
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œInt
# ã€€ã€€ã€€ã€€ï½œ   0: æ­£å¸¸çµ‚äº†
# ã€€ã€€ã€€ã€€ï½œ-401: ã‚¨ãƒ©ãƒ¼ ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®æ›¸ãå‡ºã—å¤±æ•—
# ã€€ã€€ã€€ã€€ï½œ-411: ã‚¨ãƒ©ãƒ¼ PDFãƒ•ã‚¡ã‚¤ãƒ«å†…ã®å‡¦ç†çµæœãŒç•°å¸¸çµ‚äº†
# å¼•æ•°ã€€ã€€ï½œtarget_path; å¯¾è±¡XMLãƒ•ã‚¡ã‚¤ãƒ«
#################################################################################
Function SearchPdffile {
    param (
        [System.String]$target_path,
        [System.String]$target_text
    )
    [System.Int32]$result = 0

    # PDFãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    try {
        [System.String]$tmp_textfile = ".\source\tmp\pdf_textdata.txt"
        $reader = New-Object iTextSharp.text.pdf.PdfReader($target_path)
        [System.Int32]$totalpages = $reader.NumberOfPages
        New-Item $tmp_textfile -ItemType file -Force 2>&1>$null

        ## ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãå‡ºã—
        for ([System.Int32]$i = 1; $i -le $totalpages; $i++) {
            $line = [iTextSharp.text.pdf.parser.PdfTextExtractor]::GetTextFromPage($reader, $i)
            Write-Output $line | Add-Content $tmp_textfile -Encoding UTF8
        }
        $reader.Close()
    } catch {
        $result = -401
    }

    # æŒ‡å®šæ–‡å­—åˆ—ã®æ¤œç´¢
    if ($result -eq 0) {
        [System.String]$textdata = (Get-Content -Raw $tmp_textfile)
        $pdfresult = [Regex]::Matches($textdata, $target_text) | ForEach-Object {$_.Value}

        if ($null -eq $pdfresult) {
            $result = -411
        }
    }

    return $result
}
```

[PowerShell_ShapingXMLfileTool](https://zenn.dev/haretokidoki/articles/a77765dd56f202)

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œIsExistsAttribute
# æ©Ÿèƒ½ã€€ã€€ï½œå±æ€§ã®å…¥åŠ›ãƒã‚§ãƒƒã‚¯
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œBooleanï¼ˆTrue: æ­£å¸¸çµ‚äº†, False: å‡¦ç†ä¸­æ–­ï¼‰
# å¼•æ•°ã€€ã€€ï½œtarget_path: å¯¾è±¡XMLãƒ•ã‚¡ã‚¤ãƒ«, target_ver: å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³
#################################################################################
function IsExistsAttribute {
    param (
        [System.String]$target_path,
        [PSCustomObject]$target_ver
    )
    [System.Boolean]$return = $true
    [System.String]$match_str = ''

    for ([System.Int32]$i = 0; $i -lt $target_ver.SortOrder.Length; $i++) {
        $match_str = [Regex]::Matches((Get-Content $target_path), $target_ver.SortOrder[$i]) | ForEach-Object {$_.Value}

        if (($null -eq $match_str) -And `
            ($target_ver.Required[$i] -eq '1')) {
                $return = $false
                break
        }
    }

    return $return
}

#################################################################################
# å‡¦ç†åã€€ï½œSortorderAttribute
# æ©Ÿèƒ½ã€€ã€€ï½œå±æ€§ã®ä¸¦ã³æ›¿ãˆ
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œStringï¼ˆä¸¦ã³æ›¿ãˆå¾Œã®ã‚¿ã‚°ï¼‰
# å¼•æ•°ã€€ã€€ï½œtarget_path: å¯¾è±¡XMLãƒ•ã‚¡ã‚¤ãƒ«, target_ver: å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³
#################################################################################
function SortorderAttribute {
    param (
        [System.String]$target_path,
        [PSCustomObject]$target_ver
    )
    [System.String]$return = '<PurchaseOrder'
    [System.String]$match_str = ''

    # å¯¾è±¡æ–‡å­—åˆ—ã‚’èª­ã¿è¾¼ã¿
    [System.String]$target_str = [Regex]::Matches((Get-Content -Raw $target_path), "<PurchaseOrder[\s\S]*?>") | ForEach-Object {$_.Value}

    # ä¸¦ã³æ›¿ãˆ
    foreach($item in $target_ver.SortOrder) {
        $match_str = [Regex]::Matches($target_str, $item) | ForEach-Object {$_.Value}
        $sbtemp=New-Object System.Text.StringBuilder
        @($return,`
          $match_str)|
        ForEach-Object{[void]$sbtemp.Append($_)}
        $return = $sbtemp.ToString()
    }
    $sbtemp=New-Object System.Text.StringBuilder
    @($return,`
      ">")|
    ForEach-Object{[void]$sbtemp.Append($_)}
    $return = $sbtemp.ToString()

    return $return
}

#################################################################################
# å‡¦ç†åã€€ï½œRemoveUnnecessaryparts
# æ©Ÿèƒ½ã€€ã€€ï½œä¸è¦ãªä¸€éƒ¨å±æ€§ã®å‰Šé™¤
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œStringï¼ˆå‰Šé™¤å¾Œã®ã‚¿ã‚°ï¼‰
# å¼•æ•°ã€€ã€€ï½œtarget_str: å¯¾è±¡æ–‡å­—åˆ—
#################################################################################
function RemoveUnnecessaryparts {
    param (
        [System.String]$target_str
    )
    [System.String]$return = $target_str
    [System.String]$match_str = [Regex]::Matches($target_str," Remarks=`".*?`"") | ForEach-Object {$_.Value}

    if ($null -eq $match_str) {
        return $match_str
    }

    $return = [Regex]::Replace($target_str, $match_str, "", "IgnoreCase")

    return $return
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œDiffTextfile
# æ©Ÿèƒ½ã€€ã€€ï½œãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¯”è¼ƒ
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œ-
# å¼•æ•°ã€€ã€€ï½œfromfileï¼šæ¯”è¼ƒå…ƒãƒ•ã‚¡ã‚¤ãƒ«ã€tofileï¼šæ¯”è¼ƒå…ˆãƒ•ã‚¡ã‚¤ãƒ«
# ã€€ã€€ã€€ã€€ã€€(ä»»æ„)fullï¼š-FullæŒ‡å®šã§å…¨ã¦ã®å·®ç•°è¡¨ç¤º
#################################################################################
function DiffTextfile {
    param (
        [System.String]$fromfile,
        [System.String]$tofile,
        [Switch]$full
    )
    [System.Int32]$maxrow = 40
    [System.Int32]$rowcount = 0
  
    # ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã®å¤‰æ›´
    If (-Not $c_debug) {
        [System.Management.Automation.Host.PSHostRawUserInterface]$userinterface = $host.UI.RawUI
        [System.ValueType]$windowsize = $userinterface.WindowSize
        $userinterface.WindowSize = New-Object System.Management.Automation.Host.Size(120,43)
    }
  
    # æ¯”è¼ƒå‡¦ç†
    [System.String]$line = ""
    [System.String]$forecolor = ""
    Compare-Object (Get-Content $fromfile) (Get-Content $tofile) -IncludeEqual:$full |
        ForEach-Object {
        if ($_.SideIndicator -eq "=>")
        {
            # ä¿®æ­£å¾Œã«å­˜åœ¨ã™ã‚‹è¡Œï¼ˆè¿½åŠ ã¾ãŸã¯å¤‰æ›´ã•ã‚ŒãŸè¡Œï¼‰
            $line = "[ + ] " + $_.InputObject
            $forecolor = "Red"
        } elseif ($_.SideIndicator -eq "<=") {
            # ä¿®æ­£å¾Œã«å­˜åœ¨ã—ãªã„è¡Œï¼ˆå‰Šé™¤ã¾ãŸã¯å¤‰æ›´ã•ã‚ŒãŸè¡Œï¼‰
            $line = "[ - ] " + $_.InputObject
            $forecolor = "DarkGray"
        } elseif ($full) {
            # å¤‰æ›´ãŒãªã„è¡Œ
            $line = "[ = ] " + $_.InputObject
            $forecolor = "White"
        }
        Write-Host $line -ForegroundColor $forecolor
        $rowcount++
        # æœ€å¤§è¡Œæ•°ã¾ã§é”ã—ãŸå ´åˆã€ç”»é¢ã‚’ä¸€æ™‚åœæ­¢
        if ($rowcount -ge $maxrow) {
            $rowcount = 0
            Write-Host ''
            Read-Host ' --- æ¬¡ã®ãƒšãƒ¼ã‚¸ã¸ [ Enter ] / ä¸­æ–­ [ Ctrl + C ] --- '
        }
    }
    # ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã®æˆ»ã—
    Write-Host ''
    Write-Host '--- æ¯”è¼ƒçµ‚äº† [ Enter ] ---'
    Read-Host | Out-Null
    if (-Not $c_debug) {
        $userinterface.WindowSize = $windowsize
    }
}
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ï½œReplaceXmlfile
# æ©Ÿèƒ½ã€€ã€€ï½œXMLãƒ•ã‚¡ã‚¤ãƒ«ã®ç½®æ›å‡¦ç†
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ï½œIntï¼ˆ0ï¼šæˆåŠŸ, -501ï¼šå¤±æ•—ï¼‰
# å¼•æ•°ã€€ã€€ï½œtarget_pathï¼›å¯¾è±¡XMLãƒ•ã‚¡ã‚¤ãƒ«, target_str: å¯¾è±¡æ–‡å­—åˆ—
#################################################################################
function ReplaceXmlfile {
    param (
        [System.String]$target_path,
        [System.String]$target_str
    )
    [System.Int32]$result = 0
    [System.String]$xmldata = [System.IO.File]::ReadAllText($target_path)
    $xmldata = [Regex]::Replace($xmldata, "<PurchaseOrder[\s\S]*?>", $afterdel)

    try {
        [System.IO.File]::WriteAllText($target_path, $xmldata)
        # DEBUG
        if ($c_debug) {
            $tag_after = [Regex]::Matches((Get-Content $target_path),"<PurchaseOrder[\s\S]*?>") | ForEach-Object {$_.Value}
            $sbtemp=New-Object System.Text.StringBuilder
            @("DEBUG : ä¸‹è¨˜å†…å®¹ã§ç½®æ›ã—ã¾ã—ãŸã€‚`r`n", `
              "`r`n",`
              "--[ç½®æ›å¾Œ]------------------------------------------------`r`n", `
              "${tag_after}`r`n",`
              "----------------------------------------------------------`r`n",`
              "`r`n")|
            ForEach-Object{[void]$sbtemp.Append($_)}
            $prompt_message = $sbtemp.ToString()
            Write-Host $prompt_message -ForegroundColor DarkYellow
        }
    } catch {
        $result = -501
    }

    return $result
}
```

[PowerShell_WindowsUpdateTool](https://zenn.dev/haretokidoki/articles/a5d1a471a5699a)

```powershell:
#################################################################################
# å‡¦ç†åã€€ | SwitchActiveWindow
# æ©Ÿèƒ½ã€€ã€€ | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®åˆ‡ã‚Šæ›¿ãˆ
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | ãªã—
# å¼•æ•°ã€€ã€€ | cscode: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦åˆ‡ã‚Šæ›¿ãˆã‚‹C#ã®ã‚³ãƒ¼ãƒ‰
# ã€€ã€€ã€€ã€€ | window_name: åˆ‡ã‚Šæ›¿ãˆã‚‹ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®åå‰
#################################################################################
Function SwitchActiveWindow {
    Param (
        [System.String]$cscode_filepath,
        [System.String]$window_name
    )

    add-type -AssemblyName microsoft.VisualBasic
    add-type -AssemblyName System.Windows.Forms

    [System.String]$cscode = Get-Content $cscode_filepath -Raw -Encoding utf8

    $Win32 = add-type -memberDefinition $cscode -name "Win32ApiFunctions" -passthru
    
    $ps = Get-Process | Where-Object {$_.Name -match $window_name}
    foreach($process in $ps){
        $Win32::ActiveWindow($process.MainWindowHandle);
    }
}
```

```csharp:
public static void ActiveWindow(IntPtr hWnd)
{
    if (hWnd == IntPtr.Zero)
    {
        return;
    }

    //ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒæœ€å°åŒ–ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯å…ƒã«æˆ»ã™
    if (IsIconic(hWnd))
    {
        ShowWindowAsync(hWnd, SW_RESTORE);
    }

    //AttachThreadInputã®æº–å‚™
    //ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ãƒãƒ³ãƒ‰ãƒ«ã‚’å–å¾—
    IntPtr forehWnd=GetForegroundWindow();
    if (forehWnd == hWnd)
    {
        return;
    }
    //ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã®ã‚¹ãƒ¬ãƒƒãƒ‰IDã‚’å–å¾—
    uint foreThread = GetWindowThreadProcessId(forehWnd, IntPtr.Zero);
    //è‡ªåˆ†ã®ã‚¹ãƒ¬ãƒƒãƒ‰IDã‚’åå¾—
    uint thisThread = GetCurrentThreadId();

    uint timeout = 200000;
    if (foreThread != thisThread)
    {
        //ForegroundLockTimeoutã®ç¾åœ¨ã®è¨­å®šã‚’å–å¾—
        //Visual Studio 2010, 2012èµ·å‹•å¾Œã¯ã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¨é•ã†å€¤ã‚’è¿”ã™
        SystemParametersInfoGet(SPI_GETFOREGROUNDLOCKTIMEOUT, 0, ref timeout, 0);
        //ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‹ã‚‰å–å¾—ã™ã‚‹å ´åˆ
        //timeout = (uint)Microsoft.Win32.Registry.GetValue(
        //    @"HKEY_CURRENT_USER\Control Panel\Desktop",
        //    "ForegroundLockTimeout", 200000);

        //ForegroundLockTimeoutã®å€¤ã‚’0ã«ã™ã‚‹
        //(SPIF_UPDATEINIFILE | SPIF_SENDCHANGE)ã‚’ä½¿ã„ãŸã„ãŒã€
        //  timeoutãŒãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¨é•ã†å€¤ã ã¨æˆ»ã›ãªããªã‚‹ã®ã§ä½¿ã‚ãªã„
        SystemParametersInfoSet(SPI_SETFOREGROUNDLOCKTIMEOUT, 0, 0, 0);

        //å…¥åŠ›å‡¦ç†æ©Ÿæ§‹ã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹
        AttachThreadInput(thisThread, foreThread, true);
    }

    //ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã«ã™ã‚‹å‡¦ç†
    SetForegroundWindow(hWnd);
    SetWindowPos(hWnd, HWND_TOP, 0, 0, 0, 0,
        SWP_NOMOVE | SWP_NOSIZE | SWP_SHOWWINDOW | SWP_ASYNCWINDOWPOS);
    BringWindowToTop(hWnd);
    ShowWindowAsync(hWnd, SW_SHOW);
    SetFocus(hWnd);

    if (foreThread != thisThread)
    {
        //ForegroundLockTimeoutã®å€¤ã‚’å…ƒã«æˆ»ã™
        //ã“ã“ã§ã‚‚(SPIF_UPDATEINIFILE | SPIF_SENDCHANGE)ã¯ä½¿ã‚ãªã„
        SystemParametersInfoSet(SPI_SETFOREGROUNDLOCKTIMEOUT, 0, timeout, 0);

        //ãƒ‡ã‚¿ãƒƒãƒ
        AttachThreadInput(thisThread, foreThread, false);
    }
}

[DllImport("user32.dll")]
[return: MarshalAs(UnmanagedType.Bool)]
private static extern bool SetForegroundWindow(IntPtr hWnd);

[DllImport("user32.dll")]
private static extern IntPtr GetForegroundWindow();

[DllImport("user32.dll", SetLastError = true)]
[return: MarshalAs(UnmanagedType.Bool)]
private static extern bool BringWindowToTop(IntPtr hWnd);

[DllImport("user32.dll")]
static extern IntPtr SetFocus(IntPtr hWnd);

[DllImport("user32.dll", SetLastError = true)]
[return: MarshalAs(UnmanagedType.Bool)]
private static extern bool SetWindowPos(IntPtr hWnd,
    int hWndInsertAfter, int x, int y, int cx, int cy, int uFlags);

private const int SWP_NOSIZE = 0x0001;
private const int SWP_NOMOVE = 0x0002;
private const int SWP_NOZORDER = 0x0004;
private const int SWP_SHOWWINDOW = 0x0040;
private const int SWP_ASYNCWINDOWPOS = 0x4000;
private const int HWND_TOP = 0;
private const int HWND_BOTTOM = 1;
private const int HWND_TOPMOST = -1;
private const int HWND_NOTOPMOST = -2;

[DllImport("user32.dll")]
[return: MarshalAs(UnmanagedType.Bool)]
private static extern bool ShowWindow(IntPtr hWnd, int nCmdShow);
[DllImport("user32.dll")]
[return: MarshalAs(UnmanagedType.Bool)]
private static extern bool ShowWindowAsync(IntPtr hWnd, int nCmdShow);

private const int SW_SHOWNORMAL = 1;
private const int SW_SHOW = 5;
private const int SW_RESTORE = 9;

[DllImport("user32.dll")]
[return: MarshalAs(UnmanagedType.Bool)]
private static extern bool IsIconic(IntPtr hWnd);

[DllImport("user32.dll")]
private static extern uint GetWindowThreadProcessId(
    IntPtr hWnd, IntPtr ProcessId);

[DllImport("kernel32.dll")]
private static extern uint GetCurrentThreadId();

[DllImport("user32.dll")]
[return: MarshalAs(UnmanagedType.Bool)]
private static extern bool AttachThreadInput(
    uint idAttach, uint idAttachTo, bool fAttach);

[DllImport("user32.dll", EntryPoint = "SystemParametersInfo",
    SetLastError = true)]
[return: MarshalAs(UnmanagedType.Bool)]
private static extern bool SystemParametersInfoGet(
    uint action, uint param, ref uint vparam, uint init);

[DllImport("user32.dll", EntryPoint = "SystemParametersInfo",
    SetLastError = true)]
[return: MarshalAs(UnmanagedType.Bool)]
private static extern bool SystemParametersInfoSet(
    uint action, uint param, uint vparam, uint init);

private const uint SPI_GETFOREGROUNDLOCKTIMEOUT = 0x2000;
private const uint SPI_SETFOREGROUNDLOCKTIMEOUT = 0x2001;
private const uint SPIF_UPDATEINIFILE = 0x01;
private const uint SPIF_SENDCHANGE = 0x02;
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ | InstallModules
# æ©Ÿèƒ½ã€€ã€€ | ãƒªã‚¹ãƒˆã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | MESSAGECODEï¼ˆenumï¼‰
# å¼•æ•°ã€€ã€€ | install_modules : ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯¾è±¡ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
#################################################################################
Function InstallModules {
    Param (
        [System.String[]]$function_parameters
    )

    [MESSAGECODE]$messagecode = [MESSAGECODE]::Successful

    [System.String[]]$modules_array = $function_parameters[0].Split(',')

    foreach ($module_name in $modules_array) {
        # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®æœ‰ç„¡ã‚’ãƒã‚§ãƒƒã‚¯
        if ($null -eq (Get-Module -Name "$module_name")) {
            # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒãªã„ç‚ºã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
            try {
                [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
                Install-Module -Name "$module_name"
                Import-Module -Name "$module_name"

                Write-Host "$module_name has been installed." -ForegroundColor Cyan
                Write-Host ''
                Write-Host ''
            }
            catch {
                $messagecode = [MESSAGECODE]::Error_InstallModules
            }
        }
        else {
            # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã®ç‚ºã€ã‚¹ã‚­ãƒƒãƒ—
            Write-Host "$module_name has been already installed."
            Write-Host ''
            Write-Host ''
        }
    }

    ### DEBUG ###
    if ($DEBUG_ON) {
        Write-Host '### DEBUG PRINT ###'
        Write-Host ''

        Write-Host "Function InstallModules: messagecode [${messagecode}]"

        Write-Host ''
        Write-Host '###################'
        Write-Host ''
        Write-Host ''
    }

    return $messagecode
}
```

## å‚è€ƒæƒ…å ±

https://zenn.dev/haretokidoki/articles/4da393f1f8d49d

## é–¢é€£è¨˜äº‹

https://haretokidoki-blog.com/pasocon_powershell-startup/
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960

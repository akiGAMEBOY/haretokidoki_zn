---
title: "Windows上にあるパーティションをドライブレターに割り当ててOS上で認識される。"
emoji: "⛳"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---
## 概要

通常表示されない回復パーティション（WinRE）内のデータを確認するために、一時的にドライブレターを割り当てる方法を調べました。

割り当てた後に解除する切り戻し手順とあわせて紹介。

## この記事のターゲット

- Windows OS ユーザーの方
- Windows OSで非表示のディスクにアクセスしたい方

## 環境

### Windows OS

## 対応方法

### 回復パーティションを割り当てる方法

管理者権限 ＋ コマンドプロンプト で対応。

1. 管理者としてコマンドプロンプトを実行
    「 `⊞ Windowsキー ＋ R` 」で“ファイル名を指定して実行”を起動。
    起動後、入力欄に「 `cmd` 」と入力し、` Ctrl ＋ Shift ＋ Enterキー` を押すことで、管理者として実行。

1. WinREの停止

    ```
    C:\WINDOWS\system32>reagentc /info
    Windows 回復環境 (Windows RE) およびシステム リセット構成
    情報:

    ★     Windows RE の状態:         Disabled
        Windows RE の場所:
        ブート構成データ (BCD) ID: 36046695-249b-11eb-a108-XXXXXXXXXXXX
        回復イメージの場所:
        回復イメージ インデックス: 0
        カスタム イメージの場所:
        カスタム イメージ インデックス: 0

    REAGENTC.EXE: 操作は成功しました。


    C:\WINDOWS\system32>
    C:\WINDOWS\system32>reagentc /disable
    ★ REAGENTC.EXE: Windows RE は既に無効です。


    C:\WINDOWS\system32>
    ```

1. dikspartを起動

    ```
    Microsoft Windows [Version 10.0.19045.4046]
    (c) Microsoft Corporation. All rights reserved.

    C:\WINDOWS\system32>diskpart

    Microsoft DiskPart バージョン 10.0.19041.3636

    Copyright (C) Microsoft Corporation.
    コンピューター: "コンピューター名"

    DISKPART>
    ```

1. 対象のディスクを選択

    ```
    DISKPART> list disk

    ディスク      状態           サイズ   空き   ダイナ GPT
    ###                                          ミック
    ------------  -------------  -------  -------  ---  ---
    ディスク 0    オンライン           465 GB  1024 KB
    ディスク 1    オンライン           238 GB  1000 MB        *

    DISKPART>

    DISKPART> sel disk 1

    ディスク 1 が選択されました。

    DISKPART>
    ```

1. 割り当てるパーティションを選択

    ```
    DISKPART> list part

    Partition ###  Type                Size     Offset
    -------------  ------------------  -------  -------
    Partition 1    システム               700 MB  1024 KB
    Partition 2    予約                 128 MB   701 MB
    Partition 3    プライマリ              130 GB   829 MB
    Partition 4    プライマリ              106 GB   131 GB
    Partition 5    回復                1000 MB   237 GB

    DISKPART>

    DISKPART> sel part 5

    パーティション 5 が選択されました。

    DISKPART>
    ```

1. ドライブレターを割り当て

    ```
    DISKPART> assign letter=z

    DiskPart はドライブ文字またはマウント ポイントを正常に割り当てました。

    DISKPART>

    DISKPART> exit

    DiskPart を終了しています...

    C:\WINDOWS\system32>
    ```

1. 割り当たったことを確認



WinRE 回復パーティションの空き容量を減らすためにファイルを追加する具体的な方法は以下の通りです。この作業はシステムに影響を与える可能性があるため、十分なバックアップを取った上で慎重に行ってください。

1. **管理者権限でコマンドプロンプトを開く**: `cmd` を検索し、「管理者として実行」を選択します。
2. **DiskPartを使用してWinREパーティションを選択**:
    - `diskpart` を入力し、Enterキーを押します。
    - `list disk` を入力し、Enterキーを押して利用可能なディスクを表示します。
    - `select disk X` (XはWinREパーティションが存在するディスク番号) を入力し、Enterキーを押します。
    - `list partition` を入力し、Enterキーを押してパーティションのリストを表示します。
    - `select partition Y` (YはWinREパーティションの番号) を入力し、Enterキーを押します。
3. **WinREパーティションにアクセス**:
    - `assign letter=Z` (Zは任意の未使用ドライブ文字) を入力し、Enterキーを押してWinREパーティションにドライブ文字を割り当てます。
    - `exit` を入力し、DiskPartを終了します。
4. **大きなファイルを作成してコピー**:
    - 管理者権限のコマンドプロンプトで、以下のコマンドを使用して大きなファイルを作成します。
    このコマンドは、1GBのダミーファイルを作成します。必要に応じてファイルサイズを調整してください。
        
        ```
        fsutil file createnew Z:\dummyfile.txt 1000000000
        
        ```
        
    - WinREパーティションにダミーファイルをコピーします。

[これでWinREパーティションの空き容量が減少します。ただし、WinREパーティションはWindowsの回復機能に必要なため、空き容量を完全になくすとシステムの回復機能が損なわれる可能性があることに注意してください。また、不要になったダミーファイルは削除して空き容量を確保してください。1](https://learn.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/windows-recovery-environment--windows-re--technical-reference?view=windows-11)[2](https://www.pasoble.jp/tips/how-to-recreate-winre.html)

-----

DiskPartでドライブの割り当てを解除するには、以下のコマンドを使用します。

1. **DiskPartを開く**: 管理者権限でコマンドプロンプトを開き、`diskpart`と入力してEnterキーを押します。
2. **ボリュームを選択**: `list volume`を入力してEnterキーを押し、割り当てを解除したいボリュームの一覧を表示します。次に、`select volume X`（Xはボリューム番号）を入力してEnterキーを押し、操作するボリュームを選択します。
3. **ドライブレターの割り当てを解除**: `remove letter=Y`（Yは割り当てられているドライブレター）を入力してEnterキーを押します。

これで、選択したボリュームからドライブレターの割り当てが解除されます。¹²

ソース: Bing との会話 2024/3/12
(1) Diskpartでドライブレターを割り当ておよび削除する方法. https://partition.aomei.jp/articles/assign-drive-letter.html.
(2) diskpart | Microsoft Learn. https://learn.microsoft.com/ja-jp/windows-server/administration/windows-commands/diskpart.
(3) Windowsでドライブレターの割り当て/削除/変更を行う方法【コマンドプロンプト編】 | パソコンに困ったらFind Out!. https://pc.siraberu.info/post-2909/.
(4) Windows 11／10／8／7でパーティションを削除する4つの方法. https://partition.aomei.jp/windows-10/how-to-remove-partition-windows-10.html.

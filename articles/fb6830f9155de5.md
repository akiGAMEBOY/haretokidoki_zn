---
title: "[PowerShell]å…±é€šåŒ–ã—ãŸFunctionã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ç´¹ä»‹"
emoji: "ğŸ¤–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell", "ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰", "ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ "]
published: false
---
## æ¦‚è¦

D:\Documents\VS Code\haretokidoki_zn\articles\1c671247e9523c.md

```powershell:ã‚¸ãƒ£ã‚°é…åˆ—ã€Œ @() ã€ã§å®£è¨€ã—ãŸå¤‰æ•°ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ
# Function å®šç¾©
Function CheckPortMultipleServers {
    Param (
        [System.String[][]]$port_check_lists
    )

    for($i = 0; $i -lt $port_check_lists.Length; $i++) {
	    $target_row = $port_check_lists[$i]
	    Test-NetConnection $target_row[0] -Port $target_row[1]
	}
}

# Function å®Ÿè¡Œ
[System.String[][]]$server_lists = @(
    @('localhost','8080'),
    @('localhost','8000'),
    @('google.com','443'),
    @('smtp.google.com','25')
)
CheckPortMultipleServers $server_lists
```

```powershell:å¤šæ¬¡å…ƒé…åˆ—ã€Œ [,] ã€ã§å®£è¨€ã—ãŸå¤‰æ•°ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ
# Function å®šç¾©
Function CheckPortMultipleServers {
    Param (
        [System.String[,]]$port_check_lists
    )

    for($i = 0; $i -lt $port_check_lists.Length; $i++) {
        Test-NetConnection $port_check_lists[$i,0] -Port $port_check_lists[$i,1]
    }
}

# Function å®Ÿè¡Œ
$server_lists = New-Object "System.String[,]" 4,2
$server_lists[0,0] = 'localhost'
$server_lists[0,1] = '8080'
$server_lists[1,0] = 'localhost'
$server_lists[1,1] = '8000'
$server_lists[2,0] = 'google.com'
$server_lists[2,1] = '443'
$server_lists[3,0] = 'smtp.google.com'
$server_lists[3,1] = '25'
CheckPortMultipleServers $server_lists
```

D:\Documents\VS Code\haretokidoki_zn\articles\2d0b0dcd503c2e.md

```powershell:Bing AIã®å›ç­”ã‚’å‚è€ƒã«æ‰‹ç›´ã—ã—ãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
Function ShowStrings {
    Param (
        [System.Object[]]$strings
    )
    
    # ãƒã‚¤ãƒˆæ•°ï¼ˆShift JISï¼‰ã«å¤‰æ›
    # [System.Object[]]$to_bytes = $strings
    # â†‘ ã“ã‚Œã ã¨åŒã˜ãƒ¡ãƒ¢ãƒªã‚’å‚ç…§ã—ã¦ã„ã‚‹ç‚ºã€$to_bytesã‚’å¤‰æ›ã™ã‚‹éš›ã«ä¸€ç·’ã«$stringsã‚‚å¤‰æ›ã•ã‚Œã¦ã—ã¾ã†ã€‚
    # ã€€ å¤‰æ›å‰ ã¨ å¤‰æ›å¾Œ ã‚’æ¯”è¼ƒã—ãŸã„ç‚ºã€Closeãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã€‚
    [System.Object[]]$to_bytes = $strings.Clone()
    [System.Int32]$i = 0
    [System.Int32]$max_length = 0
    for ($i = 0; $i -lt $to_bytes.Count; $i++) {
        $to_bytes[$i] = [System.Text.Encoding]::GetEncoding("shift_jis").GetByteCount($to_bytes[$i])
        if ($max_length -lt $to_bytes[$i]) {
            $max_length = $to_bytes[$i]
        }
    }

    Write-Host ' ============ å¤‰æ›å‰ ============ '
    Write-Host ''
    Write-Host "${strings}"
    Write-Host ' ================================ '
    Write-Host ''
    Write-Host ''
    Write-Host ' ============ å¤‰æ›å¾Œ ============ '
    Write-Host ''
    Write-Host "${to_bytes}"
    Write-Host ' ================================ '
    Write-Host ''
    Write-Host ''

    # ã‚¿ãƒ–æ•°ã®è¨ˆç®— ã¨ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›
    [System.Int32]$tab_count = 0
    [System.Int32]$tab_width = 8
    Write-Host ' ============ å‡ºåŠ›çµæœ ============ '
    Write-Host ''
    for ($i = 0; $i -lt $to_bytes.Count; $i++) {
        # ã‚¿ãƒ–ã®æ•°ã‚’è¨ˆç®—ã—ã¾ã™
        # æœ€é•·ã®æ–‡å­—åˆ—ã¨ã®å·®åˆ†ã‚’ã‚¿ãƒ–ã®å¹…ã§å‰²ã‚Šã€åˆ‡ã‚Šä¸Šã’ã¾ã™
        $tab_count = [Math]::Ceiling(($max_length - [System.Int32]$to_bytes[$i]) / $tab_width)
        # æœ€ä½1ã¤ã¯ã‚¿ãƒ–ã‚’æŒ¿å…¥ã™ã‚‹ã‚ˆã†è¨­å®š
        if ($tab_count -eq 0) {
            $tab_count = 1
        }

        # æœ€çµ‚æ¡ã«æ”¹è¡Œãªã—ã§å…ˆé ­éƒ¨ã®æ–‡å­—åˆ—ã‚’å‡ºåŠ›
        Write-Host "æ–‡å­—åˆ— [$($strings[$i])]" -NoNewline
        Write-Host ("`t" * $tab_count) -NoNewline
        # æœ€çµ‚æ¡ã«æ”¹è¡Œã‚ã‚Šã§ç¶šãæ–‡å­—åˆ—ã‚’å‡ºåŠ›
        Write-Host "ã€ãƒã‚¤ãƒˆæ•°ï¼ˆShift-JISï¼‰[$($to_bytes[$i])] byte"
    }
    Write-Host ' ================================ '
    Write-Host ''
    Write-Host ''
}
```

```powershell:ä½œæˆã—ãŸFunctionã‚’å‘¼ã³å‡ºã—ã¦æ¤œè¨¼
PS C:\WINDOWS\system32> $strings = @("1234567890", "ã‚", "ï½±", "123456789012345678901234567890", "abcdefg")
PS C:\WINDOWS\system32>
PS C:\WINDOWS\system32> CalculationTabcount $strings
 ============ å¤‰æ›å‰ ============

1234567890 ã‚ ï½± 123456789012345678901234567890 abcdefg
 ================================


 ============ å¤‰æ›å¾Œ ============

10 2 1 30 7
 ================================


 ============ å‡ºåŠ›çµæœ ============

æ–‡å­—åˆ— [1234567890]                     ã€ãƒã‚¤ãƒˆæ•°ï¼ˆShift-JISï¼‰[10] byte
æ–‡å­—åˆ— [ã‚]                             ã€ãƒã‚¤ãƒˆæ•°ï¼ˆShift-JISï¼‰[2] byte
æ–‡å­—åˆ— [ï½±]                              ã€ãƒã‚¤ãƒˆæ•°ï¼ˆShift-JISï¼‰[1] byte
æ–‡å­—åˆ— [123456789012345678901234567890] ã€ãƒã‚¤ãƒˆæ•°ï¼ˆShift-JISï¼‰[30] byte
æ–‡å­—åˆ— [abcdefg]                        ã€ãƒã‚¤ãƒˆæ•°ï¼ˆShift-JISï¼‰[7] byte
 ================================


PS C:\WINDOWS\system32>
```

D:\Documents\VS Code\haretokidoki_zn\articles\3df8f03faeac28.md

```powershell:æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’å–å¾—ã™ã‚‹Function
#################################################################################
# å‡¦ç†åã€€ | GetSjisCount
# æ©Ÿèƒ½ã€€ã€€ | æ–‡å­—åˆ—å…¨ä½“ã®ãƒã‚¤ãƒˆæ•°ã‚’Shift JISã§å–å¾—
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Int32ï¼ˆæ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ï¼‰
# å¼•æ•°ã€€ã€€ | target_str: å¯¾è±¡æ–‡å­—åˆ—
#################################################################################
Function GetSjisCount {
    Param (
        [System.String]$target_str
    )

    # æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’SJISã§è¨­å®š
    $encoding = [System.Text.Encoding]::GetEncoding("Shift_JIS")

    # æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’è¿”ã™
    return $encoding.GetByteCount($target_str)
}
```

```powershell:å®Ÿéš›ã«å®Ÿè¡Œã—ãŸçµæœ
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> GetSjisCount 'é …ç›®0001  '
10
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
```

```powershell:ãƒã‚¤ãƒˆæ•°ã§æ–‡å­—åˆ—æŠ½å‡ºã™ã‚‹Function
#################################################################################
# å‡¦ç†åã€€ | ExtractByteSubstring
# æ©Ÿèƒ½ã€€ã€€ | ãƒã‚¤ãƒˆæ•°ã§æ–‡å­—åˆ—ã‚’æŠ½å‡º
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Stringï¼ˆæŠ½å‡ºã—ãŸæ–‡å­—åˆ—ï¼‰
# å¼•æ•°ã€€ã€€ | target_str: å¯¾è±¡æ–‡å­—åˆ—
# ã€€ã€€ã€€ã€€ | start     : æŠ½å‡ºé–‹å§‹ã™ã‚‹ãƒã‚¤ãƒˆä½ç½®
# ã€€ã€€ã€€ã€€ | length    : æŒ‡å®šãƒã‚¤ãƒˆæ•°
#################################################################################
Function ExtractByteSubstring {
    Param (
        [System.String]$target_str,
        [System.Int32]$start,
        [System.Int32]$length
    )

    $encoding = [System.Text.Encoding]::GetEncoding("Shift_JIS")

    # æ–‡å­—åˆ—ã‚’ãƒã‚¤ãƒˆé…åˆ—ã«å¤‰æ›
    [System.Byte[]]$all_bytes = $encoding.GetBytes($target_str)

    # æŠ½å‡ºã™ã‚‹ãƒã‚¤ãƒˆé…åˆ—ã‚’åˆæœŸåŒ–
    $extracted_bytes = New-Object Byte[] $length

    # æŒ‡å®šã•ã‚ŒãŸãƒã‚¤ãƒˆä½ç½®ã‹ã‚‰ãƒã‚¤ãƒˆé…åˆ—ã‚’æŠ½å‡º
    [System.Array]::Copy($all_bytes, $start, $extracted_bytes, 0, $length)

    # æŠ½å‡ºã—ãŸãƒã‚¤ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æ–‡å­—åˆ—ã¨ã—ã¦è¿”ã™
    return $encoding.GetString($extracted_bytes)
}
```

D:\Documents\VS Code\haretokidoki_zn\articles\31ad6dfc204e38.md

```powershell:å®Ÿéš›ã«å®Ÿè¡Œã—ãŸçµæœ
# 4ãƒã‚¤ãƒˆç›®ã¨5ãƒã‚¤ãƒˆç›®ã®é–“ï¼ˆ$start = 4ï¼‰ã‚’é–‹å§‹ä½ç½®ã¨ã—ã¦4ãƒã‚¤ãƒˆåˆ†ï¼ˆ$length = 4ï¼‰ã®æ–‡å­—åˆ—ã‚’æŠ½å‡º
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> ExtractByteSubstring '1234ã‚ã‹' 4 4
ã‚ã‹
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
```

```powershell:PowerShell 7.2ä»¥å‰ï¼šè‡ªä½œã®Functionã‚’ä½œæˆ
# Functionã®å®šç¾©
Function PingRepeat{
    param(
        [System.String]$target_host = 'localhost',
        [System.Int32]$interval = 1000
    )
    # ãƒ–ãƒ¬ãƒ¼ã‚¯é€ä¿¡ã•ã‚Œã‚‹ã¾ã§ç¹°ã‚Šè¿”ã—
    while ($true) {
        try {
            # pingå®Ÿè¡Œ
            [Microsoft.PowerShell.Commands.TestConnectionCommand+PingStatus]$ping_data = Test-Connection $target_host -Count 1 -ErrorAction Stop
            # ç”»é¢ã«çµæœè¡¨ç¤º
            [System.String]$now_datetime = Get-Date -Format "yyyy/MM/dd HH:mm:ss.fff"
            # ResponseTimeãŒ0ã®å ´åˆã€nullã«ãªã‚‹ãŸã‚åˆ¤å®šã™ã‚‹
            if ($null -eq $ping_data.ResponseTime) {
                # ResponseTImeãŒnullã®å ´åˆã¯ã€å›ºå®šå€¤"0 ms"
                Write-Output "$now_datetime, $target_host, 0 ms"
            }
            else {
                # nullã§ã¯ãªã„å ´åˆã€å–å¾—ã—ãŸå€¤ã‚’è¨­å®š
                Write-Output "$now_datetime, $target_host, $($ping_data.ResponseTime) ms"
            }
        }
        catch {
            Write-Host "ã‚¨ãƒ©ãƒ¼ï¼š$($_.Exception.Message)" -ForegroundColor Red
            # ã€Œping -tã€ã®æŒ™å‹•ã«åˆã‚ã›ã€pingç–é€šãŒå–ã‚Œãªãã¦ã‚‚å‡¦ç†ã‚’ç¶šè¡Œã™ã‚‹ã€‚
            # ã‚‚ã—ã€NGã¨ãªã£ãŸå ´åˆã«å‡¦ç†ã‚’ä¸­æ–­ã—ãŸã„å ´åˆã¯ã€ã“ã“ã§ã€Œbreakã€ã‚’å®Ÿè¡Œã€‚
            # break
        }
        # é–“éš”ã‚’ã‚ã‘ã‚‹
        Start-Sleep -Milliseconds $interval
    }
}
```

```powershell:PowerShell 7.2ä»¥å‰ï¼šè‡ªä½œFunctionã‚’å®Ÿè¡Œ
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å"> PingRepeat www.bing.com
2024/02/22 13:39:52.273, www.bing.com, 26 ms
2024/02/22 13:39:53.329, www.bing.com, 50 ms
2024/02/22 13:39:54.379, www.bing.com, 24 ms
2024/02/22 13:39:55.667, www.bing.com, 247 ms
2024/02/22 13:39:56.733, www.bing.com, 48 ms
2024/02/22 13:39:57.821, www.bing.com, 62 ms
2024/02/22 13:39:58.846, www.bing.com, 20 ms
2024/02/22 13:39:59.896, www.bing.com, 20 ms
PS C:\Users\"ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
```


## å‚è€ƒæƒ…å ±

D:\Documents\VS Code\haretokidoki_zn\articles\4da393f1f8d49d.md
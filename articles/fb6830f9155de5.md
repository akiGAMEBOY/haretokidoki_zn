---
title: "[PowerShell]å…±é€šåŒ–ã—ãŸFunctionã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ï¼ˆå€‹åˆ¥è¨˜äº‹ã§ç´¹ä»‹ã—ãŸFunctionï¼‰"
emoji: "ğŸ¤–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["powershell", "ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰", "ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ "]
published: false
---
## æ¦‚è¦

## ã“ã®è¨˜äº‹ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ

- PowerShellãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–¹
- é »ç¹ã«æ›¸ãå‡¦ç†ã‚’å…±é€šåŒ–ã—ãŸã„æ–¹
- å…±é€šåŒ–ã—ãŸãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«ã—ãŸã„æ–¹

## Functionä¸€è¦§

### å€‹åˆ¥ã®è¨˜äº‹ã§ç´¹ä»‹ã—ãŸFunction

https://zenn.dev/haretokidoki/articles/1c671247e9523c

```powershell:
# Function å®šç¾©
Function CheckPortMultipleServers {
    Param (
        [System.String[][]]$port_check_lists
    )

    for($i = 0; $i -lt $port_check_lists.Length; $i++) {
	    $target_row = $port_check_lists[$i]
	    Test-NetConnection $target_row[0] -Port $target_row[1]
	}
}

# Function å®Ÿè¡Œ
[System.String[][]]$server_lists = @(
    @('localhost','8080'),
    @('localhost','8000'),
    @('google.com','443'),
    @('smtp.google.com','25')
)
CheckPortMultipleServers $server_lists
```

```powershell:
# Function å®šç¾©
Function CheckPortMultipleServers {
    Param (
        [System.String[,]]$port_check_lists
    )

    for($i = 0; $i -lt $port_check_lists.Length; $i++) {
        Test-NetConnection $port_check_lists[$i,0] -Port $port_check_lists[$i,1]
    }
}

# Function å®Ÿè¡Œ
$server_lists = New-Object "System.String[,]" 4,2
$server_lists[0,0] = 'localhost'
$server_lists[0,1] = '8080'
$server_lists[1,0] = 'localhost'
$server_lists[1,1] = '8000'
$server_lists[2,0] = 'google.com'
$server_lists[2,1] = '443'
$server_lists[3,0] = 'smtp.google.com'
$server_lists[3,1] = '25'
CheckPortMultipleServers $server_lists
```

https://zenn.dev/haretokidoki/articles/2d0b0dcd503c2e

```powershell:
Function ShowStrings {
    Param (
        [System.Object[]]$strings
    )
    
    # ãƒã‚¤ãƒˆæ•°ï¼ˆShift JISï¼‰ã«å¤‰æ›
    # [System.Object[]]$to_bytes = $strings
    # â†‘ ã“ã‚Œã ã¨åŒã˜ãƒ¡ãƒ¢ãƒªã‚’å‚ç…§ã—ã¦ã„ã‚‹ç‚ºã€$to_bytesã‚’å¤‰æ›ã™ã‚‹éš›ã«ä¸€ç·’ã«$stringsã‚‚å¤‰æ›ã•ã‚Œã¦ã—ã¾ã†ã€‚
    # ã€€ å¤‰æ›å‰ ã¨ å¤‰æ›å¾Œ ã‚’æ¯”è¼ƒã—ãŸã„ç‚ºã€Closeãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã€‚
    [System.Object[]]$to_bytes = $strings.Clone()
    [System.Int32]$i = 0
    [System.Int32]$max_length = 0
    for ($i = 0; $i -lt $to_bytes.Count; $i++) {
        $to_bytes[$i] = [System.Text.Encoding]::GetEncoding("shift_jis").GetByteCount($to_bytes[$i])
        if ($max_length -lt $to_bytes[$i]) {
            $max_length = $to_bytes[$i]
        }
    }

    Write-Host ' ============ å¤‰æ›å‰ ============ '
    Write-Host ''
    Write-Host "${strings}"
    Write-Host ' ================================ '
    Write-Host ''
    Write-Host ''
    Write-Host ' ============ å¤‰æ›å¾Œ ============ '
    Write-Host ''
    Write-Host "${to_bytes}"
    Write-Host ' ================================ '
    Write-Host ''
    Write-Host ''

    # ã‚¿ãƒ–æ•°ã®è¨ˆç®— ã¨ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›
    [System.Int32]$tab_count = 0
    [System.Int32]$tab_width = 8
    Write-Host ' ============ å‡ºåŠ›çµæœ ============ '
    Write-Host ''
    for ($i = 0; $i -lt $to_bytes.Count; $i++) {
        # ã‚¿ãƒ–ã®æ•°ã‚’è¨ˆç®—ã—ã¾ã™
        # æœ€é•·ã®æ–‡å­—åˆ—ã¨ã®å·®åˆ†ã‚’ã‚¿ãƒ–ã®å¹…ã§å‰²ã‚Šã€åˆ‡ã‚Šä¸Šã’ã¾ã™
        $tab_count = [Math]::Ceiling(($max_length - [System.Int32]$to_bytes[$i]) / $tab_width)
        # æœ€ä½1ã¤ã¯ã‚¿ãƒ–ã‚’æŒ¿å…¥ã™ã‚‹ã‚ˆã†è¨­å®š
        if ($tab_count -eq 0) {
            $tab_count = 1
        }

        # æœ€çµ‚æ¡ã«æ”¹è¡Œãªã—ã§å…ˆé ­éƒ¨ã®æ–‡å­—åˆ—ã‚’å‡ºåŠ›
        Write-Host "æ–‡å­—åˆ— [$($strings[$i])]" -NoNewline
        Write-Host ("`t" * $tab_count) -NoNewline
        # æœ€çµ‚æ¡ã«æ”¹è¡Œã‚ã‚Šã§ç¶šãæ–‡å­—åˆ—ã‚’å‡ºåŠ›
        Write-Host "ã€ãƒã‚¤ãƒˆæ•°ï¼ˆShift-JISï¼‰[$($to_bytes[$i])] byte"
    }
    Write-Host ' ================================ '
    Write-Host ''
    Write-Host ''
}

# Functionå®Ÿè¡Œ
$strings = @("1234567890", "ã‚", "ï½±", "123456789012345678901234567890", "abcdefg")
CalculationTabcount $strings
```

https://zenn.dev/haretokidoki/articles/3df8f03faeac28

```powershell:
#################################################################################
# å‡¦ç†åã€€ | GetSjisCount
# æ©Ÿèƒ½ã€€ã€€ | æ–‡å­—åˆ—å…¨ä½“ã®ãƒã‚¤ãƒˆæ•°ã‚’Shift JISã§å–å¾—
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Int32ï¼ˆæ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ï¼‰
# å¼•æ•°ã€€ã€€ | target_str: å¯¾è±¡æ–‡å­—åˆ—
#################################################################################
Function GetSjisCount {
    Param (
        [System.String]$target_str
    )

    # æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’SJISã§è¨­å®š
    $encoding = [System.Text.Encoding]::GetEncoding("Shift_JIS")

    # æ–‡å­—åˆ—ã®ãƒã‚¤ãƒˆæ•°ã‚’è¿”ã™
    return $encoding.GetByteCount($target_str)
}

# Functionå®Ÿè¡Œ
GetSjisCount 'é …ç›®0001  '
```

```powershell:
#################################################################################
# å‡¦ç†åã€€ | ExtractByteSubstring
# æ©Ÿèƒ½ã€€ã€€ | ãƒã‚¤ãƒˆæ•°ã§æ–‡å­—åˆ—ã‚’æŠ½å‡º
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | Stringï¼ˆæŠ½å‡ºã—ãŸæ–‡å­—åˆ—ï¼‰
# å¼•æ•°ã€€ã€€ | target_str: å¯¾è±¡æ–‡å­—åˆ—
# ã€€ã€€ã€€ã€€ | start     : æŠ½å‡ºé–‹å§‹ã™ã‚‹ãƒã‚¤ãƒˆä½ç½®
# ã€€ã€€ã€€ã€€ | length    : æŒ‡å®šãƒã‚¤ãƒˆæ•°
#################################################################################
Function ExtractByteSubstring {
    Param (
        [System.String]$target_str,
        [System.Int32]$start,
        [System.Int32]$length
    )

    $encoding = [System.Text.Encoding]::GetEncoding("Shift_JIS")

    # æ–‡å­—åˆ—ã‚’ãƒã‚¤ãƒˆé…åˆ—ã«å¤‰æ›
    [System.Byte[]]$all_bytes = $encoding.GetBytes($target_str)

    # æŠ½å‡ºã™ã‚‹ãƒã‚¤ãƒˆé…åˆ—ã‚’åˆæœŸåŒ–
    $extracted_bytes = New-Object Byte[] $length

    # æŒ‡å®šã•ã‚ŒãŸãƒã‚¤ãƒˆä½ç½®ã‹ã‚‰ãƒã‚¤ãƒˆé…åˆ—ã‚’æŠ½å‡º
    [System.Array]::Copy($all_bytes, $start, $extracted_bytes, 0, $length)

    # æŠ½å‡ºã—ãŸãƒã‚¤ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æ–‡å­—åˆ—ã¨ã—ã¦è¿”ã™
    return $encoding.GetString($extracted_bytes)
}

# Functionå®Ÿè¡Œ
# 4ãƒã‚¤ãƒˆç›®ã¨5ãƒã‚¤ãƒˆç›®ã®é–“ï¼ˆ$start = 4ï¼‰ã‚’é–‹å§‹ä½ç½®ã¨ã—ã¦4ãƒã‚¤ãƒˆåˆ†ï¼ˆ$length = 4ï¼‰ã®æ–‡å­—åˆ—ã‚’æŠ½å‡º
ExtractByteSubstring '1234ã‚ã‹' 4 4
```

https://zenn.dev/haretokidoki/articles/31ad6dfc204e38

```powershell:
# Functionã®å®šç¾©
Function PingRepeat{
    param(
        [System.String]$target_host = 'localhost',
        [System.Int32]$interval = 1000
    )
    # ãƒ–ãƒ¬ãƒ¼ã‚¯é€ä¿¡ã•ã‚Œã‚‹ã¾ã§ç¹°ã‚Šè¿”ã—
    while ($true) {
        try {
            # pingå®Ÿè¡Œ
            [Microsoft.PowerShell.Commands.TestConnectionCommand+PingStatus]$ping_data = Test-Connection $target_host -Count 1 -ErrorAction Stop
            # ç”»é¢ã«çµæœè¡¨ç¤º
            [System.String]$now_datetime = Get-Date -Format "yyyy/MM/dd HH:mm:ss.fff"
            # ResponseTimeãŒ0ã®å ´åˆã€nullã«ãªã‚‹ãŸã‚åˆ¤å®šã™ã‚‹
            if ($null -eq $ping_data.ResponseTime) {
                # ResponseTImeãŒnullã®å ´åˆã¯ã€å›ºå®šå€¤"0 ms"
                Write-Output "$now_datetime, $target_host, 0 ms"
            }
            else {
                # nullã§ã¯ãªã„å ´åˆã€å–å¾—ã—ãŸå€¤ã‚’è¨­å®š
                Write-Output "$now_datetime, $target_host, $($ping_data.ResponseTime) ms"
            }
        }
        catch {
            Write-Host "ã‚¨ãƒ©ãƒ¼ï¼š$($_.Exception.Message)" -ForegroundColor Red
            # ã€Œping -tã€ã®æŒ™å‹•ã«åˆã‚ã›ã€pingç–é€šãŒå–ã‚Œãªãã¦ã‚‚å‡¦ç†ã‚’ç¶šè¡Œã™ã‚‹ã€‚
            # ã‚‚ã—ã€NGã¨ãªã£ãŸå ´åˆã«å‡¦ç†ã‚’ä¸­æ–­ã—ãŸã„å ´åˆã¯ã€ã“ã“ã§ã€Œbreakã€ã‚’å®Ÿè¡Œã€‚
            # break
        }
        # é–“éš”ã‚’ã‚ã‘ã‚‹
        Start-Sleep -Milliseconds $interval
    }
}

# Functionå®Ÿè¡Œ
PingRepeat www.bing.com
```

https://zenn.dev/haretokidoki/articles/84aea5bddf2dd6

```powershell:
# é–¢æ•°ã¨ã—ã¦å®šç¾©
Function Invoke-MultipleCommands {
    Param (
        # å¿…é ˆé …ç›®ï¼šå®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆãŒã‚ã‚‹æ–‡å­—åˆ—é…åˆ—ç”¨ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼
        [Parameter(Mandatory=$true)]
        [System.String[]]$commands
    )
    # é…åˆ—å†…ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ç¹°ã‚Šè¿”ã—å‡¦ç†ã§å®Ÿè¡Œ
    foreach ($command in $commands) {
        # æ–‡å­—åˆ—ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã«å¤‰æ›
        [System.Management.Automation.ScriptBlock]$scriptblock = [ScriptBlock]::Create($command)
        # ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã‚’å®Ÿè¡Œ
        Invoke-Command -ScriptBlock $scriptblock
    }
}

# Functionã‚’å‘¼ã³å‡ºã™
Invoke-MultipleCommands -commands @('Get-Date', 'Get-Item .\', 'Get-PSDrive C')
```

https://zenn.dev/haretokidoki/articles/962a7fc6c51b47

```powershell:
# æ–‡å­—ã‚³ãƒ¼ãƒ‰ã®åˆ¤å®š
Function Get-PsEncoding {
	Param (
		[Parameter(Mandatory=$true)][System.String]$targetfile
	)
	$stream_reader = [System.IO.StreamReader] $targetfile
	$profile_encoding = $stream_reader.CurrentEncoding
	$stream_reader.Close()

	Write-Host "EncodingName: [$($profile_encoding.EncodingName)]"
}
```

```powershell:
Function Check-BOMStatus {
    Param (
        [Parameter(Mandatory=$true)][System.String]$targetfile
    )
    if (-Not (Test-Path $targetfile)) {
        Write-Host 'The target file does not exist.' -ForegroundColor Red
        return
    }
    
    # BOMã®ãƒã‚¤ãƒˆã‚·ãƒ¼ã‚±ãƒ³ã‚¹
    $UTF7_BOM1 = [System.Byte[]](0x2B,0x2F,0x76,0x38)
    $UTF7_BOM2 = [System.Byte[]](0x2B,0x2F,0x76,0x39)
    $UTF7_BOM3 = [System.Byte[]](0x2B,0x2F,0x76,0x2B)
    $UTF7_BOM4 = [System.Byte[]](0x2B,0x2F,0x76,0x2F)
    $UTF8_BOM = [System.Byte[]](0xEF,0xBB,0xBF)
    $UTF16BE_BOM = [System.Byte[]](0xFE,0xFF)
    $UTF16LE_BOM = [System.Byte[]](0xFF,0xFE)
    $UTF32BE_BOM = [System.Byte[]](0x00,0x00,0xFE,0xFF)
    $UTF32LE_BOM = [System.Byte[]](0xFF,0xFE,0x00,0x00)
    
    # å…ˆé ­è¡Œã‚’ãƒã‚¤ãƒˆã§èª­ã¿è¾¼ã¿å…ˆé ­ã‹ã‚‰3ãƒã‚¤ãƒˆåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    [System.Byte[]]$first_4bytes = (Get-Content -Path $targetfile -Encoding Byte -TotalCount 4)
    [System.Byte[]]$first_3bytes = $first_4bytes[0..2]
    [System.Byte[]]$first_2bytes = $first_4bytes[0..1]
    
    # å…ˆé ­ãƒã‚¤ãƒˆã§BOMä»˜ãã‹åˆ¤å®š
    # UTF-7
    if (($null -eq (Compare-Object $first_4bytes $UTF7_BOM1 -SyncWindow 0)) -Or
        ($null -eq (Compare-Object $first_4bytes $UTF7_BOM2 -SyncWindow 0)) -Or
        ($null -eq (Compare-Object $first_4bytes $UTF7_BOM3 -SyncWindow 0)) -Or
        ($null -eq (Compare-Object $first_4bytes $UTF7_BOM4 -SyncWindow 0))) {
        Write-Host "[$($targetfile)] is UTF-7 BOM."
    }
    # UTF-8
    elseif ($null -eq (Compare-Object $first_3bytes $UTF8_BOM -SyncWindow 0)) {
        Write-Host "[$($targetfile)] is UTF-8 BOM."
    }
    # UTF-16 BE
    elseif ($null -eq (Compare-Object $first_2bytes $UTF16BE_BOM -SyncWindow 0)) {
        Write-Host "[$($targetfile)] is UTF-16 BE BOM."
    }
    # UTF-16 LE
    elseif ($null -eq (Compare-Object $first_2bytes $UTF16LE_BOM -SyncWindow 0)) {
        Write-Host "[$($targetfile)] is UTF-16 LE BOM."
    }
    # UTF-32 BE
    elseif ($null -eq (Compare-Object $first_4bytes $UTF32BE_BOM -SyncWindow 0)) {
        Write-Host "[$($targetfile)] is UTF-32 BE BOM."
    }
    # UTF-32 LE
    elseif ($null -eq (Compare-Object $first_4bytes $UTF32LE_BOM -SyncWindow 0)) {
        Write-Host "[$($targetfile)] is UTF-32 LE BOM."
    }
    else {
        Write-Host "[$($targetfile)] is not BOM." -ForegroundColor Red
    }
}
```

https://zenn.dev/haretokidoki/articles/1632e92c37ea98

```powershell:
Function Get-Datatype {
	Param (
	    [Parameter(Mandatory=$true)]$variable
	)

    # æ–‡å­—åˆ—é…åˆ—ã‚’å®£è¨€
	[System.String[]]$rowdata = @(
		$variable.GetType().BaseType.FullName,      # å¤‰æ•°ã®ãƒ™ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—
		$variable.GetType().FullName                # å¤‰æ•°ã®ãƒ‡ãƒ¼ã‚¿å‹
	)
	
    # PSCustomObjectã§é …ç›®åã‚’è¨­å®š
	$types_table = [PSCustomObject]@{
		BaseType = $rowdata[0]
		DataType = $rowdata[1]
	}

    # ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§è¡¨ç¤º
    $types_table | Format-Table -Property BaseType, DataType -AutoSize -Wrap
}
```

https://zenn.dev/haretokidoki/articles/67788ca9b47b27

```powershell:
# ç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã—ã¦ã„ã‚‹ã‹ç¢ºèªï¼ˆTrueã®å ´åˆã€â€œç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œâ€ã—ã¦ã„ã‚‹ã¨åˆ¤æ–­ï¼‰
Function isAdminPowerShell {
    $win_id = [System.Security.Principal.WindowsIdentity]::GetCurrent()
    $win_principal = new-object System.Security.Principal.WindowsPrincipal($win_id)
    $admin_permission = [System.Security.Principal.WindowsBuiltInRole]::Administrator
    return $win_principal.IsInRole($admin_permission)
}
# ç¾åœ¨ã€è¨­å®šã—ã¦ã„ã‚‹æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
Function GetPsCharcode {
    [System.String[]]$ps_charcode = @()
    $ps_charcode = @(
        # ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã™ã‚‹æ–‡å­—ã‚³ãƒ¼ãƒ‰ã®è¦å®šå€¤
        ($PSDefaultParameterValues['*:Encoding']),
        # PowerShellã‹ã‚‰å¤–éƒ¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«æ¸¡ã™æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®è¨­å®š
        ($global:OutputEncoding).WebName,
        # PowerShellã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã™ã‚‹æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®è¨­å®š
        ([console]::OutputEncoding).WebName
    )

    return $ps_charcode
}
# PowerShellã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´
Function ChangeWindowTitle {
    # åŒºåˆ‡ã‚Šæ–‡å­—ã®è¨­å®š
    [System.String]$pos1 = '|'
    [System.String]$pos2 = ';'

    # ç¾åœ¨ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å–å¾—
    [System.String]$title = $Host.UI.RawUI.WindowTitle
    [System.String]$base_title = $title

    # ã™ã§ã«ã“ã®Functionã§ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´ã—ã¦ã„ã‚‹å ´åˆã€ä¸€ç•ªå·¦ã«ã‚ã‚‹å…ƒã®ã‚¿ã‚¤ãƒˆãƒ«åã®ã¿æŠ½å‡º
    [System.String[]]$title_array = $title.Split($pos1)
    if ($title_array.Length -ne 0) {
        $base_title = ($title_array[0]).TrimEnd()
    }

    # ç¾åœ¨ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
    [System.String[]]$ps_charcode = GetPsCharcode

    # ç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã—ã¦ã„ã‚‹ã‹ã«ã‚ˆã‚Šè¨­å®šã™ã‚‹ã‚¿ã‚¤ãƒˆãƒ«åã‚’åˆ†å²
    [System.String]$change_title = $base_title
    if (isAdminPowerShell) {
        # PowerShellã‚’ç®¡ç†è€…ã¨ã—ã¦å®Ÿè¡Œã—ã¦ã„ã‚‹å ´åˆ
        $change_title = $base_title + " $pos1 " +
                        "DefaultParameter='$($ps_charcode[0])'" + " $pos2 " +
                        "GlobalEncoding='$($ps_charcode[1])'" + " $pos2 " +
                        "ConsoleEncoding='$($ps_charcode[2])'" + " $pos2 " +
                        "#Administrator"
    }
    else {
        # ã—ã¦ã„ãªã„å ´åˆ
        $change_title = $base_title + " $pos1 " +
                        "DefaultParameter='$($ps_charcode[0])'" + " $pos2 " +
                        "GlobalEncoding='$($ps_charcode[1])'" + " $pos2 " +
                        "ConsoleEncoding='$($ps_charcode[2])'" + " $pos2 " +
                        "#Not_Administrator"
    }
    $Host.UI.RawUI.WindowTitle = $change_title

    # å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    Write-Host 'ã‚¿ã‚¤ãƒˆãƒ«ã«â€œæ–‡å­—ã‚³ãƒ¼ãƒ‰â€ã¨â€œç®¡ç†è€…æ¨©é™ã®æœ‰ç„¡â€ã®æƒ…å ±ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚' -ForegroundColor Cyan
}
```

https://zenn.dev/haretokidoki/articles/8946231076f129

```powershell:
Function SetPsOutputEncoding {
    Param (
        [System.String]$charcode = 'reset_encoding'
    )

    switch ($charcode) {
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’UTF8ã«è¨­å®šã™ã‚‹
        'utf8' {
            $PSDefaultParameterValues['*:Encoding'] = 'utf8'
            $global:OutputEncoding = [System.Text.Encoding]::UTF8
            [console]::OutputEncoding = [System.Text.Encoding]::UTF8
        }
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’Shift JISï¼ˆSJISï¼‰ã«è¨­å®šã™ã‚‹
        'sjis' {
            # $PSDefaultParameterValues['*:Encoding'] = 'default'ã«ã¤ã„ã¦
            #   ã“ã®è¨­å®šã¯Coreä»¥å¤–ï¼ˆ5.1ä»¥å‰ï¼‰ã®ç’°å¢ƒã§ã®ã¿Shift JISã§è¨­å®šã•ã‚Œã‚‹ã€‚
            #   Coreç’°å¢ƒã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯ã€UTF-8ã§ã‚ã‚ŠUTF-8ã§è¨­å®šã•ã‚Œã¦ã—ã¾ã†ã€‚
            #   ã¾ãŸã€Shift JISã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚‚å­˜åœ¨ã—ãªã„ç‚ºã€Coreç’°å¢ƒã§Shift JISã®è¨­å®šã¯ä¸å¯ã¨ãªã‚‹ã€‚
            $PSDefaultParameterValues['*:Encoding'] = 'default'
            $global:OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
            [console]::OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
        }
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ASCIIã«è¨­å®šã™ã‚‹
        'ascii' {
            $PSDefaultParameterValues.Remove('*:Encoding')
            $global:OutputEncoding = [System.Text.Encoding]::ASCII
            [console]::OutputEncoding = [System.Text.Encoding]::ASCII
        }
        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æŒ‡å®šã‚’è§£é™¤ã™ã‚‹
        'rm_encoding' {
            $PSDefaultParameterValues.Remove('*:Encoding')
        }
        # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰è¨­å®šã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
        'reset_encoding' {
            $PSDefaultParameterValues.Remove('*:Encoding')

            If ($PSVersionTable.PSEdition -eq 'Core') {
                # Core ã®å ´åˆ
                $global:OutputEncoding = [System.Text.Encoding]::UTF8
                [console]::OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
            }
            else {
                # Core ä»¥å¤–ã®å ´åˆï¼ˆPowerShell 5.1 ä»¥å‰ï¼‰
                $global:OutputEncoding = [System.Text.Encoding]::ASCII
                [console]::OutputEncoding = [System.Text.Encoding]::GetEncoding('shift_jis')
            }
        }
    }
}

# å®Ÿè¡Œãƒ†ã‚¹ãƒˆ
SetPsOutputEncoding 'utf8'
```

https://zenn.dev/haretokidoki/articles/aea5b45679d966

```powershell:
Function Get-PyEncoding {
    Param (
        [Parameter(Mandatory=$true)][System.String]$targetfile
    )

    # python ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
    if (-Not(Get-Command 'python' -ErrorAction SilentlyContinue)) {
        Write-Host 'Python is not install.' -ForegroundColor Red
        return
    }

    # å­˜åœ¨ãƒã‚§ãƒƒã‚¯
    if (-Not(Test-Path $targetfile)) {
        Write-Host "[$targetfile] does not exist." -ForegroundColor Red
        return
    }

    # çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›
    [System.String]$fullpath_targetfile = (Convert-Path $targetfile)
    
    # ãƒ‡ãƒ¼ã‚¿ç¨®é¡ã®ãƒã‚§ãƒƒã‚¯
    if (-Not(Test-Path $fullpath_targetfile -PathType Leaf)) {
        Write-Host "[$fullpath_targetfile] is not a file." -ForegroundColor Red
        return
    }

    # Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã‚³ãƒ¼ãƒ‰
    [System.String[]]$py_source = 
@"
import subprocess
import sys

# chardet ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
try:
    import chardet
except ImportError:
    subprocess.check_call([sys.executable, '-m', 'pip', 'install', 'chardet', '--user'])
    import chardet

# æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’åˆ¤å®šã™ã‚‹Function
def determine_encoding(file_path):
    with open(file_path, 'rb') as file:
        raw_data = file.read()
        result = chardet.detect(raw_data)
        print(f"Detected encoding for [{file_path}] is {result['encoding']} with {result['confidence']*100}% confidence.")

# ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã®å¼•æ•°ã‚’å–å¾—
file_path = sys.argv[1]

# å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®æ–‡å­—åˆ—ã‚’åˆ¤å®š
determine_encoding(file_path)

"@ -split "`r`n"

    # Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æº–å‚™
    #   Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ ¼ç´ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãŒãªã„å ´åˆã¯ã€æ–°è¦ä½œæˆ
    [System.String]$pyfolder_path = "$PROFILE\..\user-defined-py"
    if (-Not(Test-Path $pyfolder_path)) {
        New-Item -Path $pyfolder_path -ItemType 'directory' -Force > $null
    }
    $pyfolder_path = (Convert-Path $pyfolder_path)
    #   ä»Šå›å®Ÿè¡Œã™ã‚‹Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒãªã„å ´åˆã¯ã€æ–°è¦ä½œæˆ
    [System.String]$pyscript_path = "$pyfolder_path\chardet_runner.py"
    if (-Not(Test-Path $pyscript_path)) {
        $utf8Encoding = New-Object System.Text.UTF8Encoding
        [System.IO.File]::WriteAllText($pyscript_path, $py_source, $utf8Encoding)
    }

    # Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ
    try {
        python $pyscript_path $fullpath_targetfile
    }
    catch {
        Write-Host 'Python script execution error.'
        return
    }
}
```

https://zenn.dev/haretokidoki/articles/cdaf8a77dfc892

```powershell:
# æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’å¯è¦–åŒ–ã™ã‚‹Function
Function VisualizeReturncode {
    Param (
        [Parameter(Mandatory=$true)][System.String]$Path,
        [ValidateSet('CRLF', 'LF')][System.String]$ReturnCode = 'CRLF'
    )

    [System.Collections.Hashtable]$ReturnCode_Regex = @{
        'CR'   = "`r"
        'LF'   = "`n"
        'CRLF' = "`r`n"
    }

    [System.Collections.Hashtable]$ReturnCode_Mark = @{
        'CR'   = '<CR>'
        'LF'   = '<LF>'
        'CRLF' = '<CRLF>'
    }

    # ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã™ã‚‹éš›ã®æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã€‚æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã¯å¼•æ•°ã§æŒ‡å®šã—ãŸ CRLF ã‹ LF ãŒå…¥ã‚‹ã€‚
    [System.Collections.Hashtable]$ReturnCode_Visualize = @{
        'CR'   = "<CR>$($ReturnCode_Regex[$Returncode])"
        'LF'   = "<LF>$($ReturnCode_Regex[$Returncode])"
        'CRLF' = "<CRLF>$($ReturnCode_Regex[$Returncode])"
    }

    # æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’ãƒãƒ¼ã‚¯ã«å¤‰æ›
    [System.String]$target_data = (Get-Content -Path $Path -Raw)
    $target_data = $target_data -Replace $ReturnCode_Regex['CRLF'], $ReturnCode_Mark['CRLF']
    $target_data = $target_data -Replace $ReturnCode_Regex['LF'], $ReturnCode_Mark['LF']
    $target_data = $target_data -Replace $ReturnCode_Regex['CR'], $ReturnCode_Mark['CR']

    # ãƒãƒ¼ã‚¯ã‹ã‚‰ãƒãƒ¼ã‚¯ï¼‹æ”¹è¡Œã‚³ãƒ¼ãƒ‰ï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«è¡¨ç¤ºç”¨ï¼‰ã«å¤‰æ›
    $target_data = $target_data -Replace $ReturnCode_Mark['CRLF'], $ReturnCode_Visualize['CRLF']
    $target_data = $target_data -Replace $ReturnCode_Mark['LF'], $ReturnCode_Visualize['LF']
    $target_data = $target_data -Replace $ReturnCode_Mark['CR'], $ReturnCode_Visualize['CR']

    Write-Host ''
    Write-Host ' *-- Result: VisualizeReturncode ---------------------------------------------* '
    Write-Host $target_data
    Write-Host ' *----------------------------------------------------------------------------* '
    Write-Host ''
    Write-Host ''
}

# æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›ã™ã‚‹Function
Function ReplaceReturncode {
    Param (
        # å¿…é ˆï¼šå¤‰æ›å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š
        [Parameter(Mandatory=$true)][System.String]$Path,
        # å¿…é ˆï¼šå¤‰æ›ã™ã‚‹å‰å¾Œã®æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®š
        [Parameter(Mandatory=$true)][ValidateSet('CR', 'LF', 'CRLF')][System.String]$BeforeCode,
        [Parameter(Mandatory=$true)][ValidateSet('CR', 'LF', 'CRLF', 'NONE')][System.String]$AfterCode,
        # ä»»æ„ï¼šå¤‰æ›å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã§ä¿å­˜ã—ãŸã„å ´åˆã«ä¿å­˜å…ˆã‚’æŒ‡å®š
        [System.String]$Destination='',
        # ä»»æ„ï¼šå¤‰æ›å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¯è¦–åŒ–ã—ã‚³ãƒ³ã‚½ãƒ¼ãƒ«è¡¨ç¤ºã—ãŸã„å ´åˆã«æŒ‡å®š
        [System.Boolean]$Show=$false
    )

    # Beforeãƒ»AfterãŒç•°ãªã‚‹æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
    if ($BeforeCode -eq $AfterCode) {
        Write-Host ''
        Write-Host 'å¼•æ•°ã§æŒ‡å®šã•ã‚ŒãŸ å¤‰æ›å‰ ã¨ å¤‰æ›å¾Œ ã®æ”¹è¡Œã‚³ãƒ¼ãƒ‰ãŒåŒä¸€ã§ã™ã€‚å¼•æ•°ã‚’è¦‹ç›´ã—ã¦ãã ã•ã„ã€‚'
        Write-Host ''
        Write-Host ''
        return
    }

    # ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆ
    if (-Not(Test-Path $Path)) {
        Write-Host ''
        Write-Host 'å¤‰æ›å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚'
        Write-Host ''
        Write-Host ''
        return
    }

    # ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ãŒãªã„å ´åˆ
    [System.String]$before_data = (Get-Content -Path $Path -Raw)
    if ($null -eq $before_data) {
        Write-Host ''
        Write-Host 'å¤‰æ›å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ãŒç©ºã§ã™ã€‚å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚'
        Write-Host ''
        Write-Host ''
        return
    }

    # æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
    [System.Collections.Hashtable]$ReturnCode_Regex = @{
        'CR'   = "`r"
        'LF'   = "`n"
        'CRLF' = "`r`n"
        'NONE' = ''
    }

    # æŒ‡å®šã—ãŸå¤‰æ›å‰å¾Œã®æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’æ­£è¦è¡¨ç¾ã®è¡¨è¨˜ã«å¤‰æ›´
    [System.String]$BeforeCode_regex = $ReturnCode_Regex[$BeforeCode]
    [System.String]$AfterCode_regex = $ReturnCode_Regex[$AfterCode]

    # å¤‰æ›å‡¦ç†
    [System.String]$after_data = ($before_data -Replace $BeforeCode_regex, $AfterCode_regex)
    
    # å¤‰æ›ã•ã‚Œãªã‹ã£ãŸå ´åˆ
    if ($null -eq (Compare-Object $before_data $after_data -SyncWindow 0)) {
        Write-Host ''
        Write-Host 'å‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã—ãŸãŒã€å¯¾è±¡ã®æ”¹è¡Œã‚³ãƒ¼ãƒ‰ãŒãªãå¤‰æ›ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚å‡¦ç†ã‚’çµ‚äº†ã—ã¾ã™ã€‚'
        Write-Host ''
        Write-Host ''
        return
    }
    # ä¿å­˜å…ˆã®æŒ‡å®šãŒãªã„å ´åˆã€ä¸Šæ›¸ãä¿å­˜
    if ($Destination -eq '') {
        $Destination = $Path
        Write-Host ''
        Write-Host 'ä¸Šæ›¸ãä¿å­˜ã—ã¾ã™ã€‚'
    }
    # ä¿å­˜å…ˆãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã§ä¿å­˜ï¼ˆåå‰ã‚’ä»˜ã‘ã¦ä¿å­˜ï¼‰
    else {
        if (Test-Path $Destination -PathType Leaf) {
            Write-Host ''
            Write-Host 'æŒ‡å®šã®ä¿å­˜å ´æ‰€ã«ã¯ã€ã™ã§ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã™ã€‚å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚' -ForegroundColor Red
            Write-Host ''
            Write-Host ''
            return
        }
        if (-Not(Test-Path "$Destination\.." -PathType Container)) {
            Write-Host ''
            Write-Host 'ä¿å­˜å ´æ‰€ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚' -ForegroundColor Red
            Write-Host ''
            Write-Host ''
            return
        }
        Write-Host ''
        Write-Host 'åå‰ã‚’ä»˜ã‘ã¦ä¿å­˜ã—ã¾ã™ã€‚'
    }
    # ä¿å­˜
    Try {
        Set-Content -Path $Destination -Value $after_data -NoNewline
    }
    catch {
        Write-Error 'ReplaceReturncodeã®ä¿å­˜å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å‡¦ç†ã‚’ä¸­æ–­ã—ã¾ã™ã€‚'
        return
    }
    [System.String]$savepath_full = Convert-Path $Destination
    Write-Host "ã€€ä¿å­˜å…ˆ: [$savepath_full]"
    Write-Host ''
    Write-Host ''
    
    # è¡¨ç¤º
    if ($Show) {
        VisualizeReturncode($Destination)
    }
}
```

`D:\Downloads\utf16.txt` ã‚’å¯¾è±¡ã«æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’ CRLF ã‹ã‚‰ LF ã«å¤‰æ›ã—ã¾ã™ã€‚
ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€Œ-Showã€ã‚’ `$True` ã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã—ã¦ã„ã‚‹ç‚ºã€è‡ªå‹•çš„ã«Function `VisualizeReturncode`ãŒå‘¼ã³å‡ºã•ã‚Œã¦ã€
å¤‰æ›ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’å¯è¦–åŒ–ã—ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã—ã¾ã™ã€‚

```powershell:
PS D:\Downloads> ReplaceReturncode .\utf16.txt CRLF LF -Show $True

ä¸Šæ›¸ãä¿å­˜ã—ã¾ã™ã€‚
ã€€ä¿å­˜å…ˆ: [D:\Downloads\utf16.txt]



 *-- Result: VisualizeReturncode ---------------------------------------------*
test<LF>
<LF>

 *----------------------------------------------------------------------------*


PS D:\Downloads>
```

https://zenn.dev/haretokidoki/articles/d2c98229b3ca95

```powershell:
# Function
Function Write-WingetShow {
    Param (
        [System.String[]]$targetIds
    )
    # æŠ½å‡ºå¯¾è±¡ã®æ–‡å­—åˆ—ã‚’æŒ‡å®š
    [System.String]$HitMessage = 'è¦‹ã¤ã‹ã‚Šã¾ã—ãŸ '
    [System.String]$InstallerType = '  ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®ç¨®é¡: '

    # æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’UTF-8ã«å¤‰æ›´
    [console]::OutputEncoding = [System.Text.Encoding]::UTF8

    # ã‚³ãƒãƒ³ãƒ‰çµæœã‹ã‚‰æŠ½å‡ºã—ã‚¢ãƒ—ãƒªåãƒ»IDãƒ»ã‚½ãƒ¼ã‚¹ã®ã¿ã‚’è¡¨ç¤º
    foreach ($id in $targetIds) {
        [System.String[]]$appInfo = (winget show --id $id)
        # æ¤œç´¢çµæœã‚ã‚Š
        if ($appInfo -match $HitMessage) {
            $appNameAndId = $appInfo | Select-String "$HitMessage.*" | ForEach-Object {
                $_.Matches[0].Value -replace "$HitMessage", ''
            }
            $appSource = $appInfo | Select-String "$InstallerType.*" | ForEach-Object {
                $_.Matches[0].Value -replace "$InstallerType", ''
            }
            Write-Host "$appNameAndId [$appSource]"
        }
        # æ¤œç´¢çµæœãªã—
        else {
            Write-Warning "è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ID: [$id]"
            # ä¸­æ–­ã™ã‚‹å ´åˆã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆè§£é™¤
            #return
        }
    }
}

# æ¤œç´¢å¯¾è±¡ã®IDã‚’é…åˆ—ã§æŒ‡å®š
$searchIds = @(
    'Microsoft.Edge',
    '1234567890AB',
    'XPFFZHVGQWWLHB',
    'Microsoft.VCLibs.Desktop.14'
)

# Function ã®å®Ÿè¡Œ
Write-WingetShow $searchIds
```

https://zenn.dev/haretokidoki/articles/fac8e50fbe9dcd

```powershell:
# ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ enumè¨­å®š
Add-Type -TypeDefinition @"
    public enum MESSAGECODE {
        Successful = 0,
        Abend,
        Cancel,
        Error_NotCore,
        Error_NotSupportedVersion,
        Error_NotWindows
    }
"@
#################################################################################
# å‡¦ç†åã€€ | VerificationEnv
# æ©Ÿèƒ½ã€€ã€€ | PowerShellç’°å¢ƒãƒã‚§ãƒƒã‚¯
#--------------------------------------------------------------------------------
# æˆ»ã‚Šå€¤ã€€ | MESSAGECODEï¼ˆenumï¼‰
# å¼•æ•°ã€€ã€€ | ãªã—
#################################################################################
Function VerificationEnv {
    [MESSAGECODE]$return_code = [MESSAGECODE]::Successful

    # ç’°å¢ƒæƒ…å ±ã‚’å–å¾—
    [System.Collections.Hashtable]$ps_ver = $PSVersionTable

    # ç’°å¢ƒã®åˆ¤å®šï¼šCoreã§ã¯ãªã„å ´åˆï¼ˆ5.1ã ã¨'Desktop'ã¨ãªã‚‹ï¼‰
    if ($ps_ver.PSEdition -ne 'Core') {
        $return_code = [MESSAGECODE]::Error_NotCore
        Write-Host 'Coreï¼ˆ6.0ä»¥é™ï¼‰ã®ç’°å¢ƒã§ã¯ãªã„' -ForegroundColor Red
    }
    # ç’°å¢ƒã®åˆ¤å®šï¼šãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ7ã‚ˆã‚Šå°ã•ã„å ´åˆ
    elseif ($ps_ver.PSVersion.Major -lt 7) {
        $return_code = [MESSAGECODE]::Error_NotSupportedVersion
        Write-Host 'Coreï¼ˆ6.0ä»¥é™ï¼‰ã®ç’°å¢ƒã ãŒã€7ä»¥ä¸Š ã®ç’°å¢ƒã§ã¯ãªã„' -ForegroundColor Red
    }
    # ç’°å¢ƒã®åˆ¤å®šï¼šWindows OSã§ã¯ãªã„å ´åˆï¼ˆPowerShell Coreã®ã¿ä½¿ç”¨ã§ãã‚‹è‡ªå‹•å¤‰æ•°ï¼‰
    elseif (-Not($IsWindows)) {
        $return_code = [MESSAGECODE]::Error_NotWindows
        Write-Host 'Coreï¼ˆ6.0ä»¥é™ï¼‰ã®ç’°å¢ƒã§ã€ã‹ã¤ 7ä»¥ä¸Š ã®ç’°å¢ƒã ãŒã€Windows OS ã®ç’°å¢ƒã§ã¯ãªã„' -ForegroundColor Red
    }
    else {
        Write-Host 'Coreï¼ˆ6.0ä»¥é™ï¼‰ã®ç’°å¢ƒã§ã€ã‹ã¤ 7ä»¥ä¸Š ã®ç’°å¢ƒã€Windows OS ã®ç’°å¢ƒã§ã‚ã‚‹'
    }

    return $return_code
}
```

## å‚è€ƒæƒ…å ±

https://zenn.dev/haretokidoki/articles/4da393f1f8d49d

## é–¢é€£è¨˜äº‹

https://haretokidoki-blog.com/pasocon_powershell-startup/
https://zenn.dev/haretokidoki/articles/7e6924ff0cc960
